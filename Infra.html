<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Infra - Junkman
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="Junkman" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:panlw.github.io ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; Junkman</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
       
       <li><a href="index.html">HOME</a></li>
    <li><a href="archives.html">Archives</a></li>
    <li><a href="about.html">ABOUT</a></li>

    <li><label>Categories</label></li>

        
            <li><a href="Infra.html">Infra</a></li>
        
            <li><a href="Coding.html">Coding</a></li>
        
            <li><a href="Solution.html">Solution</a></li>
        
            <li><a href="Archtect.html">Archtect</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
	$(function(){
		$('#menu_item_index').addClass('is_active');
	});
</script>
<div class="row">
	<div class="large-8 medium-8 columns">
		<div class="markdown-body home-categories">
		
			<div class="article">
                <a class="clearlink" href="15243906809509.html">
                
                  <h1>curl 网站开发指南</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<blockquote>
<p><a href="http://www.ruanyifeng.com/blog/2011/09/curl.html">http://www.ruanyifeng.com/blog/2011/09/curl.html</a><br/>
作者： <a href="http://www.ruanyifeng.com/">阮一峰</a> 日期： <a href="http://www.ruanyifeng.com/blog/2011/09/">2011年9月 4日</a></p>
</blockquote>

<p><a href="http://curl.haxx.se/">curl</a>是一种命令行工具，作用是发出网络请求，然后得到和提取数据，显示在&quot;标准输出&quot;（stdout）上面。<br/>
它支持多种协议，下面举例讲解如何将它用于网站开发。</p>

<h3 id="toc_0"><strong>一、查看网页源码</strong></h3>

<p>直接在curl命令后加上网址，就可以看到网页源码。我们以网址www.sina.com为例（选择该网址，主要因为它的网页代码较短）：</p>

<pre><code>  $ curl www.sina.com
  &lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;
  &lt;html&gt;&lt;head&gt;
  &lt;title&gt;301 Moved Permanently&lt;/title&gt;
  &lt;/head&gt;&lt;body&gt;
  &lt;h1&gt;Moved Permanently&lt;/h1&gt;
  &lt;p&gt;The document has moved &lt;a href=&quot;http://www.sina.com.cn/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
  &lt;/body&gt;&lt;/html&gt;
</code></pre>

<p>如果要把这个网页保存下来，可以使用<code>-o</code>参数，这就相当于使用wget命令了。</p>

<pre><code>  $ curl -o [文件名] www.sina.com
</code></pre>

<h3 id="toc_1"><strong>二、自动跳转</strong></h3>

<p>有的网址是自动跳转的。使用<code>-L</code>参数，curl就会跳转到新的网址。</p>

<pre><code>  $ curl -L www.sina.com
</code></pre>

<p>键入上面的命令，结果就自动跳转为www.sina.com.cn。</p>

<h3 id="toc_2"><strong>三、显示头信息</strong></h3>

<p><code>-i</code>参数可以显示http response的头信息，连同网页代码一起。</p>

<pre><code>  $ curl -i www.sina.com
  HTTP/1.0 301 Moved Permanently
  Date: Sat, 03 Sep 2011 23:44:10 GMT
  Server: Apache/2.0.54 (Unix)
  Location: http://www.sina.com.cn/
  Cache-Control: max-age=3600
  Expires: Sun, 04 Sep 2011 00:44:10 GMT
  Vary: Accept-Encoding
  Content-Length: 231
  Content-Type: text/html; charset=iso-8859-1
  Age: 3239
  X-Cache: HIT from sh201-9.sina.com.cn
  Connection: close
  
  &lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;
   &lt;html&gt;&lt;head&gt;
   &lt;title&gt;301 Moved Permanently&lt;/title&gt;
   &lt;/head&gt;&lt;body&gt;
   &lt;h1&gt;Moved Permanently&lt;/h1&gt;
   &lt;p&gt;The document has moved &lt;a href=&quot;http://www.sina.com.cn/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
   &lt;/body&gt;&lt;/html&gt;
</code></pre>

<p><code>-I</code>参数则是只显示http response的头信息。</p>

<h3 id="toc_3"><strong>四、显示通信过程</strong></h3>

<p><code>-v</code>参数可以显示一次http通信的整个过程，包括端口连接和http request头信息。</p>

<pre><code>  $ curl -v www.sina.com
  * About to connect() to www.sina.com port 80 (#0)
  * Trying 61.172.201.195... connected
  * Connected to www.sina.com (61.172.201.195) port 80 (#0)
  &gt; GET / HTTP/1.1
  &gt; User-Agent: curl/7.21.3 (i686-pc-linux-gnu) libcurl/7.21.3 OpenSSL/0.9.8o zlib/1.2.3.4 libidn/1.18
  &gt; Host: www.sina.com
  &gt; Accept: */*
  &gt; 
  * HTTP 1.0, assume close after body
  &lt; HTTP/1.0 301 Moved Permanently
  &lt; Date: Sun, 04 Sep 2011 00:42:39 GMT
  &lt; Server: Apache/2.0.54 (Unix)
  &lt; Location: http://www.sina.com.cn/
  &lt; Cache-Control: max-age=3600
  &lt; Expires: Sun, 04 Sep 2011 01:42:39 GMT
  &lt; Vary: Accept-Encoding
  &lt; Content-Length: 231
  &lt; Content-Type: text/html; charset=iso-8859-1
  &lt; X-Cache: MISS from sh201-19.sina.com.cn
  &lt; Connection: close
  &lt; 
  &lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;
  &lt;html&gt;&lt;head&gt;
  &lt;title&gt;301 Moved Permanently&lt;/title&gt;
  &lt;/head&gt;&lt;body&gt;
  &lt;h1&gt;Moved Permanently&lt;/h1&gt;
  &lt;p&gt;The document has moved &lt;a href=&quot;http://www.sina.com.cn/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
  &lt;/body&gt;&lt;/html&gt;
  * Closing connection #0
</code></pre>

<p>如果你觉得上面的信息还不够，那么下面的命令可以查看更详细的通信过程。</p>

<pre><code>  $ curl --trace output.txt www.sina.com
</code></pre>

<p>或者</p>

<pre><code>  $ curl --trace-ascii output.txt www.sina.com
</code></pre>

<p>运行后，请打开output.txt文件查看。</p>

<h3 id="toc_4"><strong>五、发送表单信息</strong></h3>

<p>发送表单信息有GET和POST两种方法。GET方法相对简单，只要把数据附在网址后面就行。</p>

<pre><code>  $ curl example.com/form.cgi?data=xxx
</code></pre>

<p>POST方法必须把数据和网址分开，curl就要用到--data参数。</p>

<pre><code>  $ curl -X POST --data &quot;data=xxx&quot; example.com/form.cgi
</code></pre>

<p>如果你的数据没有经过表单编码，还可以让curl为你编码，参数是<code>--data-urlencode</code>。</p>

<pre><code>  $ curl -X POST--data-urlencode &quot;date=April 1&quot; example.com/form.cgi
</code></pre>

<h3 id="toc_5"><strong>六、HTTP动词</strong></h3>

<p>curl默认的HTTP动词是GET，使用<code>-X</code>参数可以支持其他动词。</p>

<pre><code>  $ curl -X POST www.example.com
  $ curl -X DELETE www.example.com
</code></pre>

<h3 id="toc_6"><strong>七、文件上传</strong></h3>

<p>假定文件上传的表单是下面这样：</p>

<pre><code>  &lt;form method=&quot;POST&quot; enctype=&#39;multipart/form-data&#39; action=&quot;upload.cgi&quot;&gt;
    &lt;input type=file name=upload&gt;
    &lt;input type=submit name=press value=&quot;OK&quot;&gt;
  &lt;/form&gt;
</code></pre>

<p>你可以用curl这样上传文件：</p>

<pre><code>  $ curl --form upload=@localfilename --form press=OK [URL]
</code></pre>

<h3 id="toc_7"><strong>八、Referer字段</strong></h3>

<p>有时你需要在http request头信息中，提供一个referer字段，表示你是从哪里跳转过来的。</p>

<pre><code>  $ curl --referer http://www.example.com http://www.example.com
</code></pre>

<h3 id="toc_8"><strong>九、User Agent字段</strong></h3>

<p>这个字段是用来表示客户端的设备信息。服务器有时会根据这个字段，针对不同设备，返回不同格式的网页，比如手机版和桌面版。<br/>
iPhone4的User Agent是</p>

<pre><code>  Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_0 like Mac OS X; en-us) AppleWebKit/532.9 (KHTML, like Gecko) Version/4.0.5 Mobile/8A293 Safari/6531.22.7
</code></pre>

<p>curl可以这样模拟：</p>

<pre><code>  $ curl --user-agent &quot;[User Agent]&quot; [URL]
</code></pre>

<h3 id="toc_9"><strong>十、cookie</strong></h3>

<p>使用<code>--cookie</code>参数，可以让curl发送cookie。</p>

<pre><code>  $ curl --cookie &quot;name=xxx&quot; www.example.com
</code></pre>

<p>至于具体的cookie的值，可以从http response头信息的<code>Set-Cookie</code>字段中得到。<br/>
<code>-c cookie-file</code>可以保存服务器返回的cookie到文件，<code>-b cookie-file</code>可以使用这个文件作为cookie信息，进行后续的请求。</p>

<pre><code>  $ curl -c cookies http://example.com
  $ curl -b cookies http://example.com
</code></pre>

<h3 id="toc_10"><strong>十一、增加头信息</strong></h3>

<p>有时需要在http request之中，自行增加一个头信息。<code>--header</code>参数就可以起到这个作用。</p>

<pre><code>  $ curl --header &quot;Content-Type:application/json&quot; http://example.com
</code></pre>

<h3 id="toc_11"><strong>十二、HTTP认证</strong></h3>

<p>有些网域需要HTTP认证，这时curl需要用到<code>--user</code>参数。</p>

<pre><code>  $ curl --user name:password example.com
</code></pre>

<h2 id="toc_12"><strong>参考资料</strong></h2>

<ul>
<li><a href="http://curl.haxx.se/docs/httpscripting.html">Using cURL to automate HTTP jobs</a></li>
<li><a href="http://bbs.et8.net/bbs/showthread.php?t=568472">教你学用CURL</a></li>
<li><a href="https://httpkit.com/resources/HTTP-from-the-Command-Line/">9 uses for cURL worth knowing</a></li>
</ul>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2018/4/22</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Network.html'>Network</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="adblo.html">
                
                  <h1>撰写 Adblock Plus 过滤规则</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<blockquote>
<p><a href="https://adblockplus.org/zh_CN/filters">https://adblockplus.org/zh_CN/filters</a></p>
</blockquote>

<p>当前的 Adblock Plus 版本允许您通过许多不同的方法来优化过滤规则。本文档就是告诉您如何做。</p>

<p><u>声明</u>：这里给出的过滤规则只是示例，不一定能直接使用。</p>

<h2 id="toc_0">AdBlock Plus 过滤规则介绍</h2>

<p>本章节描述的过滤规则属性，对偶尔才写过滤规则的用户来说足矣。</p>

<h3 id="toc_1">基本过滤规则</h3>

<p>最简单的过滤规则当然就是您想阻挡的横幅广告地址，但是这些地址常常会在您每次打开页面时改变。例如： <code>http://example.com/ads/banner123.gif</code>，其中 123 是一个随机数字。在这里阻挡整个图片地址是没用的，您需要创建一条更通用的过滤规则 —— 如 <code>http://example.com/ads/banner*.gif</code>。或者更为通用一些的，如 <code>http://example.com/ads/*</code>。</p>

<p><u>注</u>：不要使用通配符来代替过多的字符。过滤规则 <code>http://example.com/*</code> 固然可以阻挡所有的横幅广告， 但也会阻挡 example.com 下其它一些您想看的内容。</p>

<h3 id="toc_2">定义例外规则</h3>

<p>有时您可能会发现某个过滤规则平时挡广告挡得很好，但在某些情况下，会阻挡一些不该挡的内容。您不想移除这条过滤规则，但也不希望它阻挡不该挡的内容。</p>

<p>这就是例外规则的好处——它们允许您定义过滤规则不被使用的情况。例如，您不满意过滤规则 <code>adv</code> 阻挡了 <code>http://example.com/advice.html</code>，您就可以定义一条例外规则 <code>@@advice</code> 。 例外规则和过滤规则没什么两样，您可以使用通配符或正则表达式。您只需在规则前添加 <code>@@</code> 来声明这是一个例外规则。</p>

<p>Exception rules can do more. If you specify <code>$document</code> option you will get an exception for the entire page. For example, if your exception rule is <code>@@||example.com^$document</code> and you open some page from example.com — Adblock Plus will be entirely disabled on this page and nothing will be blocked.</p>

<h3 id="toc_3">匹配网址开头 / 结尾</h3>

<p>通常 Adblock Plus 处理过滤规则时，会自己假设在过滤规则的开头与结尾都有一个通配符，例如，过滤规则 <code>ad</code> 和 <code>*ad*</code> 是一样。 正常情况下这没什么问题，但有时您可能想要定义可以匹配以网址开头或结尾的过滤规则。例如，您想要阻挡所有的 Flash，但如果您添加过滤规则 <code>swf</code> 地址 <code>http://example.com/swf/index.html</code> 同样也将被阻挡。</p>

<p>这个问题的解决方法：使用管线符号（|）来表示地址的最前端或最末端。例如这条过滤规则 <code>swf|</code> 会阻挡 <code>http://example.com/annoyingflash.swf</code> 但不会阻挡 <code>http://example.com/swf/index.html</code>。这条过滤规则 <code>|http://baddomain.example/</code> 会阻挡 <code>http://baddomain.example/banner.gif</code> 但不会阻挡 <code>http://gooddomain.example/analyze?http://baddomain.example</code>。</p>

<p>有时您想阻挡 <code>http://example.com/banner.gif</code> 以及 <code>https://example.com/banner.gif</code> 和 <code>http://www.example.com/banner.gif</code>。这时只需在过滤规则的域名前面加上两个管线符号（||）：<code>||example.com/banner.gif</code> 将会阻挡上面的地址而不会阻挡 <code>http://badexample.com/banner.gif</code> 或者 <code>http://gooddomain.example/analyze?http://example.com/banner.gif</code>（需要 Adblock Plus 1.1 或更高版本）。</p>

<h3 id="toc_4">标记分隔符</h3>

<p>通常您需要接受过滤规则的任何分隔符。例如，您可能写这样一个规则阻挡 <code>http://example.com/</code> 和 <code>http://example.com:8000/</code> 但不能阻挡 <code>http://example.com.ar/</code>。在这里，符号 (<sup>)</sup> 用作一个分隔符。 <code>http://example.com^</code>（需要 Adblock Plus 1.1 或更高版本）。</p>

<p>分隔符可以是除了字母、数字或者 _ - . % 之外的任何字符。 这个地址的结尾也是作为一个分隔符，下面的例子中所有的分隔符以红色标记出： http:<strong>//</strong>example.com<strong>:</strong>8000<strong>/</strong>foo.bar<strong>?</strong>a<strong>=</strong>12<strong>&amp;</strong>b<strong>=</strong>%D1%82%D0%B5%D1%81%D1%82。所以这个地址可以通过这些过滤规则过滤 <code>^example.com^</code> 或 <code>^%D1%82%D0%B5%D1%81%D1%82^</code> 或 <code>^foo.bar^</code> 。</p>

<h3 id="toc_5">注释</h3>

<p>任何以感叹号 (!) 开始的规则，都被视为注释。在过滤规则的列表中，仍然会显示这些规则，但会用灰色的字来显示，而不是黑色。Adblock Plus 在判断规则时，会忽略这些注释，所以我们可以写下任何我们想写的东西。您可以在一条规则上面写下这条规则是做什么用的。也可以在过滤列表的上方写上作者信息（大多数过滤列表的作者已经这样做了）。</p>

<h4 id="toc_6">特殊注释</h4>

<p>特殊注释只在下载的过滤规则列表中生效，在自定义列表中无效。 它们可以为该过滤规则列表设置许多参数：</p>

<ul>
<li><p><code>! Homepage: http://example.com/</code></p>

<p>此注释表明哪个网页是该过滤规则列表的首页。</p></li>
<li><p><code>! Title: FooList</code></p>

<p>此注释为该过滤规则列表设置一个固定的标题。 如果此注释存在，用户不能再更改该标题。</p></li>
<li><p><code>! Expires: 5 days</code></p>

<p>此注释设置该过滤规则列表的更新间隔，指定的值为天数（例如<code>5 days</code>）或者小时数（例如<code>8 hours</code>）。 可以提供 1 小时至 14 天之间的值。 注意：更新并不一定会在指定的间隔到达时发生。 实际的更新时间会稍微随机化并取决于一些额外因素，以减少服务器负载。</p></li>
<li><p><code>! Checksum: OaopkIiiAl77sSHk/VAWDA</code></p>

<p>此注释确保数据的意外损坏不会导致出现过滤规则的意外损坏。 举例来说，一些防火墙软件可能会在下载时修改像是 <code>*/adnetwork/*</code> 的过滤规则来试图保护用户免于广告。 但这会导致移除过滤规则的部分内容，Adblock Plus 将只会看到过滤规则像是 <code>**</code>。 过滤规则列表中的校验和注释就是为了防止这种情况，任何修改将导致该校验和不再与内容相匹配，然后 Adblock Plus 将忽略该数据。</p>

<p>计算该校验和需要执行下列步骤：</p>

<ul>
<li>  移除现存的校验和及注释（如果有）。</li>
<li>  使用 UTF-8 编码对过滤规则列表的文本进行编码。</li>
<li>  转换所有换行符为 Unix 样式（替换掉 <code>\r</code> 用 <code>\n</code> ，如果有）。</li>
<li>  移除空行（用 <code>\n</code> 字符替换掉连续的 <code>\n</code> 字符）。</li>
<li>  计算该文本的 MD5 校验和的 Base64 编码，去除结尾的 <code>=</code> 字符（如有）。</li>
</ul>

<p>您也可以看看基于 Python 实现的 <a href="https://hg.adblockplus.org/adblockplus/file/tip/validateChecksum.py">验证校验和</a>和 <a href="https://hg.adblockplus.org/adblockplus/file/tip/addChecksum.py">添加校验和到文件</a>作为参考。</p></li>
<li><p><code>! Redirect: http://example.com/list.txt</code></p>

<p>此注释表明该过滤规则列表已被转移到一个新的下载地址。 Adblock Plus 将忽略此注释后的任何文件内容并立即尝试从新的地址下载。 如果成功，过滤规则列表的地址将按此设置被更新。 如果新的地址与当前地址相同，此注释将被忽略，并意味着它可以作为该过滤规则列表的 “权威” 地址使用。</p></li>
<li><p><code>! Version: 1234</code></p>

<p>此注释定义过滤规则列表的数字版本。 此版本号将显示在问题报告中，并且可以用于验证报告指向的是否是过滤规则列表的当前版本。</p></li>
</ul>

<h3 id="toc_7">进阶功能</h3>

<p>本章节描述的特性通常只有高级用户和维护过滤列表的作者才会看。普通用户可跳过。</p>

<h4 id="toc_8">指定过滤规则选项</h4>

<p>Adblock Plus 允许您指定某些选项来改变某条规则的行为。您列举这些选项的时候将它们放在美元符号 ($) 后面并用逗号 (,) 分割这些选项，放在过滤规则的最后面，例如：</p>

<pre>*/ads/*$script,match-case
</pre>

<p>这里的 <code>*/ads/*</code> 是真实的过滤规则 <code>script</code> 和 <code>match-case</code> 是其指定的选项。下面是目前支持的选项：</p>

<ul>
<li>  类型选项：判定过滤规则（或例外规则）过滤元素的类型。过滤规则可以指定多个类型选项来过滤指定的元素类型。可以指定的类型包括：

<ul>
<li>  <code>script</code> —— 外部脚本，由 HTML script 标签加载</li>
<li>  <code>image</code> —— 正常图片，通常由 HTML 的 img 标签所载入</li>
<li>  <code>stylesheet</code> —— 外部 CSS 样式文件</li>
<li>  <code>object</code> —— 由浏览器插件处理的内容，例如 Flash 或 Java</li>
<li>  <code>xmlhttprequest</code> — requests started using the <a href="https://xhr.spec.whatwg.org/"><code>XMLHttpRequest</code> object</a> or <a href="https://fetch.spec.whatwg.org/"><code>fetch()</code> API</a></li>
<li>  <code>object-subrequest</code> —— 插件的请求，比如 Flash</li>
<li>  <code>subdocument</code> —— 内嵌的页面，通常通过 HTML 的框架方式内嵌</li>
<li>  <code>ping</code> — requests started by <a href="https://developer.mozilla.org/docs/Web/HTML/Element/a#attr-ping"><code>&lt;a ping&gt;</code></a> or <a href="https://developer.mozilla.org/docs/Web/API/Navigator/sendBeacon"><code>navigator.sendBeacon()</code></a> (Adblock Plus 2.7.1 or higher required)</li>
<li>  <code>websocket</code> — requests initiated via <a href="https://developer.mozilla.org/docs/Web/API/WebSocket"><code>WebSocket</code> object</a> (Adblock Plus 2.8 or higher required)</li>
<li>  <code>webrtc</code> — connections opened via <a href="https://developer.mozilla.org/docs/Web/API/RTCPeerConnection"><code>RTCPeerConnection</code> instances</a> to ICE servers (Adblock Plus 1.13.3 for Chrome and Opera, 3.0 for Firefox, or higher required)</li>
<li>  <code>document</code> —— 网页本身（只适用于 <a href="#whitelist">例外规则</a> ）</li>
<li>  <code>elemhide</code> —— 只适用于例外规则，类似于<code>document</code> 但是只禁用页面上的<a href="#elemhide">隐藏规则</a>而不是所有规则（需要 Adblock Plus 1.2 或更高版本）</li>
<li>  <code>generichide</code> — for exception rules only, similar to <code>elemhide</code> but only disables <a href="#generic-specific">generic</a> element hiding rules on the page (Adblock Plus 2.6.12 or higher required)</li>
<li>  <code>genericblock</code> — for exception rules only, just like <code>generichide</code> but disables <a href="#generic-specific">generic</a> blocking rules (Adblock Plus 2.6.12 or higher required)</li>
<li>  <code>popup</code> — pages opened in a new tab or window</li>
<li>  <code>other</code> —— 其他不在上面的类型的请求The type options <code>background</code>, <code>xbl</code> and <code>dtd</code> are outdated and should no longer be used.</li>
</ul></li>
<li>  反转类型选项：指定过滤规则<strong>不</strong>应用的元素类型。可以指定的类型选项： <code>~script</code>, <code>~image</code>, <code>~stylesheet</code>, <code>~object</code>, <code>~xmlhttprequest</code>, <code>~object-subrequest</code>, <code>~subdocument</code>, <code>~document</code>, <code>~elemhide</code>, <code>~other</code></li>
<li>  third-party/first-party 请求限制：如果指定了 <code>third-party</code> 选项， 则过滤规则只适用于来源与当前正在浏览的页面的不同的请求。类似地，<code>~third-party</code> 适用于来源与当前浏览页面相同的请求。</li>
<li>  域名限定：选项 <code>domain=example.com</code> 指过滤规则只适用于 &quot;example.com&quot; 下的页面 。多个域名可以用 &quot;|&quot; 分隔： 过滤规则 <code>domain=example.com|example.net</code> 将只适用于 &quot;example.com&quot; 或 &quot;example.net&quot; 的页面。如果一个域名是前面有 &quot;~&quot;，则该过滤规则<strong>不</strong>适用于这个域名的页面。例如： <code>domain=~example.com</code> 指过滤规则适用于除了 example.com 之外的任何域名的页面而 <code>domain=example.com|~foo.example.com</code> 限定了过滤规则适用于 &quot;example.com&quot; 但不包括 &quot;foo.example.com&quot; 。</li>
<li>  Sitekey 限制：选项 <code>sitekey=abcdsitekeydcba</code> 意味着该过滤规则应该只在页面上提供了一个与过滤规则内含有的非常相似的（但没有 = 后缀的）公钥和一个可被验证的签名时应用。可以使用 “|” 作为分隔指定多个 sitekey：使用 <code>sitekey=abcdsitekeydcba|bcdesitekeyedcb</code> 作为过滤规则的选项时，将只会在页面提供了 “abcdsitekeydcba” 或者 “bcdesitekeyedcb” 的 sitekey 时应用。这类似于域名限制，但这允许单条过滤规则应用到相当多的域。注意，sitekey 限制需要<a href="#sitekey_server">服务器侧的修改</a>。</li>
<li>  <code>match-case</code> —— 使过滤规则只适用于匹配地址，例如：过滤规则 <code>*/BannerAd.gif$match-case</code> 会阻挡 <code>http://example.com/BannerAd.gif</code> 但不会阻挡 <code>http://example.com/bannerad.gif</code>。</li>
<li>  <code>collapse</code> — 这个选项将覆盖全局 &quot;隐藏已屏蔽元素的占位符&quot; 选项，并确保过滤规则总是隐藏这些元素。类似地，<code>~collapse</code> 选项将确保过滤规则不隐藏这些元素。</li>
<li>  <code>donottrack</code> —— 对有该选项的阻挡规则匹配到且有该选项的例外规则未匹配到的地址会发送一个 <a href="http://donottrack.us/">Do-Not-Track 头</a> (需要 Adblock Plus 1.3.5 或更高版本)。 为了向后兼容，使用此选项时建议使用矛盾的组合类型选项，防止此规则在早期版本的 Adblock Plus 中阻挡任何东西： <code>*$donottrack,image,~image</code></li>
</ul>

<h4 id="toc_9">使用正则表达式</h4>

<p>如果您想更好地控制您的过滤规则，什么匹配，什么不匹配，您可以使用正则表达式。例如过滤规则 <code>/banner\d+/</code> 会匹配 <code>banner123</code> 和 <code>banner321</code> 而不会匹配 <code>banners</code>。 您可以查看<a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Regular_Expressions#Creating_a_Regular_Expression">正则表达式的文档</a>来学习如何写正则表达式。</p>

<p><u>注</u>： 由于性能原因，建议尽可能避免使用正则表达式。</p>

<h2 id="toc_10">元素隐藏</h2>

<h3 id="toc_11">基本规则</h3>

<p>有时您可能会发现无法阻挡某些内嵌在网页中的文字广告。如果查看源码的话，可能发现类似这样的代码：</p>

<pre><div class="textad">
Cheapest tofu, only here and now!
</div>
<div id="sponsorad">
Really cheap tofu, click here!
</div>
<textad>
Only here you get the best tofu!
</textad>
</pre>

<p>因为您必须下载页面的内容，所以您也必须下载这些广告。对于这种情况，您可以做的就是把这些广告藏起来，这样您就不会看到他们了。这也就是元素隐藏的意义所在。</p>

<p>上面代码中的第一则广告是在一个 class 属性为 “textad” 的 div 容器内。过滤规则 <code>##.textad</code> 。 这里的 ## 表明这是一条元素隐藏规则，剩下的就是定义需要隐藏元素的选择器，同样的，您可以通过他们的 id 属性来隐藏 <code>###sponsorad</code> 会隐藏第二个广告。您不需要指定元素的名称， 过滤规则 <code>##textad</code> 同样也可以。您也可以仅指定要阻挡的元素名称来隐藏，例如：<code>{4}</code> 可以隐藏第三则广告。</p>

<p>在不查看页面源码的情况下，<a href="/zh_CN/elemhidehelper">Element Hiding Helper 扩展</a> 可以帮助选择正确的元素并写出相应的规则。基础的 HTML 知识还是很有用的。</p>

<p><u>注</u>：元素隐藏规则与普通过滤规则的工作方式有很大的差别。元素隐藏规则不支持通配符。</p>

<h3 id="toc_12">限定在特定域名的规则</h3>

<p>通常您只想要隐藏特定网站的特定广告，而不希望规则会作用于其他网站。例如，过滤规则 <code>##.sponsor</code> 可能会把某些网站的有效代码也隐藏了。但如果你把它写成 <code>example.com##.sponsor</code> 就只会在 <code>http://example.com/</code> 和 <code>http://something.example.com/</code> 生效了，而不是 <code>http://example.org/</code>。 你也可以指定多个域名——只要用逗号（,）分隔即可：<code>domain1.example,domain2.example,domain3.example##.sponsor</code> 。</p>

<p>如果在域名之前有 &quot;~&quot;，该过滤规则<strong>不</strong>适用于这个域名的页面（需要 AdBlock Plus 1.1 或更高版本）。例如， <code>~example.com##.sponsor</code> 将适用于除了 &quot;example.com&quot; 之外的域名，<code>example.com,~foo.example.com##.sponsor</code> 适用于 &quot;example.com&quot; 但不适用于 &quot;foo.example.com&quot; 子域名。</p>

<p><u>注</u>：由于元素隐藏实现方式的关系，您只可以将隐藏规则限定在完整的域名。您不能使用网址的其他部份，也不可用 <code>domain</code> 代替 <code>domain.example,domain.test</code> 。</p>

<p><u>注</u>： 限定域名的元素隐藏规则也可用来隐藏浏览器的使用界面。例如，过滤规则 <code>browser##menuitem#javascriptConsole</code> 会隐藏 Firefox 工具菜单中的 JavaScript 控制台。</p>

<h3 id="toc_13">属性选择符</h3>

<p>一些广告隐藏起来并不容易——它们广告不仅没有 id 也没有 class 属性。您可以使用其他属性来隐藏，例如 <code>##table[width=&quot;80%&quot;]</code> 可以隐藏 width 属性值为 80% 的表格元素。 如果您不想指定属性的完整值，<code>##div[title*=&quot;adv&quot;]</code> 会隐藏所有 title 属性包含 adv 字符的 div 元素。您还可以检查属性的开始和结束字符，例如 <code>##div[title^=&quot;adv&quot;][title$=&quot;ert&quot;]</code> 会隐藏 titile 属性以 adv 开始并且以 ert 结束的 div 元素。正如您所见，你可以使用多个条件 —— <code>table[width=&quot;80%&quot;][bgcolor=&quot;white&quot;]</code> 会匹配到 width 属性为 80%、bgcolor 属性为 white 的表格元素。</p>

<h3 id="toc_14">高级选择符</h3>

<p>通常情况下，Firefox 支持的 CSS 选择器都可用于元素隐藏。例如：下面的过滤规则会隐藏 class 的属性为 adheader 的 div 元素相邻的元素： <code>##.adheader + *</code>。完整的 CSS 列表请查看 <a href="http://www.w3.org/TR/css3-selectors/">W3C CSS 规范</a> （Firefox 目前并没有支持所有的选择器）。 Please keep in mind that browsers are slower to process these selectors than selectors based on <code>class</code> or <code>id</code> attribute only.</p>

<p><u>注</u>：这个功能只是给高级用户使用的，您可以很舒服地通过 CSS 选择符去使用它。Adblock Plus 无法检查您添加的选择器的语法是否正确，如果您使用无效的 CSS 语法，可能会破坏其它已有的有效过滤规则。建议使用 JavaScript 控制台检查是否有 CSS 错误。</p>

<h3 id="toc_15">Extended CSS selectors (Adblock Plus specific)</h3>

<p>Sometimes the standard CSS selectors aren&#39;t powerful enough to hide an advertisement. For those cases we have added some new selectors, namely <code>:-abp-has()</code>, <code>:-abp-contains()</code> and <code>:-abp-properties()</code> (requires Adblock Plus 1.13.3 or higher for Chrome and Opera).</p>

<p>When writing an element hiding filter that makes use of these extended selectors you must use the <code>#?#</code> syntax, e.g. <code>example.com#?#selector</code>. But it&#39;s important to note that doing so carries a performance impact, so do so sparingly and make sure those filters are specific to as few domains and elements as possible.</p>

<h4 id="toc_16">:-abp-properties()</h4>

<p><code>:-abp-properties(properties)</code> will select elements based upon stylesheet properties. For example <code>:-abp-properties(width:300px;height:250px;)</code> will select elements that have a corresponding CSS rule in a stylesheet which sets the <code>width</code> and <code>height</code> to the values <code>300px</code> and <code>250px</code> respectively. Property names are matched case-insensitively. Furthermore, wildcards can be used so that <code>:-abp-properties(width:*px;height:250px;)</code> will match any width specified in pixels and a height of 250 pixels.</p>

<p>You can also use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions">regular expressions</a> by surrounding the properties expression with &quot;/&quot;. For example, <code>:-abp-properties(/width:30[2-8]px;height:250px;/)</code> will match widths between 302 and 308 pixels and a height of 250 pixels.</p>

<p><u>Note</u>: The <a href="https://adblockplus.org/development-builds/new-css-property-filter-syntax">older syntax</a> for the CSS property filters is deprecated and will be automatically converted to the new format . The syntax to select the style properties remain the same. For example, <code>[-abp-properties=&#39;width:300px;height:250px;&#39;]</code> will be converted to <code>:-abp-properties(width:300px;height:250px;)</code>.</p>

<p><code>:-abp-properties()</code> will also select elements using the style properties found in their pseudo-elements, like <code>::before</code> and <code>::after</code>. For example, <code>:-abp-properties(content:&#39;Advertisment&#39;)</code> will match elements where the string <u>Advertisment</u> is found in either their <code>::before</code> or <code>::after</code> pseudo element.</p>

<h4 id="toc_17">:-abp-has()</h4>

<p><code>:-abp-has(selector)</code> will select elements based on their content. For example <code>:-abp-has(&gt; div &gt; a.advertiser)</code> will select elements that contain as a direct descendant a <code>&lt;div&gt;</code> that contains an <code>&lt;a&gt;</code> with the class <code>advertiser</code>. The inner selector can be relative to the element scope, and can use any of the pseudo-selectors, including <code>:-abp-has()</code> and will determine whether the selection will occur.</p>

<h4 id="toc_18">:-abp-contains()</h4>

<p><code>:-abp-contains(text)</code> will select elements based on their text content. For example, <code>div.sidebar &gt; span:-abp-contains(Advertisment)</code> will select the <code>&lt;span&gt;</code> elements within a <code>&lt;div&gt;</code>, with a class of <code>sidebar</code> that contains the word &quot;Advertisment&quot;. In practice, you&#39;d want to combine this with a <code>:-abp-has()</code> to select the outer container — something like <code>div.sidebar &gt; div:-abp-has(span:-abp-contains(Advertisment))</code> to select the container that would contain an advertisement label.</p>

<h3 id="toc_19">例外规则</h3>

<p>例外规则的作用是在特定域名中禁用已有的规则。 这对于那些与其他订阅组配合使用，且无法更改该订阅组的作者来说较为有用。 例如，如要让 <code>##.textad</code> 规则禁用于 <code>example.com</code>，可以使用 <code>example.com#@#.textad</code>。 这条组合规则就等同于 <code>~example.com##.textad</code>。 建议您仅在无法调整全局隐藏规则时才使用例外规则，否则请首选限定在特定域名的规则。 These exceptions will be applied to <a href="#elemhide-emulation">advanced pseudo-selector rules</a> as well.</p>

<h3 id="toc_20">Generic / Specific filters</h3>

<p>With the <code>$generichide</code> and <code>$genericblock</code> filter options the distinction between generic and specific filters becomes important.</p>

<p>We classify a filter to be <strong>specific</strong> if it matches one or more domains or matches a sitekey. If a filter has no domains specified (or only domain exceptions) and no sitekey then it counts as <strong>generic</strong>. For example, <code>example.com##.textad</code> is a specific filter, whereas both <code>##.textad</code> and <code>~example.com##.textad</code> are generic.</p>

<p>Note that with blocking rules the domain must be specified under the \(domain option for them to be considered specific. For example, `||example.com^` is considered generic whereas `*/ads/*\)domain=example.com` is site-specific.</p>

<h2 id="toc_21">在服务器上实施 sitekey</h2>

<p>若想完成一个采用 <a href="#options">sitekey 限制的过滤规则</a>，一个网页需要返回 Base64 编码的公钥版本和 Adblock Plus 可以验证的签名。目前来说，这需要在 HTTP 相应头中包含（<code>X-Adblock-Key: abcdpublickeydcba_abcdsignaturedcba</code>）及 document 的根标签中（<code>&lt;html data-adblockkey=&quot;abcdpublickeydcba_abcdsignaturedcba&quot;&gt;</code>）。</p>

<p>首先，您需要创建一个专用的 RSA 密钥（最好是 512 位以保证较低传输负担）和一个公钥的 DER 表示。</p>

<p>创建签名使用的数据是一个请求变量的连续列表（即 URI、Host 和 User Agent），分隔符是 <code>NUL</code> 字符，即 “\0”。举例来说：</p>

<pre>  /index.html?q=foo\0www.example.com\0Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:30.0) Gecko/20100101 Firefox/30.0
</pre>

<p>最后，使用 SEC_OID_ISO_SHA_WITH_RSA_SIGNATURE 签名算法生成此字符串的签名（是使用 OpenSSL 时的默认值）。</p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2018/4/22</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Network.html'>Network</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
              


			<div class="row">
			  <div class="large-6 columns">
			  <p class="text-left" style="padding-top:25px;">
			   
			  </p>
			  </div>
			  <div class="large-6 columns">
			<p class="text-right" style="padding-top:25px;">
			
			</p>
			  </div>
			</div>
		</div>
	</div><!-- large 8 -->

 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="http://panlw.github.io/assets/img/logo.png" /></div>
            
                <h1>Junkman</h1>
                <div class="site-des">“拾荒者”一词来自凯文・凯利的《失控》中关于机器学习的故事（“收集癖好机”如何完成他的收集工作）。</div>
                <div class="social">









<a target="_blank" class="github" target="_blank" href="https://github.com/panlw/" title="GitHub">GitHub</a>

  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="Infra.html"><strong>Infra</strong></a>
        
            <a href="Coding.html"><strong>Coding</strong></a>
        
            <a href="Solution.html"><strong>Solution</strong></a>
        
            <a href="Archtect.html"><strong>Archtect</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15248848757950.html">Learn to visualize data with this free D3.js course</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15248846042998.html">Modularizing your GraphQL schema code</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15248840485977.html">The Basics of Web Workers - HTML5 Rocks</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15248829536577.html">A tale of Webpack 4 and how to finally configure it in the right way</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15248824810738.html">理解JWT的使用场景和优劣</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>


  </body>
</html>
