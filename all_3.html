<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Junkman
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="Junkman" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:panlw.github.io ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; Junkman</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
       
       <li><a href="index.html">HOME</a></li>
    <li><a href="archives.html">Archives</a></li>
    <li><a href="about.html">ABOUT</a></li>

    <li><label>Categories</label></li>

        
            <li><a href="Infra.html">Infra</a></li>
        
            <li><a href="Coding.html">Coding</a></li>
        
            <li><a href="Solution.html">Solution</a></li>
        
            <li><a href="Archtect.html">Archtect</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
	$(function(){
		$('#menu_item_index').addClass('is_active');
	});
</script>
<div class="row">
	<div class="large-8 medium-8 columns">
		<div class="markdown-body home-categories">
		
			<div class="article">
                <a class="clearlink" href="15244133646661.html">
                
                  <h1>Native Extension for Node.js</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<blockquote>
<p><a href="https://www.nan-labs.com/blog/native-extensions-for-nodejs/">https://www.nan-labs.com/blog/native-extensions-for-nodejs/</a></p>

<p><u>If you are a Spanish reader you can read this post in Spanish here: <a href="http://laplatajs.github.io/blog/2018/02/27/extensiones-nativas.html">Extensiones Nativas: ¿dónde empezar?</a></u></p>

<p>In this article we will talk about the most important concepts to develop native extensions for NodeJS. Later, I will show how to build our first native extension with a practical example. And finally, I will leave some links to read more about it.</p>
</blockquote>

<h2 id="toc_0">The basics to get started with native extensions</h2>

<p>In simple terms, we can say that a native extension is a set of C++ implemented logic that can be invoked from JavaScript code.</p>

<p>At this point, it’s interesting for us to clarify how NodeJS works and which are the parts involved in it. It’s important to know why we can talk about two languages (JavaScript &amp; C++) under the NodeJS context.</p>

<p>I like to explain it this way:</p>

<ul>
<li>  <strong>JavaScript</strong>: it’s the coding language.</li>
<li>  <strong>V8</strong>: it’s the engine that runs our JavaScript code.</li>
<li>  <strong>Libuv</strong>: it’s a C library that provides us with asynchronous execution.</li>
</ul>

<p>Now, where can we place native extensions? I will choose write/read disk action as an example to explain it. Neither JavaScript nor V8 provides us with disk access. Libuv provides asynchronous execution. But, with NodeJS we can write/read to disk, right? Well, this is the point where native extensions get into the match. The fs module is implemented using C++ (it has disk access) and eventually exposes methods (like writeFile and readFile) which can be invoked from JavaScript.</p>

<p><img src="media/15244133646661/15244134699236.jpg" alt="Interaction with native extensions diagram"/></p>

<p>Once we have learned this, we can start taking our first steps in native extensions. Let’s talk about the tools we need.</p>

<h2 id="toc_1">Basic tooling to build a native extension</h2>

<h3 id="toc_2">Binding.gyp file</h3>

<p>This file allows us to specify how we need to compile our native extension. One of the main thing that we need to define are the files that will be compiled and how we will call the final binary. It has a JSON like structure, and the keys to get this configured are sources and target.</p>

<h3 id="toc_3"><a href="https://github.com/nodejs/node-gyp">Node-gyp</a></h3>

<p>It’s the tool that allows us to compile our native extension. It’s implemented in NodeJS and it’s bundled with npm so we can just run npm install and that will compile our native extension. When we run npm install, it will detect our binding.gyp file included in our root folder and then it will start compiling.</p>

<p>Also, it allows us to make release(default) or debug builds. As a result, a binary file with .node extension will be created inside a release or debug folder, depending on how it was configured.</p>

<h3 id="toc_4"><a href="https://github.com/TooTallNate/node-bindings">Bindings</a></h3>

<p>It’s a NodeJS package which allows us to export our native extension. It’s in charge of searching in a build or release folder for us.</p>

<h3 id="toc_5"><a href="https://nodejs.org/api/n-api.html">N-API</a></h3>

<p>It’s C API that allows us to interact with our engine in a completely abstract way. For me, it’s the result of an evolution that tries to port node to different architectures.</p>

<p>N-API provides stability and compatibility between different node versions. That is, if my native extension is compiled to node 8.1, I don’t need to compile it again for node 8.6 or 9.3. Thus making the life of the maintainers and contributors easier.</p>

<p>At this moment, N-API is under <a href="https://nodejs.org/docs/latest/api/n-api.html#n_api_n_api">experimental state</a>.</p>

<h3 id="toc_6"><a href="https://github.com/nodejs/node-addon-api">Node addon api</a></h3>

<p>This NodeJS module provides us with a C++ implementation of N-API and allows us to use the language advantages.</p>

<h2 id="toc_7">First steps in the native extension world</h2>

<p><u>Note: For this example, I used node 9.3.</u></p>

<p>To get initiated on the native extension world we will use the classic hello world example. The idea is to not overload the code with extra logic so we can focus on the minimum necessary code.</p>

<p>We start initializing npm so that we can then install our dependencies:</p>

<p><code>npm init</code></p>

<p>Now, as we said, we install our dependencies:</p>

<p><code>npm i node-addon-api bindings</code></p>

<p>At this point we need to create our C file with our logic:</p>

<p><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-1baaff35daab552f019ad459494450f1.css"></p>

<pre><code class="language-cpp">#include &lt;napi.h&gt;

Napi::String SayHi(const Napi::CallbackInfo&amp; info) {
  Napi::Env env = info.Env();

  return Napi::String::New(env, &quot;Hi!&quot;);
}

Napi::Object init(Napi::Env env, Napi::Object exports) {
    exports.Set(Napi::String::New(env, &quot;sayHi&quot;), Napi::Function::New(env, SayHi));
    return exports;
};

NODE_API_MODULE(hello_world, init);
</code></pre>

<blockquote>
<p><a href="https://gist.github.com/nanlabsweb/d6c985ee9842fab274d4116c2fb0f443/raw/188b287e5092727700cfe1ddff8f6cbc402f3e3e/hello_world.cc">view raw</a> <a href="https://gist.github.com/nanlabsweb/d6c985ee9842fab274d4116c2fb0f443#file-hello_world-cc">hello_world.cc</a> hosted with ❤ by <a href="https://github.com">GitHub</a></p>
</blockquote>

<p>This file has three important parts that will be explained from bottom to top:</p>

<ul>
<li>  <strong>NODE_API_MODULE</strong> (Line 14): The first argument is the native extension name and the second one is the name of the function that initializes our extension.</li>
<li>  <strong>Init</strong> (Line 10): This is the function that will initialize our native extension. In this function we must export the functions that will be invoked from JavaScript code. To do this, we need to set the name of the function to the exports object and the function itself that will be invoked. This init function must return the exports object.</li>
<li>  <strong>SayHi</strong> (Line 3): This function is what will be executed when we invoke our native extension from our JavaScript.</li>
</ul>

<p>Later, we need to create our <strong>binding.gyp</strong> file that will contain our native extension configuration:</p>

<p><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-1baaff35daab552f019ad459494450f1.css"></p>

<pre><code class="language-json">{
  &quot;targets&quot;: [
    { 
      &quot;cflags!&quot;: [ &quot;-fno-exceptions&quot; ],
      &quot;cflags_cc!&quot;: [ &quot;-fno-exceptions&quot; ],
      &quot;include_dirs&quot; : [
        &quot;&lt;!@(node -p \&quot;require(&#39;node-addon-api&#39;).include\&quot;)&quot;
      ],
      &quot;target_name&quot;: &quot;hello_world&quot;,
      &quot;sources&quot;: [ &quot;hello_world.cc&quot; ],
      &#39;defines&#39;: [ &#39;NAPI_DISABLE_CPP_EXCEPTIONS&#39; ]
    }
  ]
}
</code></pre>

<blockquote>
<p><a href="https://gist.github.com/nanlabsweb/ebbc7d0c2dd5249b5f833e8a2b845f5d/raw/61068384831764b78bc8a7ace9deedefb1faadc5/binding.gyp">view raw</a> <a href="https://gist.github.com/nanlabsweb/ebbc7d0c2dd5249b5f833e8a2b845f5d#file-binding-gyp">binding.gyp</a> hosted with ❤ by <a href="https://github.com">GitHub</a></p>
</blockquote>

<p>Finally, the JavaScript code that will require our extension and invoke it.</p>

<p><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-1baaff35daab552f019ad459494450f1.css"></p>

<pre><code>const hello_world = require(&#39;bindings&#39;)(&#39;hello_world&#39;)

console.log(hello_world.sayHi());
</code></pre>

<blockquote>
<p><a href="https://gist.github.com/nanlabsweb/30019fc7ae72f3898f93623d535d8790/raw/a43850af02bfb800bad0ab82426c64b307f50e1c/index.js">view raw</a> <a href="https://gist.github.com/nanlabsweb/30019fc7ae72f3898f93623d535d8790#file-index-js">index.js</a> hosted with ❤ by <a href="https://github.com">GitHub</a></p>
</blockquote>

<p>Now, we just need to compile our extension running npm install and run the JavaScript file that is used:</p>

<p><img src="media/15244133646661/15244136958142.gif" alt="Native extensions gif demonstrating real usage."/></p>

<p>And that’s it. We just run our native extension.</p>

<h2 id="toc_8">What we had before N-API?</h2>

<p>I find it important to know the context and history of native extensions since it gives access to a lot of documentation and examples. The idea is for N-API to eventually replace NAN. For that reason we should look back to NAN for a moment.</p>

<p>NAN? Yes, <a href="https://github.com/nodejs/nan">Native Abstraction for Node.js</a>. NAN is a C++ library that provides us with V8 abstraction, but it doesn’t allow us to abstract ourselves from the V8.<br/>
In new NodeJS releases, there could be V8 changes that could break our native extension. Using NAN is a way to avoid this problem.</p>

<h2 id="toc_9">Further steps to develop your native extensions</h2>

<p>As I said, knowing about NAN allows us to learn from its examples and documentation. It’s a good complement to our native extension learning process.</p>

<ul>
<li>  NAPI examples can be found in <a href="https://github.com/nodejs/node/tree/master/test/addons-napi">here</a>.</li>
<li>  Node-addon-api examples can be found in <a href="https://github.com/nodejs/abi-stable-node-addon-examples">here</a>.</li>
<li>  Nan examples can be found in <a href="https://github.com/nodejs/nan/tree/master/test">here</a>.</li>
<li>  Another good source are tests <a href="https://github.com/nodejs/node-addon-api/tree/master/test">here</a>.</li>
<li>  To learn more about native extensions <a href="https://nodeaddons.com/">here</a>.</li>
</ul>

<h2 id="toc_10">Conclusion</h2>

<p>Learning about native extensions helped me to understand how NodeJS works and how it’s composed. There are more than one scenario where we can use them, such as performance boosts, C/C++ library integrations, or integration with legacy code.</p>

<p>In summary, it’s an excellent way to learn about NodeJS internals.</p>

<p>If you have any doubt, please post a comment and I will help you.</p>

<h3 id="toc_11">Taking part in the community</h3>

<p>I made this post for a contribution to <a href="http://laplatajs.github.io/">LaPlataJS</a>. It’s a local JavaScript community where I participate helping with talks, events organization, or posts. I think that whenever you can you should join a community. For me, it has a lot of benefits. You can know really good people, share ideas, learn things and, sometimes, go for a beer with your folks.</p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2018/4/23</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Node.js.html'>Node.js</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15244093031262.html">
                
                  <h1>A GraphQL & Node.js Express Tutorial: Powerful E-Commerce with GraphCMS</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<blockquote>
<p><a href="https://snipcart.com/blog/graphql-nodejs-express-tutorial">https://snipcart.com/blog/graphql-nodejs-express-tutorial</a></p>

<p>In a rush? Skip <a href="https://snipcart.com/blog/graphql-nodejs-express-tutorial#tutorial">tutorial steps</a> or <a href="https://snipcart.com/blog/graphql-nodejs-express-tutorial#conclusion">GitHub repo &amp; live demo</a>.</p>
</blockquote>

<p>Trends... they come and go.</p>

<p>Take those fidget spinners for instance, aren&#39;t we all tired of seeing them everywhere, right?</p>

<p>Chances are we&#39;re still stuck with them for a little while, and then we&#39;ll never hear from them again.</p>

<p>Nowhere is the &quot;trend&quot; phenomenon more obvious than in our developer universe, where technologies and shiny new toys appear every day. In this post, I want to try something new that, unlike spinners, is probably here to stay.</p>

<p>I&#39;m talking about <a href="http://graphql.org/"><strong>GraphQL</strong></a>.<br/>
<img src="https://lh3.googleusercontent.com/-7x7a96dgNeo/WuVwY03sBPI/AAAAAAAAACY/xSkMmaV3dG01sNsh4vm7sSXOLaZ8zbQ5wCHMYCw/I/15244094735531.png" alt=""/></p>

<p>Today, we’ll take part in this up-and-coming technology by sharing a GraphQL tutorial, while at the same time trying to capitalize on the last breath of the spinners trend by setting up our own online shop. We&#39;ll integrate GraphQL with <strong>Node.js Express</strong> to create a small e-commerce app.</p>

<p>In fact, we&#39;ll be using the GraphQL-based <a href="https://snipcart.com/blog/intro-api-first-headless-cms-directus">headless content management system</a>, <a href="https://graphcms.com/"><strong>GraphCMS</strong></a> and <a href="http://www.apollodata.com/"><strong>Apollo</strong></a>.</p>

<p>Live demo and full code repo included at the end. ;)</p>

<p><img src="https://lh3.googleusercontent.com/-kILqQsAY-P8/WuVwZEygETI/AAAAAAAAACc/rdEoJRc1zPAa51kDuwMlr2UvluHKj25kQCHMYCw/I/15244095062275.png" alt="GraphCMS logo"/></p>

<p>Let’s <u>spin</u> our way (see what I did there?) into all of the following:</p>

<ol>
<li> Creating a Node.js Express app</li>
<li> Setting up GraphCMS</li>
<li> Querying the GraphQL API using Apollo client</li>
<li> Creating our shop with Snipcart</li>
</ol>

<p>But let’s not get ahead of ourselves and start by digging deeper into what we&#39;re working with here.</p>

<h2 id="toc_0">What is GraphQL?</h2>

<p><strong>GraphQL is a new syntax for your API that defines how to fetch data from one or many databases.</strong></p>

<p>Since this new <u>query language</u> for APIs was open sourced in 2015 by a small company named Facebook (which used it for its mobile apps since 2012), a growing community has been supporting and developing it.</p>

<p>It has been created to solve some structural problems developers encountered when they started to create apps that were way more complex than before.</p>

<p>As for Facebook’s use case, they wanted to put all of the website features into the users&#39; hands, with their mobile apps, back in 2011. That’s when they started to think about a new way of doing things. A way that would make traffic between clients and servers simpler, more organized.</p>

<p>GraphQL was the result.</p>

<p><img src="media/15244093031262/15244098515128.png" alt="What is GraphQL"/></p>

<p>They made it possible to manage data over a single endpoint via HTTP. Each query you send to your API gets you exactly what you want. What I mean here is that you will receive on the other end <u>nothing more</u> and <u>nothing less</u> than what you need. The data needed is determined client side instead of letting servers control it, helping to build apps that are way <u>faster</u> and <u>more stable</u>.</p>

<p>Its <a href="https://dev-blog.apollodata.com/the-anatomy-of-a-graphql-query-6dffa9e9e747">_type schema system_</a> regroups all the data you can access, no matter where it is stored, under different fields. You can relate these to one another in order to get the information needed in one simple request.</p>

<p>Now, this is just a quick GraphQL overview. We won’t get into all the specifics here since it’s not the goal of this post. But there are plenty of helpful resources available should you want to learn more:</p>

<ul>
<li>  <a href="http://graphql.org/learn/best-practices/">Here’s a nice tool</a> to help you get started with it.</li>
<li>  To dive straight into it, take a look at the <a href="https://facebook.github.io/graphql/#">GraphQL specs</a>.</li>
</ul>

<h3 id="toc_1">Why GraphQL over REST APIs?</h3>

<p>This topic has already caused a lot of discussions on dev forums, and what you get out of these is that you can’t compare both <u>directly</u>. <a href="https://philsturgeon.uk/api/2017/01/24/graphql-vs-rest-overview/">They are not the same</a>, and GraphQL won’t take over REST APIs tomorrow morning. Whereas the first is, as I already mentioned, a query language, the other is an <u>architectural concept</u>.</p>

<p>You can actually <a href="https://www.youtube.com/embed/UBGzsb2UkeY">wrap a REST API in GraphQL</a>. This is good to know if you want to try GraphQL without throwing away your existing infrastructure.</p>

<p>Still, more and more developers will turn towards GraphQL for their new APIs, because it solves a lot of the problems that pushed them to scratch their heads with REST’s multiple endpoints.</p>

<p><img src="media/15244093031262/15244097343716.png" alt="REST API vs GraphQL"/></p>

<p>GraphQL vs REST API queries <a href="https://medium.com/@ottovw/rest-api-downfalls-and-dawn-of-graphql-dd00991a0eb8">[source]</a></p>

<p>The latter means you have to make different calls to different endpoints for a single request, like loading a page. It made the process slower as you create more complex architectures. And it can rapidly become a real mess with REST APIs for that reason.</p>

<h3 id="toc_2">So, what should you do?</h3>

<p>It’s entirely up to you, but there are situations where GraphQL starts to look like the best option:</p>

<ul>
<li>  If you have multiple clients, because they simply write their own queries, in the language of their choice, GraphQL supports them all;</li>
<li>  If you work on different platforms: web, mobile, apps, etc;</li>
<li>  If your API is highly customizable.</li>
</ul>

<p>Speaking of <u>highly customizable</u>, we&#39;ll try to determine how we can fit Snipcart into all of this, with the help of an Express app. Before jumping in the demo, let&#39;s learn a bit more about this Node.js Express framework we&#39;ll use.</p>

<h2 id="toc_3">What is Node.js Express?</h2>

<p><strong>Express is a fast, unopinionated, minimalist web framework for Node.js.</strong></p>

<p>We&#39;ve <a href="https://snipcart.com/blog/nodejs-ecommerce-harp-js-static">already played with Node before</a>, but here we&#39;ll use Express for the server-side of our demo. It&#39;s probably the most well-known framework for Node.js right now. <a href="https://expressjs.com/en/starter/installing.html">Official docs over here</a>.</p>

<p>It&#39;s a simple framework that adds fundamental web application features on top of Node.js. It was one of the first out there and is widely used by lots of companies that work with Node.js (IBM, Uber &amp; more).</p>

<p>There&#39;s a ton of modules you can add on top of it to handle most use cases. Like a body parser we&#39;ll use today to deal with JSON payloads.</p>

<p>Although there are some alternatives such as <a href="http://koajs.com/">Koa</a> and <a href="http://sailsjs.com/">SailsJS</a>, I decided to go with the classic and stick to what I know best.</p>

<p>It&#39;s now time to put these awesome tools to use; let&#39;s sell some spinners!</p>

<h2 id="toc_4">Building an e-commerce app: Node.js Express &amp; GraphQL demo</h2>

<p>In this demo, we&#39;ll craft a small shop web application from scratch. Other than Express we&#39;ll be using several technologies to achieve this goal.</p>

<p>Namely, <code>apollo-client</code> from folks at <strong>Apollo</strong>, a very neat framework that makes it easy to query a GraphQL API.</p>

<p>The GraphQL API will be handled by <strong>GraphCMS</strong>.</p>

<p>On top of that, we&#39;ll add our e-commerce solution, Snipcart. ;)</p>

<h3 id="toc_5">Getting started with Node.js Express</h3>

<p>We&#39;ll start by initializing a new node project.</p>

<pre><code>npm init

</code></pre>

<p>Answer the quick questions that the CLI will ask you.</p>

<p>This will create the <code>project.json</code> file and then we&#39;ll be ready to start for real.</p>

<p>We&#39;ll first need to add <code>express</code> npm package.</p>

<pre><code>npm install express --save

</code></pre>

<p>Then, we&#39;ll create the entry file of our application. Let&#39;s name it <code>server.js</code>.</p>

<pre><code>// /server.js

const express = require(&#39;express&#39;)
const app = express()

app.listen(3000, function() {
    console.log(&#39;Listening on port 3000.&#39;);
})

</code></pre>

<p>The first thing we&#39;ll do is to set the view engine we are going to use. In our case, we&#39;ll go ahead with <code>pug</code>.</p>

<pre><code>npm install pug --save

</code></pre>

<p>Then we&#39;ll add these lines to the <code>server.js</code> file.</p>

<pre><code>// /server.js

app.set(&#39;view engine&#39;, &#39;pug&#39;)
app.set(&#39;views&#39;, path.join(__dirname, &#39;/app/views&#39;))

</code></pre>

<p>This will set our default view engine and the path where our views will be located.</p>

<p>We&#39;ll then need to create a router to show the list of our products. Create a new directory named <code>app</code> in your root folder and then create another folder named <code>routers</code> in the former.</p>

<p>We&#39;ll create a router named <code>products.js</code>.</p>

<pre><code>// /app/routers/products.js

const express = require(&#39;express&#39;)
const router = express.Router()

router.get(&#39;/&#39;, (req, res) =&gt; {
})

</code></pre>

<p>We&#39;ll need to register this router in our app. Add these lines to <code>server.js</code> file:</p>

<pre><code>// /server.js

const products = require(&#39;./app/routers/products&#39;)
app.use(&#39;/&#39;, products)

</code></pre>

<h3 id="toc_6">Setting up GraphCMS</h3>

<p>Now for GraphCMS. You&#39;ll need an account: create one <a href="https://app.graphcms.com/">here</a>.</p>

<p>Once logged in, create a new project. I named mine <code>Snipcart demo</code>. Once the project is created, click on Content and then on Add Content Model.</p>

<p><img src="media/15244093031262/15244098950968.png" alt="add-content-model"/></p>

<p>We&#39;ll now define the fields of the product, add the necessary fields so your model looks like this:</p>

<p><img src="media/15244093031262/15244099157106.png" alt="product-fields"/></p>

<p>You can then create a few products. When it&#39;s done we&#39;ll need to get the GraphQL API endpoint and make it readable.</p>

<p>Click on Settings in the menu, and enable Public API Access.</p>

<p><img src="media/15244093031262/15244108383474.png" alt="public-api-access"/></p>

<p>Then note your <strong>Simple Endpoint</strong> URL in the Endpoints section.</p>

<h3 id="toc_7">Querying our GraphQL API</h3>

<p>Back to the code now. We&#39;ll need to change our <code>products.js</code> router to fetch the items from the API. Before that, we&#39;ll create a small service module that&#39;ll interact with the API using Apollo client.</p>

<p>Let&#39;s install the modules we&#39;ll need from npm.</p>

<pre><code>npm install apollo-client graphql-tag node-fetch url numeral --save

</code></pre>

<p>We also install <code>node-fetch</code> because the <code>fetch</code> method used by <code>apollo-client</code> is not yet available in Node.js.</p>

<p><code>url</code> and <code>numeral</code> package will be used for display purposes that we&#39;ll see later.</p>

<p>We&#39;ll also create a configuration file in our project root containing things such as an API endpoint URL and Snipcart API key.</p>

<pre><code>// /config.json

{
    &quot;apiEndpoint&quot;: &quot;https://api.graphcms.com/simple/v1/cj3c0azkizxa6018532qd1tmh&quot;,
    &quot;snipcartApiKey&quot;: &quot;MzMxN2Y0ODMtOWNhMy00YzUzLWFiNTYtZjMwZTRkZDcxYzM4&quot;
}

</code></pre>

<p>Create a new directory named <code>services</code> in the <code>app</code> folder. We&#39;ll add a new file named <code>products.js</code> in it.</p>

<pre><code>// /app/services/products.js

fetch = require(&#39;node-fetch&#39;)
const config = require(&#39;./../../config.json&#39;)
const Apollo = require(&#39;apollo-client&#39;)
const gql = require(&#39;graphql-tag&#39;)
const ApolloClient = Apollo.ApolloClient
const createNetworkInterface = Apollo.createNetworkInterface

const client = new ApolloClient({
    networkInterface: createNetworkInterface({
        uri: config.apiEndpoint
    })
})

module.exports = {
    getAllProducts: () =&gt; {
        return new Promise((resolve, reject) =&gt; {
            client.query({
                query: gql`
                   query {
                        allProducts {
                            name,
                            id,
                            sku,
                            price,
                            description,
                            image {
                                url
                            }
                        }
                    }
                `
            })
            .then((response) =&gt; {
                resolve(response.data.allProducts)
            })
        })
    },
    getProductById: (id) =&gt; {
        return new Promise((resolve, reject) =&gt; {
            client.query({
                query: gql`
                    query {
                        Product(id: &quot;${id}&quot;) {
                            name,
                            id,
                            image {
                                url
                            },
                            description,
                            price,
                            sku
                        }
                    }
                `
            })
            .then((response) =&gt; {
                resolve(response.data.Product)
            })
        })
    }
}

</code></pre>

<h3 id="toc_8">Creating the store with Snipcart</h3>

<p>So we now have a way to fetch our data. We can retrieve a list of products and a product by its id. Should be enough for our humble tutorial.</p>

<p>Let&#39;s start by listing all our products. Open the router file <code>products.js</code>.</p>

<pre><code>// /app/routers/products.js

const express = require(&#39;express&#39;)
const router = express.Router()
const productsService = require (&#39;./../services/products&#39;)

router.get(&#39;/&#39;, (req, res) =&gt; {
    productsService.getAllProducts()
        .then(function (data) {
            res.render(&#39;products/index&#39;, {
                products: data
            })
        })
})

module.exports = router

</code></pre>

<p>We fetch the products from the GraphQL API, then render a view that we&#39;ll need to create.</p>

<p>Let&#39;s start with the views we need. We&#39;ll start by putting together our base layout. Place a file named <code>layout.pug</code> in <code>/app/views</code> directory.</p>

<pre><code>// /app/views/layout.pug

html
    head
        if title
            title #{ title }
        else
            title Awesome shop powered by GraphCMS and Snipcart

        block styles
            link(href=&#39;https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.2/css/bulma.min.css&#39;, rel=&#39;stylesheet&#39;, type=&quot;text/css&quot;)
            link(href=&quot;https://cdn.snipcart.com/themes/2.0/base/snipcart.min.css&quot;, type=&quot;text/css&quot;, rel=&quot;stylesheet&quot;)
            link(href=&#39;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css&#39;, type=&#39;text/css&#39;, rel=&#39;stylesheet&#39;)

        block scripts
            script(src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js&quot;)
            script(src=&quot;https://cdn.snipcart.com/scripts/2.0/snipcart.js&quot;, id=&quot;snipcart&quot;, data-api-key=snipcartApiKey)

    body
        .container
            nav.nav.has-shadow
                .nav-left
                    a(href=&#39;/&#39;).nav-item.is-active.is-tab Spinners

                .nav-right.nav-menu
                    a.nav-item.is-tab.snipcart-summary.snipcart-checkout
                        i.fa.fa-shopping-cart &amp;nbsp;
                        | View cart (
                        span.snipcart-total-items 0
                        | )
        block content

</code></pre>

<p>You will notice that I added some files in there already. First, I included <a href="http://bulma.io/">Bulma</a> to make a decent looking application quickly, FontAwesome for the icons, then jQuery and <a href="https://app.snipcart.com/register">Snipcart</a>&#39;s required files.</p>

<p>I also added a nav bar with the cart content summary in it.</p>

<p>Now that we have a layout, we&#39;ll generate the view that will list the products.</p>

<p>Insert a new file named <code>index.pug</code> in <code>/app/views/products</code> folder.</p>

<pre><code>// /app/views/products/index.pug

extends ../layout.pug
include ../_mixins/snipcart.pug

block content
    .section
        .container
            .heading
                h1.title Our spinners

    .section
        .container
            .columns.is-multiline
                each p in products
                    .column.is-half
                        article.media
                            figure.media-left
                                p.image.is-64x64
                                    img(src=p.image.url)
                            .media-content
                                .content
                                    p
                                        strong #{ p.name }
                                        small  #{ formatMoney(p.price) }
                                        br
                                        | !{ p.description }
                                nav.level
                                    .level-left
                                        +snipcart_button(p).level-item(title=&#39;Add to cart&#39;)
                                            span.icon.is-small
                                                i.fa.fa-cart-plus
                                        a(href=`/products/${p.id}`, title=&#39;View details&#39;).level-item
                                            span.icon.is-small
                                                i.fa.fa-info

</code></pre>

<p>This template will render each product, with its details and two buttons: one to get to the product details and another one to add it to the cart.</p>

<p>You will notice that I used some methods to display things such as <code>formatMoney</code> and a <code>mixin</code> named <code>snipcart_button</code>.</p>

<p>Here&#39;s the code for the mixin:</p>

<pre><code>// /app/views/_mixins/snipcart.pug

mixin snipcart_button(product)
    a(href=&#39;#&#39;).snipcart-add-item&amp;attributes(attributes)(
        data-item-name=product.name
        data-item-id=product.sku
        data-item-price=product.price
        data-item-image=product.image.url
        data-item-url=fullUrl(`/products/${product.id}/json`)
    )
        block

</code></pre>

<p>We&#39;ll see later what&#39;s up with the <code>products/${product.id}/json</code> URL.</p>

<p>The <code>formatMoney</code> will be added to the <code>locals</code>. Open the <code>server.js</code> file and modify it:</p>

<pre><code>// /server.js

const express = require(&#39;express&#39;)
const app = express()
const products = require(&#39;./app/routers/products&#39;)
const path = require(&#39;path&#39;)
const config = require(&#39;./config.json&#39;)

// We need these two packages for display purposes
const numeral = require(&#39;numeral&#39;)
const url = require(&#39;url&#39;)

// We add the methods and properties we need to the response locals.

app.use((req, res, next) =&gt; {
    res.locals = {
        snipcartApiKey: config.snipcartApiKey,
        formatMoney: (number) =&gt; {
            return numeral(number).format(&#39;0.00$&#39;)
        },
        fullUrl: (path) =&gt; {
            return url.format({
                protocol: req.protocol,
                host: req.get(&#39;host&#39;),
                pathname: path
            })
        }
    }
    next()
})

app.use(&#39;/&#39;, products)

app.use((req, res, next) =&gt; {
    res.status(404)
});

app.set(&#39;view engine&#39;, &#39;pug&#39;)
app.set(&#39;views&#39;, path.join(__dirname, &#39;/app/views&#39;))

app.listen(3000, function() {
    console.log(&#39;Listening on port 3000.&#39;);
})

</code></pre>

<p>We&#39;ll then have access to the Snipcart API key and two helper methods in our templates.</p>

<p>If you type: <code>node server.js</code> in your command prompt you should see something like:</p>

<p><img src="media/15244093031262/15244108647779.png" alt="store"/></p>

<p>Pretty neat! Remember when I said we&#39;d come back to the <code>/json</code> route? Now&#39;s the time. One feature we offer that isn&#39;t used enough, in my opinion, is our <a href="https://docs.snipcart.com/configuration/json-crawler">JSON crawler</a>. It&#39;s very useful when you have access to an API or server-side language like we have here.</p>

<p>So we&#39;ll generate a new route that will return the product details in a JSON format that Snipcart can understand. Open <code>products.js</code> router file and add this route handler:</p>

<pre><code>// /app/routers/products.js

router.get(&#39;/products/:id/json&#39;, (req, res, next) =&gt; {
    res.setHeader(&#39;Content-Type&#39;, &#39;application/json&#39;)
    productsService.getProductById(req.params.id)
        .then((product) =&gt; {
            if (!product) {
                next()
            }

            return res.send({
                id: product.sku,
                price: product.price
            })
        })
})

</code></pre>

<p>Whenever we&#39;ll hit this route our app will return a <code>json</code> object that our crawler will understand.</p>

<p>In this file, we are also going to add the route to show the single product details template.</p>

<pre><code>// /app/routers/products.js

router.get(&#39;/products/:id&#39;, (req, res) =&gt; {
    productsService.getProductById(req.params.id)
        .then((product) =&gt; {
            return res.render(&#39;products/details&#39;, {
                product: product
            })
        })
})

</code></pre>

<p>As we did for the products listing, we&#39;ll need to create the <code>products/details.pug</code> view.</p>

<pre><code>// /app/views/products/details.pug

extends ../layout.pug
include ../_mixins/snipcart.pug

block content
    .section
        .container
            .columns
                .card.column.is-half.is-offset-one-quarter
                    .card-image
                        figure.image.is-128x128
                            img(src=product.image.url)
                    .card-content
                        p.title.is-4 #{ product.name }
                            small  #{ formatMoney(product.price) }
                        p #{ product.description }

                    .card-content
                        +snipcart_button(product)
                            span.icon.is-large
                                i.fa.fa-cart-plus                 

</code></pre>

<p>We&#39;ll be using the same <code>mixin</code> that we used earlier to render the buy button.</p>

<h2 id="toc_9">GraphQL &amp; Node.js Express live demo</h2>

<p>You can now browse our demo website, view product details and add them to the cart.</p>

<blockquote>
<p><a href="https://github.com/snipcart/snipcart-graphcms-nodejs">See GitHub code repo</a></p>

<p><a href="https://snipcart-graphcms-nodejs.herokuapp.com/">See live demo</a></p>
</blockquote>

<p>Hope you find the fidget spinner you&#39;re looking for in there!</p>

<h3 id="toc_10">Closing thoughts</h3>

<p>GraphCMS makes it effortless to create easily consumable GraphQL API. The whole demo took me about 2 hours to write, including the learning curve for Apollo and querying a GraphQL API. I hope this will help and inspire you to try these tools! I&#39;m pretty sure that, as developers, we&#39;ll all have to work with this new query language in the near future so it&#39;s a good thing to start learning about it right now.</p>

<p><a href="https://twitter.com/home?status=As%20for%20Express%2C%20it&#x27;s%20very%20easy%20to%20get%20started%20with.%20http%3A%2F%2Fbit.ly%2F2ire4oM%20via%20%40snipcart%20%23nodejs">As for Express, it&#39;s very easy to get started with.</a> Only a few lines of code and you have a web server running that can handle HTTP requests.</p>

<p>If you feel inspired you can visit the <a href="https://github.com/chentsulin/awesome-graphql">GraphQL Awesome list</a> to see all the current possibilities of GraphQL. You can also follow the <a href="https://graphqlweekly.com/">GraphQL Newsletter</a> to stay in the loop!</p>

<hr/>

<p><u>If you found this post valuable, please take a second to <a href="https://twitter.com/home?status=GraphQL%20CMS%20Tutorial%3A%20E-Commerce%20with%20GraphCMS,%20Node.js%20and%20Apollo%20http%3A//bit.ly/2ire4oM%20%40graphcms%20%23graphql%20%23ecommerce">share it on twitter</a>. Found something we missed? Want to discuss your experience with GraphQL, GraphCMS, Node.js or Apollo? Comments are all yours!</u></p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2018/4/22</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='E-Commerce.html'>E-Commerce</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
              


			<div class="row">
			  <div class="large-6 columns">
			  <p class="text-left" style="padding-top:25px;">
			   <a href="all_2.html">&laquo; Prev Page</a>  
			  </p>
			  </div>
			  <div class="large-6 columns">
			<p class="text-right" style="padding-top:25px;">
			 <a href="all_4.html">&raquo; Next Page</a> 
			</p>
			  </div>
			</div>
		</div>
	</div><!-- large 8 -->

 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="http://panlw.github.io/assets/img/logo.png" /></div>
            
                <h1>Junkman</h1>
                <div class="site-des">“拾荒者”一词来自凯文・凯利的《失控》中关于机器学习的故事（“收集癖好机”如何完成他的收集工作）。</div>
                <div class="social">









<a target="_blank" class="github" target="_blank" href="https://github.com/panlw/" title="GitHub">GitHub</a>

  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="Infra.html"><strong>Infra</strong></a>
        
            <a href="Coding.html"><strong>Coding</strong></a>
        
            <a href="Solution.html"><strong>Solution</strong></a>
        
            <a href="Archtect.html"><strong>Archtect</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15248848757950.html">Learn to visualize data with this free D3.js course</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15248846042998.html">Modularizing your GraphQL schema code</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15248840485977.html">The Basics of Web Workers - HTML5 Rocks</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15248829536577.html">A tale of Webpack 4 and how to finally configure it in the right way</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15248824810738.html">理解JWT的使用场景和优劣</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>


  </body>
</html>
