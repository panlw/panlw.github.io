<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Junkman]]></title>
  <link href="http://panlw.github.io/atom.xml" rel="self"/>
  <link href="http://panlw.github.io/"/>
  <updated>2018-09-04T09:27:06+08:00</updated>
  <id>http://panlw.github.io/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://www.mweb.im/">MWeb</generator>
  
  <entry>
    <title type="html"><![CDATA[Securing Spring Boot with JWTs]]></title>
    <link href="http://panlw.github.io/15359384213292.html"/>
    <updated>2018-09-03T09:33:41+08:00</updated>
    <id>http://panlw.github.io/15359384213292.html</id>
    <content type="html"><![CDATA[
<pre><code>Dylan Meeus September 20, 2016
</code></pre>

<blockquote>
<p><a href="https://auth0.com/blog/securing-spring-boot-with-jwts/">https://auth0.com/blog/securing-spring-boot-with-jwts/</a></p>
</blockquote>

<pre><code>Learn how to set up a Spring Boot project using Java, and secure it with JWTs.  
</code></pre>

<p>The approach exposed in this article is <strong>out-of-date</strong> and is left here for reference only. Please, <a href="/blog/implementing-jwt-authentication-on-spring-boot">check out a <strong>better and up-to-date</strong> approach on how to secure Spring Boot applications with JWTs here.</a></p>

<p><strong>TL;DR:</strong> Spring Boot is a technology that makes it easy to create Java and Groovy applications utilizing the full power of Spring, with minimal setup. It allows you to create applications that &#39;just run&#39; without hassle; and even the project setup becomes a breeze. Read on to find out how to set up a fully-functioning project and secure it with JWT in almost no time!</p>

<h2 id="toc_0">Spring Boot Overview</h2>

<p><a href="https://projects.spring.io/spring-boot/">Spring Boot</a> is a technology from <a href="https://pivotal.io/">Pivotal</a>, known for giving us the powerful Spring framework. With Spring Boot, they offer an easy way to set up a project and get it running in no time. They took the approach of valuing convention over configuration, meaning that you will spend a lot less time struggling with the setup and more time focusing on what is unique about your project. Along with having an embedded Tomcat, Jetty, or Undertow, a large number of possible the deployment issues have been eliminated, causing most applications to &#39;just run&#39;.</p>

<p>Above all, Spring Boot is meant to make it <u>easy</u> to get a project running, starting all the way at the beginning by providing multiple ways to set up a Spring Boot project. Let&#39;s jump right into setting up our project and getting our&#39;Hello World&#39;!</p>

<p>If you can&#39;t wait to see the result, feel free to check out the full code on this <a href="https://github.com/auth0-blog/spring-boot-jwts">GitHub repository</a>.</p>

<h2 id="toc_1">Setting Up the Spring Boot Project</h2>

<p>There are various ways to get started with a Spring Boot project. They provide both a <a href="http://start.spring.io/">quick start</a> and a <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/cli-using-the-cli.html">CLI tool</a>. If we didn&#39;t want to use those, we could also set up a project with Spring Boot manually, using either <a href="https://maven.apache.org/">Maven</a> or <a href="https://gradle.org/">Gradle</a> and adding the necessary dependencies ourselves. In this post we will set up a project using the quick start approach, which can be found at <a href="http://start.spring.io/">start.spring.io</a>.</p>

<p>When we head over to the quick start webpage, we are presented with a few options on the main page. We will generate a <u>Maven project</u> with the latest version of Spring Boot (1.5.2 last time I checked). With the Project Metadata we could set up the standard properties of a Maven artifact, but we&#39;ll just leave it at the default for now.</p>

<p>Next, we can search for dependencies. Searching for dependencies is a handy feature once you have used Spring Boot several times and are aware of the available dependencies. Because this is our first project, however, we can click on the link at the bottom that says <u>switch to full version</u>. After doing this, we have a webpage with checkboxes for all the available dependencies. Because we want to create a web project, we&#39;ll tick that checkbox under the <u>web</u> heading.</p>

<p><img src="https://cdn.auth0.com/blog/spring-boot-auth/springboot-start.png" alt=""/></p>

<p>There are a lot of dependencies available that work with Spring Boot out of the box. Many of the common technologies are provided here, such as dependencies for <a href="https://spring.io/understanding/HATEOAS">HATEOAS</a>, <a href="https://en.wikibooks.org/wiki/Java_Persistence/What_is_JPA%3F">JPA</a>, <a href="https://www.mongodb.com/">MongoDB</a>, and <a href="http://www.thymeleaf.org/">Thymeleaf</a>. If we are going to use one of the common Java technologies, chances are good that it can easily be included in our Spring Boot project.</p>

<p>For now, all we really need is the <u>Web</u> dependency, which gives us several things including a Tomcat server and the <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html">Spring MVC framework</a>. Once we click on the <u>Generate Project</u> button, a download containing a starting project for our selected setup will start. Setting up a Spring Boot project really is just a matter of minutes!</p>

<h2 id="toc_2">Our First Spring Boot Application</h2>

<p>Once we have downloaded our zip file, the project can be imported into our favorite editor. At this point, some code is already generated for us. Let&#39;s first take a look at some of the code, to understand what Spring Boot has prepared for us.</p>

<p>As this is a Maven project, we will examine the <code>pom.xml</code> file first. The top of the file is pretty much a standard pom file. It identifies our project by the <code>groupId</code> and the <code>artifactId</code>. Our project also has a name and a description. Next, there is a reference to a parent. This is the parent of all Spring Boot starters, and contains further dependencies needed for the base of Spring Boot. Also, the <code>version</code> tag of the parent, defines the Spring Boot version that we are using.</p>

<p>This is followed by the properties, which tells us something more about the project. Because we have chosen Java 8, the properties also reflect this in the <code>java.version</code> tag.</p>

<p>Here comes the interesting part:</p>

<pre><code>&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;

&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;

</code></pre>

<p>The dependencies presented here are the ones that were selected during the setup. Because we only selected the Web dependency, we will see both <u>Web</u> and <u>Test</u> dependencies (_Test_ is provided by default, for unit testing our application). Although it might look like there are not a lot of dependencies being pulled in, that&#39;s not quite the case. The <code>spring-boot-starter-...</code> dependencies that we enter here actually fetch other dependencies they need. Because this is invisible to us, the pom.xml file looks quite clean, and all the management of those dependencies is taken care of for us as well.</p>

<p>Next, there is one plugin, the <code>spring-boot-maven-plugin</code>. This will let us build and deploy the entire application with one simple Maven command:<code>mvn spring-boot:run</code>. If we try to run this now, there won&#39;t be anything interesting yet. After running that command, we can go to <code>localhost:8080</code>, though all we will see is a &quot;Whitelabel Error Page&quot;. But, if all went well, the compilation worked without any problems and our server is up and running. Time to start doing something interesting with it!</p>

<h2 id="toc_3">Creating a Web Application</h2>

<p>In this part, we will set up a small application that will accept HTTP requests on various paths and return data. To keep this example concise, all the information will be statically provided. At first, we will just expose all the data to everyone; then we will secure some routes with a JWT and provide a login mechanism.</p>

<p>For starters, we will just create a mapping against the root (<code>/</code>) of our webserver in order to verify that this is working; afterwards we can add more specific routes for the various functions that we will offer. When we want to make methods for certain paths, we need to create a <code>RestController</code>. For now we will use our only class for this, and we will add the <code>RestController</code> and <code>EnableAutoConfiguration</code> annotations to this class. The class should be called <code>DemoApplication</code> and it is the only class with a main method.</p>

<pre><code>package com.example;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@SpringBootApplication
@RestController
@EnableAutoConfiguration
public class DemoApplication {

    @RequestMapping(&quot;/&quot;)
    String hello() {
        return &quot;hello world&quot;;
    }

    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }
}

</code></pre>

<p>When we run our application, by using <code>mvn spring-boot:run</code>, we can navigate to <code>localhost:8080</code>, and are presented with a &quot;Hello World&quot; message. An alternative approach would be to use a CLI tool like <code>curl</code> or the <code>postman</code> application to send requests to the webserver. When dealing with JWTs, <a href="https://www.getpostman.com/">postman</a> offers an incredibly convenient way to test our application.</p>

<p>Now we will extend this example a little bit. We will create a new class <code>UserController</code>, which will be once again annotated with <code>@RestController</code>. We will return some static JSON data at route <code>/users</code> to begin with.</p>

<pre><code>package com.example;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class UserController {

  /* Maps to all HTTP actions by default (GET,POST,..)*/
  @RequestMapping(&quot;/users&quot;)
  public @ResponseBody String getUsers() {
    return &quot;{\&quot;users\&quot;:[{\&quot;firstname\&quot;:\&quot;Richard\&quot;, \&quot;lastname\&quot;:\&quot;Feynman\&quot;},&quot; +
           &quot;{\&quot;firstname\&quot;:\&quot;Marie\&quot;,\&quot;lastname\&quot;:\&quot;Curie\&quot;}]}&quot;;
  }
}

</code></pre>

<p>We have some pretty similar code to our original &#39;Hello World&#39;, but now we are returning JSON-encoded data. For this reason, the <code>@ResponseBody</code> annotation has been added. With this annotation, when a request specifies in the headers that it wants to accept <code>application/json</code>, the data will be returned to the client as JSON. When testing this with postman, the returned data look like this:</p>

<pre><code> {
     &quot;user&quot;: [{
         &quot;firstname&quot;: &quot;Richard&quot;,
         &quot;lastname&quot;: &quot;Feynman&quot;
     }, {
         &quot;firstname&quot;: &quot;Marie&quot;,
         &quot;lastname&quot;: &quot;Curie&quot;
     }]
 }

</code></pre>

<h2 id="toc_4">Securing Spring Boot Application With JWT</h2>

<p><a href="/blog/implementing-jwt-authentication-on-spring-boot">A <strong>better and easier</strong> way on how to secure Spring Boot with JWTs is explained here. Take a look!</a></p>

<p>At this point, our application is exposed to everyone. Anyone can query our webserver and request a list of all the users. We&#39;d prefer that it&#39;s only exposed to people who are logged in. For this purpose, we will secure our application with JSON Web Tokens (JWTs).</p>

<p>JWT is a relatively new technology, defined in <a href="https://tools.ietf.org/html/rfc7519">rfc-7519</a>. It defines a compact, URL-safe way of sharing data between parties using a JSON object. The information is signed with either a secret (using an HMAC) or a public/private key-pair using RSA. If you want to learn more about <a href="https://auth0.com/learn/json-web-tokens/">JWTs</a>, we&#39;ve got you covered!</p>

<h3 id="toc_5">Adding Secure Routes</h3>

<p>The first step is to secure some routes of our application. For this demo we will expose the routes <code>/</code> and <code>/login</code> to everyone, and only expose <code>/users</code> to people whom can provide a valid JWT token. To achieve this, we start by adding <code>spring-boot-starter-security</code> to our <code>pom.xml</code>. This will give us the necessary classes to start working with authentication in Spring Boot. In addition, we will add a dependency to manage our JWTs.</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
    &lt;artifactId&gt;jjwt&lt;/artifactId&gt;
    &lt;version&gt;0.7.0&lt;/version&gt;
&lt;/dependency&gt;

</code></pre>

<p>Once we have updated the <code>pom.xml</code> file and imported the new dependencies, we are ready to start securing our routes. First of all, we want to avoid exposing <code>/users</code> to everyone, so we will create a configuration that restricts its access. We will accomplish this by adding a new class called <code>WebSecurityConfig</code> that extends the <code>WebSecurityConfigurerAdapter</code> class from Spring Security. Let&#39;s add this new class, under a new package called <code>com.example.security</code>, with the following content:</p>

<pre><code>package com.example.security;

import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;

@Configuration
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
  @Override
  protected void configure(HttpSecurity http) throws Exception {
    http.csrf().disable().authorizeRequests()
        .antMatchers(&quot;/&quot;).permitAll()
        .antMatchers(HttpMethod.POST, &quot;/login&quot;).permitAll()
        .anyRequest().authenticated()
        .and()
        // We filter the api/login requests
        .addFilterBefore(new JWTLoginFilter(&quot;/login&quot;, authenticationManager()),
                UsernamePasswordAuthenticationFilter.class)
        // And filter other requests to check the presence of JWT in header
        .addFilterBefore(new JWTAuthenticationFilter(),
                UsernamePasswordAuthenticationFilter.class);
  }

  @Override
  protected void configure(AuthenticationManagerBuilder auth) throws Exception {
    // Create a default account
    auth.inMemoryAuthentication()
        .withUser(&quot;admin&quot;)
        .password(&quot;password&quot;)
        .roles(&quot;ADMIN&quot;);
  }
}

</code></pre>

<p>Here we have decided that everyone can access the <code>/</code> route, and that the <code>/login</code> route is only publicly available for <code>POST</code> requests. For all other routes, authentication is required. You may have noted that the <code>JWTLoginFilter</code> class and the <code>JWTAuthenticationFilter</code> class are missing. We will create them soon, but their goal is to filter for the <code>/login</code> route, and every other route, to decide what should happen when someone access these routes. In this class, we also added a default account that we can use to test our application.</p>

<p>The great thing here is that we have now secured our application without having to change code for existing routes. We did not alter our previously created <code>UserController</code>, nor did we have to write any xml-configuration.</p>

<p>The classes <code>JWTLoginFilter</code> and <code>JWTAuthenticationFilter</code> will handle logging in and authenticating users, respectively. Before we can use these classes, however, we need to create a class that can handle JWTs.</p>

<h3 id="toc_6">Creating a JWT Service on Spring Boot</h3>

<p>Our JWT service will deal with the creation and verification of our tokens. In this example, we will create a token based on a username and an expiration time, and then sign it with a secret (using an HMAC). We will use <code>io.jsonwebtoken.Jwts</code> here for creating and verifying our tokens; they also provide a bunch of algorithms we can use to sign our secret.</p>

<p>For this, let&#39;s create a new class called <code>TokenAuthenticationService</code>, under the <code>com.example.security</code>, with the following code:</p>

<pre><code>package com.example.security;

import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import org.springframework.security
            .authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.Date;

import static java.util.Collections.emptyList;

class TokenAuthenticationService {
  static final long EXPIRATIONTIME = 864_000_000; // 10 days
  static final String SECRET = &quot;ThisIsASecret&quot;;
  static final String TOKEN_PREFIX = &quot;Bearer&quot;;
  static final String HEADER_STRING = &quot;Authorization&quot;;

  static void addAuthentication(HttpServletResponse res, String username) {
    String JWT = Jwts.builder()
        .setSubject(username)
        .setExpiration(new Date(System.currentTimeMillis() + EXPIRATIONTIME))
        .signWith(SignatureAlgorithm.HS512, SECRET)
        .compact();
    res.addHeader(HEADER_STRING, TOKEN_PREFIX + &quot; &quot; + JWT);
  }

  static Authentication getAuthentication(HttpServletRequest request) {
    String token = request.getHeader(HEADER_STRING);
    if (token != null) {
      // parse the token.
      String user = Jwts.parser()
          .setSigningKey(SECRET)
          .parseClaimsJws(token.replace(TOKEN_PREFIX, &quot;&quot;))
          .getBody()
          .getSubject();

      return user != null ?
          new UsernamePasswordAuthenticationToken(user, null, emptyList()) :
          null;
    }
    return null;
  }
}

</code></pre>

<h3 id="toc_7">Authenticating with JWTs</h3>

<p>We now have everything set up to use JWTs in our authentication process. We&#39;ll first take a look at the <code>JWTLoginFilter</code> class. This class will intercept <code>POST</code> requests on the <code>/login</code> path and attempt to authenticate the user. When the user is successfully authenticated, it will return a JWT in the <code>Authorization</code> header of the response. Let&#39;s create this class, under the <code>com.example.security</code> package, with the following content:</p>

<pre><code>package com.example.security;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.AuthenticationException;
import org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter;
import org.springframework.security.web.util.matcher.AntPathRequestMatcher;

import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.Collections;

public class JWTLoginFilter extends AbstractAuthenticationProcessingFilter {

  public JWTLoginFilter(String url, AuthenticationManager authManager) {
    super(new AntPathRequestMatcher(url));
    setAuthenticationManager(authManager);
  }

  @Override
  public Authentication attemptAuthentication(
      HttpServletRequest req, HttpServletResponse res)
      throws AuthenticationException, IOException, ServletException {
    AccountCredentials creds = new ObjectMapper()
        .readValue(req.getInputStream(), AccountCredentials.class);
    return getAuthenticationManager().authenticate(
        new UsernamePasswordAuthenticationToken(
            creds.getUsername(),
            creds.getPassword(),
            Collections.emptyList()
        )
    );
  }

  @Override
  protected void successfulAuthentication(
      HttpServletRequest req,
      HttpServletResponse res, FilterChain chain,
      Authentication auth) throws IOException, ServletException {
    TokenAuthenticationService
        .addAuthentication(res, auth.getName());
  }
}

</code></pre>

<p>During the authentication attempt, which is dealt by the <code>attemptAuthentication</code> method, we retrieve the username and password from the request. After they are retrieved, we use the <code>AuthenticationManager</code> to verify that these details match with an existing user. If it does, we enter the <code>successfulAuthentication</code> method. In this method we fetch the name from the authenticated user, and pass it on to <code>TokenAuthenticationService</code>, which will then add a JWT to the response.</p>

<p>Now we will implement the <code>JWTAuthenticationFilter</code> class. Let&#39;s create this class, under the same <code>com.example.security</code> package, with the following content:</p>

<pre><code>package com.example.security;

import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.web.filter.GenericFilterBean;
import org.springframework.security.core.Authentication;
import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletRequest;
import java.io.IOException;

public class JWTAuthenticationFilter extends GenericFilterBean {

  @Override
  public void doFilter(ServletRequest request,
             ServletResponse response,
             FilterChain filterChain)
      throws IOException, ServletException {
    Authentication authentication = TokenAuthenticationService
        .getAuthentication((HttpServletRequest)request);

    SecurityContextHolder.getContext()
        .setAuthentication(authentication);
    filterChain.doFilter(request,response);
  }
}

</code></pre>

<p>What this filter does is to intercept all requests to validate the presence of the JWTâ€“that is, the ones that are not issued to <code>/</code> nor <code>/users</code>. This validation is done with the help of the <code>TokenAuthenticationService</code> class.</p>

<p>We need just one extra class: the <code>AccountCredentials</code> class. This will be used to map request data when a <code>POST</code> call is made to <code>/login</code> path. The request data should contain the username and password as part of the body. Let&#39;s create this class, under the same <code>com.example.security</code> package, with the following content:</p>

<pre><code>package com.example.security;

public class AccountCredentials {

  private String username;
  private String password;
  // getters &amp; setters
}

</code></pre>

<h3 id="toc_8">Running the Spring Boot Application</h3>

<p>Our Spring Boot application is now secured and supports authentication with JWTs, so we can go ahead and run our application again. When our server is up and running, we can test this out by querying <code>http://localhost:8080/users</code>, and we should get a message saying &quot;Access Denied.&quot; To authenticate ourselves, we will send a <code>POST</code> request to <code>/login</code> with our user&#39;s credentials in the body: <code>{&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;password&quot;}</code>.</p>

<p><img src="https://cdn.auth0.com/blog/spring-boot-auth/postman.png" alt=""/></p>

<p>In the response to this request, we will get a token as part of the <u>Authorization</u> header, prefixed by &quot;Bearer&quot;. We can copy this token, with the <code>Bearer</code> prefix, to issue GET requests to our <code>/users</code> path. To do this, alter the request to <code>/users</code> to include a header called <code>Authorization</code>, paste the JWT received when logging in, and launch the request. If all went well, we should once again be presented with the users.</p>

<p><img src="https://cdn.auth0.com/blog/spring-boot-auth/getusers.png" alt=""/></p>

<h2 id="toc_9">Advantages of Spring Boot</h2>

<p>Now that we&#39;ve completed our Spring Boot application, let&#39;s reflect on the advantages this framework gave us:</p>

<ul>
<li><p><strong>Fast development:</strong> Setting up the project took us just a few minutes, getting it to run just a few more.</p></li>
<li><p><strong>Many dependencies managed for us:</strong> While we still had to alter our pom.xml file, we did not have to include too many dependencies. Most of them are added on build time by Maven as dependencies to Spring Boot default libs. Issues of incompatible dependencies are largely gone because of this.</p></li>
<li><p><strong>No XML configuration:</strong> At no point did we have to write XML configuration files: all configuration was done from within Java files by the use of annotations and existing classes and methods.</p></li>
<li><p><strong>Self-contained applications:</strong> The applications we can make with Spring Boot are self-contained. We can simply run the application using one simple command, and the deployment (containing a webserver) is done for us.</p></li>
<li><p><strong>Leverage a mature framework:</strong> Spring Boot can leverage the power of the mature Spring framework, which is something many Java developers are already familiar with, making adoption of Spring Boot more convenient!</p></li>
<li><p><strong>Well documented:</strong> Being well documented is important, and Pivotal has great documentation on how to get started with Spring Boot and Spring. If you&#39;re curious about learning more, you should check out the <a href="https://spring.io/guides">Getting Started Guides</a>.</p></li>
</ul>

<h3 id="toc_10">Spring Boot and MicroServices</h3>

<p>One of the advantages of Spring Boot lies with microservices. Microservices are a successor of the SOA, service oriented architecture. A microservice is responsible for managing a single data domain and the functions thereof. Spring Boot is actually a great example of this principle, as it consists of many different modules that we can use. Recall that during the setup of our application, we could choose between a whole range of these dependencies, dependencies that could be added to our project by including a simple reference to them in our <code>pom.xml</code> file. Each of these dependencies can be thought of as a microservice. Each project would function as a self-contained service that we could then use in other projects.</p>

<p><img src="https://cdn.auth0.com/blog/microservices/Microservices2.png" alt=""/></p>

<p><u>Typical microservices diagram</u></p>

<p>In our example, we have created a REST service that is self-contained. We could focus on writing just the REST api that deals with logging in and retrieving a list of users. We could then create another Spring Boot project for another part of our application (say, for example, a JSP application or desktop client), if we were so inclined. These Spring Boot applications could then communicate with each other via HTTP, but would be largely independent of each other. This all makes Spring Boot a popular choice in modern architectures, and one worth checking out!</p>

<h2 id="toc_11">Aside: Using Spring Boot with Auth0</h2>

<p>Securing Spring Boot APIs with Auth0 is an easy task, as we will see, and brings a lot of great features to the table. With Auth0 we have to write just a few lines of code to get a solid <a href="https://auth0.com/docs/identityproviders">identity management solution</a>, including <a href="https://auth0.com/docs/sso/single-sign-on">single sign-on</a>, user management, support for social identity providers (like Facebook, GitHub, Twitter, etc.), enterprise (Active Directory, LDAP, SAML, etc.), and your own database of users.</p>

<p>For starters, if you haven&#39;t done so yet, this is a good time to sign up for a <a href="https://auth0.com/signup">free Auth0 account</a>. Having an Auth0 account, the first thing that we must do is to <a href="https://manage.auth0.com/#/apis">create a new API on the dashboard</a>. An API is an entity that represents an external resource, capable of accepting and responding to protected resource requests made by client applications. And this is exactly what the Spring Boot app that we just built is, an API.</p>

<p><img src="https://cdn.auth0.com/blog/spring-boot-jwts/create-api.png" alt=""/></p>

<p><strong>Note</strong>, if you don&#39;t already have the APIs menu item, you can enable it by going to your <a href="https://manage.auth0.com/#/account/advanced">Account Settings</a> and in the <strong>Advanced</strong> tab, scroll down until you see <strong>Enable APIs Section</strong> and flip the switch.</p>

<p>When creating an API, we must define three fields: <code>Name</code>, which is just a friendly name for our new API; <code>Identifier</code>, which is a <code>String</code> that we will use when requesting an <code>access_token</code>; and the <code>Signing Algorithm</code>, which defines if this API will use a <a href="https://auth0.com/blog/json-web-token-signing-algorithms-overview/">symmetric or asymmetric algorithm</a> to sign the <code>access_token</code>. In our case, we will fill this fields, respectively, with: <code>Spring Boot Users API</code>; <code>spring-boot-jwts</code>; and <code>RS256</code> (i.e. we will use an asymmetric algorithm).</p>

<p>Auth0 supports different <a href="https://auth0.com/docs/api-auth">OAuth 2.0 flows to request access tokens</a>. In our particular case, to keep the example simple, we are going to use the <a href="https://auth0.com/docs/api-auth/grant/password">APIs &amp; Trusted Clients flow</a>. Keep in mind that this flow, although being the easiest one to implement, is the less secure one and must be used <strong>only</strong> when the the client application is <strong>absolutely trusted</strong>. Most situations will require other flows, and the <a href="https://auth0.com/docs/api-auth/which-oauth-flow-to-use">&quot;Which OAuth 2.0 flow should I use?&quot;</a> article on Auth0 can help on deciding which is the best approach.</p>

<p>To use the <u>APIs &amp; Trusted Clients</u> flow, we must first configure the <code>Default Directory</code> property on our Auth0 account. To do so, head to the <a href="https://manage.auth0.com/#/account">Account settings</a> page and add <code>Username-Password-Authentication</code> as the value of the <code>Default Directory</code> property.</p>

<h3 id="toc_12">Changes to the Project</h3>

<p>Since we are now using Auth0, we don&#39;t need to issue the JWTs ourselves anymore, so there is one dependency that we can remove and a few classes also. All the changes that are required can be found on the <code>auth0</code> <a href="https://github.com/auth0-blog/spring-boot-jwts/tree/auth0">branch on GitHub</a>. But we will go through the changes now.</p>

<p>First, let&#39;s remove the classes that we don&#39;t need anymore. Remove all the files in this list:</p>

<ul>
<li>  <code>src/main/java/com/example/security/AccountCredentials.java</code></li>
<li>  <code>src/main/java/com/example/security/JWTAuthenticationFilter.java</code></li>
<li>  <code>src/main/java/com/example/security/JWTLoginFilter.java</code></li>
<li>  <code>src/main/java/com/example/security/TokenAuthenticationService.java</code></li>
</ul>

<p>And then we remove the following dependency from our <code>pom.xml</code> file:</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
    &lt;artifactId&gt;jjwt&lt;/artifactId&gt;
  &lt;version&gt;0.7.0&lt;/version&gt;
&lt;/dependency&gt;

</code></pre>

<p>Now, under <code>./src/main/resources</code>, there is a file called <code>application.properties</code>. This file needs to be populated with data from your Auth0 account. By default, when creating a new account you will have a &quot;Default App&quot;, which you could use for this. These are the important parts of that config, so remember to replace the values with the values of your application:</p>

<pre><code># spring-boot-jwts is the identifier of the API that we just created
auth0.audience=spring-boot-jwts
# replace YOUR-DOMAIN to get something like https://bkrebs.auth0.com/
auth0.issuer=https://YOUR-DOMAIN.auth0.com/

</code></pre>

<p>Before we jump into the code, we need to add some dependencies to Maven.</p>

<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;com.auth0&lt;/groupId&gt;
  &lt;artifactId&gt;auth0&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;com.auth0&lt;/groupId&gt;
  &lt;artifactId&gt;auth0-spring-security-api&lt;/artifactId&gt;
  &lt;version&gt;1.0.0-rc.2&lt;/version&gt;
&lt;/dependency&gt;

</code></pre>

<p>Once we&#39;ve done this, let&#39;s replace the source code of the <code>WebSecurityConfig</code> class, under the <code>./src/main/java/com/example/security/WebSecurityConfig.java</code> file, with the following:</p>

<pre><code>package com.example.security;

import com.auth0.spring.security.api.JwtWebSecurityConfigurer;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;

@Configuration
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
  @Value(&quot;${auth0.audience}&quot;)
  private String audience;

  @Value(&quot;${auth0.issuer}&quot;)
  private String issuer;

  @Override
  protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests()
        .antMatchers(&quot;/&quot;).permitAll()
        .antMatchers(&quot;/users&quot;).authenticated();

    JwtWebSecurityConfigurer
        .forRS256(audience, issuer)
        .configure(http);
  }
}

</code></pre>

<p>There we have it, this was all that&#39;s required to use Auth0 with Spring Boot. We can jump into testing this application now, once again with Postman or a tool like curl. So let&#39;s run the application:</p>

<pre><code>mvn spring-boot:run

</code></pre>

<p>Before getting an access token to issue requests to our API, we first need to create a new user on Auth0. To do that we have to issue a <code>POST</code> request, which requires a <code>Content-Type</code> header with <code>application/json</code>, to <code>https://bkrebs.auth0.com/dbconnections/signup</code> with the following JSON body:</p>

<pre><code>{
  &quot;client_id&quot;: &quot;hfs2An7Zka9OPbXs0CRpmmmL33IKy4mA&quot;,
  &quot;email&quot;: &quot;user@test.com&quot;,
  &quot;password&quot;: &quot;123123&quot;,
  &quot;connection&quot;: &quot;Username-Password-Authentication&quot;
}

</code></pre>

<p>After that we can get an access token. For that we need to issue a <code>POST</code> request to <code>https://bkrebs.auth0.com/oauth/token</code> that contains a JSON object in the body, which also requires a <code>Content-Type</code> header with <code>application/json</code>, that looks like:</p>

<pre><code>{
  &quot;grant_type&quot;:&quot;password&quot;,
  &quot;username&quot;: &quot;user@test.com&quot;,
  &quot;password&quot;: &quot;123123&quot;,
  &quot;audience&quot;: &quot;spring-boot-jwts&quot;,
  &quot;client_id&quot;: &quot;hfs2An7Zka9OPbXs0CRpmmmL33IKy4mA&quot;,
  &quot;client_secret&quot;: &quot;Hx4eFNAT8TI2POIWXhxWDJ8vWpZxt79DQYUl7e898Uw0ASfc7eY42zPf2H-Gv1n1&quot;
}

</code></pre>

<p>The <code>client_id</code> and <code>client_secret</code> properties, on both requests, must be changed properly. Their values can be found in the <code>Spring Boot Users API (Test Application)</code> application that Auth0 created for us. Head to the <a href="https://manage.auth0.com/#/applications">Applications page</a> to get them.</p>

<p>Issuing this last request will give us an <code>access_token</code>. We will use this token in the header of the <code>GET</code> request that we will send to our Spring Boot API, in a similar manner to how we did it before. Now if we query our endpoint again, we get a list of the users. As we see, integrating Auth0 with Spring Boot is an easy process!</p>

<h2 id="toc_13">Conclusion</h2>

<p>Creating a project with Spring Boot makes development a lot easier. We can save a lot of time otherwise spent on dealing with configuration and deployment, which are now taken care of for us. We can add a great deal of functionality to our project by including another dependency in our pom.xml, and all this gets bundled into one self-contained, easily-deployed application. As you can tell from the start of this project, there is a lot more to explore with Spring Boot, <a href="http://start.spring.io/">so what are you waiting for? ;-)</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java 8 Concurrency Tutorial: Atomic Variables and ConcurrentMap]]></title>
    <link href="http://panlw.github.io/15358820607055.html"/>
    <updated>2018-09-02T17:54:20+08:00</updated>
    <id>http://panlw.github.io/15358820607055.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://winterbe.com/posts/2015/05/22/java8-concurrency-tutorial-atomic-concurrent-map-examples/">https://winterbe.com/posts/2015/05/22/java8-concurrency-tutorial-atomic-concurrent-map-examples/</a></p>
</blockquote>

<p>Welcome to the third part of my tutorial series about multi-threaded programming in Java 8. This tutorial covers two important parts of the Concurrency API: Atomic Variables and Concurrent Maps. Both have been greatly improved with the introduction of lambda expressions and functional programming in the latest Java 8 release. All those new features are described with a bunch of easily understood code samples. Enjoy!</p>

<ul>
<li>  Part 1: <a href="/posts/2015/04/07/java8-concurrency-tutorial-thread-executor-examples/">Threads and Executors</a></li>
<li>  Part 2: <a href="/posts/2015/04/30/java8-concurrency-tutorial-synchronized-locks-examples/">Synchronization and Locks</a></li>
<li>  Part 3: Atomic Variables and ConcurrentMap</li>
</ul>

<p>For simplicity the code samples of this tutorial make use of the two helper methods <code>sleep(seconds)</code> and <code>stop(executor)</code> as defined <a href="https://github.com/winterbe/java8-tutorial/blob/master/src/com/winterbe/java8/samples/concurrent/ConcurrentUtils.java">here</a>.</p>

<h3 id="toc_0">AtomicInteger<a href="#atomicinteger" title="Permalink to this section">#</a></h3>

<p>The package <code>java.concurrent.atomic</code> contains many useful classes to perform atomic operations. An operation is atomic when you can safely perform the operation in parallel on multiple threads without using the <code>synchronized</code> keyword or locks as shown in my <a href="/posts/2015/04/30/java8-concurrency-tutorial-synchronized-locks-examples/">previous tutorial</a>.</p>

<p>Internally, the atomic classes make heavy use of <a href="http://en.wikipedia.org/wiki/Compare-and-swap">compare-and-swap</a> (CAS), an atomic instruction directly supported by most modern CPUs. Those instructions usually are much faster than synchronizing via locks. So my advice is to prefer atomic classes over locks in case you just have to change a single mutable variable concurrently.</p>

<p>Now let&#39;s pick one of the atomic classes for a few examples: <code>AtomicInteger</code></p>

<pre><code>AtomicInteger atomicInt = new AtomicInteger(0);

ExecutorService executor = Executors.newFixedThreadPool(2);

IntStream.range(0, 1000)
    .forEach(i -&gt; executor.submit(atomicInt::incrementAndGet));

stop(executor);

System.out.println(atomicInt.get());    // =&gt; 1000

</code></pre>

<p>By using <code>AtomicInteger</code> as a replacement for <code>Integer</code> we&#39;re able to increment the number concurrently in a thread-safe manor without synchronizing the access to the variable. The method <code>incrementAndGet()</code> is an atomic operation so we can safely call this method from multiple threads.</p>

<p>AtomicInteger supports various kinds of atomic operations. The method <code>updateAndGet()</code> accepts a lambda expression in order to perform arbitrary arithmetic operations upon the integer:</p>

<pre><code>AtomicInteger atomicInt = new AtomicInteger(0);

ExecutorService executor = Executors.newFixedThreadPool(2);

IntStream.range(0, 1000)
    .forEach(i -&gt; {
        Runnable task = () -&gt;
            atomicInt.updateAndGet(n -&gt; n + 2);
        executor.submit(task);
    });

stop(executor);

System.out.println(atomicInt.get());    // =&gt; 2000

</code></pre>

<p>The method <code>accumulateAndGet()</code> accepts another kind of lambda expression of type <code>IntBinaryOperator</code>. We use this method to sum up all values from 0 to 1000 concurrently in the next sample:</p>

<pre><code>AtomicInteger atomicInt = new AtomicInteger(0);

ExecutorService executor = Executors.newFixedThreadPool(2);

IntStream.range(0, 1000)
    .forEach(i -&gt; {
        Runnable task = () -&gt;
            atomicInt.accumulateAndGet(i, (n, m) -&gt; n + m);
        executor.submit(task);
    });

stop(executor);

System.out.println(atomicInt.get());    // =&gt; 499500

</code></pre>

<p>Other useful atomic classes are <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicBoolean.html">AtomicBoolean</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicLong.html">AtomicLong</a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicReference.html">AtomicReference</a>.</p>

<h3 id="toc_1">LongAdder<a href="#longadder" title="Permalink to this section">#</a></h3>

<p>The class <code>LongAdder</code> as an alternative to <code>AtomicLong</code> can be used to consecutively add values to a number.</p>

<pre><code>ExecutorService executor = Executors.newFixedThreadPool(2);

IntStream.range(0, 1000)
    .forEach(i -&gt; executor.submit(adder::increment));

stop(executor);

System.out.println(adder.sumThenReset());   // =&gt; 1000

</code></pre>

<p>LongAdder provides methods <code>add()</code> and <code>increment()</code> just like the atomic number classes and is also thread-safe. But instead of summing up a single result this class maintains a set of variables internally to reduce contention over threads. The actual result can be retrieved by calling <code>sum()</code> or <code>sumThenReset()</code>.</p>

<p>This class is usually preferable over atomic numbers when updates from multiple threads are more common than reads. This is often the case when capturing statistical data, e.g. you want to count the number of requests served on a web server. The drawback of <code>LongAdder</code> is higher memory consumption because a set of variables is held in-memory.</p>

<h3 id="toc_2">LongAccumulator<a href="#longaccumulator" title="Permalink to this section">#</a></h3>

<p>LongAccumulator is a more generalized version of LongAdder. Instead of performing simple add operations the class <code>LongAccumulator</code> builds around a lambda expression of type <code>LongBinaryOperator</code> as demonstrated in this code sample:</p>

<pre><code>LongBinaryOperator op = (x, y) -&gt; 2 * x + y;
LongAccumulator accumulator = new LongAccumulator(op, 1L);

ExecutorService executor = Executors.newFixedThreadPool(2);

IntStream.range(0, 10)
    .forEach(i -&gt; executor.submit(() -&gt; accumulator.accumulate(i)));

stop(executor);

System.out.println(accumulator.getThenReset());     // =&gt; 2539

</code></pre>

<p>We create a LongAccumulator with the function <code>2 * x + y</code> and an initial value of one. With every call to <code>accumulate(i)</code> both the current result and the value <code>i</code> are passed as parameters to the lambda expression.</p>

<p>A <code>LongAccumulator</code> just like <code>LongAdder</code> maintains a set of variables internally to reduce contention over threads.</p>

<h3 id="toc_3">ConcurrentMap<a href="#concurrentmap" title="Permalink to this section">#</a></h3>

<p>The interface <code>ConcurrentMap</code> extends the map interface and defines one of the most useful concurrent collection types. Java 8 introduces functional programming by adding new methods to this interface.</p>

<p>In the next code snippets we use the following sample map to demonstrates those new methods:</p>

<pre><code>ConcurrentMap&lt;String, String&gt; map = new ConcurrentHashMap&lt;&gt;();
map.put(&quot;foo&quot;, &quot;bar&quot;);
map.put(&quot;han&quot;, &quot;solo&quot;);
map.put(&quot;r2&quot;, &quot;d2&quot;);
map.put(&quot;c3&quot;, &quot;p0&quot;);

</code></pre>

<p>The method <code>forEach()</code> accepts a lambda expression of type <code>BiConsumer</code> with both the key and value of the map passed as parameters. It can be used as a replacement to for-each loops to iterate over the entries of the concurrent map. The iteration is performed sequentially on the current thread.</p>

<pre><code>map.forEach((key, value) -&gt; System.out.printf(&quot;%s = %s\n&quot;, key, value));

</code></pre>

<p>The method <code>putIfAbsent()</code> puts a new value into the map only if no value exists for the given key. At least for the <code>ConcurrentHashMap</code> implementation of this method is thread-safe just like <code>put()</code> so you don&#39;t have to synchronize when accessing the map concurrently from different threads:</p>

<pre><code>String value = map.putIfAbsent(&quot;c3&quot;, &quot;p1&quot;);
System.out.println(value);    // p0

</code></pre>

<p>The method <code>getOrDefault()</code> returns the value for the given key. In case no entry exists for this key the passed default value is returned:</p>

<pre><code>String value = map.getOrDefault(&quot;hi&quot;, &quot;there&quot;);
System.out.println(value);    // there

</code></pre>

<p>The method <code>replaceAll()</code> accepts a lambda expression of type <code>BiFunction</code>. BiFunctions take two parameters and return a single value. In this case the function is called with the key and the value of each map entry and returns a new value to be assigned for the current key:</p>

<pre><code>map.replaceAll((key, value) -&gt; &quot;r2&quot;.equals(key) ? &quot;d3&quot; : value);
System.out.println(map.get(&quot;r2&quot;));    // d3

</code></pre>

<p>Instead of replacing all values of the map <code>compute()</code> let&#39;s us transform a single entry. The method accepts both the key to be computed and a bi-function to specify the transformation of the value.</p>

<pre><code>map.compute(&quot;foo&quot;, (key, value) -&gt; value + value);
System.out.println(map.get(&quot;foo&quot;));   // barbar

</code></pre>

<p>In addition to <code>compute()</code> two variants exist: <code>computeIfAbsent()</code> and <code>computeIfPresent()</code>. The functional parameters of these methods only get called if the key is absent or present respectively.</p>

<p>Finally, the method <code>merge()</code> can be utilized to unify a new value with an existing value in the map. Merge accepts a key, the new value to be merged into the existing entry and a bi-function to specify the merging behavior of both values:</p>

<pre><code>map.merge(&quot;foo&quot;, &quot;boo&quot;, (oldVal, newVal) -&gt; newVal + &quot; was &quot; + oldVal);
System.out.println(map.get(&quot;foo&quot;));   // boo was foo

</code></pre>

<h3 id="toc_4">ConcurrentHashMap<a href="#concurrenthashmap" title="Permalink to this section">#</a></h3>

<p>All those methods above are part of the <code>ConcurrentMap</code> interface, thereby available to all implementations of that interface. In addition the most important implementation <code>ConcurrentHashMap</code> has been further enhanced with a couple of new methods to perform parallel operations upon the map.</p>

<p>Just like parallel streams those methods use a special <code>ForkJoinPool</code> available via <code>ForkJoinPool.commonPool()</code> in Java 8. This pool uses a preset parallelism which depends on the number of available cores. Four CPU cores are available on my machine which results in a parallelism of three:</p>

<pre><code>System.out.println(ForkJoinPool.getCommonPoolParallelism());  // 3

</code></pre>

<p>This value can be decreased or increased by setting the following JVM parameter:</p>

<pre><code>-Djava.util.concurrent.ForkJoinPool.common.parallelism=5

</code></pre>

<p>We use the same example map for demonstrating purposes but this time we work upon the concrete implementation <code>ConcurrentHashMap</code> instead of the interface <code>ConcurrentMap</code>, so we can access all public methods from this class:</p>

<pre><code>ConcurrentHashMap&lt;String, String&gt; map = new ConcurrentHashMap&lt;&gt;();
map.put(&quot;foo&quot;, &quot;bar&quot;);
map.put(&quot;han&quot;, &quot;solo&quot;);
map.put(&quot;r2&quot;, &quot;d2&quot;);
map.put(&quot;c3&quot;, &quot;p0&quot;);

</code></pre>

<p>Java 8 introduces three kinds of parallel operations: <code>forEach</code>, <code>search</code> and <code>reduce</code>. Each of those operations are available in four forms accepting functions with keys, values, entries and key-value pair arguments.</p>

<p>All of those methods use a common first argument called <code>parallelismThreshold</code>. This threshold indicates the minimum collection size when the operation should be executed in parallel. E.g. if you pass a threshold of 500 and the actual size of the map is 499 the operation will be performed sequentially on a single thread. In the next examples we use a threshold of one to always force parallel execution for demonstrating purposes.</p>

<h4 id="toc_5">ForEach<a href="#foreach" title="Permalink to this section">#</a></h4>

<p>The method <code>forEach()</code> is capable of iterating over the key-value pairs of the map in parallel. The lambda expression of type <code>BiConsumer</code> is called with the key and value of the current iteration step. In order to visualize parallel execution we print the current threads name to the console. Keep in mind that in my case the underlying <code>ForkJoinPool</code> uses up to a maximum of three threads.</p>

<pre><code>map.forEach(1, (key, value) -&gt;
    System.out.printf(&quot;key: %s; value: %s; thread: %s\n&quot;,
        key, value, Thread.currentThread().getName()));

// key: r2; value: d2; thread: main
// key: foo; value: bar; thread: ForkJoinPool.commonPool-worker-1
// key: han; value: solo; thread: ForkJoinPool.commonPool-worker-2
// key: c3; value: p0; thread: main

</code></pre>

<h4 id="toc_6">Search<a href="#search" title="Permalink to this section">#</a></h4>

<p>The method <code>search()</code> accepts a <code>BiFunction</code> returning a non-null search result for the current key-value pair or <code>null</code> if the current iteration doesn&#39;t match the desired search criteria. As soon as a non-null result is returned further processing is suppressed. Keep in mind that <code>ConcurrentHashMap</code> is unordered. The search function should not depend on the actual processing order of the map. If multiple entries of the map match the given search function the result may be non-deterministic.</p>

<pre><code>String result = map.search(1, (key, value) -&gt; {
    System.out.println(Thread.currentThread().getName());
    if (&quot;foo&quot;.equals(key)) {
        return value;
    }
    return null;
});
System.out.println(&quot;Result: &quot; + result);

// ForkJoinPool.commonPool-worker-2
// main
// ForkJoinPool.commonPool-worker-3
// Result: bar

</code></pre>

<p>Here&#39;s another example searching solely on the values of the map:</p>

<pre><code>String result = map.searchValues(1, value -&gt; {
    System.out.println(Thread.currentThread().getName());
    if (value.length() &gt; 3) {
        return value;
    }
    return null;
});

System.out.println(&quot;Result: &quot; + result);

// ForkJoinPool.commonPool-worker-2
// main
// main
// ForkJoinPool.commonPool-worker-1
// Result: solo

</code></pre>

<h4 id="toc_7">Reduce<a href="#reduce" title="Permalink to this section">#</a></h4>

<p>The method <code>reduce()</code> already known from Java 8 Streams accepts two lambda expressions of type <code>BiFunction</code>. The first function transforms each key-value pair into a single value of any type. The second function combines all those transformed values into a single result, ignoring any possible <code>null</code> values.</p>

<pre><code>String result = map.reduce(1,
    (key, value) -&gt; {
        System.out.println(&quot;Transform: &quot; + Thread.currentThread().getName());
        return key + &quot;=&quot; + value;
    },
    (s1, s2) -&gt; {
        System.out.println(&quot;Reduce: &quot; + Thread.currentThread().getName());
        return s1 + &quot;, &quot; + s2;
    });

System.out.println(&quot;Result: &quot; + result);

// Transform: ForkJoinPool.commonPool-worker-2
// Transform: main
// Transform: ForkJoinPool.commonPool-worker-3
// Reduce: ForkJoinPool.commonPool-worker-3
// Transform: main
// Reduce: main
// Reduce: main
// Result: r2=d2, c3=p0, han=solo, foo=bar

</code></pre>

<p>I hope you&#39;ve enjoyed reading the third part of my tutorial series about Java 8 Concurrency. The code samples from this tutorial are <a href="https://github.com/winterbe/java8-tutorial">hosted on GitHub</a> along with many other Java 8 code snippets. You&#39;re welcome to fork the repo and try it by your own.</p>

<p>If you want to support my work, please share this tutorial with your friends. You should also <a href="https://twitter.com/winterbe_">follow me on Twitter</a> as I constantly tweet about Java and programming related stuff.</p>

<ul>
<li>  Part 1: <a href="/posts/2015/04/07/java8-concurrency-tutorial-thread-executor-examples/">Threads and Executors</a></li>
<li>  Part 2: <a href="/posts/2015/04/30/java8-concurrency-tutorial-synchronized-locks-examples/">Synchronization and Locks</a></li>
<li>  Part 3: Atomic Variables and ConcurrentMap</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java 8 Concurrency Tutorial: Synchronization and Locks]]></title>
    <link href="http://panlw.github.io/15358774987730.html"/>
    <updated>2018-09-02T16:38:18+08:00</updated>
    <id>http://panlw.github.io/15358774987730.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://winterbe.com/posts/2015/04/30/java8-concurrency-tutorial-synchronized-locks-examples/">https://winterbe.com/posts/2015/04/30/java8-concurrency-tutorial-synchronized-locks-examples/</a></p>
</blockquote>

<p>Welcome to the second part of my Java 8 Concurrency Tutorial out of a series of guides teaching multi-threaded programming in Java 8 with easily understood code examples. In the next 15 min you learn how to synchronize access to mutable shared variables via the synchronized keyword, locks and semaphores.</p>

<ul>
<li>  Part 1: <a href="/posts/2015/04/07/java8-concurrency-tutorial-thread-executor-examples/">Threads and Executors</a></li>
<li>  Part 2: Synchronization and Locks</li>
<li>  Part 3: <a href="/posts/2015/05/22/java8-concurrency-tutorial-atomic-concurrent-map-examples/">Atomic Variables and ConcurrentMap</a></li>
</ul>

<p>The majority of concepts shown in this article also work in older versions of Java. However the code samples focus on Java 8 and make heavy use of lambda expressions and new concurrency features. If you&#39;re not yet familiar with lambdas I recommend reading my <a href="/posts/2014/03/16/java-8-tutorial/">Java 8 Tutorial</a> first.</p>

<p>For simplicity the code samples of this tutorial make use of the two helper methods <code>sleep(seconds)</code> and <code>stop(executor)</code> as defined <a href="https://github.com/winterbe/java8-tutorial/blob/master/src/com/winterbe/java8/samples/concurrent/ConcurrentUtils.java">here</a>.</p>

<h3 id="toc_0">Synchronized<a href="#synchronized" title="Permalink to this section">#</a></h3>

<p>In the <a href="(/posts/2015/04/07/java8-concurrency-tutorial-thread-executor-examples/)">previous tutorial</a> we&#39;ve learned how to execute code in parallel via executor services. When writing such multi-threaded code you have to pay particular attention when accessing shared mutable variables concurrently from multiple threads. Let&#39;s just say we want to increment an integer which is accessible simultaneously from multiple threads.</p>

<p>We define a field <code>count</code> with a method <code>increment()</code> to increase count by one:</p>

<pre><code>int count = 0;

void increment() {
    count = count + 1;
}

</code></pre>

<p>When calling this method concurrently from multiple threads we&#39;re in serious trouble:</p>

<pre><code>ExecutorService executor = Executors.newFixedThreadPool(2);

IntStream.range(0, 10000)
    .forEach(i -&gt; executor.submit(this::increment));

stop(executor);

System.out.println(count);  // 9965

</code></pre>

<p>Instead of seeing a constant result count of 10000 the actual result varies with every execution of the above code. The reason is that we share a mutable variable upon different threads without synchronizing the access to this variable which results in a <a href="http://en.wikipedia.org/wiki/Race_condition">race condition</a>.</p>

<p>Three steps have to be performed in order to increment the number: (i) read the current value, (ii) increase this value by one and (iii) write the new value to the variable. If two threads perform these steps in parallel it&#39;s possible that both threads perform step 1 simultaneously thus reading the same current value. This results in lost writes so the actual result is lower. In the above sample 35 increments got lost due to concurrent unsynchronized access to count but you may see different results when executing the code by yourself.</p>

<p>Luckily Java supports thread-synchronization since the early days via the <code>synchronized</code> keyword. We can utilize <code>synchronized</code> to fix the above race conditions when incrementing the count:</p>

<pre><code>synchronized void incrementSync() {
    count = count + 1;
}

</code></pre>

<p>When using <code>incrementSync()</code> concurrently we get the desired result count of 10000. No race conditions occur any longer and the result is stable with every execution of the code:</p>

<pre><code>ExecutorService executor = Executors.newFixedThreadPool(2);

IntStream.range(0, 10000)
    .forEach(i -&gt; executor.submit(this::incrementSync));

stop(executor);

System.out.println(count);  // 10000

</code></pre>

<p>The <code>synchronized</code> keyword is also available as a block statement.</p>

<pre><code>void incrementSync() {
    synchronized (this) {
        count = count + 1;
    }
}

</code></pre>

<p>Internally Java uses a so called <u>monitor</u> also known as <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/locksync.html">monitor lock or intrinsic lock</a> in order to manage synchronization. This monitor is bound to an object, e.g. when using synchronized methods each method share the same monitor of the corresponding object.</p>

<p>All implicit monitors implement the <u>reentrant</u> characteristics. Reentrant means that locks are bound to the current thread. A thread can safely acquire the same lock multiple times without running into deadlocks (e.g. a synchronized method calls another synchronized method on the same object).</p>

<h3 id="toc_1">Locks<a href="#locks" title="Permalink to this section">#</a></h3>

<p>Instead of using implicit locking via the <code>synchronized</code> keyword the Concurrency API supports various explicit locks specified by the <code>Lock</code> interface. Locks support various methods for finer grained lock control thus are more expressive than implicit monitors.</p>

<p>Multiple lock implementations are available in the standard JDK which will be demonstrated in the following sections.</p>

<h4 id="toc_2">ReentrantLock<a href="#reentrantlock" title="Permalink to this section">#</a></h4>

<p>The class <code>ReentrantLock</code> is a mutual exclusion lock with the same basic behavior as the implicit monitors accessed via the <code>synchronized</code> keyword but with extended capabilities. As the name suggests this lock implements reentrant characteristics just as implicit monitors.</p>

<p>Let&#39;s see how the above sample looks like using <code>ReentrantLock</code>:</p>

<pre><code>ReentrantLock lock = new ReentrantLock();
int count = 0;

void increment() {
    lock.lock();
    try {
        count++;
    } finally {
        lock.unlock();
    }
}

</code></pre>

<p>A lock is acquired via <code>lock()</code> and released via <code>unlock()</code>. It&#39;s important to wrap your code into a <code>try/finally</code> block to ensure unlocking in case of exceptions. This method is thread-safe just like the synchronized counterpart. If another thread has already acquired the lock subsequent calls to <code>lock()</code> pause the current thread until the lock has been unlocked. Only one thread can hold the lock at any given time.</p>

<p>Locks support various methods for fine grained control as seen in the next sample:</p>

<pre><code>ExecutorService executor = Executors.newFixedThreadPool(2);
ReentrantLock lock = new ReentrantLock();

executor.submit(() -&gt; {
    lock.lock();
    try {
        sleep(1);
    } finally {
        lock.unlock();
    }
});

executor.submit(() -&gt; {
    System.out.println(&quot;Locked: &quot; + lock.isLocked());
    System.out.println(&quot;Held by me: &quot; + lock.isHeldByCurrentThread());
    boolean locked = lock.tryLock();
    System.out.println(&quot;Lock acquired: &quot; + locked);
});

stop(executor);

</code></pre>

<p>While the first task holds the lock for one second the second task obtains different information about the current state of the lock:</p>

<pre><code>Locked: true
Held by me: false
Lock acquired: false

</code></pre>

<p>The method <code>tryLock()</code> as an alternative to <code>lock()</code> tries to acquire the lock without pausing the current thread. The boolean result must be used to check if the lock has actually been acquired before accessing any shared mutable variables.</p>

<h4 id="toc_3">ReadWriteLock<a href="#readwritelock" title="Permalink to this section">#</a></h4>

<p>The interface <code>ReadWriteLock</code> specifies another type of lock maintaining a pair of locks for read and write access. The idea behind read-write locks is that it&#39;s usually safe to read mutable variables concurrently as long as nobody is writing to this variable. So the read-lock can be held simultaneously by multiple threads as long as no threads hold the write-lock. This can improve performance and throughput in case that reads are more frequent than writes.</p>

<pre><code>ExecutorService executor = Executors.newFixedThreadPool(2);
Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
ReadWriteLock lock = new ReentrantReadWriteLock();

executor.submit(() -&gt; {
    lock.writeLock().lock();
    try {
        sleep(1);
        map.put(&quot;foo&quot;, &quot;bar&quot;);
    } finally {
        lock.writeLock().unlock();
    }
});

</code></pre>

<p>The above example first acquires a write-lock in order to put a new value to the map after sleeping for one second. Before this task has finished two other tasks are being submitted trying to read the entry from the map and sleep for one second:</p>

<pre><code>Runnable readTask = () -&gt; {
    lock.readLock().lock();
    try {
        System.out.println(map.get(&quot;foo&quot;));
        sleep(1);
    } finally {
        lock.readLock().unlock();
    }
};

executor.submit(readTask);
executor.submit(readTask);

stop(executor);

</code></pre>

<p>When you execute this code sample you&#39;ll notice that both read tasks have to wait the whole second until the write task has finished. After the write lock has been released both read tasks are executed in parallel and print the result simultaneously to the console. They don&#39;t have to wait for each other to finish because read-locks can safely be acquired concurrently as long as no write-lock is held by another thread.</p>

<h4 id="toc_4">StampedLock<a href="#stampedlock" title="Permalink to this section">#</a></h4>

<p>Java 8 ships with a new kind of lock called <code>StampedLock</code> which also support read and write locks just like in the example above. In contrast to <code>ReadWriteLock</code> the locking methods of a <code>StampedLock</code> return a stamp represented by a <code>long</code> value. You can use these stamps to either release a lock or to check if the lock is still valid. Additionally stamped locks support another lock mode called <u>optimistic locking</u>.</p>

<p>Let&#39;s rewrite the last example code to use <code>StampedLock</code> instead of <code>ReadWriteLock</code>:</p>

<pre><code>ExecutorService executor = Executors.newFixedThreadPool(2);
Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
StampedLock lock = new StampedLock();

executor.submit(() -&gt; {
    long stamp = lock.writeLock();
    try {
        sleep(1);
        map.put(&quot;foo&quot;, &quot;bar&quot;);
    } finally {
        lock.unlockWrite(stamp);
    }
});

Runnable readTask = () -&gt; {
    long stamp = lock.readLock();
    try {
        System.out.println(map.get(&quot;foo&quot;));
        sleep(1);
    } finally {
        lock.unlockRead(stamp);
    }
};

executor.submit(readTask);
executor.submit(readTask);

stop(executor);

</code></pre>

<p>Obtaining a read or write lock via <code>readLock()</code> or <code>writeLock()</code> returns a stamp which is later used for unlocking within the finally block. Keep in mind that stamped locks don&#39;t implement reentrant characteristics. Each call to lock returns a new stamp and blocks if no lock is available even if the same thread already holds a lock. So you have to pay particular attention not to run into deadlocks.</p>

<p>Just like in the previous <code>ReadWriteLock</code> example both read tasks have to wait until the write lock has been released. Then both read tasks print to the console simultaneously because multiple reads doesn&#39;t block each other as long as no write-lock is held.</p>

<p>The next example demonstrates <u>optimistic locking</u>:</p>

<pre><code>ExecutorService executor = Executors.newFixedThreadPool(2);
StampedLock lock = new StampedLock();

executor.submit(() -&gt; {
    long stamp = lock.tryOptimisticRead();
    try {
        System.out.println(&quot;Optimistic Lock Valid: &quot; + lock.validate(stamp));
        sleep(1);
        System.out.println(&quot;Optimistic Lock Valid: &quot; + lock.validate(stamp));
        sleep(2);
        System.out.println(&quot;Optimistic Lock Valid: &quot; + lock.validate(stamp));
    } finally {
        lock.unlock(stamp);
    }
});

executor.submit(() -&gt; {
    long stamp = lock.writeLock();
    try {
        System.out.println(&quot;Write Lock acquired&quot;);
        sleep(2);
    } finally {
        lock.unlock(stamp);
        System.out.println(&quot;Write done&quot;);
    }
});

stop(executor);

</code></pre>

<p>An optimistic read lock is acquired by calling <code>tryOptimisticRead()</code> which always returns a stamp without blocking the current thread, no matter if the lock is actually available. If there&#39;s already a write lock active the returned stamp equals zero. You can always check if a stamp is valid by calling <code>lock.validate(stamp)</code>.</p>

<p>Executing the above code results in the following output:</p>

<pre><code>Optimistic Lock Valid: true
Write Lock acquired
Optimistic Lock Valid: false
Write done
Optimistic Lock Valid: false

</code></pre>

<p>The optimistic lock is valid right after acquiring the lock. In contrast to normal read locks an optimistic lock doesn&#39;t prevent other threads to obtain a write lock instantaneously. After sending the first thread to sleep for one second the second thread obtains a write lock without waiting for the optimistic read lock to be released. From this point the optimistic read lock is no longer valid. Even when the write lock is released the optimistic read locks stays invalid.</p>

<p>So when working with optimistic locks you have to validate the lock every time <u>after</u> accessing any shared mutable variable to make sure the read was still valid.</p>

<p>Sometimes it&#39;s useful to convert a read lock into a write lock without unlocking and locking again. <code>StampedLock</code> provides the method <code>tryConvertToWriteLock()</code> for that purpose as seen in the next sample:</p>

<pre><code>ExecutorService executor = Executors.newFixedThreadPool(2);
StampedLock lock = new StampedLock();

executor.submit(() -&gt; {
    long stamp = lock.readLock();
    try {
        if (count == 0) {
            stamp = lock.tryConvertToWriteLock(stamp);
            if (stamp == 0L) {
                System.out.println(&quot;Could not convert to write lock&quot;);
                stamp = lock.writeLock();
            }
            count = 23;
        }
        System.out.println(count);
    } finally {
        lock.unlock(stamp);
    }
});

stop(executor);

</code></pre>

<p>The task first obtains a read lock and prints the current value of field <code>count</code> to the console. But if the current value is zero we want to assign a new value of <code>23</code>. We first have to convert the read lock into a write lock to not break potential concurrent access by other threads. Calling <code>tryConvertToWriteLock()</code> doesn&#39;t block but may return a zero stamp indicating that no write lock is currently available. In that case we call <code>writeLock()</code> to block the current thread until a write lock is available.</p>

<h3 id="toc_5">Semaphores<a href="#semaphores" title="Permalink to this section">#</a></h3>

<p>In addition to locks the Concurrency API also supports counting semaphores. Whereas locks usually grant exclusive access to variables or resources, a semaphore is capable of maintaining whole sets of permits. This is useful in different scenarios where you have to limit the amount concurrent access to certain parts of your application.</p>

<p>Here&#39;s an example how to limit access to a long running task simulated by <code>sleep(5)</code>:</p>

<pre><code>ExecutorService executor = Executors.newFixedThreadPool(10);

Semaphore semaphore = new Semaphore(5);

Runnable longRunningTask = () -&gt; {
    boolean permit = false;
    try {
        permit = semaphore.tryAcquire(1, TimeUnit.SECONDS);
        if (permit) {
            System.out.println(&quot;Semaphore acquired&quot;);
            sleep(5);
        } else {
            System.out.println(&quot;Could not acquire semaphore&quot;);
        }
    } catch (InterruptedException e) {
        throw new IllegalStateException(e);
    } finally {
        if (permit) {
            semaphore.release();
        }
    }
}

IntStream.range(0, 10)
    .forEach(i -&gt; executor.submit(longRunningTask));

stop(executor);

</code></pre>

<p>The executor can potentially run 10 tasks concurrently but we use a semaphore of size 5, thus limiting concurrent access to 5. It&#39;s important to use a <code>try/finally</code> block to properly release the semaphore even in case of exceptions.</p>

<p>Executing the above code results in the following output:</p>

<pre><code>Semaphore acquired
Semaphore acquired
Semaphore acquired
Semaphore acquired
Semaphore acquired
Could not acquire semaphore
Could not acquire semaphore
Could not acquire semaphore
Could not acquire semaphore
Could not acquire semaphore

</code></pre>

<p>The semaphores permits access to the actual long running operation simulated by <code>sleep(5)</code> up to a maximum of 5. Every subsequent call to <code>tryAcquire()</code> elapses the maximum wait timeout of one second, resulting in the appropriate console output that no semaphore could be acquired.</p>

<p>This was the second part out of a series of concurrency tutorials. More parts will be released in the near future, so stay tuned. As usual you find all code samples from this article on <a href="https://github.com/winterbe/java8-tutorial">GitHub</a>, so feel free to fork the repo and try it by your own.</p>

<p>I hope you&#39;ve enjoyed this article. If you have any further questions send me your feedback in the comments below. You should also <a href="https://twitter.com/winterbe_">follow me on Twitter</a> for more dev-related stuff!</p>

<ul>
<li>  Part 1: <a href="/posts/2015/04/07/java8-concurrency-tutorial-thread-executor-examples/">Threads and Executors</a></li>
<li>  Part 2: Synchronization and Locks</li>
<li>  Part 3: <a href="/posts/2015/05/22/java8-concurrency-tutorial-atomic-concurrent-map-examples/">Atomic Variables and ConcurrentMap</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java 8 Concurrency Tutorial: Threads and Executors]]></title>
    <link href="http://panlw.github.io/15358757119900.html"/>
    <updated>2018-09-02T16:08:31+08:00</updated>
    <id>http://panlw.github.io/15358757119900.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://winterbe.com/posts/2015/04/07/java8-concurrency-tutorial-thread-executor-examples/">https://winterbe.com/posts/2015/04/07/java8-concurrency-tutorial-thread-executor-examples/</a></p>
</blockquote>

<p>Welcome to the first part of my Java 8 Concurrency tutorial. This guide teaches you <a href="http://en.wikipedia.org/wiki/Concurrent_computing">concurrent programming</a> in Java 8 with easily understood code examples. It&#39;s the first part out of a series of tutorials covering the Java Concurrency API. In the next 15 min you learn how to execute code in parallel via threads, tasks and executor services.</p>

<ul>
<li>  Part 1: Threads and Executors</li>
<li>  Part 2: <a href="/posts/2015/04/30/java8-concurrency-tutorial-synchronized-locks-examples/">Synchronization and Locks</a></li>
<li>  Part 3: <a href="/posts/2015/05/22/java8-concurrency-tutorial-atomic-concurrent-map-examples/">Atomic Variables and ConcurrentMap</a></li>
</ul>

<p>The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/package-summary.html">Concurrency API</a> was first introduced with the release of Java 5 and then progressively enhanced with every new Java release. The majority of concepts shown in this article also work in older versions of Java. However my code samples focus on Java 8 and make heavy use of lambda expressions and other new features. If you&#39;re not yet familiar with lambdas I recommend reading my <a href="/posts/2014/03/16/java-8-tutorial/">Java 8 Tutorial</a> first.</p>

<h3 id="toc_0">Threads and Runnables<a href="#threads-and-runnables" title="Permalink to this section">#</a></h3>

<p>All modern operating systems support concurrency both via <a href="http://en.wikipedia.org/wiki/Process_(computing)">processes</a> and <a href="http://en.wikipedia.org/wiki/Thread_%28computing%29">threads</a>. Processes are instances of programs which typically run independent to each other, e.g. if you start a java program the operating system spawns a new process which runs in parallel to other programs. Inside those processes we can utilize threads to execute code concurrently, so we can make the most out of the available cores of the CPU.</p>

<p>Java supports <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html">Threads</a> since JDK 1.0. Before starting a new thread you have to specify the code to be executed by this thread, often called the <u>task</u>. This is done by implementing <code>Runnable</code> - a functional interface defining a single void no-args method <code>run()</code> as demonstrated in the following example:</p>

<pre><code>Runnable task = () -&gt; {
    String threadName = Thread.currentThread().getName();
    System.out.println(&quot;Hello &quot; + threadName);
};

task.run();

Thread thread = new Thread(task);
thread.start();

System.out.println(&quot;Done!&quot;);

</code></pre>

<p>Since <code>Runnable</code> is a functional interface we can utilize Java 8 lambda expressions to print the current threads name to the console. First we execute the runnable directly on the main thread before starting a new thread.</p>

<p>The result on the console might look like this:</p>

<pre><code>Hello main
Hello Thread-0
Done!

</code></pre>

<p>Or that:</p>

<pre><code>Hello main
Done!
Hello Thread-0

</code></pre>

<p>Due to concurrent execution we cannot predict if the runnable will be invoked before or after printing &#39;done&#39;. The order is non-deterministic, thus making concurrent programming a complex task in larger applications.</p>

<p>Threads can be put to sleep for a certain duration. This is quite handy to simulate long running tasks in the subsequent code samples of this article:</p>

<pre><code>Runnable runnable = () -&gt; {
    try {
        String name = Thread.currentThread().getName();
        System.out.println(&quot;Foo &quot; + name);
        TimeUnit.SECONDS.sleep(1);
        System.out.println(&quot;Bar &quot; + name);
    }
    catch (InterruptedException e) {
        e.printStackTrace();
    }
};

Thread thread = new Thread(runnable);
thread.start();

</code></pre>

<p>When you run the above code you&#39;ll notice the one second delay between the first and the second print statement. <code>TimeUnit</code> is a useful enum for working with units of time. Alternatively you can achieve the same by calling <code>Thread.sleep(1000)</code>.</p>

<p>Working with the <code>Thread</code> class can be very tedious and error-prone. Due to that reason the <strong>Concurrency API</strong> has been introduced back in 2004 with the release of Java 5. The API is located in package <code>java.util.concurrent</code> and contains many useful classes for handling concurrent programming. Since that time the Concurrency API has been enhanced with every new Java release and even Java 8 provides new classes and methods for dealing with concurrency.</p>

<p>Now let&#39;s take a deeper look at one of the most important parts of the Concurrency API - the executor services.</p>

<h3 id="toc_1">Executors<a href="#executors" title="Permalink to this section">#</a></h3>

<p>The Concurrency API introduces the concept of an <code>ExecutorService</code> as a higher level replacement for working with threads directly. Executors are capable of running asynchronous tasks and typically manage a pool of threads, so we don&#39;t have to create new threads manually. All threads of the internal pool will be reused under the hood for revenant tasks, so we can run as many concurrent tasks as we want throughout the life-cycle of our application with a single executor service.</p>

<p>This is how the first thread-example looks like using executors:</p>

<pre><code>ExecutorService executor = Executors.newSingleThreadExecutor();
executor.submit(() -&gt; {
    String threadName = Thread.currentThread().getName();
    System.out.println(&quot;Hello &quot; + threadName);
});

// =&gt; Hello pool-1-thread-1

</code></pre>

<p>The class <code>Executors</code> provides convenient factory methods for creating different kinds of executor services. In this sample we use an executor with a thread pool of size one.</p>

<p>The result looks similar to the above sample but when running the code you&#39;ll notice an important difference: the java process never stops! Executors have to be stopped explicitly - otherwise they keep listening for new tasks.</p>

<p>An <code>ExecutorService</code> provides two methods for that purpose: <code>shutdown()</code> waits for currently running tasks to finish while <code>shutdownNow()</code> interrupts all running tasks and shut the executor down immediately.</p>

<p>This is the preferred way how I typically shutdown executors:</p>

<pre><code>try {
    System.out.println(&quot;attempt to shutdown executor&quot;);
    executor.shutdown();
    executor.awaitTermination(5, TimeUnit.SECONDS);
}
catch (InterruptedException e) {
    System.err.println(&quot;tasks interrupted&quot;);
}
finally {
    if (!executor.isTerminated()) {
        System.err.println(&quot;cancel non-finished tasks&quot;);
    }
    executor.shutdownNow();
    System.out.println(&quot;shutdown finished&quot;);
}

</code></pre>

<p>The executor shuts down softly by waiting a certain amount of time for termination of currently running tasks. After a maximum of five seconds the executor finally shuts down by interrupting all running tasks.</p>

<h4 id="toc_2">Callables and Futures<a href="#callables-and-futures" title="Permalink to this section">#</a></h4>

<p>In addition to <code>Runnable</code> executors support another kind of task named <code>Callable</code>. Callables are functional interfaces just like runnables but instead of being <code>void</code> they return a value.</p>

<p>This lambda expression defines a callable returning an integer after sleeping for one second:</p>

<pre><code>Callable&lt;Integer&gt; task = () -&gt; {
    try {
        TimeUnit.SECONDS.sleep(1);
        return 123;
    }
    catch (InterruptedException e) {
        throw new IllegalStateException(&quot;task interrupted&quot;, e);
    }
};

</code></pre>

<p>Callables can be submitted to executor services just like runnables. But what about the callables result? Since <code>submit()</code> doesn&#39;t wait until the task completes, the executor service cannot return the result of the callable directly. Instead the executor returns a special result of type <code>Future</code> which can be used to retrieve the actual result at a later point in time.</p>

<pre><code>ExecutorService executor = Executors.newFixedThreadPool(1);
Future&lt;Integer&gt; future = executor.submit(task);

System.out.println(&quot;future done? &quot; + future.isDone());

Integer result = future.get();

System.out.println(&quot;future done? &quot; + future.isDone());
System.out.print(&quot;result: &quot; + result);

</code></pre>

<p>After submitting the callable to the executor we first check if the future has already been finished execution via <code>isDone()</code>. I&#39;m pretty sure this isn&#39;t the case since the above callable sleeps for one second before returning the integer.</p>

<p>Calling the method <code>get()</code> blocks the current thread and waits until the callable completes before returning the actual result <code>123</code>. Now the future is finally done and we see the following result on the console:</p>

<pre><code>future done? false
future done? true
result: 123

</code></pre>

<p>Futures are tightly coupled to the underlying executor service. Keep in mind that every non-terminated future will throw exceptions if you shutdown the executor:</p>

<pre><code>executor.shutdownNow();
future.get();

</code></pre>

<p>You might have noticed that the creation of the executor slightly differs from the previous example. We use <code>newFixedThreadPool(1)</code> to create an executor service backed by a thread-pool of size one. This is equivalent to <code>newSingleThreadExecutor()</code> but we could later increase the pool size by simply passing a value larger than one.</p>

<h4 id="toc_3">Timeouts<a href="#timeouts" title="Permalink to this section">#</a></h4>

<p>Any call to <code>future.get()</code> will block and wait until the underlying callable has been terminated. In the worst case a callable runs forever - thus making your application unresponsive. You can simply counteract those scenarios by passing a timeout:</p>

<pre><code>ExecutorService executor = Executors.newFixedThreadPool(1);

Future&lt;Integer&gt; future = executor.submit(() -&gt; {
    try {
        TimeUnit.SECONDS.sleep(2);
        return 123;
    }
    catch (InterruptedException e) {
        throw new IllegalStateException(&quot;task interrupted&quot;, e);
    }
});

future.get(1, TimeUnit.SECONDS);

</code></pre>

<p>Executing the above code results in a <code>TimeoutException</code>:</p>

<pre><code>Exception in thread &quot;main&quot; java.util.concurrent.TimeoutException
    at java.util.concurrent.FutureTask.get(FutureTask.java:205)

</code></pre>

<p>You might already have guessed why this exception is thrown: We specified a maximum wait time of one second but the callable actually needs two seconds before returning the result.</p>

<h4 id="toc_4">InvokeAll<a href="#invokeall" title="Permalink to this section">#</a></h4>

<p>Executors support batch submitting of multiple callables at once via <code>invokeAll()</code>. This method accepts a collection of callables and returns a list of futures.</p>

<pre><code>ExecutorService executor = Executors.newWorkStealingPool();

List&lt;Callable&lt;String&gt;&gt; callables = Arrays.asList(
        () -&gt; &quot;task1&quot;,
        () -&gt; &quot;task2&quot;,
        () -&gt; &quot;task3&quot;);

executor.invokeAll(callables)
    .stream()
    .map(future -&gt; {
        try {
            return future.get();
        }
        catch (Exception e) {
            throw new IllegalStateException(e);
        }
    })
    .forEach(System.out::println);

</code></pre>

<p>In this example we utilize Java 8 functional streams in order to process all futures returned by the invocation of <code>invokeAll</code>. We first map each future to its return value and then print each value to the console. If you&#39;re not yet familiar with streams read my <a href="/posts/2014/07/31/java8-stream-tutorial-examples/">Java 8 Stream Tutorial</a>.</p>

<h4 id="toc_5">InvokeAny<a href="#invokeany" title="Permalink to this section">#</a></h4>

<p>Another way of batch-submitting callables is the method <code>invokeAny()</code> which works slightly different to <code>invokeAll()</code>. Instead of returning future objects this method blocks until the first callable terminates and returns the result of that callable.</p>

<p>In order to test this behavior we use this helper method to simulate callables with different durations. The method returns a callable that sleeps for a certain amount of time until returning the given result:</p>

<pre><code>Callable&lt;String&gt; callable(String result, long sleepSeconds) {
    return () -&gt; {
        TimeUnit.SECONDS.sleep(sleepSeconds);
        return result;
    };
}

</code></pre>

<p>We use this method to create a bunch of callables with different durations from one to three seconds. Submitting those callables to an executor via <code>invokeAny()</code> returns the string result of the fastest callable - in that case task2:</p>

<pre><code>ExecutorService executor = Executors.newWorkStealingPool();

List&lt;Callable&lt;String&gt;&gt; callables = Arrays.asList(
    callable(&quot;task1&quot;, 2),
    callable(&quot;task2&quot;, 1),
    callable(&quot;task3&quot;, 3));

String result = executor.invokeAny(callables);
System.out.println(result);

// =&gt; task2

</code></pre>

<p>The above example uses yet another type of executor created via <code>newWorkStealingPool()</code>. This factory method is part of Java 8 and returns an executor of type <code>ForkJoinPool</code> which works slightly different than normal executors. Instead of using a fixed size thread-pool <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinPool.html">ForkJoinPools</a> are created for a given parallelism size which per default is the number of available cores of the hosts CPU.</p>

<p>ForkJoinPools exist since Java 7 and will be covered in detail in a later tutorial of this series. Let&#39;s finish this tutorial by taking a deeper look at scheduled executors.</p>

<h3 id="toc_6">Scheduled Executors<a href="#scheduled-executors" title="Permalink to this section">#</a></h3>

<p>We&#39;ve already learned how to submit and run tasks once on an executor. In order to periodically run common tasks multiple times, we can utilize scheduled thread pools.</p>

<p>A <code>ScheduledExecutorService</code> is capable of scheduling tasks to run either periodically or once after a certain amount of time has elapsed.</p>

<p>This code sample schedules a task to run after an initial delay of three seconds has passed:</p>

<pre><code>ScheduledExecutorService executor = Executors.newScheduledThreadPool(1);

Runnable task = () -&gt; System.out.println(&quot;Scheduling: &quot; + System.nanoTime());
ScheduledFuture&lt;?&gt; future = executor.schedule(task, 3, TimeUnit.SECONDS);

TimeUnit.MILLISECONDS.sleep(1337);

long remainingDelay = future.getDelay(TimeUnit.MILLISECONDS);
System.out.printf(&quot;Remaining Delay: %sms&quot;, remainingDelay);

</code></pre>

<p>Scheduling a task produces a specialized future of type <code>ScheduledFuture</code> which - in addition to <code>Future</code> - provides the method <code>getDelay()</code> to retrieve the remaining delay. After this delay has elapsed the task will be executed concurrently.</p>

<p>In order to schedule tasks to be executed periodically, executors provide the two methods <code>scheduleAtFixedRate()</code> and <code>scheduleWithFixedDelay()</code>. The first method is capable of executing tasks with a fixed time rate, e.g. once every second as demonstrated in this example:</p>

<pre><code>ScheduledExecutorService executor = Executors.newScheduledThreadPool(1);

Runnable task = () -&gt; System.out.println(&quot;Scheduling: &quot; + System.nanoTime());

int initialDelay = 0;
int period = 1;
executor.scheduleAtFixedRate(task, initialDelay, period, TimeUnit.SECONDS);

</code></pre>

<p>Additionally this method accepts an initial delay which describes the leading wait time before the task will be executed for the first time.</p>

<p>Please keep in mind that <code>scheduleAtFixedRate()</code> doesn&#39;t take into account the actual duration of the task. So if you specify a period of one second but the task needs 2 seconds to be executed then the thread pool will working to capacity very soon.</p>

<p>In that case you should consider using <code>scheduleWithFixedDelay()</code> instead. This method works just like the counterpart described above. The difference is that the wait time period applies between the end of a task and the start of the next task. For example:</p>

<pre><code>ScheduledExecutorService executor = Executors.newScheduledThreadPool(1);

Runnable task = () -&gt; {
    try {
        TimeUnit.SECONDS.sleep(2);
        System.out.println(&quot;Scheduling: &quot; + System.nanoTime());
    }
    catch (InterruptedException e) {
        System.err.println(&quot;task interrupted&quot;);
    }
};

executor.scheduleWithFixedDelay(task, 0, 1, TimeUnit.SECONDS);

</code></pre>

<p>This example schedules a task with a fixed delay of one second between the end of an execution and the start of the next execution. The initial delay is zero and the tasks duration is two seconds. So we end up with an execution interval of 0s, 3s, 6s, 9s and so on. As you can see <code>scheduleWithFixedDelay()</code> is handy if you cannot predict the duration of the scheduled tasks.</p>

<p>This was the first part out of a series of concurrency tutorials. I recommend practicing the shown code samples by your own. You find all code samples from this article on <a href="https://github.com/winterbe/java8-tutorial">GitHub</a>, so feel free to fork the repo and <a href="https://github.com/winterbe/java8-tutorial/stargazers">give me star</a>.</p>

<p>I hope you&#39;ve enjoyed this article. If you have any further questions send me your feedback in the comments below or via <a href="https://twitter.com/winterbe_">Twitter</a>.</p>

<ul>
<li>  Part 1: Threads and Executors</li>
<li>  Part 2: <a href="/posts/2015/04/30/java8-concurrency-tutorial-synchronized-locks-examples/">Synchronization and Locks</a></li>
<li>  Part 3: <a href="/posts/2015/05/22/java8-concurrency-tutorial-atomic-concurrent-map-examples/">Atomic Variables and ConcurrentMap</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java 8 Stream Tutorial]]></title>
    <link href="http://panlw.github.io/15358756631902.html"/>
    <updated>2018-09-02T16:07:43+08:00</updated>
    <id>http://panlw.github.io/15358756631902.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/">https://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/</a></p>
</blockquote>

<p>This example-driven tutorial gives an in-depth overview about Java 8 streams. When I first read about the <code>Stream</code> API, I was confused about the name since it sounds similar to <code>InputStream</code> and <code>OutputStream</code> from Java I/O. But Java 8 streams are a completely different thing. Streams are <a href="http://en.wikipedia.org/wiki/Monad_%28functional_programming%29">Monads</a>, thus playing a big part in bringing <u>functional programming</u> to Java:</p>

<blockquote>
<p>In functional programming, a monad is a structure that represents computations defined as sequences of steps. A type with a monad structure defines what it means to chain operations, or nest functions of that type together.</p>
</blockquote>

<p>This guide teaches you how to work with Java 8 streams and how to use the different kind of available stream operations. You&#39;ll learn about the processing order and how the ordering of stream operations affect runtime performance. The more powerful stream operations <code>reduce</code>, <code>collect</code> and <code>flatMap</code> are covered in detail. The tutorial ends with an in-depth look at parallel streams.</p>

<p>If you&#39;re not yet familiar with Java 8 lambda expressions, functional interfaces and method references, you probably want to read my <a href="http://winterbe.com/posts/2014/03/16/java-8-tutorial/">Java 8 Tutorial</a> first before starting with this tutorial.</p>

<h3 id="toc_0">How streams work<a href="#how-streams-work" title="Permalink to this section">#</a></h3>

<p>A stream represents a sequence of elements and supports different kind of operations to perform computations upon those elements:</p>

<pre><code>List&lt;String&gt; myList =
    Arrays.asList(&quot;a1&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;c2&quot;, &quot;c1&quot;);

myList
    .stream()
    .filter(s -&gt; s.startsWith(&quot;c&quot;))
    .map(String::toUpperCase)
    .sorted()
    .forEach(System.out::println);

// C1
// C2

</code></pre>

<p>Stream operations are either intermediate or terminal. Intermediate operations return a stream so we can chain multiple intermediate operations without using semicolons. Terminal operations are either void or return a non-stream result. In the above example <code>filter</code>, <code>map</code> and <code>sorted</code> are intermediate operations whereas <code>forEach</code> is a terminal operation. For a full list of all available stream operations see the <a href="http://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">Stream Javadoc</a>. Such a chain of stream operations as seen in the example above is also known as <u>operation pipeline</u>.</p>

<p>Most stream operations accept some kind of lambda expression parameter, a functional interface specifying the exact behavior of the operation. Most of those operations must be both <u>non-interfering</u> and <u>stateless</u>. What does that mean?</p>

<p>A function is <a href="http://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html#NonInterference">non-interfering</a> when it does not modify the underlying data source of the stream, e.g. in the above example no lambda expression does modify <code>myList</code> by adding or removing elements from the collection.</p>

<p>A function is <a href="http://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html#Statelessness">stateless</a> when the execution of the operation is deterministic, e.g. in the above example no lambda expression depends on any mutable variables or states from the outer scope which might change during execution.</p>

<h3 id="toc_1">Different kind of streams<a href="#different-kind-of-streams" title="Permalink to this section">#</a></h3>

<p>Streams can be created from various data sources, especially collections. Lists and Sets support new methods <code>stream()</code> and <code>parallelStream()</code> to either create a sequential or a parallel stream. Parallel streams are capable of operating on multiple threads and will be covered in a later section of this tutorial. We focus on sequential streams for now:</p>

<pre><code>Arrays.asList(&quot;a1&quot;, &quot;a2&quot;, &quot;a3&quot;)
    .stream()
    .findFirst()
    .ifPresent(System.out::println);  // a1

</code></pre>

<p>Calling the method <code>stream()</code> on a list of objects returns a regular object stream. But we don&#39;t have to create collections in order to work with streams as we see in the next code sample:</p>

<pre><code>Stream.of(&quot;a1&quot;, &quot;a2&quot;, &quot;a3&quot;)
    .findFirst()
    .ifPresent(System.out::println);  // a1

</code></pre>

<p>Just use <code>Stream.of()</code> to create a stream from a bunch of object references.</p>

<p>Besides regular object streams Java 8 ships with special kinds of streams for working with the primitive data types <code>int</code>, <code>long</code> and <code>double</code>. As you might have guessed it&#39;s <code>IntStream</code>, <code>LongStream</code> and <code>DoubleStream</code>.</p>

<p>IntStreams can replace the regular for-loop utilizing <code>IntStream.range()</code>:</p>

<pre><code>IntStream.range(1, 4)
    .forEach(System.out::println);

// 1
// 2
// 3

</code></pre>

<p>All those primitive streams work just like regular object streams with the following differences: Primitive streams use specialized lambda expressions, e.g. <code>IntFunction</code> instead of <code>Function</code> or <code>IntPredicate</code> instead of <code>Predicate</code>. And primitive streams support the additional terminal aggregate operations <code>sum()</code> and <code>average()</code>:</p>

<pre><code>Arrays.stream(new int[] {1, 2, 3})
    .map(n -&gt; 2 * n + 1)
    .average()
    .ifPresent(System.out::println);  // 5.0

</code></pre>

<p>Sometimes it&#39;s useful to transform a regular object stream to a primitive stream or vice versa. For that purpose object streams support the special mapping operations <code>mapToInt()</code>, <code>mapToLong()</code> and <code>mapToDouble</code>:</p>

<pre><code>Stream.of(&quot;a1&quot;, &quot;a2&quot;, &quot;a3&quot;)
    .map(s -&gt; s.substring(1))
    .mapToInt(Integer::parseInt)
    .max()
    .ifPresent(System.out::println);  // 3

</code></pre>

<p>Primitive streams can be transformed to object streams via <code>mapToObj()</code>:</p>

<pre><code>IntStream.range(1, 4)
    .mapToObj(i -&gt; &quot;a&quot; + i)
    .forEach(System.out::println);

// a1
// a2
// a3

</code></pre>

<p>Here&#39;s a combined example: the stream of doubles is first mapped to an int stream and than mapped to an object stream of strings:</p>

<pre><code>Stream.of(1.0, 2.0, 3.0)
    .mapToInt(Double::intValue)
    .mapToObj(i -&gt; &quot;a&quot; + i)
    .forEach(System.out::println);

// a1
// a2
// a3

</code></pre>

<h3 id="toc_2">Processing Order<a href="#processing-order" title="Permalink to this section">#</a></h3>

<p>Now that we&#39;ve learned how to create and work with different kinds of streams, let&#39;s dive deeper into how stream operations are processed under the hood.</p>

<p>An important characteristic of intermediate operations is laziness. Look at this sample where a terminal operation is missing:</p>

<pre><code>Stream.of(&quot;d2&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;b3&quot;, &quot;c&quot;)
    .filter(s -&gt; {
        System.out.println(&quot;filter: &quot; + s);
        return true;
    });

</code></pre>

<p>When executing this code snippet, nothing is printed to the console. That is because intermediate operations will only be executed when a terminal operation is present.</p>

<p>Let&#39;s extend the above example by the terminal operation <code>forEach</code>:</p>

<pre><code>Stream.of(&quot;d2&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;b3&quot;, &quot;c&quot;)
    .filter(s -&gt; {
        System.out.println(&quot;filter: &quot; + s);
        return true;
    })
    .forEach(s -&gt; System.out.println(&quot;forEach: &quot; + s));

</code></pre>

<p>Executing this code snippet results in the desired output on the console:</p>

<pre><code>filter:  d2
forEach: d2
filter:  a2
forEach: a2
filter:  b1
forEach: b1
filter:  b3
forEach: b3
filter:  c
forEach: c

</code></pre>

<p>The order of the result might be surprising. A naive approach would be to execute the operations horizontally one after another on all elements of the stream. But instead each element moves along the chain vertically. The first string &quot;d2&quot; passes <code>filter</code> then <code>forEach</code>, only then the second string &quot;a2&quot; is processed.</p>

<p>This behavior can reduce the actual number of operations performed on each element, as we see in the next example:</p>

<pre><code>Stream.of(&quot;d2&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;b3&quot;, &quot;c&quot;)
    .map(s -&gt; {
        System.out.println(&quot;map: &quot; + s);
        return s.toUpperCase();
    })
    .anyMatch(s -&gt; {
        System.out.println(&quot;anyMatch: &quot; + s);
        return s.startsWith(&quot;A&quot;);
    });

// map:      d2
// anyMatch: D2
// map:      a2
// anyMatch: A2

</code></pre>

<p>The operation <code>anyMatch</code> returns <code>true</code> as soon as the predicate applies to the given input element. This is true for the second element passed &quot;A2&quot;. Due to the vertical execution of the stream chain, <code>map</code> has only to be executed twice in this case. So instead of mapping all elements of the stream, <code>map</code> will be called as few as possible.</p>

<h4 id="toc_3">Why order matters<a href="#why-order-matters" title="Permalink to this section">#</a></h4>

<p>The next example consists of two intermediate operations <code>map</code> and <code>filter</code> and the terminal operation <code>forEach</code>. Let&#39;s once again inspect how those operations are being executed:</p>

<pre><code>Stream.of(&quot;d2&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;b3&quot;, &quot;c&quot;)
    .map(s -&gt; {
        System.out.println(&quot;map: &quot; + s);
        return s.toUpperCase();
    })
    .filter(s -&gt; {
        System.out.println(&quot;filter: &quot; + s);
        return s.startsWith(&quot;A&quot;);
    })
    .forEach(s -&gt; System.out.println(&quot;forEach: &quot; + s));

// map:     d2
// filter:  D2
// map:     a2
// filter:  A2
// forEach: A2
// map:     b1
// filter:  B1
// map:     b3
// filter:  B3
// map:     c
// filter:  C

</code></pre>

<p>As you might have guessed both <code>map</code> and <code>filter</code> are called five times for every string in the underlying collection whereas <code>forEach</code> is only called once.</p>

<p>We can greatly reduce the actual number of executions if we change the order of the operations, moving <code>filter</code> to the beginning of the chain:</p>

<pre><code>Stream.of(&quot;d2&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;b3&quot;, &quot;c&quot;)
    .filter(s -&gt; {
        System.out.println(&quot;filter: &quot; + s);
        return s.startsWith(&quot;a&quot;);
    })
    .map(s -&gt; {
        System.out.println(&quot;map: &quot; + s);
        return s.toUpperCase();
    })
    .forEach(s -&gt; System.out.println(&quot;forEach: &quot; + s));

// filter:  d2
// filter:  a2
// map:     a2
// forEach: A2
// filter:  b1
// filter:  b3
// filter:  c

</code></pre>

<p>Now, <code>map</code> is only called once so the operation pipeline performs much faster for larger numbers of input elements. Keep that in mind when composing complex method chains.</p>

<p>Let&#39;s extend the above example by an additional operation, <code>sorted</code>:</p>

<pre><code>Stream.of(&quot;d2&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;b3&quot;, &quot;c&quot;)
    .sorted((s1, s2) -&gt; {
        System.out.printf(&quot;sort: %s; %s\n&quot;, s1, s2);
        return s1.compareTo(s2);
    })
    .filter(s -&gt; {
        System.out.println(&quot;filter: &quot; + s);
        return s.startsWith(&quot;a&quot;);
    })
    .map(s -&gt; {
        System.out.println(&quot;map: &quot; + s);
        return s.toUpperCase();
    })
    .forEach(s -&gt; System.out.println(&quot;forEach: &quot; + s));

</code></pre>

<p>Sorting is a special kind of intermediate operation. It&#39;s a so called <u>stateful operation</u> since in order to sort a collection of elements you have to maintain state during ordering.</p>

<p>Executing this example results in the following console output:</p>

<pre><code>sort:    a2; d2
sort:    b1; a2
sort:    b1; d2
sort:    b1; a2
sort:    b3; b1
sort:    b3; d2
sort:    c; b3
sort:    c; d2
filter:  a2
map:     a2
forEach: A2
filter:  b1
filter:  b3
filter:  c
filter:  d2

</code></pre>

<p>First, the sort operation is executed on the entire input collection. In other words <code>sorted</code> is executed horizontally. So in this case <code>sorted</code> is called eight times for multiple combinations on every element in the input collection.</p>

<p>Once again we can optimize the performance by reordering the chain:</p>

<pre><code>Stream.of(&quot;d2&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;b3&quot;, &quot;c&quot;)
    .filter(s -&gt; {
        System.out.println(&quot;filter: &quot; + s);
        return s.startsWith(&quot;a&quot;);
    })
    .sorted((s1, s2) -&gt; {
        System.out.printf(&quot;sort: %s; %s\n&quot;, s1, s2);
        return s1.compareTo(s2);
    })
    .map(s -&gt; {
        System.out.println(&quot;map: &quot; + s);
        return s.toUpperCase();
    })
    .forEach(s -&gt; System.out.println(&quot;forEach: &quot; + s));

// filter:  d2
// filter:  a2
// filter:  b1
// filter:  b3
// filter:  c
// map:     a2
// forEach: A2

</code></pre>

<p>In this example <code>sorted</code> is never been called because <code>filter</code> reduces the input collection to just one element. So the performance is greatly increased for larger input collections.</p>

<h3 id="toc_4">Reusing Streams<a href="#reusing-streams" title="Permalink to this section">#</a></h3>

<p>Java 8 streams cannot be reused. As soon as you call any terminal operation the stream is closed:</p>

<pre><code>Stream&lt;String&gt; stream =
    Stream.of(&quot;d2&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;b3&quot;, &quot;c&quot;)
        .filter(s -&gt; s.startsWith(&quot;a&quot;));

stream.anyMatch(s -&gt; true);    // ok
stream.noneMatch(s -&gt; true);   // exception

</code></pre>

<p>Calling <code>noneMatch</code> after <code>anyMatch</code> on the same stream results in the following exception:</p>

<pre><code>java.lang.IllegalStateException: stream has already been operated upon or closed
    at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:229)
    at java.util.stream.ReferencePipeline.noneMatch(ReferencePipeline.java:459)
    at com.winterbe.java8.Streams5.test7(Streams5.java:38)
    at com.winterbe.java8.Streams5.main(Streams5.java:28)

</code></pre>

<p>To overcome this limitation we have to to create a new stream chain for every terminal operation we want to execute, e.g. we could create a stream supplier to construct a new stream with all intermediate operations already set up:</p>

<pre><code>Supplier&lt;Stream&lt;String&gt;&gt; streamSupplier =
    () -&gt; Stream.of(&quot;d2&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;b3&quot;, &quot;c&quot;)
            .filter(s -&gt; s.startsWith(&quot;a&quot;));

streamSupplier.get().anyMatch(s -&gt; true);   // ok
streamSupplier.get().noneMatch(s -&gt; true);  // ok

</code></pre>

<p>Each call to <code>get()</code> constructs a new stream on which we are save to call the desired terminal operation.</p>

<h3 id="toc_5">Advanced Operations<a href="#advanced-operations" title="Permalink to this section">#</a></h3>

<p>Streams support plenty of different operations. We&#39;ve already learned about the most important operations like <code>filter</code> or <code>map</code>. I leave it up to you to discover all other available operations (see <a href="http://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">Stream Javadoc</a>). Instead let&#39;s dive deeper into the more complex operations <code>collect</code>, <code>flatMap</code> and <code>reduce</code>.</p>

<p>Most code samples from this section use the following list of persons for demonstration purposes:</p>

<pre><code>class Person {
    String name;
    int age;

    Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    @Override
    public String toString() {
        return name;
    }
}

List&lt;Person&gt; persons =
    Arrays.asList(
        new Person(&quot;Max&quot;, 18),
        new Person(&quot;Peter&quot;, 23),
        new Person(&quot;Pamela&quot;, 23),
        new Person(&quot;David&quot;, 12));

</code></pre>

<h4 id="toc_6">Collect<a href="#collect" title="Permalink to this section">#</a></h4>

<p>Collect is an extremely useful terminal operation to transform the elements of the stream into a different kind of result, e.g. a <code>List</code>, <code>Set</code> or <code>Map</code>. Collect accepts a <code>Collector</code> which consists of four different operations: a <u>supplier</u>, an <u>accumulator</u>, a <u>combiner</u> and a <u>finisher</u>. This sounds super complicated at first, but the good part is Java 8 supports various built-in collectors via the <code>Collectors</code> class. So for the most common operations you don&#39;t have to implement a collector yourself.</p>

<p>Let&#39;s start with a very common usecase:</p>

<pre><code>List&lt;Person&gt; filtered =
    persons
        .stream()
        .filter(p -&gt; p.name.startsWith(&quot;P&quot;))
        .collect(Collectors.toList());

System.out.println(filtered);    // [Peter, Pamela]

</code></pre>

<p>As you can see it&#39;s very simple to construct a list from the elements of a stream. Need a set instead of list - just use <code>Collectors.toSet()</code>.</p>

<p>The next example groups all persons by age:</p>

<pre><code>Map&lt;Integer, List&lt;Person&gt;&gt; personsByAge = persons
    .stream()
    .collect(Collectors.groupingBy(p -&gt; p.age));

personsByAge
    .forEach((age, p) -&gt; System.out.format(&quot;age %s: %s\n&quot;, age, p));

// age 18: [Max]
// age 23: [Peter, Pamela]
// age 12: [David]

</code></pre>

<p>Collectors are extremely versatile. You can also create aggregations on the elements of the stream, e.g. determining the average age of all persons:</p>

<pre><code>Double averageAge = persons
    .stream()
    .collect(Collectors.averagingInt(p -&gt; p.age));

System.out.println(averageAge);     // 19.0

</code></pre>

<p>If you&#39;re interested in more comprehensive statistics, the summarizing collectors return a special built-in summary statistics object. So we can simply determine <u>min</u>, <u>max</u> and arithmetic <u>average</u> age of the persons as well as the <u>sum</u> and <u>count</u>.</p>

<pre><code>IntSummaryStatistics ageSummary =
    persons
        .stream()
        .collect(Collectors.summarizingInt(p -&gt; p.age));

System.out.println(ageSummary);
// IntSummaryStatistics{count=4, sum=76, min=12, average=19.000000, max=23}

</code></pre>

<p>The next example joins all persons into a single string:</p>

<pre><code>String phrase = persons
    .stream()
    .filter(p -&gt; p.age &gt;= 18)
    .map(p -&gt; p.name)
    .collect(Collectors.joining(&quot; and &quot;, &quot;In Germany &quot;, &quot; are of legal age.&quot;));

System.out.println(phrase);
// In Germany Max and Peter and Pamela are of legal age.

</code></pre>

<p>The join collector accepts a delimiter as well as an optional prefix and suffix.</p>

<p>In order to transform the stream elements into a map, we have to specify how both the keys and the values should be mapped. Keep in mind that the mapped keys must be unique, otherwise an <code>IllegalStateException</code> is thrown. You can optionally pass a merge function as an additional parameter to bypass the exception:</p>

<pre><code>Map&lt;Integer, String&gt; map = persons
    .stream()
    .collect(Collectors.toMap(
        p -&gt; p.age,
        p -&gt; p.name,
        (name1, name2) -&gt; name1 + &quot;;&quot; + name2));

System.out.println(map);
// {18=Max, 23=Peter;Pamela, 12=David}

</code></pre>

<p>Now that we know some of the most powerful built-in collectors, let&#39;s try to build our own special collector. We want to transform all persons of the stream into a single string consisting of all names in upper letters separated by the <code>|</code> pipe character. In order to achieve this we create a new collector via <code>Collector.of()</code>. We have to pass the four ingredients of a collector: a <u>supplier</u>, an <u>accumulator</u>, a <u>combiner</u> and a <u>finisher</u>.</p>

<pre><code>Collector&lt;Person, StringJoiner, String&gt; personNameCollector =
    Collector.of(
        () -&gt; new StringJoiner(&quot; | &quot;),          // supplier
        (j, p) -&gt; j.add(p.name.toUpperCase()),  // accumulator
        (j1, j2) -&gt; j1.merge(j2),               // combiner
        StringJoiner::toString);                // finisher

String names = persons
    .stream()
    .collect(personNameCollector);

System.out.println(names);  // MAX | PETER | PAMELA | DAVID

</code></pre>

<p>Since strings in Java are immutable, we need a helper class like <code>StringJoiner</code> to let the collector construct our string. The supplier initially constructs such a StringJoiner with the appropriate delimiter. The accumulator is used to add each persons upper-cased name to the StringJoiner. The combiner knows how to merge two StringJoiners into one. In the last step the finisher constructs the desired String from the StringJoiner.</p>

<h4 id="toc_7">FlatMap<a href="#flatmap" title="Permalink to this section">#</a></h4>

<p>We&#39;ve already learned how to transform the objects of a stream into another type of objects by utilizing the <code>map</code> operation. Map is kinda limited because every object can only be mapped to exactly one other object. But what if we want to transform one object into multiple others or none at all? This is where <code>flatMap</code> comes to the rescue.</p>

<p>FlatMap transforms each element of the stream into a stream of other objects. So each object will be transformed into zero, one or multiple other objects backed by streams. The contents of those streams will then be placed into the returned stream of the <code>flatMap</code> operation.</p>

<p>Before we see <code>flatMap</code> in action we need an appropriate type hierarchy:</p>

<pre><code>class Foo {
    String name;
    List&lt;Bar&gt; bars = new ArrayList&lt;&gt;();

    Foo(String name) {
        this.name = name;
    }
}

class Bar {
    String name;

    Bar(String name) {
        this.name = name;
    }
}

</code></pre>

<p>Next, we utilize our knowledge about streams to instantiate a couple of objects:</p>

<pre><code>List&lt;Foo&gt; foos = new ArrayList&lt;&gt;();

// create foos
IntStream
    .range(1, 4)
    .forEach(i -&gt; foos.add(new Foo(&quot;Foo&quot; + i)));

// create bars
foos.forEach(f -&gt;
    IntStream
        .range(1, 4)
        .forEach(i -&gt; f.bars.add(new Bar(&quot;Bar&quot; + i + &quot; &lt;- &quot; + f.name))));

</code></pre>

<p>Now we have a list of three foos each consisting of three bars.</p>

<p>FlatMap accepts a function which has to return a stream of objects. So in order to resolve the bar objects of each foo, we just pass the appropriate function:</p>

<pre><code>foos.stream()
    .flatMap(f -&gt; f.bars.stream())
    .forEach(b -&gt; System.out.println(b.name));

// Bar1 &lt;- Foo1
// Bar2 &lt;- Foo1
// Bar3 &lt;- Foo1
// Bar1 &lt;- Foo2
// Bar2 &lt;- Foo2
// Bar3 &lt;- Foo2
// Bar1 &lt;- Foo3
// Bar2 &lt;- Foo3
// Bar3 &lt;- Foo3

</code></pre>

<p>As you can see, we&#39;ve successfully transformed the stream of three foo objects into a stream of nine bar objects.</p>

<p>Finally, the above code example can be simplified into a single pipeline of stream operations:</p>

<pre><code>IntStream.range(1, 4)
    .mapToObj(i -&gt; new Foo(&quot;Foo&quot; + i))
    .peek(f -&gt; IntStream.range(1, 4)
        .mapToObj(i -&gt; new Bar(&quot;Bar&quot; + i + &quot; &lt;- &quot; f.name))
        .forEach(f.bars::add))
    .flatMap(f -&gt; f.bars.stream())
    .forEach(b -&gt; System.out.println(b.name));

</code></pre>

<p>FlatMap is also available for the <code>Optional</code> class introduced in Java 8. Optionals <code>flatMap</code> operation returns an optional object of another type. So it can be utilized to prevent nasty <code>null</code> checks.</p>

<p>Think of a highly hierarchical structure like this:</p>

<pre><code>class Outer {
    Nested nested;
}

class Nested {
    Inner inner;
}

class Inner {
    String foo;
}

</code></pre>

<p>In order to resolve the inner string <code>foo</code> of an outer instance you have to add multiple null checks to prevent possible NullPointerExceptions:</p>

<pre><code>Outer outer = new Outer();
if (outer != null &amp;&amp; outer.nested != null &amp;&amp; outer.nested.inner != null) {
    System.out.println(outer.nested.inner.foo);
}

</code></pre>

<p>The same behavior can be obtained by utilizing optionals <code>flatMap</code> operation:</p>

<pre><code>Optional.of(new Outer())
    .flatMap(o -&gt; Optional.ofNullable(o.nested))
    .flatMap(n -&gt; Optional.ofNullable(n.inner))
    .flatMap(i -&gt; Optional.ofNullable(i.foo))
    .ifPresent(System.out::println);

</code></pre>

<p>Each call to <code>flatMap</code> returns an <code>Optional</code> wrapping the desired object if present or <code>null</code> if absent.</p>

<h4 id="toc_8">Reduce<a href="#reduce" title="Permalink to this section">#</a></h4>

<p>The reduction operation combines all elements of the stream into a single result. Java 8 supports three different kind of <code>reduce</code> methods. The first one reduces a stream of elements to exactly one element of the stream. Let&#39;s see how we can use this method to determine the oldest person:</p>

<pre><code>persons
    .stream()
    .reduce((p1, p2) -&gt; p1.age &gt; p2.age ? p1 : p2)
    .ifPresent(System.out::println);    // Pamela

</code></pre>

<p>The <code>reduce</code> method accepts a <code>BinaryOperator</code> accumulator function. That&#39;s actually a <code>BiFunction</code> where both operands share the same type, in that case <code>Person</code>. BiFunctions are like <code>Function</code> but accept two arguments. The example function compares both persons ages in order to return the person with the maximum age.</p>

<p>The second <code>reduce</code> method accepts both an identity value and a <code>BinaryOperator</code> accumulator. This method can be utilized to construct a new Person with the aggregated names and ages from all other persons in the stream:</p>

<pre><code>Person result =
    persons
        .stream()
        .reduce(new Person(&quot;&quot;, 0), (p1, p2) -&gt; {
            p1.age += p2.age;
            p1.name += p2.name;
            return p1;
        });

System.out.format(&quot;, result.name, result.age);
// name=MaxPeterPamelaDavid; age=76

</code></pre>

<p>The third <code>reduce</code> method accepts three parameters: an identity value, a <code>BiFunction</code> accumulator and a combiner function of type <code>BinaryOperator</code>. Since the identity values type is not restricted to the <code>Person</code> type, we can utilize this reduction to determine the sum of ages from all persons:</p>

<pre><code>Integer ageSum = persons
    .stream()
    .reduce(0, (sum, p) -&gt; sum += p.age, (sum1, sum2) -&gt; sum1 + sum2);

System.out.println(ageSum);  // 76

</code></pre>

<p>As you can see the result is <u>76</u>, but what&#39;s happening exactly under the hood? Let&#39;s extend the above code by some debug output:</p>

<pre><code>Integer ageSum = persons
    .stream()
    .reduce(0,
        (sum, p) -&gt; {
            System.out.format(&quot;accumulator: sum=%s; person=%s\n&quot;, sum, p);
            return sum += p.age;
        },
        (sum1, sum2) -&gt; {
            System.out.format(&quot;combiner: sum1=%s; sum2=%s\n&quot;, sum1, sum2);
            return sum1 + sum2;
        });

// accumulator: sum=0; person=Max
// accumulator: sum=18; person=Peter
// accumulator: sum=41; person=Pamela
// accumulator: sum=64; person=David

</code></pre>

<p>As you can see the accumulator function does all the work. It first get called with the initial identity value <u>0</u> and the first person <u>Max</u>. In the next three steps <code>sum</code> continually increases by the age of the last steps person up to a total age of <u>76</u>.</p>

<p>Wait wat? The combiner never gets called? Executing the same stream in parallel will lift the secret:</p>

<pre><code>Integer ageSum = persons
    .parallelStream()
    .reduce(0,
        (sum, p) -&gt; {
            System.out.format(&quot;accumulator: sum=%s; person=%s\n&quot;, sum, p);
            return sum += p.age;
        },
        (sum1, sum2) -&gt; {
            System.out.format(&quot;combiner: sum1=%s; sum2=%s\n&quot;, sum1, sum2);
            return sum1 + sum2;
        });

// accumulator: sum=0; person=Pamela
// accumulator: sum=0; person=David
// accumulator: sum=0; person=Max
// accumulator: sum=0; person=Peter
// combiner: sum1=18; sum2=23
// combiner: sum1=23; sum2=12
// combiner: sum1=41; sum2=35

</code></pre>

<p>Executing this stream in parallel results in an entirely different execution behavior. Now the combiner is actually called. Since the accumulator is called in parallel, the combiner is needed to sum up the separate accumulated values.</p>

<p>Let&#39;s dive deeper into parallel streams in the next chapter.</p>

<h3 id="toc_9">Parallel Streams<a href="#parallel-streams" title="Permalink to this section">#</a></h3>

<p>Streams can be executed in parallel to increase runtime performance on large amount of input elements. Parallel streams use a common <code>ForkJoinPool</code> available via the static <code>ForkJoinPool.commonPool()</code> method. The size of the underlying thread-pool uses up to five threads - depending on the amount of available physical CPU cores:</p>

<pre><code>ForkJoinPool commonPool = ForkJoinPool.commonPool();
System.out.println(commonPool.getParallelism());    // 3

</code></pre>

<p>On my machine the common pool is initialized with a parallelism of 3 per default. This value can be decreased or increased by setting the following JVM parameter:</p>

<pre><code>-Djava.util.concurrent.ForkJoinPool.common.parallelism=5

</code></pre>

<p>Collections support the method <code>parallelStream()</code> to create a parallel stream of elements. Alternatively you can call the intermediate method <code>parallel()</code> on a given stream to convert a sequential stream to a parallel counterpart.</p>

<p>In order to understate the parallel execution behavior of a parallel stream the next example prints information about the current thread to <code>sout</code>:</p>

<pre><code>Arrays.asList(&quot;a1&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;c2&quot;, &quot;c1&quot;)
    .parallelStream()
    .filter(s -&gt; {
        System.out.format(&quot;filter: %s [%s]\n&quot;,
            s, Thread.currentThread().getName());
        return true;
    })
    .map(s -&gt; {
        System.out.format(&quot;map: %s [%s]\n&quot;,
            s, Thread.currentThread().getName());
        return s.toUpperCase();
    })
    .forEach(s -&gt; System.out.format(&quot;forEach: %s [%s]\n&quot;,
        s, Thread.currentThread().getName()));

</code></pre>

<p>By investigating the debug output we should get a better understanding which threads are actually used to execute the stream operations:</p>

<pre><code>filter:  b1 [main]
filter:  a2 [ForkJoinPool.commonPool-worker-1]
map:     a2 [ForkJoinPool.commonPool-worker-1]
filter:  c2 [ForkJoinPool.commonPool-worker-3]
map:     c2 [ForkJoinPool.commonPool-worker-3]
filter:  c1 [ForkJoinPool.commonPool-worker-2]
map:     c1 [ForkJoinPool.commonPool-worker-2]
forEach: C2 [ForkJoinPool.commonPool-worker-3]
forEach: A2 [ForkJoinPool.commonPool-worker-1]
map:     b1 [main]
forEach: B1 [main]
filter:  a1 [ForkJoinPool.commonPool-worker-3]
map:     a1 [ForkJoinPool.commonPool-worker-3]
forEach: A1 [ForkJoinPool.commonPool-worker-3]
forEach: C1 [ForkJoinPool.commonPool-worker-2]

</code></pre>

<p>As you can see the parallel stream utilizes all available threads from the common <code>ForkJoinPool</code> for executing the stream operations. The output may differ in consecutive runs because the behavior which particular thread is actually used is non-deterministic.</p>

<p>Let&#39;s extend the example by an additional stream operation, <code>sort</code>:</p>

<pre><code>Arrays.asList(&quot;a1&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;c2&quot;, &quot;c1&quot;)
    .parallelStream()
    .filter(s -&gt; {
        System.out.format(&quot;filter: %s [%s]\n&quot;,
            s, Thread.currentThread().getName());
        return true;
    })
    .map(s -&gt; {
        System.out.format(&quot;map: %s [%s]\n&quot;,
            s, Thread.currentThread().getName());
        return s.toUpperCase();
    })
    .sorted((s1, s2) -&gt; {
        System.out.format(&quot;sort: %s &lt;&gt; %s [%s]\n&quot;,
            s1, s2, Thread.currentThread().getName());
        return s1.compareTo(s2);
    })
    .forEach(s -&gt; System.out.format(&quot;forEach: %s [%s]\n&quot;,
        s, Thread.currentThread().getName()));

</code></pre>

<p>The result may look strange at first:</p>

<pre><code>filter:  c2 [ForkJoinPool.commonPool-worker-3]
filter:  c1 [ForkJoinPool.commonPool-worker-2]
map:     c1 [ForkJoinPool.commonPool-worker-2]
filter:  a2 [ForkJoinPool.commonPool-worker-1]
map:     a2 [ForkJoinPool.commonPool-worker-1]
filter:  b1 [main]
map:     b1 [main]
filter:  a1 [ForkJoinPool.commonPool-worker-2]
map:     a1 [ForkJoinPool.commonPool-worker-2]
map:     c2 [ForkJoinPool.commonPool-worker-3]
sort:    A2 &lt;&gt; A1 [main]
sort:    B1 &lt;&gt; A2 [main]
sort:    C2 &lt;&gt; B1 [main]
sort:    C1 &lt;&gt; C2 [main]
sort:    C1 &lt;&gt; B1 [main]
sort:    C1 &lt;&gt; C2 [main]
forEach: A1 [ForkJoinPool.commonPool-worker-1]
forEach: C2 [ForkJoinPool.commonPool-worker-3]
forEach: B1 [main]
forEach: A2 [ForkJoinPool.commonPool-worker-2]
forEach: C1 [ForkJoinPool.commonPool-worker-1]

</code></pre>

<p>It seems that <code>sort</code> is executed sequentially on the main thread only. Actually, <code>sort</code> on a parallel stream uses the new Java 8 method <code>Arrays.parallelSort()</code> under the hood. As stated in <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#parallelSort-T:A-">Javadoc</a> this method decides on the length of the array if sorting will be performed sequentially or in parallel:</p>

<blockquote>
<p>If the length of the specified array is less than the minimum granularity, then it is sorted using the appropriate Arrays.sort method.</p>
</blockquote>

<p>Coming back to the <code>reduce</code> example from the last section. We already found out that the combiner function is only called in parallel but not in sequential streams. Let&#39;s see which threads are actually involved:</p>

<pre><code>List&lt;Person&gt; persons = Arrays.asList(
    new Person(&quot;Max&quot;, 18),
    new Person(&quot;Peter&quot;, 23),
    new Person(&quot;Pamela&quot;, 23),
    new Person(&quot;David&quot;, 12));

persons
    .parallelStream()
    .reduce(0,
        (sum, p) -&gt; {
            System.out.format(&quot;accumulator: sum=%s; person=%s [%s]\n&quot;,
                sum, p, Thread.currentThread().getName());
            return sum += p.age;
        },
        (sum1, sum2) -&gt; {
            System.out.format(&quot;combiner: sum1=%s; sum2=%s [%s]\n&quot;,
                sum1, sum2, Thread.currentThread().getName());
            return sum1 + sum2;
        });

</code></pre>

<p>The console output reveals that both the <u>accumulator</u> and the <u>combiner</u> functions are executed in parallel on all available threads:</p>

<pre><code>accumulator: sum=0; person=Pamela; [main]
accumulator: sum=0; person=Max;    [ForkJoinPool.commonPool-worker-3]
accumulator: sum=0; person=David;  [ForkJoinPool.commonPool-worker-2]
accumulator: sum=0; person=Peter;  [ForkJoinPool.commonPool-worker-1]
combiner:    sum1=18; sum2=23;     [ForkJoinPool.commonPool-worker-1]
combiner:    sum1=23; sum2=12;     [ForkJoinPool.commonPool-worker-2]
combiner:    sum1=41; sum2=35;     [ForkJoinPool.commonPool-worker-2]

</code></pre>

<p>In summary, it can be stated that parallel streams can bring be a nice performance boost to streams with a large amount of input elements. But keep in mind that some parallel stream operations like <code>reduce</code> and <code>collect</code> need additional computations (combine operations) which isn&#39;t needed when executed sequentially.</p>

<p>Furthermore we&#39;ve learned that all parallel stream operations share the same JVM-wide common <code>ForkJoinPool</code>. So you probably want to avoid implementing slow blocking stream operations since that could potentially slow down other parts of your application which rely heavily on parallel streams.</p>

<h3 id="toc_10">That&#39;s it<a href="#thats-it" title="Permalink to this section">#</a></h3>

<p>My programming guide to Java 8 streams ends here. If you&#39;re interested in learning more about Java 8 streams, I recommend to you the <a href="http://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html#NonInterference">Stream Javadoc</a> package documentation. If you want to learn more about the underlying mechanisms, you probably want to read Martin Fowlers article about <a href="http://martinfowler.com/articles/collection-pipeline/">Collection Pipelines</a>.</p>

<p>If you&#39;re interested in JavaScript as well, you may want to have a look at <a href="https://github.com/winterbe/streamjs">Stream.js</a> - a JavaScript implementation of the Java 8 Streams API. You may also wanna read my <a href="/posts/2014/03/16/java-8-tutorial/">Java 8 Tutorial</a> and my <a href="/posts/2014/04/05/java8-nashorn-tutorial/">Java 8 Nashorn Tutorial</a>.</p>

<p>Hopefully this tutorial was helpful to you and you&#39;ve enjoyed reading it. The full source code of the tutorial samples is <a href="https://github.com/winterbe/java8-tutorial">hosted on GitHub</a>. Feel free to <a href="https://github.com/winterbe/java8-tutorial/fork">fork the repository</a> or send me your feedback via <a href="https://twitter.com/winterbe_">Twitter</a>.</p>

<p>Happy coding!</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Migrate Maven Projects to Java 11]]></title>
    <link href="http://panlw.github.io/15358753472382.html"/>
    <updated>2018-09-02T16:02:27+08:00</updated>
    <id>http://panlw.github.io/15358753472382.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://winterbe.com/posts/2018/08/29/migrate-maven-projects-to-java-11-jigsaw/">https://winterbe.com/posts/2018/08/29/migrate-maven-projects-to-java-11-jigsaw/</a></p>
</blockquote>

<p>So you want to migrate to Java 11 but your Maven project is still sitting on Java 8? You don&#39;t care much about the new <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html">module system</a> (Jigsaw) introduced in Java 9, you just want your application to run on the latest JDK version? Then this guide is for you. It includes everything I&#39;ve learned while migrating our product to Java 11.</p>

<blockquote>
<p>As of 2019 Oracle Java 8 will no longer receive free security updates. So now is the time to migrate to <a href="http://jdk.java.net/11/">JDK 11</a>.</p>
</blockquote>

<h3 id="toc_0">Clean up your <code>pom.xml</code> files<a href="#clean-up-your-pom-xml-files" title="Permalink to this section">#</a></h3>

<p>The first thing you should do before even thinking about upgrading the Java version is to clean up your <code>pom.xml</code> files. If your project is a multi-module Maven project then it helps to establish a parent POM and maintain <code>dependencyManagement</code> und <code>pluginManagement</code> in this file. That way all your plugins and dependencies are defined in a single file and are not spread across multiple POM files what makes managing versions easier.</p>

<p>In order to migrate your project to the latest Java version 11 it&#39;s highly recommended to update as much plugins and dependencies to the latest stable version as possible. Many plugins such as the compiler plugin, surefire or failsafe are not compatible with Java 9 if you use older versions. Also a lot of libraries are incompatible without migrating to the latest version.</p>

<p>Make sure you have the versions plugin configured in your master POM:</p>

<pre><code>&lt;plugin&gt;
    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
    &lt;artifactId&gt;versions-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.5&lt;/version&gt;
    &lt;configuration&gt;
        &lt;generateBackupPoms&gt;false&lt;/generateBackupPoms&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;

</code></pre>

<p>This plugin helps finding the latest plugin or dependency versions for your modules. Open up the terminal and execute this command to find the plugin versions you have to update:</p>

<pre><code>mvn versions:display-plugin-updates

</code></pre>

<p>You will see a list of plugins used in your project with newer versions available. Update all of those plugins to the lastest stable version. After you&#39;ve updated your plugin versions make sure that your project still compiles and runs properly.</p>

<blockquote>
<p>You can use <code>mvn -N ...</code> from your projects root directory to just check your parent POM in case of multi-module projects.</p>
</blockquote>

<h3 id="toc_1">Configure plugins for Java 11<a href="#configure-plugins-for-java-11" title="Permalink to this section">#</a></h3>

<p>The most important plugins for Java 11 are the compiler plugin, surefire (for unit-tests) and failsafe (for integration-tests).</p>

<p>In order to compile your project for Java 11 add the <code>release</code> configuration to the compiler plugin, a new compiler parameter to replace the <code>source</code> and <code>target</code> version parameters:</p>

<pre><code>&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
    &lt;version&gt;3.8.0&lt;/version&gt;
    &lt;configuration&gt;
        &lt;release&gt;11&lt;/release&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;

</code></pre>

<blockquote>
<p>Also don&#39;t forget to set your IDEs project SDK to same JDK version. In Intellij IDEA go to Module Settings -&gt; Project -&gt; SDK.</p>
</blockquote>

<p>For surefire and failsafe plugins we add an additional argument <code>--illegal-access=permit</code> to allow all reflection access for third party libraries:</p>

<pre><code>&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.22.0&lt;/version&gt;
    &lt;configuration&gt;
        &lt;argLine&gt;
            --illegal-access=permit
        &lt;/argLine&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.22.0&lt;/version&gt;
    &lt;configuration&gt;
        &lt;argLine&gt;
            --illegal-access=permit
        &lt;/argLine&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;

</code></pre>

<p>This is only needed if your dependencies make heavy use of reflection. If you&#39;re unsure whether you need this you can add the <code>argLine</code> later if your tests run into trouble.</p>

<p>You&#39;ll see warnings like this when a library tries to illegally access classes via <code>setAccessible(true)</code>:</p>

<pre><code>WARNING: Please consider reporting this to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release

</code></pre>

<blockquote>
<p>Keep in mind that later you probably also have to pass the <code>--illegal-access=permit</code> parameter when starting your application.</p>
</blockquote>

<h3 id="toc_2">Update dependencies<a href="#update-dependencies" title="Permalink to this section">#</a></h3>

<p>As mentioned before the best thing you can do is to migrate all your dependencies to the latest stable versions to make sure everything works fine with Java 11. While many older dependencies might work just fine there&#39;s a couple of dependencies where version updates are mandatory, e.g. all those various bytecode enhancement libaries such as <code>javassist</code>, <code>cglib</code>, <code>asm</code> or <code>byte-buddy</code>. Those libraries often come as transitive dependencies so make sure at least those libaries are up-to-date.</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.javassist&lt;/groupId&gt;
    &lt;artifactId&gt;javassist&lt;/artifactId&gt;
    &lt;version&gt;3.23.1-GA&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;cglib&lt;/groupId&gt;
    &lt;artifactId&gt;cglib-nodep&lt;/artifactId&gt;
    &lt;version&gt;3.2.7&lt;/version&gt;
&lt;/dependency&gt;

</code></pre>

<p>This command helps to find outdated dependency versions from your modules:</p>

<pre><code>mvn versions:display-dependency-updates

</code></pre>

<p>Update as much libaries as possible to the latest stable version. If there&#39;s some dependency that you can&#39;t update due to compatibility issues in your project than leave it as is. Chances are that it just runs fine with Java 11.</p>

<p>Now is a good time to compile your project with JDK 11 for the first time:</p>

<pre><code>mvn clean test-compile compile

</code></pre>

<blockquote>
<p>Hint: You can speed up multi-module Maven projects by using parallel builds, e.g. <code>mvn -T 4 compile</code> compiles all modules in parallel on 4 CPU cores.</p>
</blockquote>

<p>You will eventually face different compiler errors such as <code>ClassNotFoundException</code>. Every project is different so I cannot provide solutions for every problem you will face. The rest of this article describes solutions to various problems we had to solve in order to run our application with JDK 11.</p>

<h3 id="toc_3">Add missing modules<a href="#add-missing-modules" title="Permalink to this section">#</a></h3>

<p>With the introduction of the Java module system (Jigsaw) in Java 9 the Java standard libary has been divided into separate modules. While most classes are still available without any changes, some are not. You have to explicitely define which additional modules your application needs access to or you can just add those modules from the Maven central repository.</p>

<blockquote>
<p>The command <code>java --list-modules</code> lists all available modules.</p>
</blockquote>

<p>When migrating our web project to Java 11 we had to add <code>jaxb</code> and <code>javax.annotations</code> to prevent <code>ClassNotFoundException</code>. We&#39;ve added the following libaries as additional Maven dependencies to our POMs:</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;javax.annotation&lt;/groupId&gt;
    &lt;artifactId&gt;javax.annotation-api&lt;/artifactId&gt;
    &lt;version&gt;1.3.2&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;javax.xml.bind&lt;/groupId&gt;
    &lt;artifactId&gt;jaxb-api&lt;/artifactId&gt;
    &lt;version&gt;2.4.0-b180725.0427&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.glassfish.jaxb&lt;/groupId&gt;
    &lt;artifactId&gt;jaxb-runtime&lt;/artifactId&gt;
    &lt;version&gt;2.4.0-b180725.0644&lt;/version&gt;
&lt;/dependency&gt;

</code></pre>

<blockquote>
<p>Instead of adding those libaries via Maven we could utilize the <code>â€“add-modules</code> Java parameter to add additional JDK modules to the project.</p>
</blockquote>

<h3 id="toc_4">Fixing <code>sun.*</code> and <code>com.sun.*</code> imports<a href="#fixing-sun-and-com-sun-imports" title="Permalink to this section">#</a></h3>

<p>While some classes have been moved to additional Java modules other classes can no longer been used in user code, namely classes from <code>sun.*</code> packages and also some classes from <code>com.sun.*</code>. If you get compiler errors because your code links to classes from those packages you have to remove those imports from your code.</p>

<p>Here&#39;s a few things we had to fix in our project:</p>

<ul>
<li>  <code>sun.misc.BASE64Encoder</code>: This can simply be replaced by <code>java.util.Base64.getEncoder()</code> which is available since Java 8.</li>
<li>  <code>sun.reflect.generics.reflectiveObjects.ParameterizedTypeImpl</code>: This class has accidentally been used in our code base and can simply be replaced by the interface type <code>java.lang.reflect.ParameterizedType</code>.</li>
<li>  <code>sun.reflect.annotation.AnnotationParser</code>: We use this class to programmatically create annotation instances. The class is no longer accessible but can be replaced by <code>AnnotationFactory</code> from Hibernate Validator.</li>
<li>  <code>com.sun.org.apache.xml.internal.utils.DefaultErrorHandler</code>: We&#39;ve replaced this class with a custom implementation of the interface.</li>
</ul>

<h3 id="toc_5">Currency formats<a href="#currency-formats" title="Permalink to this section">#</a></h3>

<p>We&#39;ve encountered a curious case with number formats for locales such as <code>Locale.GERMANY</code> which let a bunch of our tests fail with a rather strange assertion error:</p>

<pre><code>java.lang.AssertionError:
Expected: is &quot;9,80 â‚¬&quot;
     but: was &quot;9,80Â â‚¬&quot;

</code></pre>

<p>The underlying code uses <code>NumberFormat.getCurrencyInstance(Locale.GERMANY)</code> to format numbers into the german currency format. So what the heck is happening here?</p>

<p>Javas number formats have been modified to use <a href="https://en.wikipedia.org/wiki/Non-breaking_space">non-breaking spaces</a> instead of normal spaces between the number and the currency symbol. This change makes perfectly sense because it prevents line-breaks between the number and the currency symbol in various presentation formats. Changing the strings in our tests to use non-breaking spaces (use OPTION SPACE on Mac OSX keyboards) fixed this issue.</p>

<h3 id="toc_6">Servlet Container<a href="#servlet-container" title="Permalink to this section">#</a></h3>

<p>When running web applications with Apache Tomcat you need at least Apache Tomcat 7.0.85 or later. Otherwise Tomcat will not start on Java 9 and above and you would see the following error:</p>

<pre><code>/path/to/apache-tomcat-7.0.64/bin/catalina.sh run
-Djava.endorsed.dirs=/path/to/apache-tomcat-7.0.64/endorsed is not supported. Endorsed standards and standalone APIs
Error: Could not create the Java Virtual Machine.
Error: A fatal exception has occurred. Program will exit.
in modular form will be supported via the concept of upgradeable modules.
Disconnected from server

</code></pre>

<p>Also don&#39;t forget to eventually add the additional startup parameter <code>--illegal-access=permit</code> to your servlet container.</p>

<h3 id="toc_7">That&#39;s all<a href="#thats-all" title="Permalink to this section">#</a></h3>

<p>I hope these tips are somewhat useful to you and helps you migrating your application from Java 8 to 11. If you like this guide please consider sharing the link with your followers. Also <a href="https://twitter.com/winterbe_">let me know on Twitter</a> if your migration was successful.</p>

<p>Good luck!</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Zookeeper æ€»è§ˆ]]></title>
    <link href="http://panlw.github.io/15356007721649.html"/>
    <updated>2018-08-30T11:46:12+08:00</updated>
    <id>http://panlw.github.io/15356007721649.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://juejin.im/post/5a3b542d6fb9a0452725c25f">https://juejin.im/post/5a3b542d6fb9a0452725c25f</a></p>

<p>ç¿»è¯‘è‡ª Zookeeper å®˜æ–¹ç½‘ç«™ Release 3.4.11 ç‰ˆæœ¬</p>
</blockquote>

<h2 id="toc_0">Zookeeper</h2>

<ul>
<li>  <a href="#1">Zookeeper: ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨è®¾è®¡çš„<code>åˆ†å¸ƒå¼åè°ƒæœåŠ¡</code></a>

<ul>
<li>  <a href="#1.1">Zookeeper è®¾è®¡ç›®æ ‡</a></li>
<li>  <a href="#1.2">Zookeeper<code>æ•°æ®æ¨¡åž‹</code>å’Œ<code>å±‚çº§å‘½åç©ºé—´</code></a></li>
<li>  <a href="#1.3">Zookeeper<code>é»˜è®¤èŠ‚ç‚¹</code>å’Œ<code>ä¸´æ—¶èŠ‚ç‚¹</code></a></li>
<li>  <a href="#1.4">Zookeeper<code>æ¡ä»¶æ›´æ–°</code>å’Œ<code>ç›‘è§†</code>(watches)</a></li>
<li>  <a href="#1.5">Zookeeper<code>ä¿è¯</code>(Guarantees)</a></li>
<li>  <a href="#1.6">Zookeeper<code>ç®€å•API</code></a></li>
<li>  <a href="#1.7">Zookeeper<code>å®žçŽ°åŽŸç†</code></a></li>
<li>  <a href="#1.8">Zookeeper<code>ä½¿ç”¨</code></a></li>
<li>  <a href="#1.9">Zookeeper<code>æ€§èƒ½</code></a></li>
<li>  <a href="#1.10">Zookeeper<code>å¯é æ€§</code></a></li>
<li>  <a href="#1.11">Zookeeper é¡¹ç›®</a></li>
</ul></li>
</ul>

<h3 id="toc_1"><a id="1">Zookeeper: ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨è®¾è®¡çš„<code>åˆ†å¸ƒå¼åè°ƒæœåŠ¡</code></a></h3>

<p>ZooKeeper æ˜¯ä¸€æ¬¾å¼€æºçš„<code>åˆ†å¸ƒå¼åº”ç”¨</code>çš„<code>åˆ†å¸ƒå¼åè°ƒæœåŠ¡</code>ã€‚å®ƒåŒ…å«ä¸€ä¸ªç®€å•çš„<code>åŽŸè¯­é›†</code>ï¼Œåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥åŸºäºŽå®ƒå®žçŽ°åŒæ­¥æœåŠ¡ï¼Œé…ç½®ç»´æŠ¤å’Œå‘½åæœåŠ¡ç­‰ã€‚Zookeeper è®¾è®¡å¾ˆå®¹æ˜“è¿›è¡Œç¼–ç¨‹ï¼Œå®ƒä½¿ç”¨ä¸€ç§ç±»ä¼¼äºŽæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•æ ‘ç»“æž„çš„æ•°æ®æ¨¡åž‹ï¼Œä»¥ java æ–¹å¼è¿è¡Œï¼Œæœ‰ java å’Œ c çš„ç»‘å®š (binding)ã€‚</p>

<p><code>åè°ƒæœåŠ¡</code>æ˜¯éžå¸¸éš¾ä»¥è¢«æ­£ç¡®å®žçŽ°çš„ã€‚ä»–ä»¬ç‰¹åˆ«å®¹æ˜“äº§ç”Ÿè¯¸å¦‚ç«žæ€æ¡ä»¶ã€æ­»é”ç­‰é”™è¯¯ã€‚ZooKeeper èƒŒåŽçš„åŠ¨æœºæ˜¯ä¸ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå‡è½»ä»Žé›¶å¼€å§‹å®žçŽ°åè°ƒæœåŠ¡çš„éš¾åº¦ã€‚</p>

<h3 id="toc_2"><a id="1.1">è®¾è®¡ç›®æ ‡</a></h3>

<h5 id="toc_3">Zookeeper æ˜¯éžå¸¸ç®€å•çš„ã€‚</h5>

<p>ZooKeeper å…è®¸åˆ†å¸ƒå¼è¿›ç¨‹é€šè¿‡ä¸Žæ ‡å‡†æ–‡ä»¶ç³»ç»Ÿç±»ä¼¼ç»„ç»‡çš„å…±äº«å±‚çº§å‘½åç©ºé—´æ¥ç›¸äº’åè°ƒã€‚å‘½åç©ºé—´è¢«ç§°ä¸º<code>znode</code>çš„æ•°æ®è®°å½•ç»„æˆï¼Œç”¨ ZooKeeper çš„è¯´æ³•ï¼Œè¿™äº›è®°å½•å’Œæ ‡å‡†æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å’Œç›®å½•éžå¸¸ç›¸ä¼¼ã€‚ä¸Žå…¸åž‹çš„ç”¨äºŽå­˜å‚¨çš„æ–‡ä»¶ç³»ç»Ÿä¸åŒï¼ŒZooKeeper æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™æ„å‘³ç€ ZooKeeper å¯ä»¥å®žçŽ°é«˜åžåé‡å’Œä½Žå»¶è¿Ÿã€‚</p>

<p>Zookeeper çš„å®žçŽ°ç€é‡äºŽé«˜æ€§èƒ½ã€é«˜å¯ç”¨æ€§å’Œä¸¥æ ¼çš„é¡ºåºè®¿é—®ã€‚ZooKeeper çš„æ€§èƒ½æ–¹é¢æ„å‘³ç€å®ƒå¯ä»¥ç”¨äºŽå¤§åž‹åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å¯é æ€§æ–¹é¢ä½¿å®ƒä¸ä¼šé€ æˆå•ç‚¹æ•…éšœã€‚ä¸¥æ ¼çš„æŽ’åºæ„å‘³ç€å¯ä»¥åœ¨å®¢æˆ·ç«¯å®žçŽ°å¤æ‚çš„åŒæ­¥åŽŸè¯­ã€‚</p>

<h5 id="toc_4">Zookeeper æ˜¯å¤åˆ¶çš„ï¼ˆreplicatedï¼‰</h5>

<p>å°±åƒå®ƒåè°ƒçš„åˆ†å¸ƒå¼è¿›ç¨‹ä¸€æ ·ï¼ŒZookeeper è‡ªèº«ä¹Ÿåœ¨è¢«ç§°ä¸º â€œensembleâ€ çš„ä¸€ç»„ä¸»æœºä¹‹é—´è¿›è¡Œå¤åˆ¶ã€‚</p>

<p><img src="media/15356007721649/15356009470781.jpg" alt=""/></p>

<p>ç»„æˆ Zookeeper æœåŠ¡ (Service) çš„æ¯ä¸ªæœåŠ¡å™¨ (server) ä¹‹é—´éƒ½å¿…é¡»ç›¸äº’äº†è§£å¯¹æ–¹ã€‚ä»–ä»¬ç»´æŠ¤ä¸€ä¸ªå†…å­˜çŠ¶æ€å›¾ï¼Œä»¥åŠä¸€ä¸ªæŒä¹…å­˜å‚¨çš„äº‹åŠ¡æ—¥å¿—å’Œå¿«ç…§ã€‚åªè¦è¿™äº›æœåŠ¡å™¨ (servers) ä¸­å¤§å¤šæ•°æ˜¯å¯ç”¨çš„ï¼Œæ•´ä¸ª ZooKeeper æœåŠ¡å°±æ˜¯å¯ç”¨çš„ã€‚</p>

<p>å®¢æˆ·ç«¯ (client) è¿žæŽ¥åˆ°ä»»æ„ä¸€å° ZooKeeper æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯ç»´æŠ¤ä¸€ä¸ª TCP è¿žæŽ¥ï¼Œé€šè¿‡å®ƒå‘é€è¯·æ±‚ã€èŽ·å–å“åº”ã€èŽ·å–ç›‘è§†äº‹ä»¶ä»¥åŠå‘é€å¿ƒè·³ã€‚å¦‚æžœåˆ°æœåŠ¡å™¨çš„ TCP è¿žæŽ¥ä¸­æ–­ï¼Œå®¢æˆ·ç«¯å°†è¿žæŽ¥åˆ°å…¶ä»–ä¸åŒçš„æœåŠ¡å™¨ã€‚</p>

<h5 id="toc_5">Zokeeper æ˜¯æœ‰é¡ºåºçš„</h5>

<p>ZooKeeper ä½¿ç”¨åæ˜ æ‰€æœ‰ ZooKeeper äº‹åŠ¡é¡ºåºçš„æ•°å­—æ¥æ ‡è®°æ¯ä¸ªæ›´æ–°ã€‚åŽç»­æ“ä½œå¯ä»¥ä½¿ç”¨è¯¥æ¬¡åºæ¥å®žçŽ°æ›´é«˜çº§åˆ«çš„æŠ½è±¡ï¼Œä¾‹å¦‚åŒæ­¥åŽŸè¯­ã€‚</p>

<h5 id="toc_6">ZooKeeper æ˜¯å¿«é€Ÿçš„</h5>

<p>åœ¨åº”å¯¹ä»¥ â€œè¯»â€ ä¸ºä¸»çš„è´Ÿè½½æ—¶å°¤å…¶åœ°å¿«é€Ÿã€‚ZooKeeper åº”ç”¨ç¨‹åºåœ¨æ•°åƒå°æœºå™¨ä¸Šè¿è¡Œï¼Œå¹¶ä¸”åœ¨è¯»å–æ¯”å†™å…¥æ›´ä¸ºæ™®éçš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½è¡¨çŽ°æœ€ä½³ï¼Œæ¯”ä¾‹çº¦ä¸º 10ï¼š1ã€‚</p>

<h3 id="toc_7"><a id="1.2">Zookeeper æ•°æ®æ¨¡åž‹å’Œå±‚çº§å‘½åç©ºé—´</a></h3>

<p>ZooKeeper æä¾›çš„å‘½åç©ºé—´ä¸Žæ ‡å‡†æ–‡ä»¶ç³»ç»Ÿéžå¸¸ç›¸ä¼¼ã€‚è·¯å¾„æ˜¯ç”±æ–œæ <code>/</code>åˆ†éš”çš„ä¸€ç³»åˆ—å…ƒç´ ã€‚ ZooKeeper å‘½åç©ºé—´ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ç”±ä¸€ä¸ªè·¯å¾„æ ‡è¯†ã€‚<br/>
<img src="media/15356007721649/15356009665985.jpg" alt=""/></p>

<h3 id="toc_8"><a id="1.3">Zookeeper<code>é»˜è®¤èŠ‚ç‚¹</code>å’Œ<code>ä¸´æ—¶èŠ‚ç‚¹</code></a></h3>

<p>ä¸Žæ ‡å‡†æ–‡ä»¶ç³»ç»Ÿä¸åŒçš„æ˜¯ï¼ŒZooKeeper å‘½åç©ºé—´ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ‹¥æœ‰ä¸Žå…¶ç›¸å…³çš„æ•°æ®ä»¥åŠå­èŠ‚ç‚¹ã€‚è¿™å°±åƒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªç›®å½•ã€‚ZooKeeper è¢«è®¾è®¡ç”¨æ¥å­˜å‚¨ç›¸å…³çš„åè°ƒæ•°æ®ï¼Œå¦‚çŠ¶æ€ä¿¡æ¯ã€é…ç½®ã€ä½ç½®ä¿¡æ¯ç­‰ç­‰ï¼Œæ‰€ä»¥æ¯ä¸ªèŠ‚ç‚¹ä¸Šå­˜å‚¨çš„æ•°æ®é€šå¸¸éƒ½å¾ˆå°ï¼Œåœ¨å­—èŠ‚ (byte) åˆ°åƒå­—èŠ‚ (kb) èŒƒå›´å†…ã€‚æˆ‘ä»¬ä½¿ç”¨æœ¯è¯­ znode æ¥æ¸…æ¥šåœ°è¯´æ˜Žæˆ‘ä»¬æ­£åœ¨è®¨è®º ZooKeeper æ•°æ®èŠ‚ç‚¹ã€‚</p>

<p>Znode ç»´æŠ¤äº†ä¸€ä¸ªçŠ¶æ€ (<code>stat</code>) ç»“æž„ï¼Œå…¶ä¸­åŒ…å«äº†è¡¨ç¤ºæ•°æ®æ”¹å˜ã€è®¿é—®æŽ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰æ”¹å˜çš„ç‰ˆæœ¬å·ã€æ—¶é—´æˆ³ï¼Œå¯ç”¨äºŽç¼“å­˜æ ¡éªŒã€åè°ƒæ›´æ–°ã€‚æ¯å½“ä¸€ä¸ª znode çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œç‰ˆæœ¬å·å°±ä¼šå¢žåŠ ã€‚ä¾‹å¦‚ï¼Œæ¯å½“å®¢æˆ·ç«¯æ£€ç´¢æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯ä¹Ÿä¼šæŽ¥æ”¶åˆ°ç›¸åº”æ•°æ®çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚</p>

<p>å­˜å‚¨åœ¨å‘½åç©ºé—´ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®æ˜¯ä»¥åŽŸå­æ–¹å¼è¯»å–å’Œå†™å…¥çš„ã€‚è¯»å–ä¸€ä¸ª znode å°†èŽ·å¾—å…¶å…¨éƒ¨çš„æ•°æ®ï¼Œè€Œå†™å…¥åˆ™æ›¿æ¢å…¶å…¨éƒ¨çš„æ•°æ®ã€‚</p>

<p>ZooKeeper ä¹Ÿæœ‰ä¸´æ—¶èŠ‚ç‚¹çš„æ¦‚å¿µã€‚å½“åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¼šè¯ä¸€ç›´ä¿æŒæ´»åŠ¨ï¼Œçž¬æ—¶èŠ‚ç‚¹å°±ä¸€ç›´å­˜åœ¨ã€‚è€Œå½“ä¼šè¯ç»ˆç»“æ—¶ï¼Œçž¬æ—¶èŠ‚ç‚¹è¢«åˆ é™¤ã€‚</p>

<h3 id="toc_9"><a id="1.4">Zookeeper<code>æ¡ä»¶æ›´æ–°</code>å’Œ<code>ç›‘è§†</code>(watches)</a></h3>

<p>ZooKeeper æ”¯æŒ â€œç›‘è§†â€(watches) çš„æ¦‚å¿µã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨ znode ä¸Šè®¾ç½®ä¸€ä¸ªç›‘è§† (watch)ã€‚å½“ znode æ”¹å˜æ—¶ï¼Œç›‘è§†(watch) å°†è¢«è§¦å‘å¹¶ç§»é™¤ã€‚å½“ç›‘è§† (watch) è¢«è§¦å‘æ—¶ï¼Œå½“ â€œç›‘è§†â€ è¢«è§¦å‘æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¸€ä¸ªæè¿°äº† znode çš„å˜æ›´çš„æ•°æ®åŒ…ã€‚å¦‚æžœå®¢æˆ·ç«¯å’Œ Zookeeper æœåŠ¡å™¨ä¹‹é—´çš„è¿žæŽ¥æ–­å¼€æ—¶ï¼Œå®¢æˆ·ç«¯å°†ä¼šæ”¶åˆ°ä¸€ä¸ªæœ¬åœ°é€šçŸ¥ã€‚</p>

<h3 id="toc_10"><a id="1.5">Zookeeper<code>ä¿è¯</code>(Guarantees)</a></h3>

<p>Zookeeper éžå¸¸åœ°å¿«é€Ÿä¹Ÿéžå¸¸ç®€å•ã€‚ä¸è¿‡ï¼Œç”±äºŽå®ƒçš„ç›®æ ‡æ˜¯ä½œä¸ºæž„å»ºè¯¸å¦‚ â€œåŒæ­¥â€ è¿™ç±»æ›´å¤æ‚æœåŠ¡çš„åŸºç¡€ï¼Œå®ƒæä¾›äº†ä¸€äº›çš„ä¸€ç»„ä¿è¯ï¼š</p>

<ul>
<li>  é¡ºåºä¸€è‡´æ€§ - æ¥è‡ªå®¢æˆ·ç«¯çš„æ›´æ”¹è¯·æ±‚å°†ä¼šæŒ‰ç…§å®ƒä»¬çš„å‘é€çš„é¡ºåºè¢«åº”ç”¨ã€‚</li>
<li>  åŽŸå­æ€§ - æ›´æ”¹è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ï¼Œä¸ä¼šå­˜åœ¨éƒ¨åˆ†æˆåŠŸã€éƒ¨åˆ†å¤±è´¥çš„ç»“æžœã€‚</li>
<li>  å•ä¸€ç³»ç»Ÿæ˜ åƒ - å®¢æˆ·ç«¯ä¼šçœ‹åˆ° Zookeeper æœåŠ¡çš„ç›¸åŒçš„è§†å›¾ï¼Œè€Œæ— è®ºå®ƒä»¬è¿žåˆ°å…·ä½“å“ªä¸€ä¸ªæœåŠ¡å™¨ä¸Š</li>
<li>  å¯é æ€§ - ä¸€æ—¦ä¸€æ¬¡æ›´æ”¹è¯·æ±‚è¢«åº”ç”¨ï¼Œæ›´æ”¹çš„ç»“æžœå°±ä¼šè¢«æŒä¹…åŒ–ï¼Œç›´åˆ°è¢«ä¸‹ä¸€æ¬¡æ›´æ”¹è¦†ç›–ã€‚</li>
<li>  åŠæ—¶æ€§ - å®¢æˆ·ç«¯çœ‹åˆ°çš„ç³»ç»Ÿè§†å›¾åœ¨ä¸€å®šçš„æ—¶é—´èŒƒå›´å†…æ€»æ˜¯æœ€æ–°çš„ã€‚</li>
</ul>

<h3 id="toc_11"><a id="1.6">ç®€å•çš„ API</a></h3>

<p>ZooKeeper çš„ä¸€ä¸ªè®¾è®¡ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªéžå¸¸ç®€å•çš„ç¼–ç¨‹æŽ¥å£ã€‚ å› æ­¤ï¼Œå®ƒåªæ”¯æŒè¿™äº›æ“ä½œï¼š</p>

<ul>
<li><p>###### create</p>

<blockquote>
<p>åœ¨ï¼ˆå‘½åç©ºé—´ï¼‰æ ‘çš„ä¸€ä¸ªç‰¹å®šåœ°å€ä¸Šåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
</blockquote></li>
<li><p>###### delete</p>

<blockquote>
<p>åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
</blockquote></li>
<li><p>###### exists</p>

<blockquote>
<p>åˆ¤æ–­æŸä¸ªè·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥èŠ‚ç‚¹ã€‚</p>
</blockquote></li>
<li><p>###### get data</p>

<blockquote>
<p>èŽ·å–èŠ‚ç‚¹çš„æ•°æ®ã€‚</p>
</blockquote></li>
<li><p>###### set data</p>

<blockquote>
<p>å‘èŠ‚ç‚¹å†™å…¥æ•°æ®ã€‚</p>
</blockquote></li>
<li><p>###### get children</p>

<blockquote>
<p>æ£€ç´¢èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨ã€‚</p>
</blockquote></li>
<li><p>###### sync</p>

<blockquote>
<p>ç­‰å¾…æ•°æ®ä¼ æ’­å®Œæˆã€‚</p>
</blockquote></li>
</ul>

<h3 id="toc_12"><a id="1.7">Zookeeper<code>å®žçŽ°åŽŸç†</code></a></h3>

<p><a href="https://link.juejin.im?target=http%3A%2F%2Fzookeeper.apache.org%2Fdoc%2Fr3.4.11%2FzookeeperOver.html%23fg_zkComponents">ZooKeeper Components</a> æ˜¾ç¤ºäº† ZooKeeper æœåŠ¡çš„é«˜çº§ç»„ä»¶ã€‚é™¤<code>Request Processor</code>å¤–ï¼Œæž„æˆ ZooKeeper æœåŠ¡çš„æ¯ä¸ªæœåŠ¡å™¨éƒ½å¤åˆ¶æ¯ä¸ªç»„ä»¶çš„å‰¯æœ¬ã€‚</p>

<p><img src="media/15356007721649/15356009879352.jpg" alt=""/></p>

<p><code>replicated database</code>æ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œå®ƒåŒ…å«äº†æ•´é¢—æ•°æ®æ ‘ã€‚æ•°æ®å†™å…¥åœ¨åº”ç”¨åˆ°å†…å­˜æ•°æ®åº“ä¹‹å‰ï¼Œä¼šå…ˆåºåˆ—åŒ–åˆ°ç£ç›˜ã€‚</p>

<p>æ¯ä¸€ä¸ª Zookeeper æœåŠ¡å™¨éƒ½å‘å®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œå®¢æˆ·ç«¯è¿žæŽ¥åˆ°ä¸€ä¸ªç¡®åˆ‡çš„ Zookeeper æœåŠ¡å™¨æäº¤è¯·æ±‚ã€‚è¯»è¯·æ±‚ä»ŽæœåŠ¡å™¨æ•°æ®åº“çš„æœ¬åœ°æ‹·è´ä¸­èŽ·å–ã€‚æ”¹å˜ Zookeeper æœåŠ¡çŠ¶æ€çš„è¯·æ±‚ã€å†™å…¥è¯·æ±‚é€šè¿‡ä¸€ä¸ªä¸€è‡´æ€§åè®®è¿›è¡Œå¤„ç†ã€‚</p>

<p>ä½œä¸ºåè®®çš„ä¸€éƒ¨åˆ†ï¼Œå®¢æˆ·ç«¯çš„æ‰€æœ‰å†™å…¥è¯·æ±‚éƒ½è¢«è½¬å‘åˆ°ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨è¢«ç§°ä¸º leaderã€‚è€Œå…¶ä½™çš„æœåŠ¡å™¨ï¼Œè¢«ç§°ä¸º followerï¼Œä»Ž leader æŽ¥æ”¶æ¶ˆæ¯ææ¡ˆï¼ˆproposalï¼‰å¹¶å¯¹æ¶ˆæ¯çš„äº¤ä»˜å–å¾—ä¸€è‡´ã€‚æ¶ˆæ¯å±‚ç»´æŠ¤ leader å¤±æ•ˆæ—¶çš„æ›´æ–°æ›¿æ¢ä»¥åŠ leader å’Œ follower ä¹‹é—´çš„åŒæ­¥ã€‚</p>

<p>Zookeeper ä½¿ç”¨è‡ªå®šä¹‰çš„åŽŸå­æ¶ˆæ¯åè®®ã€‚ç”±äºŽæ¶ˆæ¯å±‚æ˜¯åŽŸå­çš„ï¼ŒZookeeper å¯ä»¥ä¿è¯æœ¬åœ°çš„å¤åˆ¶å“ä¸ä¼šä¸ä¸€è‡´ã€‚å½“ leader æ”¶åˆ°ä¸€ä¸ªå†™å…¥è¯·æ±‚æ—¶ï¼Œå®ƒè®¡ç®—ç³»ç»Ÿæ‰€å¤„çš„çŠ¶æ€ä»¥åŠä½•æ—¶åº”ç”¨å†™å…¥è¯·æ±‚ï¼Œå¹¶å°†æ­¤è½¬æ¢ä¸ºä¸€ä¸ªäº‹åŠ¡ï¼ŒåŒ…å«æ–°çš„çŠ¶æ€ã€‚</p>

<h3 id="toc_13"><a id="1.8">ä½¿ç”¨</a></h3>

<p>Zookeeper çš„ç¼–ç¨‹æŽ¥å£ç‰¹æ„åœ°å®šä¹‰å¾—å¾ˆç®€å•ã€‚ç„¶è€Œï¼Œé€šè¿‡è¿™äº›ç¼–ç¨‹æŽ¥å£å¯ä»¥æ›´é«˜é˜¶çš„æ“ä½œï¼Œä¾‹å¦‚åŒæ­¥åŽŸè¯­ï¼Œæˆå‘˜åˆ†ç»„ï¼Œæ‰€æœ‰æƒï¼Œç­‰ç­‰ã€‚</p>

<h3 id="toc_14"><a id="1.9">æ€§èƒ½</a></h3>

<p>Zookeeper è¢«è®¾è®¡ä¸ºé«˜æ€§èƒ½ã€‚ä½†å®žé™…æ˜¯å¦å¦‚æ­¤å‘¢ï¼Ÿåœ¨é›…è™Žç ”å‘ä¸­å¿ƒçš„ Zookeeper å¼€å‘å›¢é˜Ÿçš„ç ”ç©¶ç»“æžœè¡¨æ˜Žçš„ç¡®å¦‚æ­¤ã€‚ï¼ˆå‚è§ä¸‹å›¾ï¼šZookeeper åžåé‡éšè¯»å†™æ¯”çš„å˜åŒ–ï¼‰ã€‚åœ¨ â€œè¯»â€ å¤šäºŽ â€œå†™â€ çš„åº”ç”¨ç¨‹åºä¸­å°¤å…¶åœ°é«˜æ€§èƒ½ï¼Œå› ä¸º â€œå†™â€ ä¼šå¯¼è‡´åœ¨æ‰€æœ‰çš„æœåŠ¡å™¨é—´åŒæ­¥çŠ¶æ€ã€‚ï¼ˆâ€œè¯»â€å¤šäºŽ â€œå†™â€ æ˜¯åè°ƒæœåŠ¡çš„å…¸åž‹åœºæ™¯ã€‚ï¼‰</p>

<p>Zookeeper åžåé‡éšè¯»å†™æ¯”çš„å˜åŒ–</p>

<p><img src="media/15356007721649/15356010042046.jpg" alt=""/></p>

<p>å›¾ â€œZookeeper åžåé‡éšè¯»å†™æ¯”çš„å˜åŒ–â€ æ˜¯ Zookeeper3.2 ç‰ˆæœ¬è¿è¡ŒäºŽ Dual 2Gh Xeon + 2 ä¸ª 15K RPM çš„ SATA ç¡¬ç›˜é©±åŠ¨å™¨çš„æœåŠ¡å™¨ä¸Šçš„ç»“æžœã€‚ä¸€ä¸ªé©±åŠ¨å™¨ç”¨ä½œ Zookeeper ä¸“ç”¨çš„æ—¥å¿—è®¾å¤‡ã€‚å¿«ç…§å†™åˆ°æ“ä½œç³»ç»Ÿé©±åŠ¨å™¨ã€‚å†™è¯·æ±‚æ˜¯ 1K æ•°æ®çš„å†™å…¥è€Œè¯»è¯·æ±‚æ˜¯ 1K çš„æ•°æ®è¯»å–ã€‚â€œServersâ€ æ ‡å‡ºäº† Zookeeper Ensemble çš„å¤§å°ï¼Œå³ç»„æˆ Zookeeper æœåŠ¡çš„æœåŠ¡å™¨çš„æ•°é‡ã€‚å¤§çº¦ 30 å°å…¶å®ƒçš„æœåŠ¡å™¨è¢«ç”¨ä½œæ¨¡æ‹Ÿå®¢æˆ·ç«¯ã€‚Zookeeper Ensemble è¢«é…ç½®ä¸ºä¸å…è®¸å®¢æˆ·ç«¯è¿žæŽ¥åˆ° Leader ã€‚</p>

<p>æ³¨ï¼š3.2 ç‰ˆæœ¬çš„è¯» / å†™æ€§èƒ½ç›¸å¯¹äºŽ 3.1 ç‰ˆæœ¬ä»¥å‰æœ‰æœ€å¤šè¾¾ 2 å€çš„æå‡ã€‚</p>

<p>åŸºå‡†æµ‹è¯•ä¹Ÿè¡¨æ˜Žäº† Zookeeper çš„å¯é æ€§ã€‚å›¾ â€œé”™è¯¯å‘ç”Ÿçš„æƒ…å†µä¸‹çš„å¯é æ€§â€ å±•ç¤ºäº† Zookeeper æ˜¯å¦‚ä½•åº”å¯¹å„ç§ä¸åŒçš„å¤±æ•ˆçš„ã€‚å›¾ä¸­æ ‡æ³¨çš„äº‹ä»¶å¦‚ä¸‹ï¼š</p>

<ol>
<li><p>ä¸€ä¸ª Follower å¤±æ•ˆç„¶åŽæ¢å¤ã€‚</p></li>
<li><p>å¦ä¸€ä¸ªä¸åŒçš„ Follower å¤±æ•ˆç„¶åŽæ¢å¤ã€‚</p></li>
<li><p>Leader å¤±æ•ˆã€‚</p></li>
<li><p>ä¸¤ä¸ª Follower å¤±æ•ˆç„¶åŽæ¢å¤ã€‚</p></li>
<li><p>å¦ä¸€ä¸ª Leader å¤±æ•ˆã€‚</p></li>
</ol>

<h3 id="toc_15"><a id="1.10">å¯é æ€§</a></h3>

<p><img src="media/15356007721649/15356010153963.jpg" alt=""/></p>

<p>ä»Žè¿™å¼ å›¾ä¸­å¯ä»¥å¾—åˆ°å‡ ç‚¹é‡è¦çš„ç»“æžœã€‚é¦–å…ˆï¼Œå¦‚æžœ follower å¤±æ•ˆå¹¶å¿«é€Ÿæ¢å¤ï¼ŒZookeeper èƒ½å¤Ÿç»´æŒé«˜åžåé‡ï¼Œå°½ç®¡å­˜åœ¨å¤±æ•ˆã€‚ä½†ä¹Ÿè®¸æ›´é‡è¦çš„æ˜¯ï¼Œleader é€‰ä¸¾ç®—æ³•ä½¿ç³»ç»Ÿè¶³å¤Ÿå¿«åœ°æ¢å¤ï¼Œé¿å…äº†åžåé‡çš„æ€»ä½“ä¸‹é™ã€‚ä»Žè§‚å¯Ÿç»“æžœæ¥çœ‹ï¼ŒZookeeper èŠ±äº†ä¸åˆ° 200 æ¯«ç§’çš„æ—¶é—´é€‰ä¸¾å‡ºäº†ä¸€ä¸ªæ–°çš„ leaderã€‚ç¬¬ä¸‰ï¼Œåªè¦ follower æ¢å¤ï¼ŒZookeeper çš„åžåé‡èƒ½å¤Ÿå†æ¬¡ä¸Šå‡åˆ°åˆšå¼€å§‹å¤„ç†è¯·æ±‚æ—¶çš„æ°´å¹³ã€‚</p>

<h3 id="toc_16"><a id="1.11">å…³äºŽ ZooKeeper é¡¹ç›®</a></h3>

<p>Zookeeper å·²ç»è¢«æˆåŠŸåœ°ç”¨åœ¨è®¸å¤šå·¥ä¸šçº§çš„åº”ç”¨ã€‚åœ¨é›…è™Žï¼ŒZookeeper è¢«ç”¨ä½œé›…è™Žæ¶ˆæ¯ä¸­é—´ä»¶çš„åè°ƒå’Œå¤±æ•ˆæ¢å¤æœåŠ¡ï¼Œè¯¥ç³»ç»Ÿæ˜¯ä¸€ä¸ªé«˜ä¼¸ç¼©æ€§çš„å‘å¸ƒè®¢é˜…ç³»ç»Ÿï¼Œç®¡ç†ç€æˆåƒä¸Šä¸‡çš„ä¸»é¢˜å¤åˆ¶å’Œæ•°æ®åˆ†å‘ã€‚Zookeeper è¿˜è¢«ç”¨åœ¨é›…è™Žçˆ¬è™«çš„æŠ“å–æœåŠ¡ä¸Šï¼Œç”¨äºŽç®¡ç†å¤±æ•ˆæ¢å¤ã€‚è®¸å¤šé›…è™Žçš„å¹¿å‘Šç³»ç»Ÿä¹Ÿç”¨ Zookeeper å®žçŽ°å¯é çš„æœåŠ¡ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MySQL]]></title>
    <link href="http://panlw.github.io/15353470248085.html"/>
    <updated>2018-08-27T13:17:04+08:00</updated>
    <id>http://panlw.github.io/15353470248085.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">JDBC Connect failed</h2>

<blockquote>
<p>Check VPN Global Mode</p>
</blockquote>

<h2 id="toc_1">Version 8+</h2>

<blockquote>
<p>&quot;Public Key Retrieval is not allowed&quot;</p>

<p>/usr/local/var/mysql/ca.pem</p>
</blockquote>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Here are examples of everything new in ECMAScript 2016, 2017, andÂ 2018]]></title>
    <link href="http://panlw.github.io/15352961449208.html"/>
    <updated>2018-08-26T23:09:04+08:00</updated>
    <id>http://panlw.github.io/15352961449208.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://medium.freecodecamp.org/here-are-examples-of-everything-new-in-ecmascript-2016-2017-and-2018-d52fa3b5a70e">https://medium.freecodecamp.org/here-are-examples-of-everything-new-in-ecmascript-2016-2017-and-2018-d52fa3b5a70e</a></p>
</blockquote>

<p><img src="https://cdn-images-1.medium.com/max/1000/1*Z-9unq6Am3vekNOa5fD1xg.png" alt=""/></p>

<p>Itâ€™s hard to keep track of whatâ€™s new in JavaScript (ECMAScript). And itâ€™s even harder to find useful code examples.</p>

<p>So in this article, Iâ€™ll cover all 18 features that are listed in the <a href="https://github.com/tc39/proposals/blob/master/finished-proposals.md">TC39â€™s finished proposals</a> that were added in ES2016, ES2017, and ES2018 (final draft) and show them with useful examples.</p>

<blockquote>
<p>This is a pretty long post but should be an easy read. Think of this as â€œ<strong>Netflix binge reading.â€</strong> By the end of this, I promise that youâ€™ll have a ton of knowledge about all these features.</p>
</blockquote>

<h4 id="toc_0"><strong>OK, letâ€™s go over these one byÂ one.</strong></h4>

<p><img src="https://cdn-images-1.medium.com/max/800/1*K09EWrqTcTwN9_dlhlzy6Q.png" alt=""/></p>

<h3 id="toc_1"><code>1\. Array.prototype.includes</code></h3>

<p><code>includes</code> is a simple instance method on the Array and helps to easily find if an item is in the Array (including <code>NaN</code> unlike <code>indexOf</code>).</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*OhhFTNabUEz8ZeI4vaCIJw.png" alt=""/>ECMAScript 2016 or ES7â€Šâ€”â€ŠArray.prototype.includes()</p>

<blockquote>
<p>Trivia: the JavaScript spec people wanted to name it <code>contains</code>Â , but this was apparently already used by Mootools so they used <code>includes</code>Â .</p>
</blockquote>

<h4 id="toc_2"><code>2\.</code> Exponentiation <code>infixÂ operator</code></h4>

<p>Math operations like addition and subtraction have infix operators like <code>+</code> and <code>-</code>Â , respectively. Similar to them, the <code>**</code> infix operator is commonly used for exponent operation. In ECMAScript 2016, the <code>**</code> was introduced instead of <code>Math.pow</code>Â .</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*c1k1vgBgGaam7XA8xAp49w.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*c1k1vgBgGaam7XA8xAp49w.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*c1k1vgBgGaam7XA8xAp49w.png" alt=""/>ECMAScript 2016 or ES7â€Šâ€”â€Š** Exponent infixÂ operator<img src="https://cdn-images-1.medium.com/freeze/max/30/1*fV_95TaY3ocgE8hlDhhv8w.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*fV_95TaY3ocgE8hlDhhv8w.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*fV_95TaY3ocgE8hlDhhv8w.png" alt=""/></p>

<h3 id="toc_3">1. Object.values()</h3>

<p><code>Object.values()</code> is a new function thatâ€™s similar to <code>Object.keys()</code> but returns all the values of the Objectâ€™s own properties excluding any value(s) in the prototypical chain.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*OkcC2Sozg0MKvkaqZWxmnw.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*OkcC2Sozg0MKvkaqZWxmnw.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*OkcC2Sozg0MKvkaqZWxmnw.png" alt=""/>ECMAScript 2017 (ES8)â€” Object.values()</p>

<h3 id="toc_4">2. Object.entries()</h3>

<p><code>Object.entries()</code> is related to <code>Object.keys</code>Â , but instead of returning just keys, it returns both keys and values in the array fashion. This makes it very simple to do things like using objects in loops or converting objects into Maps.</p>

<p><strong>Example 1:</strong></p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*23RYJzstZ7iMxKNYbfAAWg.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*23RYJzstZ7iMxKNYbfAAWg.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*23RYJzstZ7iMxKNYbfAAWg.png" alt=""/>ECMAScript 2017 (ES8)â€Šâ€”â€ŠUsing Object.entries() inÂ loops</p>

<p><strong>Example 2:</strong></p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*XAXiVkw2zKyBio4OX6DQoQ.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*XAXiVkw2zKyBio4OX6DQoQ.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*XAXiVkw2zKyBio4OX6DQoQ.png" alt=""/>ECMAScript 2017 (ES8)â€Šâ€”â€ŠUsing Object.entries() to convert Object toÂ Map</p>

<h3 id="toc_5">3. StringÂ padding</h3>

<p>Two instance methods were added to Stringâ€Šâ€”â€Š<code>String.prototype.padStart</code> and <code>String.prototype.padEnd</code>â€Šâ€”â€Šthat allow appending/prepending either an empty string or some other string to the start or the end of the original string.</p>

<pre>'someString'.padStart(numberOfCharcters [,stringForPadding]); </pre>

<pre>'5'.padStart(10) // '          5'
'5'.padStart(10, '=*') //'=*=*=*=*=5'</pre>

<pre>'5'.padEnd(10) // '5         '
'5'.padEnd(10, '=*') //'5=*=*=*=*='</pre>

<blockquote>
<p>This comes in handy when we want to align things in scenarios like pretty print display or terminal print.</p>
</blockquote>

<h4 id="toc_6">3.1 padStartÂ example:</h4>

<p>In the below example, we have a list of numbers of varying lengths. We want to prepend â€œ0â€ so that all the items have the same length of 10 digits for display purposes. We can use <code>padStart(10, &#39;0&#39;)</code> to easily achieve this.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*KLrT9Xmh43cIi2MFUmIfcw.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*KLrT9Xmh43cIi2MFUmIfcw.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*KLrT9Xmh43cIi2MFUmIfcw.png" alt=""/>ECMAScript 2017â€Šâ€”â€ŠpadStartÂ example</p>

<h4 id="toc_7">3.2 padEndÂ example:</h4>

<p><code>padEnd</code> really comes in handy when we are printing multiple items of varying lengths and want to right-align them properly.</p>

<p>The example below is a good realistic example of how <code>padEnd</code>Â , <code>padStart</code>Â , and <code>Object.entries</code> all come together to produce a beautiful output.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*fLXPci_E_yXK9uSqLz-axQ.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*fLXPci_E_yXK9uSqLz-axQ.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*fLXPci_E_yXK9uSqLz-axQ.png" alt=""/>ECMAScript 2017â€Šâ€”â€ŠpadEnd, padStart and Object.Entries example</p>

<pre>const cars = {
  'ðŸš™BMW': '10',
  'ðŸš˜Tesla': '5',
  'ðŸš–Lamborghini': '0'
}</pre>

<pre>Object.entries(cars).map(([name, count]) => {
  //padEnd appends ' -' until the name becomes 20 characters
  //padStart prepends '0' until the count becomes 3 characters.
  console.log(`${name.padEnd(20, ' -')} Count: ${count.padStart(3, '0')}`)
});</pre>

<pre>//Prints..
// ðŸš™BMW - - - - - - -  Count: 010
// ðŸš˜Tesla - - - - - -  Count: 005
// ðŸš–Lamborghini - - -  Count: 000</pre>

<h4 id="toc_8">3.3 âš ï¸ padStart and padEnd on Emojis and other double-byte chars</h4>

<p>Emojis and other double-byte chars are represented using multiple bytes of unicode. So padStart and padEnd might not work as expected!âš ï¸</p>

<p>For example: Letâ€™s say we are trying to pad the string <code>heart</code> to reach <code>10</code> characters with the â¤ï¸ emoji. The result will look like below:</p>

<pre>//Notice that instead of 5 hearts, there are only 2 hearts and 1 heart that looks odd!
'heart'.padStart(10, "â¤ï¸"); // prints.. 'â¤ï¸â¤ï¸â¤heart'</pre>

<p>This is because â¤ï¸ is 2 code points long (<code>&#39;\u2764\uFE0F&#39;</code> )! The word <code>heart</code> itself is 5 characters, so we only have a total of 5 chars left to pad. So what happens is that JS pads two hearts using <code>&#39;\u2764\uFE0F&#39;</code> and that produces â¤ï¸â¤ï¸. For the last one it simply uses the first byte of the heart <code>\u2764</code> which produces â¤</p>

<p>So we end up with: <code>â¤ï¸â¤ï¸â¤heart</code></p>

<blockquote>
<p>PS: You may use <a href="https://encoder.internetwache.org/#tab_uni">this link</a> to check out unicode char conversions.</p>
</blockquote>

<h3 id="toc_9">4. <code>Object.getOwnPropertyDescriptors</code></h3>

<p>This method returns all the details (including getter <code>get</code>and setter <code>set</code> methods) for all the properties of a given object. The main motivation to add this is to allow shallow copying / cloning an object into another objectthat also copies getter and setter functions as opposed to <code>Object.assign</code><strong>Â .</strong></p>

<p><strong>Object.assign shallow copies all the details except getter and setter functions of the original source object.</strong></p>

<p>The example below shows the difference between <code>Object.assign</code> and <code>Object.getOwnPropertyDescriptors</code> along with <code>Object.defineProperties</code> to copy an original object <code>Car</code> into a new object <code>ElectricCar</code>Â . Youâ€™ll see that by using <code>Object.getOwnPropertyDescriptors</code>Â ,<code>discount</code> getter and setter functions are also copied into the target object.</p>

<p>BEFOREâ€¦</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*7r4pk8hfx5VQ9-ERu--xCw.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*7r4pk8hfx5VQ9-ERu--xCw.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*7r4pk8hfx5VQ9-ERu--xCw.png" alt=""/>Beforeâ€Šâ€”â€ŠUsing Object.assign</p>

<p>AFTERâ€¦</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*gvlG4DfnkiOrlgPsQrjLfg.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*gvlG4DfnkiOrlgPsQrjLfg.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*gvlG4DfnkiOrlgPsQrjLfg.png" alt=""/>ECMAScript 2017 (ES8)â€Šâ€”â€ŠObject.getOwnPropertyDescriptors</p>

<pre>var Car = {
 name: 'BMW',
 price: 1000000,
 set discount(x) {
  this.d = x;
 },
 get discount() {
  return this.d;
 },
};</pre>

<pre>//Print details of Car object's 'discount' property
console.log(Object.getOwnPropertyDescriptor(Car, 'discount'));
//prints..
// { 
//   get: [Function: get],
//   set: [Function: set],
//   enumerable: true,
//   configurable: true
// }</pre>

<pre>//Copy Car's properties to ElectricCar using Object.assign
const ElectricCar = Object.assign({}, Car);</pre>

<pre>//Print details of ElectricCar object's 'discount' property
console.log(Object.getOwnPropertyDescriptor(ElectricCar, 'discount'));
//prints..
// { 
//   value: undefined,
//   writable: true,
//   enumerable: true,
//   configurable: true 

// }
//âš ï¸Notice that getters and setters are missing in ElectricCar object for 'discount' property !ðŸ‘ŽðŸ‘Ž</pre>

<pre>//Copy Car's properties to ElectricCar2 using Object.defineProperties 
//and extract Car's properties using Object.getOwnPropertyDescriptors
const ElectricCar2 = Object.defineProperties({}, Object.getOwnPropertyDescriptors(Car));</pre>

<pre>//Print details of ElectricCar2 object's 'discount' property
console.log(Object.getOwnPropertyDescriptor(ElectricCar2, 'discount'));
//prints..
// { get: [Function: get],  ðŸ‘ˆðŸ¼ðŸ‘ˆðŸ¼ðŸ‘ˆðŸ¼
//   set: [Function: set],  ðŸ‘ˆðŸ¼ðŸ‘ˆðŸ¼ðŸ‘ˆðŸ¼
//   enumerable: true,
//   configurable: true 
// }
// Notice that getters and setters are present in the ElectricCar2 object for 'discount' property!</pre>

<h3 id="toc_10">5. <code>Add trailing commas in the function parameters</code></h3>

<p>This is a minor update that allows us to have trailing commas after the last function parameter. Why? To help with tools like git blame to ensure only new developers get blamed.</p>

<p>The below example shows the problem and the solution.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*-SKZCxQdf8Rk48SSaPtDGg.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*-SKZCxQdf8Rk48SSaPtDGg.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*-SKZCxQdf8Rk48SSaPtDGg.png" alt=""/>ECMAScript 2017 (ES 8)â€Šâ€”â€ŠTrailing comma in function paramameter</p>

<blockquote>
<p>Note: You can also call functions with trailing commas!</p>
</blockquote>

<h3 id="toc_11">6. Async/Await</h3>

<p>This, by far, is the most important and most useful feature if you ask me. Async functions allows us to not deal with callback hell and make the entire code look simple.</p>

<p>The <code>async</code> keyword tells the JavaScript compiler to treat the function differently. The compiler pauses whenever it reaches the <code>await</code> keyword within that function. It assumes that the expression after <code>await</code> returns a promise and waits until the promise is resolved or rejected before moving further.</p>

<p>In the example below, the <code>getAmount</code> function is calling two asynchronous functions <code>getUser</code> and <code>getBankBalance</code>Â . We can do this in promise, but using <code>async await</code> is more elegant and simple.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*L3FZ0onbBD4ay6UhZvPoMw.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*L3FZ0onbBD4ay6UhZvPoMw.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*L3FZ0onbBD4ay6UhZvPoMw.png" alt=""/>ECMAScript 2017 (ES 8)â€Šâ€”â€ŠAsync Await basicÂ example</p>

<h4 id="toc_12"><strong>6.1</strong> Async functions themselves return aÂ Promise.</h4>

<p>If you are waiting for the result from an async function, you need to use Promiseâ€™s <code>then</code> syntax to capture its result.</p>

<p>In the following example, we want to log the result using <code>console.log</code> but not within the doubleAndAdd. So we want to wait and use <code>then</code> syntax to pass the result to <code>console.log</code>Â .</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*ylheY6gJawprWEVNL68mRQ.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*ylheY6gJawprWEVNL68mRQ.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*ylheY6gJawprWEVNL68mRQ.png" alt=""/>ECMAScript 2017 (ES 8)â€Šâ€”â€ŠAsync Await themselves returnsÂ Promise</p>

<h4 id="toc_13"><strong>6.2 Calling async/await inÂ parallel</strong></h4>

<p>In the previous example we are calling await twice, but each time we are waiting for one second (total 2 seconds). Instead we can parallelize it since <code>a</code> and <code>b</code> are not dependent on each other using <code>Promise.all</code>.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*VEF_Sq067Liq4lfTV8Xv0A.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*VEF_Sq067Liq4lfTV8Xv0A.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*VEF_Sq067Liq4lfTV8Xv0A.png" alt=""/>ECMAScript 2017 (ES 8)â€Šâ€”â€ŠUsing Promise.all to parallelize async/await</p>

<h4 id="toc_14">6.3 Error handling async/await functions</h4>

<p>There are various ways to handle errors when using async await.</p>

<h4 id="toc_15"><strong>Option 1â€Šâ€”â€ŠUse try catch within theÂ function</strong></h4>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*iP84ax2TOt5dbaIjW7kzcw.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*iP84ax2TOt5dbaIjW7kzcw.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*iP84ax2TOt5dbaIjW7kzcw.png" alt=""/>ECMAScript 2017â€Šâ€”â€Š<strong>Use try catch within the async/await function</strong></p>

<pre>//Option 1 - Use try catch within the function
async function doubleAndAdd(a, b) {
 try {
  a = await doubleAfter1Sec(a);
  b = await doubleAfter1Sec(b);
 } catch (e) {
  return NaN; //return something
 }</pre>

<pre>return a + b;
}
//ðŸš€Usage:
doubleAndAdd('one', 2).then(console.log); // NaN
doubleAndAdd(1, 2).then(console.log); // 6</pre>

<pre>function doubleAfter1Sec(param) {
 return new Promise((resolve, reject) => {
  setTimeout(function() {
   let val = param * 2;
   isNaN(val) ? reject(NaN) : resolve(val);
  }, 1000);
 });
}</pre>

<h4 id="toc_16"><strong>Option 2â€” Catch every await expression</strong></h4>

<p>Since every <code>await</code> expression returns a Promise, you can catch errors on each line as shown below.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*Bkls3dXMIRGKAwFN2r--qg.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*Bkls3dXMIRGKAwFN2r--qg.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*Bkls3dXMIRGKAwFN2r--qg.png" alt=""/>ECMAScript 2017â€Šâ€”â€Š<strong>Use try catch every await expression</strong></p>

<pre>//Option 2 - *Catch* errors on  every await line
//as each await expression is a Promise in itself
async function doubleAndAdd(a, b) {
 a = await doubleAfter1Sec(a).catch(e => console.log('"a" is NaN')); // ðŸ‘ˆ
 b = await doubleAfter1Sec(b).catch(e => console.log('"b" is NaN')); // ðŸ‘ˆ
 if (!a || !b) {
  return NaN;
 }
 return a + b;
}</pre>

<pre>//ðŸš€Usage:
doubleAndAdd('one', 2).then(console.log); // NaN  and logs:  "a" is NaN
doubleAndAdd(1, 2).then(console.log); // 6</pre>

<pre>function doubleAfter1Sec(param) {
 return new Promise((resolve, reject) => {
  setTimeout(function() {
   let val = param * 2;
   isNaN(val) ? reject(NaN) : resolve(val);
  }, 1000);
 });
}</pre>

<h4 id="toc_17"><strong>Option 3â€Šâ€”â€ŠCatch the entire async-await function</strong></h4>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*hhkv5ZBOUYViCL2UP0sv5Q.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*hhkv5ZBOUYViCL2UP0sv5Q.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*hhkv5ZBOUYViCL2UP0sv5Q.png" alt=""/>ECMAScript 2017â€Šâ€”â€Š<strong>Catch the entire async/await function at theÂ end</strong></p>

<pre>//Option 3 - Dont do anything but handle outside the function
//since async / await returns a promise, we can catch the whole function's error
async function doubleAndAdd(a, b) {
 a = await doubleAfter1Sec(a);
 b = await doubleAfter1Sec(b);
 return a + b;
}</pre>

<pre>//ðŸš€Usage:
doubleAndAdd('one', 2)
.then(console.log)
.catch(console.log); // ðŸ‘ˆðŸ‘ˆðŸ¼<------- use "catch"</pre>

<pre>function doubleAfter1Sec(param) {
 return new Promise((resolve, reject) => {
  setTimeout(function() {
   let val = param * 2;
   isNaN(val) ? reject(NaN) : resolve(val);
  }, 1000);
 });
}</pre>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*X755b572fEcI0vK0fRKWkw.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*X755b572fEcI0vK0fRKWkw.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*X755b572fEcI0vK0fRKWkw.png" alt=""/></p>

<blockquote>
<p>ECMAScript is currently in final draft and will be out in June or July 2018. All the features covered below are in Stage-4 and will be part of ECMAScript 2018.</p>
</blockquote>

<h4 id="toc_18">1. <a href="https://github.com/tc39/ecmascript_sharedmem">Shared memory andÂ atomics</a></h4>

<p>This is a huge, pretty advanced feature and is a core enhancement to JS engines.</p>

<p><strong>The main idea is to bring some sort of multi-threading feature to JavaScript so that JS developers can write high-performance, concurrent programs in the future by allowing to manage memory by themselves instead of letting JS engine manage memory.</strong></p>

<p>This is done by a new type of a global object called <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer">SharedArrayBuffer</a> that essentially stores data in a <strong>_shared_</strong> <strong>memory space</strong>. So this data can be shared between the main JS thread and web-worker threads.</p>

<p>Until now, if we want to share data between the main JS thread and web-workers, we had to copy the data and send it to the other thread using <code>postMessage</code>Â . Not anymore!</p>

<p>You simply use SharedArrayBuffer and the data is instantly accessible by both the main thread and multiple web-worker threads.</p>

<p>But sharing memory between threads can cause race conditions. To help avoid race conditions, the â€œ<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Atomics">_Atomics_</a>â€ global object is introduced. <u>Atomics</u> provides various methods to lock the shared memory when a thread is using its data. It also provides methods to update such data in that shared memory safely.</p>

<blockquote>
<p>The recommendation is to use this feature via some library, but right now there are no libraries built on top of this feature.</p>
</blockquote>

<p>If you are interested, I recommend reading:</p>

<ol>
<li> <a href="http://lucasfcosta.com/2017/04/30/JavaScript-From-Workers-to-Shared-Memory.html">_From Workers to Shared Memor_</a>_yâ€Šâ€”â€Š_<a href="http://lucasfcosta.com/">_lucasfcosta_</a></li>
<li> <a href="https://hacks.mozilla.org/category/code-cartoons/a-cartoon-intro-to-sharedarraybuffers/">_A cartoon intro to SharedArrayBuffers_</a>_â€Šâ€”â€Š_<a href="https://medium.com/@linclark">_Lin Clark_</a></li>
<li> <a href="http://2ality.com/2017/01/shared-array-buffer.html">_Shared memory and atomics_</a>_â€Šâ€”â€Š_<a href="http://rauschma.de/">_Dr. Axel Rauschmayer_</a></li>
</ol>

<h4 id="toc_19">2. Tagged Template literal restriction removed</h4>

<p>First, we need to clarify what a â€œTagged Template literalâ€ is so we can understand this feature better.</p>

<p>In ES2015+, there is a feature called a tagged template literal that allows developers to customize how strings are interpolated. For example, in the standard way strings are interpolated like belowâ€¦</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*4EizdrE9LlRZ5GXRq4G3Yw.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*4EizdrE9LlRZ5GXRq4G3Yw.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*4EizdrE9LlRZ5GXRq4G3Yw.png" alt=""/></p>

<p>In the tagged literal, you can write a function to receive the hardcoded parts of the string literal, for example <code>[ â€˜Hello â€˜, â€˜!â€™ ]</code>Â , and the replacement variables, for example,<code>[ &#39;Raja&#39;]</code>Â , as parameters into a custom function (for example <code>greet</code> ), and return whatever you want from that custom function.</p>

<p>The below example shows that our custom â€œTagâ€ function <code>greet</code> appends time of the day like â€œGood Morning!â€ â€œGood afternoon,â€ and so on depending on the time of the day to the string literal and returns a custom string.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*PfeJ5R0h6SHx6SxSkPCLmg.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*PfeJ5R0h6SHx6SxSkPCLmg.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*PfeJ5R0h6SHx6SxSkPCLmg.png" alt=""/>Tag function example that shows custom string interpolation</p>

<pre>//A "Tag" function returns a custom string literal.
//In this example, greet calls timeGreet() to append Good //Morning/Afternoon/Evening depending on the time of the day.</pre>

<pre>function greet(hardCodedPartsArray, ...replacementPartsArray) {
 console.log(hardCodedPartsArray); //[ 'Hello ', '!' ]
 console.log(replacementPartsArray); //[ 'Raja' ]</pre>

<pre>let str = '';
 hardCodedPartsArray.forEach((string, i) => {
  if (i < replacementPartsArray.length) {
   str += `${string} ${replacementPartsArray[i] || ''}`;
  } else {
   str += `${string} ${timeGreet()}`; //<-- append Good morning/afternoon/evening here
  }
 });
 return str;
}</pre>

<pre>//ðŸš€Usage:
const firstName = 'Raja';
const greetings = greet`Hello ${firstName}!`; //ðŸ‘ˆðŸ¼<-- Tagged literal</pre>

<pre>console.log(greetings); //'Hello  Raja! Good Morning!' ðŸ”¥</pre>

<pre>function timeGreet() {
 const hr = new Date().getHours();
 return hr < 12
  ? 'Good Morning!'
  : hr < 18 ? 'Good Afternoon!' : 'Good Evening!';
}</pre>

<p>Now that we discussed what â€œTaggedâ€ functions are, many people want to use this feature in different domains, like in Terminal for commands and HTTP requests for composing URIs, and so on.</p>

<h4 id="toc_20">âš ï¸The problem with Tagged StringÂ literal</h4>

<p>The problem is that ES2015 and ES2016 specs doesnâ€™t allow using escape characters like â€œ\uâ€ (unicode), â€œ\xâ€(hexadecimal) unless they look exactly like <code>\u00A9</code> or \u{2F804} or \xA9.</p>

<p>So if you have a Tagged function that internally uses some other domainâ€™s rules (like Terminalâ€™s rules), that may need to use <strong>\ubla123abla</strong> that doesnâ€™t look like \u0049 or \u{@F804}, then you would get a syntax error.</p>

<p>In ES2018, the rules are relaxed to allow such seemingly invalid escape characters as long as the Tagged function returns the values in an object with a â€œcookedâ€ property (where invalid characters are â€œundefinedâ€), and then a â€œrawâ€ property (with whatever you want).</p>

<pre><code>function myTagFunc(str) {  return { &quot;cooked&quot;: &quot;undefined&quot;, &quot;raw&quot;: str.raw[0] }} var str = myTagFunc `hi \
</code></pre>

<h3 id="toc_21">3. â€œdotallâ€ flag for Regular expression</h3>

<p>Currently in RegEx, although the dot(â€œ.â€) is supposed to match a single character, it doesnâ€™t match new line characters like <code>\n \r \f etc</code>.</p>

<p>For example:</p>

<pre>//Before
/first.second/.test('first\nsecond'); //false</pre>

<p>This enhancement makes it possible for the dot operator to match any single character. In order to ensure this doesnâ€™t break anything, we need to use <code>\s</code> flag when we create the RegEx for this to work.</p>

<pre>//ECMAScript 2018
/first.second**/s**.test('first\nsecond'); **//true**   Notice: /s ðŸ‘ˆðŸ¼</pre>

<p>Here is the overall API from the <a href="https://github.com/tc39/proposal-regexp-dotall-flag">proposal</a> doc:</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*t5xegqe5su6XgRDcBObyDw.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*t5xegqe5su6XgRDcBObyDw.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*t5xegqe5su6XgRDcBObyDw.png" alt=""/>ECMAScript 2018â€Šâ€”â€ŠRegex dotAll feature allows matching even \n via â€œ.â€ via /sÂ flag</p>

<h3 id="toc_22">4. RegExp Named Group CapturesÂ ðŸ”¥</h3>

<p>This enhancement brings a useful RegExp feature from other languages like Python, Java and so on called â€œNamed Groups.â€ This features allows developers writing RegExp to provide names (identifiers) in the format<code>(?&lt;name&gt;...)</code> for different parts of the group in the RegExp. They can then use that name to grab whichever group they need with ease.</p>

<h4 id="toc_23">4.1 Basic Named groupÂ example</h4>

<p>In the below example, we are using <code>(?&lt;year&gt;) (?&lt;month&gt;) and (?&lt;day&gt;)</code> names to group different parts of the date RegEx. The resulting object will now contain a <code>groups</code> property with properties <code>year</code>, <code>month</code>Â , and <code>day</code> with corresponding values.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*1ORiZapMHp_SV5gvOVT2WA.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*1ORiZapMHp_SV5gvOVT2WA.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*1ORiZapMHp_SV5gvOVT2WA.png" alt=""/>ECMAScript 2018â€Šâ€”â€ŠRegex named groupsÂ example</p>

<h4 id="toc_24"><strong>4.2 Using Named groups inside regexÂ itself</strong></h4>

<p>We can use the <code>\k&lt;group name&gt;</code> format to back reference the group within the regex itself. The following example shows how it works.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*O6i-gXHBifD27qD73Sw7TA.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*O6i-gXHBifD27qD73Sw7TA.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*O6i-gXHBifD27qD73Sw7TA.png" alt=""/>ECMAScript 2018â€Šâ€”â€ŠRegex named groups back referencing via \k<groupÂ name></p>

<h4 id="toc_25"><strong>4.3 Using named groups in String.prototype.replace</strong></h4>

<p>The named group feature is now baked into Stringâ€™s <code>replace</code> instance method. So we can easily swap words in the string.</p>

<p>For example, change â€œfirstName, lastNameâ€ to â€œlastName, firstNameâ€.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*weBLy9CAXFnWNwUqcwNMAg.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*weBLy9CAXFnWNwUqcwNMAg.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*weBLy9CAXFnWNwUqcwNMAg.png" alt=""/>ECMAScript 2018â€Šâ€”â€ŠUsing RegExâ€™s named groups feature in replaceÂ function</p>

<h3 id="toc_26">5. Rest properties forÂ Objects</h3>

<p>Rest operatorÂ <code>...</code> (three dots) allows us to extract Object properties that are not already extracted.</p>

<h4 id="toc_27"><strong>5.1 You can use rest to help extract only properties youÂ want</strong></h4>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*Uh4-1F3aeoy5k3hq8nVlfQ.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*Uh4-1F3aeoy5k3hq8nVlfQ.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*Uh4-1F3aeoy5k3hq8nVlfQ.png" alt=""/>ECMAScript 2018â€Šâ€”â€ŠObject destructuring viaÂ rest</p>

<h4 id="toc_28"><strong>5.2 Even better, you can remove unwanted items!Â ðŸ”¥ðŸ”¥</strong></h4>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*43kFc4JJy8DSQiA_zQXZZA.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*43kFc4JJy8DSQiA_zQXZZA.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*43kFc4JJy8DSQiA_zQXZZA.png" alt=""/>ECMAScript 2018â€Šâ€”â€ŠObject destructuring viaÂ rest</p>

<h3 id="toc_29">6. Spread properties forÂ Objects</h3>

<p>Spread properties also look just like rest properties with three dotsÂ <code>...</code> but the difference is that you use spread to create (restructure) new objects.</p>

<blockquote>
<p>Tip: the spread operator is used in the right side of the equals sign. The rest are used in the left-side of the equals sign.</p>
</blockquote>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*QmSUhdHQiXaXL9vdE27Djg.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*QmSUhdHQiXaXL9vdE27Djg.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*QmSUhdHQiXaXL9vdE27Djg.png" alt=""/>ECMAScript 2018â€Šâ€”â€ŠObject restructuring viaÂ spread</p>

<h3 id="toc_30">7. RegExp Lookbehind Assertions</h3>

<p>This is an enhancement to the RegEx that allows us to ensure some string exists immediately <em>_before</em>_ some other string.</p>

<p>You can now use a group <code>(?&lt;=â€¦)</code> <u>(question mark, less than, equals)</u> to look behind for positive assertion.</p>

<p>Further, you can use <code>(?&lt;!â€¦)</code> <u>(question mark, less than, exclamation)</u>, to look behind for a negative assertion. Essentially this will match as long as the -ve assertion passes.</p>

<p><strong>Positive Assertion:</strong> Letâ€™s say we want to ensure that the <code>#</code> sign exists before the word <code>winning</code> (that is: <code>#winning</code>) and want the regex to return just the string â€œwinningâ€. Here is how youâ€™d write it.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*MJuEF0dePb_NE8DHFm0XNw.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*MJuEF0dePb_NE8DHFm0XNw.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*MJuEF0dePb_NE8DHFm0XNw.png" alt=""/>ECMAScript 2018â€Šâ€”â€Š<code>(?&lt;=â€¦) for positive assertion</code></p>

<p><strong>Negative Assertion:</strong> Letâ€™s say we want to extract numbers from lines that have â‚¬ signs and not $ signs before those numbers.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*e1N-waOWBc3ykLRFCIzXSA.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*e1N-waOWBc3ykLRFCIzXSA.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*e1N-waOWBc3ykLRFCIzXSA.png" alt=""/>ECMAScript 2018â€Šâ€”â€Š(?&lt;!â€¦) for negative assertions</p>

<h3 id="toc_31"><strong>8.</strong> <a href="https://github.com/tc39/proposal-regexp-unicode-property-escapes"><strong>RegExp Unicode PropertyÂ Escapes</strong></a></h3>

<p>It was not easy to write RegEx to match various unicode characters. Things like <code>\w</code>Â , <code>\W</code>Â , <code>\d</code> etc only match English characters and numbers. But what about numbers in other languages like Hindi, Greek, and so on?</p>

<p>Thatâ€™s where Unicode Property Escapes come in. <strong>It turns out Unicode adds metadata properties for each symbol (character) and uses it to group or characterize various symbols.</strong></p>

<p>For example, Unicode database groups all Hindi characters(à¤¹à¤¿à¤¨à¥à¤¦à¥€) under a property called <code>Script</code> with value <code>Devanagari</code> and another property called <code>Script_Extensions</code> with the same value <code>Devanagari</code>. So we can search for <code>Script=Devanagari</code> and get all Hindi characters.</p>

<blockquote>
<p><a href="https://en.wikipedia.org/wiki/Devanagari_%28Unicode_block%29">Devanagari</a> can be used for various Indian languages like Marathi, Hindi, Sanskrit, and so on.</p>
</blockquote>

<p>Starting in ECMAScript 2018, we can use <code>\p</code> to escape characters along with <code>{Script=Devanagari}</code> to match all those Indian characters. <strong>That is, we can use:</strong> <code>**\p{Script=Devanagari}**</code> <strong>in the RegEx to match all Devanagari characters.</strong></p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*c-bRDN8WERPUYevc38jZMg.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*c-bRDN8WERPUYevc38jZMg.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*c-bRDN8WERPUYevc38jZMg.png" alt=""/>ECMAScript 2018â€Šâ€”â€ŠshowingÂ \p</p>

<pre>//The following matches multiple hindi character
**/^\p{Script=Devanagari}+$/u.test('à¤¹à¤¿à¤¨à¥à¤¦à¥€'); //true ** 
//PS:there are 3 hindi characters h</pre>

<p>Similarly, Unicode database groups all Greek characters under <code>Script_Extensions</code> (and <code>Script</code> ) property with the value <code>Greek</code>Â . So we can search for all Greek characters using <code>Script_Extensions=Greek</code> or <code>Script=Greek</code>Â .</p>

<p><strong>That is, we can use:</strong> <code>**\p{Script=Greek}**</code> <strong>in the RegEx to match all Greek characters.</strong></p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*DwP_VN4VUp7osFQC-I9OsQ.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*DwP_VN4VUp7osFQC-I9OsQ.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*DwP_VN4VUp7osFQC-I9OsQ.png" alt=""/>ECMAScript 2018â€Šâ€”â€ŠshowingÂ \p</p>

<pre>//The following matches a single Greek character
**/\p{Script_Extensions=Greek}/u.test('Ï€');** // true</pre>

<p>Further, the Unicode database stores various types of Emojis under the boolean properties <code>Emoji</code>, <code>Emoji_Component</code>, <code>Emoji_Presentation</code>, <code>Emoji_Modifier</code>, and <code>Emoji_Modifier_Base</code> with property values as <code>true</code>. So we can search for all Emojis by simply selecting <code>Emoji</code> to be true.</p>

<p><strong>That is, we can use:</strong> <code>**\p{Emoji}**</code><strong>Â ,</strong><code>**\Emoji_Modifier**</code> <strong>and so on to match various kinds of Emojis.</strong></p>

<p>The following example will make it all clear.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*DsQryeDlp8fAKBS8k_ohqw.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*DsQryeDlp8fAKBS8k_ohqw.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*DsQryeDlp8fAKBS8k_ohqw.png" alt=""/>ECMAScript 2018â€Šâ€”â€Šshowing how \p can be used for variousÂ emojis</p>

<pre>//The following matches an Emoji character
/\p{Emoji}/u.test('â¤ï¸'); //true</pre>

<pre>//The following fails because yellow emojis don't need/have Emoji_Modifier!
/\p{Emoji}\p{Emoji_Modifier}/u.test('âœŒï¸'); //false</pre>

<pre>//The following matches an emoji character\p{Emoji} followed by \p{Emoji_Modifier}
/\p{Emoji}\p{Emoji_Modifier}/u.test('âœŒðŸ½'); //true</pre>

<pre>//Explaination:
//By default the victory emoji is yellow color.
//If we use a brown, black or other variations of the same emoji, they are considered
//as variations of the original Emoji and are represented using two unicode characters.
//One for the original emoji, followed by another unicode character for the color.
//
//So in the below example, although we only see a single brown victory emoji,
//it actually uses two unicode characters, one for the emoji and another
// for the brown color.
//
//In Unicode database, these colors have Emoji_Modifier property.
//So we need to use both \p{Emoji} and \p{Emoji_Modifier} to properly and
//completely match the brown emoji.
/\p{Emoji}\p{Emoji_Modifier}/u.test('âœŒðŸ½'); //true</pre>

<p><strong>Lastly, we can use capital &quot;Pâ€(</strong><code>\P</code> <strong>) escape character instead of small p (</strong><code>\p</code> )<strong>, to negate the matches.</strong></p>

<p>References:</p>

<ol>
<li> <a href="https://mathiasbynens.be/notes/es-unicode-property-escapes">_ECMAScript 2018 Proposal_</a></li>
<li> <a href="https://mathiasbynens.be/notes/es-unicode-property-escapes">_https://mathiasbynens.be/notes/es-unicode-property-escapes_</a></li>
</ol>

<h3 id="toc_32">8. Promise.prototype.finally()</h3>

<p><code>finally()</code> is a new instance method that was added to Promise. The main idea is to allow running a callback after either <code>resolve</code> or <code>reject</code> to help clean things up. The <code>**finally**</code> <strong>callback is called without any value and is always executed no matter what.</strong></p>

<p>Letâ€™s look at various cases.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*P1V6c1ncEjeCgtS6zzR0gg.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*P1V6c1ncEjeCgtS6zzR0gg.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*P1V6c1ncEjeCgtS6zzR0gg.png" alt=""/>ECMAScript 2018â€Šâ€”â€Šfinally() in resolveÂ case<img src="https://cdn-images-1.medium.com/freeze/max/30/1*tSbu3kZCkoGpXaWDuP6MPA.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*tSbu3kZCkoGpXaWDuP6MPA.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*tSbu3kZCkoGpXaWDuP6MPA.png" alt=""/>ECMAScript 2018â€Šâ€”â€Šfinally() in rejectÂ case<img src="https://cdn-images-1.medium.com/freeze/max/30/1*kB6Ar5YJoAlwwhFqzMGBGg.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*kB6Ar5YJoAlwwhFqzMGBGg.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*kB6Ar5YJoAlwwhFqzMGBGg.png" alt=""/>ECMASCript 2018â€Šâ€”â€Šfinally() in Error thrown from PromiseÂ case<img src="https://cdn-images-1.medium.com/freeze/max/30/1*wCcbabJsS8UbFclumSISqg.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*wCcbabJsS8UbFclumSISqg.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*wCcbabJsS8UbFclumSISqg.png" alt=""/>**ECMAScript 2018â€Šâ€”â€ŠError thrown from within <strong>catch</strong> case**</p>

<h3 id="toc_33">9. Asynchronous Iteration</h3>

<p>This is an <em>extremely</em> useful feature. Basically it allows us to create loops of async code with ease!</p>

<p>This feature adds a new <strong>â€œfor-await-ofâ€</strong> loop that allows us to call async functions that return promises (or Arrays with a bunch of promises) in a loop. The cool thing is that the loop waits for each Promise to resolve before doing to the next loop.</p>

<p><img src="https://cdn-images-1.medium.com/freeze/max/30/1*liLeNfWxZ3x1sqrVmRUdRQ.png?q=20" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*liLeNfWxZ3x1sqrVmRUdRQ.png" alt=""/><img src="https://cdn-images-1.medium.com/max/800/1*liLeNfWxZ3x1sqrVmRUdRQ.png" alt=""/>ECMAScript 2018â€Šâ€”â€ŠAsync Iterator via for-await-of</p>

<p>Thatâ€™s pretty much it!</p>

<h4 id="toc_34">If this was useful, please click the clap ðŸ‘ button down below a few times to show your support! â¬‡â¬‡â¬‡Â ðŸ™ðŸ¼</h4>

<h3 id="toc_35">My OtherÂ Posts</h3>

<p><a href="https://medium.com/@rajaraodv/latest">_https://medium.com/@rajaraodv/latest_</a></p>

<h4 id="toc_36">Related ECMAScript 2015+Â posts</h4>

<ol>
<li> <a href="https://medium.freecodecamp.org/check-out-these-useful-ecmascript-2015-es6-tips-and-tricks-6db105590377">_Check out these useful ECMAScript 2015 (ES6) tips and tricks_</a></li>
<li> <a href="https://medium.com/@rajaraodv/5-javascript-bad-parts-that-are-fixed-in-es6-c7c45d44fd81#.7e2s6cghy">_5 JavaScript â€œBadâ€ Parts That Are Fixed In ES6_</a></li>
<li><p><a href="https://medium.com/@rajaraodv/is-class-in-es6-the-new-bad-part-6c4e6fe1ee65#.4hqgpj2uv">_Is â€œClassâ€ In ES6 The New â€œBadâ€ Part?_</a></p></li>
</ol>

<ul>
<li>  <a href="https://medium.freecodecamp.org/tagged/javascript?source=post">JavaScript</a></li>
<li>  <a href="https://medium.freecodecamp.org/tagged/tech?source=post">Tech</a></li>
<li>  <a href="https://medium.freecodecamp.org/tagged/programming?source=post">Programming</a></li>
<li>  <a href="https://medium.freecodecamp.org/tagged/startup?source=post">Startup</a></li>
<li>  <a href="https://medium.freecodecamp.org/tagged/web-development?source=post">Web Development</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¦‚ä½•ç”¨Goå®žçŽ°ä¸€æ¬¾ç±»ä¼¼æ»´æ»´ä¼˜æ­¥çš„ç½‘ç»œçº¦è½¦è½¯ä»¶(å«æºç )]]></title>
    <link href="http://panlw.github.io/15352960653784.html"/>
    <updated>2018-08-26T23:07:45+08:00</updated>
    <id>http://panlw.github.io/15352960653784.html</id>
    <content type="html"><![CDATA[
<pre><code>Andrew Minkin  é«˜å¯ç”¨æž¶æž„  2017-02-28
</code></pre>

<blockquote>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548297&amp;idx=1&amp;sn=71fc309da16f1ed2b3d8b0d847f730a0&amp;chksm=813a7e91b64df78734a2d155e79bedab66ebd078aed5d6ab3f01eb1b1b2a1d957f7c3ca204d5&amp;scene=21#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548297&amp;idx=1&amp;sn=71fc309da16f1ed2b3d8b0d847f730a0&amp;chksm=813a7e91b64df78734a2d155e79bedab66ebd078aed5d6ab3f01eb1b1b2a1d957f7c3ca204d5&amp;scene=21#wechat_redirect</a></p>
</blockquote>

<p>å¯¼è¯»ï¼šæˆ‘ä»¬ç»å¸¸ä½¿ç”¨æ‰“è½¦è½¯ä»¶å‡ºè¡Œï¼Œä¹Ÿç»å¸¸æ€è€ƒå…¶æž¶æž„è®¾è®¡ã€‚æœ¬æ–‡ä½œè€…åœ¨æ‰€åœ¨å›½å®¶ä¹Ÿè´Ÿè´£å¼€å‘ä¸€æ¬¾æ‰“è½¦è½¯ä»¶ï¼Œå¹¶ä¸”å¼€æºäº†å…¶ä¸­å¤§éƒ¨åˆ†ä»£ç ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½äº†è§£ç½‘ç»œçº¦è½¦è½¯ä»¶çš„æž¶æž„ä½“ç³»ã€‚æœ¬æ–‡ç”±é«˜å¯ç”¨æž¶æž„ç¿»è¯‘ã€‚</p>

<p><img src="http://mmbiz.qpic.cn/mmbiz_png/8XkvNnTiapOMnaWlypBttlyEyfP2FFJwMFfEjD6rrQsA0WwRZRO3qIAxXqlMnWvILWiadCNXYPEa33aJO5PsaLDQ/0?wx_fmt=png" alt=""/></p>

<p>å„ä½è¯»è€…å¥½ï¼Œæœ¬æ–‡å°†ç»™å¤§å®¶åˆ†äº«æˆ‘ä»¬å¦‚ä½•é€šè¿‡å†…å­˜å­˜å‚¨å®žçŽ°åœ°å›¾åŠ¨ç”»è½¦æ•ˆæžœã€‚ æˆ‘ä»¬å…¬å¸ä¹Ÿè¿è¥äº†ä¸€ä¸ªç±»ä¼¼ Uber çš„è½¯ä»¶ Namba Taxiï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®¢æˆ·ç«¯ä¸»å±å¹•ä¸Šæ˜¾ç¤ºåŠ¨ç”»è½¦ã€‚ è¿™ç¯‡æ–‡ç« æ˜¯å…³äºŽåŠŸèƒ½å¦‚ä½•å®Œæ•´å®žçŽ°çš„æ–‡ç« ï¼Œä¸»è¦ç›®çš„ä¸æ˜¯ä»‹ç» Go è¯­è¨€ã€‚</p>

<h2 id="toc_0"><strong>å¼€å§‹</strong></h2>

<p>è¿™ä¸ªæ•…äº‹å§‹äºŽ 2015 å¹´ï¼Œæˆ‘ä»¬çš„ç§»åŠ¨å¼€å‘äººå‘˜å¼€å‘ä¸€æ¬¾è½¯ä»¶ï¼Œå·¥ä½œä¸»é¢˜æ˜¯ä¸ºå‡ºç§Ÿè½¦å¸æœºæä¾›æ‰“è½¦æœåŠ¡ã€‚ åœ¨åº”ç”¨ç¨‹åºä¸­ï¼ŒåŠ¨ç”»æ±½è½¦çœ‹èµ·æ¥åƒä¸‹é¢çš„å›¾ä¸­åŠ¨ç”»é‚£æ · [1] ã€‚</p>

<p><img src="http://mmbiz.qpic.cn/mmbiz_png/8XkvNnTiapOMnaWlypBttlyEyfP2FFJwMxosd5hJ54PXZDDXnOFqibTIYtdsQGWtr4VTgYObn1zb2ULagtDvmMCg/0?wx_fmt=png" alt=""/></p>

<p>æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ç¼ºä¹åœ°å›¾è·Ÿè¸ªæ•°æ®ã€‚æˆ‘ä»¬æ¯ 15 ç§’èŽ·å–ä¸€æ¬¡ä½ç½®æ•°æ®ã€‚ æˆ‘ä»¬ä¸èƒ½ç®€å•å‡å°ä¸ŠæŠ¥é—´éš”ï¼Œå› ä¸ºå½“å¸æœºç«¯ç¨‹åºä¸Šè¡Œæ•°æ®æ—¶å€™ï¼ŒåŒæ—¶éœ€è¦èŽ·å–å½“å‰è®¢å•ï¼Œä¸‹ä¸€ä¸ªè®¢å•ï¼Œä»¥åŠä¸€äº›è­¦æŠ¥åŠŸèƒ½ï¼ˆä¸€ä¸ª SOS æŒ‰é’®ï¼Œ å½“å¸æœºæŒ‰ä¸‹å®ƒï¼Œå…¶ä»–å¸æœºå°±å¯ä»¥å¸®åŠ©ä»–ï¼‰ã€‚å½“æˆ‘ä»¬å‡å°‘æ›´æ–°é—´éš”æ—¶ï¼Œç³»ç»Ÿæµé‡æ›´å¤§ã€‚ æˆ‘ä»¬ä¸ç¡®è®¤æˆ‘ä»¬æ˜¯å¦èƒ½å¤Ÿæ‰›ä½å¦‚æ­¤å¤§çš„åˆ·æ–°ã€‚</p>

<h2 id="toc_1"><strong>å®žçŽ°çš„ç¬¬ä¸€æ­¥</strong></h2>

<p>æˆ‘ä»¬ç¬¬ä¸€æ¬¡çš„å°è¯•æ¯”è¾ƒç®€å•ï¼š</p>

<ol>
<li><p>å¤„ç†è¯·æ±‚å¹¶ä¿å­˜åæ ‡ã€‚</p></li>
<li><p>åˆ›å»ºå¦ä¸€ä¸ªè¯·æ±‚å¹¶ä¸ºæ±½è½¦è®¾ç½®åŠ¨ç”»ã€‚</p></li>
</ol>

<p>æ˜¾è€Œæ˜“è§ï¼Œè¿™æ ·åšå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå¦‚å¤§å®¶åœ¨ä¸€äº›æ‰“è½¦è½¯ä»¶æ‰€è§ï¼Œæˆ‘ä»¬ä¸èƒ½æ­£ç¡®åœ°ç»˜åˆ¶æ±½è½¦è·¯çº¿ï¼Œæ±½è½¦å¯èƒ½è·‘åœ¨ç”°é‡Žï¼Œæ£®æž—ï¼Œæ¹–æ³Šå’Œå…¬å¯“ä¸Šï¼Œç”¨è¿™ç§æ–¹æ³•åŽæ•ˆæžœçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ [2]ã€‚</p>

<p><img src="http://mmbiz.qpic.cn/mmbiz_png/8XkvNnTiapOMnaWlypBttlyEyfP2FFJwMdWKnMmHpaANJJicc67qKbmkgTPExVVtAl0y9MOeW1bjbRBavJOakx4w/0?wx_fmt=gif" alt=""/></p>

<p>ä½œä¸ºé—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ OpenStreetMap Routeing Machineï¼ˆOSRMï¼‰æ¥è§„åˆ’çº¿è·¯å¹¶æ”¹è¿›æˆ‘ä»¬çš„ç®—æ³•ï¼Œå¹¶ä½¿ç”¨ç›¸åŒçš„è¶…æ—¶è®¾ç½®ã€‚</p>

<ol>
<li><p>å‘èµ·è¯·æ±‚ã€‚</p></li>
<li><p>èŽ·å–åæ ‡ã€‚</p></li>
<li><p>å°†ä¿å­˜çš„åæ ‡å‘é€åˆ°æœåŠ¡å™¨ã€‚</p></li>
<li><p>é€šè¿‡ OSRM æž„å»ºè·¯çº¿ã€‚</p></li>
<li><p>è¿”å›žæ•°æ®åˆ°å®¢æˆ·ç«¯ã€‚</p></li>
</ol>

<p>é€šè¿‡çº¿è·¯è§„åˆ’ä½“ç³»ï¼ŒçŽ°åœ¨ä¼¼ä¹Žå¯ä»¥å·¥ä½œäº†ï¼Œä½†æˆ‘ä»¬åˆé¢ä¸´å•å‘é“è·¯çš„é—®é¢˜</p>

<p><img src="http://mmbiz.qpic.cn/mmbiz_png/8XkvNnTiapOMnaWlypBttlyEyfP2FFJwMoo1cEvvjvZgAuZ35V80cBJRJxyqHyfIGvQmDxJzDfMgUS2xuzzbNZg/0?wx_fmt=png" alt=""/></p>

<p>ä¾‹å¦‚ï¼Œå¸æœºåœç•™åœ¨çº¢ç‚¹çš„åå­—è·¯å£ã€‚ ä½†ä»–çš„è®¾å¤‡ä½ç½®å‡†ç¡®æ€§æœ‰é—®é¢˜ï¼Œå¯¼è‡´æ•°æ®æ ‡è®°åœ¨åå­—è·¯å£çš„å¯¹é¢ã€‚ åœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬èŽ·å–è¿™äº›åæ ‡ï¼Œä¿å­˜å¹¶å‘é€åˆ°åŽç«¯ï¼ŒOSRM å»ºç«‹ä¸€ä¸ªåˆæ³•çš„è·¯çº¿ï¼Œå¹¶è¿”å›žç»™åº”ç”¨ç¨‹åºã€‚å› ä¸ºå®¢æˆ·ç«¯ç§»åŠ¨å¾—éžå¸¸å¿«ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µè·¯çº¿è§„åˆ’å¾ˆå¯ç¬‘ã€‚<br/>
æˆ‘ä»¬ä»¥ä¸€ç§æœ´ç´ çš„æ–¹å¼è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ <strong>æˆ‘ä»¬æ£€æŸ¥ä¸¤ç‚¹ä¹‹é—´çš„æœ€çŸ­è·ç¦»ï¼Œå¹¶ä¸”ä¸å»ºç«‹è·ç¦»å°äºŽ 20 ç±³çš„è·¯çº¿ã€‚</strong> ä½¿ç”¨è¯¥ç®—æ³•ç»è¿‡å‡ å¤©çš„æµ‹è¯•åŽï¼Œæˆ‘ä»¬å†³å®šå‘å¸ƒæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹¶å¸Œæœ›èŽ·å–ä¸€äº›åé¦ˆã€‚<br/>
å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬çš„ç‰ˆæœ¬è¿˜å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šè¿›è¡Œç¬¬äºŒæ¬¡è¿­ä»£ã€‚</p>

<ol>
<li><p>ç¬¬ä¸€æ˜¯è½¦è´¹è®¡ç®—å™¨ï¼Œ<strong>è®¡ç®—æ˜¯åœ¨å¸æœºç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰å®Œæˆï¼Œè¿™æ ·é¿å…å‘é€æ— ç”¨çš„è¯·æ±‚</strong>ï¼Œå¯ä»¥èŠ‚çº¦å¾ˆå¤šæœåŠ¡ç«¯èµ„æºã€‚ å¦ä¸€æ–¹é¢ï¼Œä¸ºäº†å®‰å…¨ç­‰æ–¹é¢è€ƒè™‘ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡å™¨ç«¯å¤åˆ¶æ•°æ®å¹¶ä¿å­˜å®ƒã€‚</p></li>
<li><p>æ­¤å¤–ï¼Œæˆ‘ä»¬æ„è¯†åˆ°æ¯ 15 ç§’ä¸€æ¬¡ä¸ŠæŠ¥å¤ªå°‘ï¼Œå› ä¸ºç”¨æˆ·åœ¨å±å¹•æ‰“å¼€åŽï¼Œ15 ç§’åŽæ‰ä¼šçœ‹åˆ°è½¦åœ¨ç§»åŠ¨ã€‚</p></li>
<li><p>æ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨å¸æœºç«¯çš„ GPS æ¨¡å—æœ‰å¾ˆå¤šé—®é¢˜ï¼Œè¿™ä¸ªå¯èƒ½è·Ÿå¸æœºçš„æ‰‹æœºè®¾å¤‡ç›¸å…³ã€‚</p></li>
<li><p>æœ€åŽï¼Œæˆ‘ä»¬æƒ³è¦åœ¨ä¸»å±å¹•ä¸Šæ¸²æŸ“åŠ¨ç”»è½¦ã€‚</p></li>
</ol>

<h2 id="toc_2"><strong>è¿˜éœ€è¦è§£å†³çš„é—®é¢˜</strong></h2>

<ol>
<li><p>ä»Žå¸æœºæ”¶é›†æ›´å¤šçš„æ•°æ®</p></li>
<li><p>åœ¨ä¸»å±å¹•ä¸Šæ˜¾ç¤ºåŠ¨ç”»è½¦</p></li>
<li><p>åœ¨æœåŠ¡å™¨ç«¯å­˜å‚¨è¡Œè½¦è¿‡ç¨‹ä¸­è®¡è´¹æ•°æ®</p></li>
<li><p>èŠ‚çº¦ç§»åŠ¨æµé‡</p></li>
<li><p>æ¯ç§’æ”¶é›†ä¸€æ¬¡æ•°æ®</p></li>
</ol>

<p>æˆ‘æƒ³è°ˆä¸€è°ˆæœ‰å…³èŠ‚çº¦ç§»åŠ¨æµé‡å¸¦å®½çš„é—®é¢˜ã€‚åœ¨æˆ‘ä»¬å›½å®¶ï¼Œå‡ºç§Ÿè½¦æ”¶è´¹éžå¸¸ä¾¿å®œï¼Œæˆ‘ä»¬åƒä½¿ç”¨å…¬å…±äº¤é€šé‚£æ ·ä½¿ç”¨å‡ºç§Ÿè½¦ã€‚ ä¾‹å¦‚ï¼Œä»ŽåŸŽå¸‚çš„ä¸€è¾¹è·‘åˆ°å¦ä¸€è¾¹å¯èƒ½åªéœ€è¦ 2 æ¬§å…ƒï¼Œè¿™å°±è·Ÿåœ¨å·´é»Žååœ°é“ä»·æ ¼å·®ä¸å¤šã€‚ä½†å¦å¤–ä¸€æ–¹é¢ç§»åŠ¨å¸¦å®½æˆæœ¬è¿˜ä¹Ÿå¾ˆé«˜ï¼Œå¦‚æžœæˆ‘ä»¬æ¯ç§’èŠ‚çº¦ 100 å­—èŠ‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ç»™ä¸ºå…¬å¸èŠ‚çœå·®ä¸å¤š 2000 ç¾Žå…ƒã€‚</p>

<h2 id="toc_3"><strong>æ•°æ®è¿½è¸ª</strong></h2>

<ol>
<li><p>å¸æœºä½ç½®ï¼ˆçº¬åº¦ï¼Œç»åº¦ï¼‰</p></li>
<li><p>å¸æœºå½“å‰çš„ session ä¿¡æ¯ï¼Œåœ¨ç™»å½•æ—¶æˆ‘ä»¬ä¼šç»™å¸æœºç«¯æä¾› session id</p></li>
<li><p>è®¢å•ä¿¡æ¯ï¼ˆè®¢å• ID å’Œè½¦è´¹ï¼‰</p></li>
</ol>

<p>æˆ‘ä»¬å†³å®šæ¯ä¸€æ¬¡æ•°æ®ä¸ŠæŠ¥åº”å°äºŽ 100 å­—èŠ‚ã€‚ æˆ‘ä»¬å¯»æ‰¾ä¼ è¾“åè®®æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p>

<p>æ­£å¦‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å®¡è§†äº†ä»¥ä¸‹å‡ ä¸ªåè®®ï¼š</p>

<ol>
<li><p>HTTP</p></li>
<li><p>WebSockets</p></li>
<li><p>TCP</p></li>
<li><p>UDP</p></li>
</ol>

<p><strong>å¯¹æˆ‘ä»¬æ¥è¯´ç†æƒ³çš„é€‰æ‹©æ˜¯ UDP</strong>ï¼Œå› ä¸ºï¼š</p>

<ol>
<li><p>æˆ‘ä»¬åªå‘é€æ•°æ®æŠ¥</p></li>
<li><p>æˆ‘ä»¬ä¸éœ€è¦ä¿è¯é€è¾¾</p></li>
<li><p>æžç®€ä¸»ä¹‰</p></li>
<li><p>ä¿å­˜å¤§é‡æ•°æ®</p></li>
<li><p>åªæœ‰ 20 å­—èŠ‚å¼€é”€</p></li>
<li><p>åœ¨æˆ‘ä»¬çš„å›½å®¶çš„ç§»åŠ¨ç½‘ç»œæ²¡æœ‰è¢«é˜»æ­¢</p></li>
</ol>

<p>è‡³äºŽæ•°æ®åºåˆ—åŒ–ï¼Œæˆ‘ä»¬è€ƒå¯Ÿäº†ï¼š</p>

<ol>
<li><p>JSON</p></li>
<li><p>MsgPack</p></li>
<li><p>Protobuf</p></li>
</ol>

<p><strong>æˆ‘ä»¬é€‰æ‹© ProtoBuf</strong>ï¼Œå› ä¸ºå®ƒå¯¹å°æ•°æ®éžå¸¸æœ‰æ•ˆã€‚</p>

<p><img src="http://mmbiz.qpic.cn/mmbiz_png/8XkvNnTiapOMnaWlypBttlyEyfP2FFJwMLibAuRGlVYtrciaab5sWnAvKNlqe2ia2EiawGkbC9UovDeibPfdU186oGrQ/0?wx_fmt=png" alt=""/></p>

<p>ä»¥çœ‹åˆ°æœ€è¿‘çš„ç«žäº‰å¯¹æ‰‹æ˜¯ PB çš„ä¸‰å€ã€‚ï¼ˆå°ç¼–ï¼šå¯ä»¥å‚è€ƒ TimYang çš„ä¸€æ¡å¾®åš [3] ï¼‰</p>

<h2 id="toc_4"><strong>æ¯æ¬¡ä¸ŠæŠ¥æ€»å…±çš„æ•°æ®</strong></h2>

<ol>
<li><p>42 å­—èŠ‚çš„ä¸šåŠ¡æ•°æ®</p></li>
<li><p>åŠ ä¸Š 20 å­—èŠ‚çš„ IP æŠ¥å¤´</p></li>
<li><p>å¾—åˆ°æ¯æ¬¡ä¸ŠæŠ¥ 62 å­—èŠ‚æ•°æ®</p></li>
</ol>

<p>å½“æˆ‘ä»¬èŽ·å¾—æ•°æ®æ—¶ï¼Œæˆ‘ä»¬è€ƒè™‘å¦‚ä½•å­˜å‚¨ã€‚</p>

<h2 id="toc_5"><strong>æ•°æ®å­˜å‚¨</strong></h2>

<p>æˆ‘ä»¬éœ€è¦å­˜å‚¨è¿™äº›æ•°æ®ï¼š</p>

<ol>
<li><p>æ ‡è¯†å¸æœºçš„ä¼šè¯ä¿¡æ¯ session id</p></li>
<li><p>è½¦ç‰Œå·</p></li>
<li><p>è®¢å• ID å’Œè®¡è´¹ä¿¡æ¯</p></li>
<li><p>æ‰§è¡Œæœç´¢çš„æœ€åŽä½ç½®</p></li>
<li><p>N æ¬¡æœ€åŽä½ç½®ä»¥è§„åˆ’è·¯çº¿</p></li>
</ol>

<h2 id="toc_6"><strong>ä½¿ç”¨çš„å­˜å‚¨</strong></h2>

<ol>
<li><p>ä½¿ç”¨ Percona å­˜å‚¨æ‰€æœ‰æ•°æ®ã€‚ æˆ‘ä»¬å­˜å‚¨å¸æœºï¼Œè®¢å•ï¼Œè®¡è´¹ç­‰ã€‚</p></li>
<li><p>Redis ä½œä¸ºç”¨äºŽç¼“å­˜ã€‚</p></li>
<li><p>Elasticsearch ç”¨äºŽåœ°ç†ç¼–ç </p></li>
</ol>

<p>å¦‚ä¸Šæ‰€è¿°ï¼Œå½“æœ‰å¤§é‡åœ¨çº¿å¸æœºæ—¶å€™ï¼Œä½¿ç”¨è¿™äº›å­˜å‚¨æ¥ä¿å­˜æ•°æ®å¹¶ä¸æ–¹ä¾¿ã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ°ç†ç´¢å¼•ã€‚</p>

<p>æˆ‘ä»¬è¯„ä¼°äº†ä¸¤ä¸ªåœ°ç†ç´¢å¼•ï¼š</p>

<ol>
<li><p>KD æ ‘</p></li>
<li><p>R æ ‘ã€‚</p></li>
</ol>

<p>æˆ‘ä»¬å¯¹åœ°ç†ç´¢å¼•çš„è¦æ±‚ï¼š</p>

<ol>
<li><p>æœç´¢ N ä¸ªæœ€è¿‘çš„ç‚¹ã€‚</p></li>
<li><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¹³è¡¡æ ‘ï¼Œä»¥åœ¨æœ€ç³Ÿç³•çš„æƒ…å†µä¸‹æä¾›æœ€å¥½çš„æœç´¢</p></li>
</ol>

<h2 id="toc_7">KD æ ‘<img src="http://mmbiz.qpic.cn/mmbiz_png/8XkvNnTiapOMnaWlypBttlyEyfP2FFJwMNpwaMWy5okg9EBiaHFXPRZuX6SwT3ceQKficI55o5bCebUcPNDgicySKw/0?wx_fmt=png" alt=""/></h2>

<p>KD æ ‘å¹¶ä¸é€‚åˆæˆ‘ä»¬çš„éœ€è¦ï¼Œå› ä¸ºå®ƒæ˜¯ä¸å¹³è¡¡çš„ï¼Œåªèƒ½æœç´¢ä¸€ä¸ªæœ€è¿‘çš„ç‚¹ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨ kd-tree ä¸Šå®žçŽ° k-nearest é‚»å±…ï¼Œä½†æ˜¯æ²¡å¿…è¦é‡é€ è½®å­ï¼Œå› ä¸º R-tree å·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>

<h2 id="toc_8">R - æ ‘</h2>

<p><img src="http://mmbiz.qpic.cn/mmbiz_png/8XkvNnTiapOMnaWlypBttlyEyfP2FFJwMsYQQnUbcAwXMXR5drAE1gxHPEDeKnYfct9TgYtzyQjEnQxxicicPGicnw/0?wx_fmt=png" alt=""/></p>

<p>å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ã€‚ æˆ‘ä»¬å¯ä»¥æ‰§è¡Œæœç´¢ N ä¸ªæœ€è¿‘ç‚¹ï¼Œå¹¶ä¸”å®ƒæ˜¯å¹³è¡¡æ ‘ã€‚ æˆ‘ä»¬é€‰æ‹©äº†è¿™ä¸ªã€‚</p>

<p>æ‚¨å¯ä»¥å¾—åˆ°å®ƒçš„ Go è¯­è¨€å®žçŽ°æºç  [5]ã€‚</p>

<p>å¦å¤–ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¿‡æœŸæœºåˆ¶ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä½¿å¸æœºçš„è¶…æ—¶æœºåˆ¶ï¼Œæ¯”å¦‚å¸æœºç«¯ 900 ç§’æ²¡æœ‰å“åº”åˆ™åœ¨æœåŠ¡å™¨åˆ é™¤ä¼šè¯ã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦ LRU æ•°æ®ç»“æž„æ¥å­˜å‚¨æœ€åŽçš„ä½ç½®ã€‚ åŒæ—¶å› ä¸ºæˆ‘ä»¬åªå­˜å‚¨ N ä¸ªä½ç½®ã€‚ å¦‚æžœæˆ‘ä»¬å°è¯•æ·»åŠ æ•°æ®æ—¶å€™ï¼Œé˜Ÿåˆ—å­˜å‚¨å·²æ»¡ï¼Œæˆ‘ä»¬åˆ™åˆ é™¤æœ€å°‘ä½¿ç”¨çš„é‚£ä¸ªæ¡ç›®ã€‚Â </p>

<p>ä¸‹é¢æ˜¯æˆ‘ä»¬çš„å­˜å‚¨æž¶æž„ã€‚</p>

<ol>
<li><p>æˆ‘ä»¬å°†æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚</p></li>
<li><p><strong>æˆ‘ä»¬ä½¿ç”¨ R-tree æ‰§è¡Œæœç´¢æœ€è¿‘çš„å¸æœº</strong>ã€‚</p></li>
<li><p>æ­¤å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªæ£€ç´¢å›¾ï¼Œå¯ä»¥å¹¶æŒ‰è½¦ç‰Œå·æˆ– session æ‰§è¡Œæœç´¢</p></li>
</ol>

<h2 id="toc_9"><strong>æˆ‘ä»¬æ‰“è½¦è½¯ä»¶æœ€ç»ˆç®—æ³•</strong></h2>

<p>è¿™é‡Œæ˜¯åŽç«¯çš„æœ€ç»ˆç®—æ³•ï¼š</p>

<ol>
<li><p>ä½¿ç”¨ UDP ä¼ è¾“æ•°æ®</p></li>
<li><p>å°è¯•ä»Žå­˜å‚¨èŽ·å–å¸æœº</p></li>
<li><p>å¦‚æžœå­˜å‚¨ä¸å­˜åœ¨ - åˆ™ä»Ž Redis èŽ·å–å¸æœº</p></li>
<li><p>æ£€æŸ¥å¹¶éªŒè¯æ•°æ®</p></li>
<li><p>å°†å¸æœºä¿å­˜åˆ°å­˜å‚¨</p></li>
<li><p>å¦‚æžœä¸å­˜åœ¨ - åˆå§‹åŒ– LRU</p></li>
<li><p>æ›´æ–° r-tree</p></li>
</ol>

<h2 id="toc_10"><strong>HTTP æŽ¥å£</strong></h2>

<p>æˆ‘ä»¬å®žçŽ°äº†è¿™äº›æŽ¥å£ï¼š</p>

<ol>
<li><p>è¿”å›žæœ€è¿‘çš„å¸æœºï¼›</p></li>
<li><p>ä»Žå­˜å‚¨ä¸­åˆ é™¤å¸æœºï¼ˆé€šè¿‡è½¦ç‰Œå·æˆ– session idï¼‰</p></li>
<li><p>èŽ·å–è¡Œç¨‹ä¿¡æ¯</p></li>
<li><p>èŽ·å–å¸æœºä¿¡æ¯</p></li>
</ol>

<h2 id="toc_11"><strong>ç»“è®º</strong></h2>

<p>æœ€åŽï¼Œæˆ‘æƒ³ç»™å‡ºæˆ‘ä»¬åœ¨åŽç«¯ç³»ç»Ÿä¸­æ€»ç»“çš„ç»éªŒï¼š</p>

<ol>
<li><p>UDP + Protobuf ä»¥èŠ‚çœæ•°æ®</p></li>
<li><p>å†…å­˜å­˜å‚¨</p></li>
<li><p>R æ ‘èŽ·å–æœ€è¿‘çš„å¸æœº</p></li>
<li><p>LRU ç¼“å­˜ç”¨äºŽå­˜å‚¨æœ€åŽçš„ n ä¸ªä½ç½®</p></li>
<li><p>OSRM ç”¨äºŽåœ°å›¾åŒ¹é…å’Œå®šåˆ¶è·¯çº¿</p>

<p><img src="http://mmbiz.qpic.cn/mmbiz_png/8XkvNnTiapOMnaWlypBttlyEyfP2FFJwM4mXrsdcMWvsrRnGLjT82TuFmG7CMibUeb7ONlhHxRscdWpTD34nImNg/0?wx_fmt=png" alt=""/></p></li>
</ol>

<p>æ‚¨å¯ä»¥åœ¨ github [5]Â ä¸ŠæŸ¥çœ‹ä¸Šé¢æ•´ä¸ªè¿‡ç¨‹çš„æºä»£ç ã€‚çŽ°åœ¨åŠŸèƒ½è¿˜æ¯”è¾ƒç®€å•ï¼Œä½†å®žçŽ°äº†æ–‡ç« ä¸­æè¿°çš„è®¸å¤šåŠŸèƒ½ã€‚</p>

<p><strong>å‚è€ƒèµ„æº</strong></p>

<ol>
<li><p>GIF åŠ¨ç”»ä¸‹è½½ï¼š<a href="https://cdn-images-1.medium.com/max/1600/1*nI6cNApASR1mg6F5Sjgp7Q.gif">https://cdn-images-1.medium.com/max/1600/1*nI6cNApASR1mg6F5Sjgp7Q.gif</a></p></li>
<li><p><a href="https://cdn-images-1.medium.com/max/1600/1*KfGB1SARPoqOUtPtl4NNBg.gif">https://cdn-images-1.medium.com/max/1600/1*KfGB1SARPoqOUtPtl4NNBg.gif</a></p></li>
<li><p><a href="http://weibo.com/10503/24F1QpDmL">http://weibo.com/10503/24F1QpDmL</a></p></li>
<li><p><a href="https://github.com/dhconnelly/rtreego">https://github.com/dhconnelly/rtreego</a></p></li>
<li><p><a href="https://github.com/maddevsio/openfreecabs">https://github.com/maddevsio/openfreecabs</a></p></li>
<li><p>æœ¬æ–‡è‹±æ–‡åŽŸæ–‡ï¼š<a href="https://blog.maddevs.io/how-we-built-a-backend-system-for-uber-like-map-with-animated-cars-on-it-using-go-29d5dcd517a#.npo2x5788">https://blog.maddevs.io/how-we-built-a-backend-system-for-uber-like-map-with-animated-cars-on-it-using-go-29d5dcd517a#.npo2x5788</a></p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ES modules: A cartoon deep-dive]]></title>
    <link href="http://panlw.github.io/15352957865945.html"/>
    <updated>2018-08-26T23:03:06+08:00</updated>
    <id>http://panlw.github.io/15352957865945.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/">https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/</a></p>
</blockquote>

<p>ES modules bring an official, standardized module system to JavaScript. It took a while to get here, thoughâ€Šâ€”â€Šnearly 10 years of standardization work.</p>

<p>But the wait is almost over. With the release of Firefox 60 in May (<a href="https://www.mozilla.org/en-US/firefox/developer/">currently in beta</a>), all major browsers will support ES modules, and the Node modules working group is currently working on adding ES module support to <a href="https://nodejs.org/en/">Node.js</a>. And <a href="https://www.youtube.com/watch?v=qR_b5gajwug">ES module integration for WebAssembly</a> is underway as well.</p>

<p>Many JavaScript developers know that ES modules have been controversial. But few actually understand how ES modules work.</p>

<p>Letâ€™s take a look at what problem ES modules solve and how they are different from modules in other module systems.</p>

<h3 id="toc_0">What problem do modulesÂ solve?</h3>

<p>When you think about it, coding in JavaScript is all about managing variables. Itâ€™s all about assigning values to variables, or adding numbers to variables, or combining two variables together and putting them into another variable.</p>

<p><strong><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/01_variables.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/01_variables-500x178.png" alt=""/></a></strong></p>

<p>Because so much of your code is just about changing variables, how you organize these variables is going to have a big impact on how well you can codeâ€¦ and how well you can maintain that code.</p>

<p>Having just a few variables to think about at one time makes things easier. JavaScript has a way of helping you do this, called scope. Because of how scopes work in JavaScript, functions canâ€™t access variables that are defined in other functions.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/02_module_scope_01.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/02_module_scope_01-500x292.png" alt=""/></a></p>

<p>This is good. It means that when youâ€™re working on one function, you can just think about that one function. You donâ€™t have to worry about what other functions might be doing to your variables.</p>

<p>It also has a downside, though. It does make it hard to share variables between different functions.</p>

<p>What if you do want to share your variable outside of a scope? A common way to handle this is to put it on a scope above youâ€¦ for example, on the global scope.</p>

<p>You probably remember this from the jQuery days. Before you could load any jQuery plug-ins, you had to make sure that jQuery was in the global scope.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/02_module_scope_02.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/02_module_scope_02-500x450.png" alt=""/></a></p>

<p>This works, but they are some annoying problems that result.</p>

<p>First, all of your script tags need to be in the right order. Then you have to be careful to make sure that no one messes up that order.</p>

<p>If you do mess up that order, then in the middle of running, your app will throw an error. When the function goes looking for jQuery where it expects itâ€Šâ€”â€Šon the globalâ€Šâ€”â€Šand doesnâ€™t find it, it will throw an error and stop executing.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/02_module_scope_03.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/02_module_scope_03-500x450.png" alt=""/></a></p>

<p>This makes maintaining code tricky. It makes removing old code or script tags a game of roulette. You donâ€™t know what might break. The dependencies between these different parts of your code are implicit. Any function can grab anything on the global, so you donâ€™t know which functions depend on which scripts.</p>

<p>A second problem is that because these variables are on the global scope, every part of the code thatâ€™s inside of that global scope can change the variable. Malicious code can change that variable on purpose to make your code do something you didnâ€™t mean for it to, or non-malicious code could just accidentally clobber your variable.</p>

<h3 id="toc_1">How do modulesÂ help?</h3>

<p>Modules give you a better way to organize these variables and functions. With modules, you group the variables and functions that make sense to go together.</p>

<p>This puts these functions and variables into a module scope. The module scope can be used to share variables between the functions in the module.</p>

<p>But unlike function scopes, module scopes have a way of making their variables available to other modules as well. They can say explicitly which of the variables, classes, or functions in the module should be available.</p>

<p>When something is made available to other modules, itâ€™s called an export. Once you have an export, other modules can explicitly say that they depend on that variable, class or function.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/02_module_scope_04.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/02_module_scope_04-500x450.png" alt=""/></a></p>

<p>Because this is an explicit relationship, you can tell which modules will break if you remove another one.</p>

<p>Once you have the ability to export and import variables between modules, it makes it a lot easier to break up your code into small chunks that can work independently of each other. Then you can combine and recombine these chunks, kind of like Lego blocks, to create all different kinds of applications from the same set of modules.</p>

<p>Since modules are so useful, there have been multiple attempts to add module functionality to JavaScript. Today there are two module systems that are actively being used. CommonJS (CJS) is what Node.js has used historically. ESM (EcmaScript modules) is a newer system which has been added to the JavaScript specification. Browsers already support ES modules, and Node is adding support.</p>

<p>Letâ€™s take an in-depth look at how this new module system works.</p>

<h3 id="toc_2">How ES modulesÂ work</h3>

<p>When youâ€™re developing with modules, you build up a graph of dependencies. The connections between different dependencies come from any import statements that you use.</p>

<p>These import statements are how the browser or Node knows exactly what code it needs to load. You give it a file to use as an entry point to the graph. From there it just follows any of the import statements to find the rest of the code.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/04_import_graph.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/04_import_graph-500x291.png" alt=""/></a></p>

<p>But files themselves arenâ€™t something that the browser can use. It needs to parse all of these files to turn them into data structures called Module Records. That way, it actually knows whatâ€™s going on in the file.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/05_module_record.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/05_module_record-500x287.png" alt=""/></a></p>

<p>After that, the module record needs to be turned into a module instance. An instance combines two things: the code and state.</p>

<p>The code is basically a set of instructions. Itâ€™s like a recipe for how to make something. But by itself, you canâ€™t use the code to do anything. You need raw materials to use with those instructions.</p>

<p>What is state? State gives you those raw materials. State is the actual values of the variables at any point in time. Of course, these variables are just nicknames for the boxes in memory that hold the values.</p>

<p>So the module instance combines the code (the list of instructions) with the state (all the variablesâ€™ values).</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/06_module_instance.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/06_module_instance-500x372.png" alt=""/></a></p>

<p>What we need is a module instance for each module. The process of module loading is going from this entry point file to having a full graph of module instances.</p>

<p>For ES modules, this happens in three steps.</p>

<ol>
<li> Constructionâ€Šâ€”â€Šfind, download, and parse all of the files into module records.</li>
<li> Instantiation â€”find boxes in memory to place all of the exported values in (but donâ€™t fill them in with values yet). Then make both exports and imports point to those boxes in memory. This is called linking.</li>
<li> Evaluation â€”run the code to fill in the boxes with the variablesâ€™ actual values.</li>
</ol>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/07_3_phases.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/07_3_phases-500x184.png" alt=""/></a></p>

<p>People talk about ES modules being asynchronous. You can think about it as asynchronous because the work is split into these three different phasesâ€Šâ€”â€Šloading, instantiating, and evaluatingâ€Šâ€”â€Šand those phases can be done separately.</p>

<p>This means the spec does introduce a kind of asynchrony that wasnâ€™t there in CommonJS. Iâ€™ll explain more later, but in CJS a module and the dependencies below it are loaded, instantiated, and evaluated all at once, without any breaks in between.</p>

<p>However, the steps themselves are not necessarily asynchronous. They can be done in a synchronous way. It depends on whatâ€™s doing the loading. Thatâ€™s because not everything is controlled by the ES module spec. There are actually two halves of the work, which are covered by different specs.</p>

<p>The <a href="https://tc39.github.io/ecma262/#sec-modules">ES module spec</a> says how you should parse files into module records, and how you should instantiate and evaluate that module. However, it doesnâ€™t say how to get the files in the first place.</p>

<p>Itâ€™s the loader that fetches the files. And the loader is specified in a different specification. For browsers, that spec is the <a href="https://html.spec.whatwg.org/#fetch-a-module-script-tree">HTML spec</a>. But you can have different loaders based on what platform you are using.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/07_loader_vs_es.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/07_loader_vs_es-500x286.png" alt=""/></a></p>

<p>The loader also controls exactly how the modules are loaded. It calls the ES module methodsâ€Šâ€”â€Š<code>ParseModule</code>, <code>Module.Instantiate</code>, and <code>Module.Evaluate</code>. Itâ€™s kind of like a puppeteer controlling the JS engineâ€™s strings.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/08_loader_as_puppeteer.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/08_loader_as_puppeteer-500x330.png" alt=""/></a></p>

<p>Now letâ€™s walk through each step in more detail.</p>

<h4 id="toc_3">Construction</h4>

<p>Three things happen for each module during the Construction phase.</p>

<ol>
<li> Figure out where to download the file containing the module from (aka module resolution)</li>
<li> Fetch the file (by downloading it from a URL or loading it from the file system)</li>
<li> Parse the file into a module record</li>
</ol>

<h4 id="toc_4">Finding the file and fetchingÂ it</h4>

<p>The loader will take care of finding the file and downloading it. First it needs to find the entry point file. In HTML, you tell the loader where to find it by using a script tag.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/08_script_entry.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/08_script_entry-500x188.png" alt=""/></a></p>

<p>But how does it find the next bunch of modulesâ€Šâ€”â€Šthe modules that <code>main.js</code> directly depends on?</p>

<p>This is where import statements come in. One part of the import statement is called the module specifier. It tells the loader where it can find each next module.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/09_module_specifier.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/09_module_specifier-500x105.png" alt=""/></a></p>

<p>One thing to note about module specifiers: they sometimes need to be handled differently between browsers and Node. Each host has its own way of interpreting the module specifier strings. To do this, it uses something called a module resolution algorithm, which differs between platforms. Currently, some module specifiers that work in Node wonâ€™t work in the browser, but there is <a href="https://github.com/domenic/package-name-maps">ongoing work to fix this</a>.</p>

<p>Until thatâ€™s fixed, browsers only accept URLs as module specifiers. They will load the module file from that URL. But that doesnâ€™t happen for the whole graph at the same time. You donâ€™t know what dependencies the module needs you to fetch until youâ€™ve parsed the fileâ€¦ and you canâ€™t parse the file until you fetched it.</p>

<p>This means that we have to go through the tree layer-by-layer, parsing one file, then figuring out its dependencies, and then finding and loading those dependencies.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/10_construction.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/10_construction-500x302.png" alt=""/></a></p>

<p>If the main thread were to wait for each of these files to download, a lot of other tasks would pile up in its queue.</p>

<p>Thatâ€™s because when youâ€™re working in a browser, the downloading part takes a long time.</p>

<p><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/11_latency-500x270.png" alt=""/>Based on <a href="https://twitter.com/srigi/status/917998817051541504">this chart</a>.</p>

<p>Blocking the main thread like this would make an app that uses modules too slow to use. This is one of the reasons that the ES module spec splits the algorithm into multiple phases. Splitting out construction into its own phase allows browsers to fetch files and build up their understanding of the module graph before getting down to the synchronous work of instantiating.</p>

<p>This approachâ€”having the algorithm split up into phasesâ€”is one of the key differences between ES modules and CommonJS modules.</p>

<p>CommonJS can do things differently because loading files from the filesystem takes much less time than downloading across the Internet. This means Node can block the main thread while it loads the file. And since the file is already loaded, it makes sense to just instantiate and evaluate (which arenâ€™t separate phases in CommonJS). This also means that youâ€™re walking down the whole tree, loading, instantiating, and evaluating any dependencies before you return the module instance.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/12_cjs_require.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/12_cjs_require-500x298.png" alt=""/></a></p>

<p>The CommonJS approach has a few implications, and I will explain more about those later. But one thing that it means is that in Node with CommonJS modules, you can use variables in your module specifier. You are executing all of the code in this module (up to the <code>require</code> statement) before you look for the next module. That means the variable will have a value when you go to do module resolution.</p>

<p>But with ES modules, youâ€™re building up this whole module graph beforehandâ€¦ before you do any evaluation. This means you canâ€™t have variables in your module specifiers, because those variables donâ€™t have values yet.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/13_static_import.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/13_static_import-500x146.png" alt=""/></a></p>

<p>But sometimes it is really useful to use variables for module paths. For example, you might want to switch which module you load depending on what the code is doing or what environment it is running in.</p>

<p>To make this possible for ES modules, thereâ€™s a proposal called <a href="https://github.com/tc39/proposal-dynamic-import">dynamic import</a>. With it, you can use an import statement like <code>import(</code>${path}/foo.js<code>)</code>.</p>

<p>The way this works is that any file loaded using <code>import()</code> is handled as the entry point to a separate graph. The dynamically imported module starts a new graph, which is processed separately.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/14dynamic_import_graph.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/14dynamic_import_graph-500x389.png" alt=""/></a></p>

<p>One thing to note, thoughâ€Šâ€”â€Šany module that is in both of these graphs is going to share a module instance. This is because the loader caches module instances. For each module in a particular global scope, there will only be one module instance.</p>

<p>This means less work for the engine. For example, it means that the module file will only be fetched once even if multiple modules depend on it. (Thatâ€™s one reason to cache modules. Weâ€™ll see another in the evaluation section.)</p>

<p>The loader manages this cache using something called a <a href="https://html.spec.whatwg.org/multipage/webappapis.html#module-map">module map</a>. Each global keeps track of its modules in a separate module map.</p>

<p>When the loader goes to fetch a URL, it puts that URL in the module map and makes a note that itâ€™s currently fetching the file. Then it will send out the request and move on to start fetching the next file.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/15_module_map.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/15_module_map-500x170.png" alt=""/></a></p>

<p>What happens if another module depends on the same file? The loader will look up each URL in the module map. If it sees <code>fetching</code> in there, it will just move on to the next URL.</p>

<p>But the module map doesnâ€™t just keep track of what files are being fetched. The module map also serves as a cache for the modules, as weâ€™ll see next.</p>

<h4 id="toc_5">Parsing</h4>

<p>Now that we have fetched this file, we need to parse it into a module record. This helps the browser understand what the different parts of the module are.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/25_file_to_module_record.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/25_file_to_module_record-500x199.png" alt=""/></a></p>

<p>Once the module record is created, it is placed in the module map. This means that whenever itâ€™s requested from here on out, the loader can pull it from that map.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/25_module_map.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/25_module_map-500x239.png" alt=""/></a></p>

<p>There is one detail in parsing that may seem trivial, but that actually has pretty big implications. All modules are parsed as if they had <code>&quot;use strict&quot;</code> at the top. There are also other slight differences. For example, the keyword <code>await</code> is reserved in a moduleâ€™s top-level code, and the value of <code>this</code> is <code>undefined</code>.</p>

<p>This different way of parsing is called a â€œparse goalâ€. If you parse the same file but use different goals, youâ€™ll end up with different results. So you want to know before you start parsing what kind of file youâ€™re parsingâ€Šâ€”â€Šwhether itâ€™s a module or not.</p>

<p>In browsers this is pretty easy. You just put <code>type=&quot;module&quot;</code> on the script tag. This tells the browser that this file should be parsed as a module. And since only modules can be imported, the browser knows that any imports are modules, too.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/26_parse_goal.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/26_parse_goal-500x311.png" alt=""/></a></p>

<p>But in Node, you donâ€™t use HTML tags, so you donâ€™t have the option of using a <code>type</code> attribute. One way the community has tried to solve this is by using anÂ <code>.mjs</code> extension. Using that extension tells Node, â€œthis file is a moduleâ€. Youâ€™ll see people talking about this as the signal for the parse goal. The discussion is currently ongoing, so itâ€™s unclear what signal the Node community will decide to use in the end.</p>

<p>Either way, the loader will determine whether to parse the file as a module or not. If it is a module and there are imports, it will then start the process over again until all of the files are fetched and parsed.</p>

<p>And weâ€™re done! At the end of the loading process, youâ€™ve gone from having just an entry point file to having a bunch of module records.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/27_construction.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/27_construction-500x406.png" alt=""/></a></p>

<p>The next step is to instantiate this module and link all of the instances together.</p>

<h4 id="toc_6">Instantiation</h4>

<p>Like I mentioned before, an instance combines code with state. That state lives in memory, so the instantiation step is all about wiring things up to memory.</p>

<p>First, the JS engine creates a module environment record. This manages the variables for the module record. Then it finds boxes in memory for all of the exports. The module environment record will keep track of which box in memory is associated with each export.</p>

<p>These boxes in memory wonâ€™t get their values yet. Itâ€™s only after evaluation that their actual values will be filled in. There is one caveat to this rule: any exported function declarations are initialized during this phase. This makes things easier for evaluation.</p>

<p>To instantiate the module graph, the engine will do whatâ€™s called a depth first post-order traversal. This means it will go down to the bottom of the graphâ€Šâ€”â€Što the dependencies at the bottom that donâ€™t depend on anything elseâ€Šâ€”â€Šand set up their exports.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/30_live_bindings_01.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/30_live_bindings_01-500x206.png" alt=""/></a></p>

<p>The engine finishes wiring up all of the exports below a moduleâ€Šâ€”â€Šall of the exports that the module depends on. Then it comes back up a level to wire up the imports from that module.</p>

<p>Note that both the export and the import point to the same location in memory. Wiring up the exports first guarantees that all of the imports can be connected to matching exports.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/30_live_bindings_02.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/30_live_bindings_02-500x206.png" alt=""/></a></p>

<p>This is different from CommonJS modules. In CommonJS, the entire export object is copied on export. This means that any values (like numbers) that are exported are copies.</p>

<p>This means that if the exporting module changes that value later, the importing module doesnâ€™t see that change.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/31_cjs_variable.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/31_cjs_variable-500x113.png" alt=""/></a></p>

<p>In contrast, ES modules use something called live bindings. Both modules point to the same location in memory. This means that when the exporting module changes a value, that change will show up in the importing module.</p>

<p>Modules that export values can change those values at any time, but importing modules cannot change the values of their imports. That being said, if a module imports an object, it can change property values that are on that object.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/30_live_bindings_04.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/30_live_bindings_04-500x206.png" alt=""/></a></p>

<p>The reason to have live bindings like this is then you can wire up all of the modules without running any code. This helps with evaluation when you have cyclic dependencies, as Iâ€™ll explain below.</p>

<p>So at the end of this step, we have all of the instances and the memory locations for the exported/imported variables wired up.</p>

<p>Now we can start evaluating the code and filling in those memory locations with their values.</p>

<h4 id="toc_7">Evaluation</h4>

<p>The final step is filling in these boxes in memory. The JS engine does this by executing the top-level codeâ€Šâ€”â€Šthe code that is outside of functions.</p>

<p>Besides just filling in these boxes in memory, evaluating the code can also trigger side effects. For example, a module might make a call to a server.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/40_top_level_code.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/40_top_level_code-500x146.png" alt=""/></a></p>

<p>Because of the potential for side effects, you only want to evaluate the module once. As opposed to the linking that happens in instantiation, which can be done multiple times with exactly the same result, evaluation can have different results depending on how many times you do it.</p>

<p>This is one reason to have the module map. The module map caches the module by canonical URL so that there is only one module record for each module. That ensures each module is only executed once. Just as with instantiation, this is done as a depth first post-order traversal.</p>

<p>What about those cycles that we talked about before?</p>

<p>In a cyclic dependency, you end up having a loop in the graph. Usually, this is a long loop. But to explain the problem, Iâ€™m going to use a contrived example with a short loop.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/41_cjs_cycle.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/41_cjs_cycle-500x224.png" alt=""/></a></p>

<p>Letâ€™s look at how this would work with CommonJS modules. First, the main module would execute up to the require statement. Then it would go to load the counter module.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/41_cyclic_graph.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/41_cyclic_graph-500x281.png" alt=""/></a></p>

<p>The counter module would then try to access <code>message</code> from the export object. But since this hasnâ€™t been evaluated in the main module yet, this will return undefined. The JS engine will allocate space in memory for the local variable and set the value to undefined.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/42_cjs_variable_2.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/42_cjs_variable_2-500x113.png" alt=""/></a></p>

<p>Evaluation continues down to the end of the counter moduleâ€™s top level code. We want to see whether weâ€™ll get the correct value for message eventually (after main.js is evaluated), so we set up a timeout. Then evaluation resumes on <code>main.js</code>.</p>

<p><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/43_cjs_cycle.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/43_cjs_cycle-500x224.png" alt=""/></a></p>

<p>The message variable will be initialized and added to memory. But since thereâ€™s no connection between the two, it will stay undefined in the required module.</p>

<p><strong><a href="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/44_cjs_variable_2.png"><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/03/44_cjs_variable_2-500x216.png" alt=""/></a></strong></p>

<p>If the export were handled using live bindings, the counter module would see the correct value eventually. By the time the timeout runs, <code>main.js</code>â€™s evaluation would have completed and filled in the value.</p>

<p>Supporting these cycles is a big rationale behind the design of ES modules. Itâ€™s this three-phase design that makes them possible.</p>

<h3 id="toc_8">Whatâ€™s the status of ESÂ modules?</h3>

<p>With the release of Firefox 60 in early May, all major browsers will support ES modules by default. Node is also adding support, with a <a href="https://github.com/nodejs/modules">working group</a> dedicated to figuring out compatibility issues between CommonJS and ES modules.</p>

<p>This means that youâ€™ll be able to use the script tag with <code>type=module</code>, and use imports and exports. However, more module features are yet to come. The <a href="https://github.com/tc39/proposal-dynamic-import">dynamic import proposal</a> is at Stage 3 in the specification process, as is <a href="https://github.com/tc39/proposal-import-meta">import.meta</a> which will help support Node.js use cases, and the <a href="https://github.com/domenic/package-name-maps">module resolution proposal</a> will also help smooth over differences between browsers and Node.js. So you can expect working with modules to get even better in the future.</p>

<h2 id="toc_9">Acknowledgements</h2>

<p>Thank you to everyone who gave feedback on this post, or whose writing or discussions informed it, including Axel Rauschmayer, Bradley Farias, Dave Herman, Domenic Denicola, Havi Hoffman, Jason Weathersby, JF Bastien, Jon Coppeard, Luke Wagner, Myles Borins, Till Schneidereit, Tobias Koppers, and Yehuda Katz, as well as the members of the WebAssembly community group, the Node modules working group, and TC39.</p>

<h2 id="toc_10">About <a href="http://code-cartoons.com">Lin Clark</a></h2>

<p>Lin is an engineer on the Mozilla Developer Relations team. She tinkers with JavaScript, WebAssembly, Rust, and Servo, and also draws code cartoons.</p>

<ul>
<li>  <a href="http://code-cartoons.com">code-cartoons.com</a></li>
<li>  <a href="http://twitter.com/linclark">@linclark</a></li>
</ul>

<p><a href="https://hacks.mozilla.org/author/lclarkmozilla-com/">More articles by Lin Clarkâ€¦</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[13 Noteworthy Points from Googleâ€™s JavaScript Style Guide]]></title>
    <link href="http://panlw.github.io/15352953904391.html"/>
    <updated>2018-08-26T22:56:30+08:00</updated>
    <id>http://panlw.github.io/15352953904391.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://medium.freecodecamp.org/google-publishes-a-javascript-style-guide-here-are-some-key-lessons-1810b8ad050b">https://medium.freecodecamp.org/google-publishes-a-javascript-style-guide-here-are-some-key-lessons-1810b8ad050b</a></p>
</blockquote>

<p><img src="https://cdn-images-1.medium.com/max/2000/1*ouYvMzYuksK-IH1BPNKD0A.jpeg" alt=""/></p>

<p>For anyone who isnâ€™t already familiar with it, <a href="https://google.github.io/styleguide/jsguide.html">Google puts out a style guide</a> for writing JavaScript that lays out (what Google believes to be) the best stylistic practices for writing clean, understandable code.</p>

<p>These are not hard and fast rules for writing valid JavaScript, only proscriptions for maintaining consistent and appealing style choices throughout your source files. This is particularly interesting for JavaScript, which is a flexible and forgiving language that allows for a wide variety of stylistic choices.</p>

<p>Google and <a href="https://github.com/airbnb/javascript">Airbnb</a> have two of the most popular style guides out there. Iâ€™d definitely recommend you check out both of them if you spend much time writing JS.</p>

<p>The following are thirteen of what I think are the most interesting and relevant rules from Googleâ€™s JS Style Guide.</p>

<p>They deal with everything from hotly contested issues (tabs versus spaces, and the controversial issue of how semicolons should be used), to a few more obscure specifications which surprised me. They will definitely change the way I write my JS going forward.</p>

<p>For each rule, Iâ€™ll give a summary of the specification, followed by a supporting quote from the style guide that describes the rule in detail. Where applicable, Iâ€™ll also provide an example of the style in practice, and contrast it with code that does not follow the rule.</p>

<h4 id="toc_0">Use spaces, notÂ tabs</h4>

<blockquote>
<p>Aside from the line terminator sequence, the ASCII horizontal space character (0x20) is the only whitespace character that appears anywhere in a source file. This implies thatâ€¦ Tab characters are <strong>not</strong> used for indentation.</p>
</blockquote>

<p>The guide later specifies you should use two spaces (not four) for indentation.</p>

<pre>// bad
function foo() {
âˆ™âˆ™âˆ™âˆ™let name;
}
// bad
function bar() {
âˆ™let name;
}
// good
function baz() {
âˆ™âˆ™let name;
}</pre>

<h4 id="toc_1">Semicolons AREÂ required</h4>

<blockquote>
<p>Every statement must be terminated with a semicolon. Relying on automatic semicolon insertion is forbidden.</p>
</blockquote>

<p>Although I canâ€™t imagine why anyone is opposed to this idea, the consistent use of semicolons in JS is becoming the new â€˜spaces versus tabsâ€™ debate. Googleâ€™s coming out firmly here in the defence of the semicolon.</p>

<pre>// bad
let luke = {}
let leia = {}
[luke, leia].forEach(jedi => jedi.father = 'vader')</pre>

<pre>// good
let luke = {};
let leia = {};
[luke, leia].forEach((jedi) => {
  jedi.father = 'vader';
});</pre>

<h4 id="toc_2">Donâ€™t use ES6 modulesÂ (yet)</h4>

<blockquote>
<p>Do not use ES6 modules yet (i.e. the <code>export</code> and <code>import</code> keywords), as their semantics are not yet finalized. Note that this policy will be revisited once the semantics are fully-standard.</p>
</blockquote>

<pre>// Don't do this kind of thing yet:</pre>

<pre><code>//------ lib.js ------
</code></pre>

<h4 id="toc_3">Horizontal alignment is discouraged (but not forbidden)</h4>

<blockquote>
<p>This practice is permitted, but it is <strong>generally discouraged</strong> by Google Style. It is not even required to <u>maintain</u> horizontal alignment in places where it was alreadyÂ used.</p>
</blockquote>

<p>Horizontal alignment is the practice of adding a variable number of additional spaces in your code, to make certain tokens appear directly below certain other tokens on previous lines.</p>

<pre>// bad
{
  tiny:   42,  
  longer: 435, 
};</pre>

<pre>// good
{
  tiny: 42, 
  longer: 435,
};</pre>

<h4 id="toc_4">Donâ€™t use varÂ anymore</h4>

<blockquote>
<p>Declare all local variables with either <code>_const_</code> or <code>_let_</code>. Use const by default, unless a variable needs to be reassigned. The <code>_var_</code> keyword must not beÂ used.</p>
</blockquote>

<p>I still see people using <code>var</code> in code samples on StackOverflow and elsewhere. I canâ€™t tell if there are people out there who will make a case for it, or if itâ€™s just a case of old habits dying hard.</p>

<pre>// bad
var example = 42;</pre>

<pre>// good
let example = 42;</pre>

<h4 id="toc_5">Arrow functions are preferred</h4>

<blockquote>
<p>Arrow functions provide a concise syntax and fix a number of difficulties with <code>_this_</code>. Prefer arrow functions over the <code>_function_</code> keyword, particularly for nested functions</p>
</blockquote>

<p>Iâ€™ll be honest, I just thought that arrow functions were great because they were more concise and nicer to look at. Turns out they also serve a pretty important purpose.</p>

<pre>// bad
[1, 2, 3].map(function (x) {
  const y = x + 1;
  return x * y;
});
// good
[1, 2, 3].map((x) => {
  const y = x + 1;
  return x * y;
});</pre>

<h4 id="toc_6">Use template strings instead of concatenation</h4>

<blockquote>
<p>Use template strings (delimited with ```) over complex string concatenation, particularly if multiple string literals are involved. Template strings may span multipleÂ lines.</p>
</blockquote>

<pre>// bad
function sayHi(name) {
  return 'How are you, ' + name + '?';
}
// bad
function sayHi(name) {
  return ['How are you, ', name, '?'].join();
}
// bad
function sayHi(name) {
  return `How are you, ${ name }?`;
}
// good
function sayHi(name) {
  return `How are you, ${name}?`;
}</pre>

<h4 id="toc_7"><strong>Donâ€™t use line continuations for longÂ strings</strong></h4>

<blockquote>
<p>Do not use <u>line continuations</u> (that is, ending a line inside a string literal with a backslash) in either ordinary or template string literals. Even though ES5 allows this, it can lead to tricky errors if any trailing whitespace comes after the slash, and is less obvious toÂ readers.</p>
</blockquote>

<p>Interestingly enough, this is a rule that Google and Airbnb disagree on (hereâ€™s <a href="https://github.com/airbnb/javascript#strings--line-length">Airbnbâ€™s spec</a>).</p>

<p>While Google recommends concatenating longer strings (as shown below) Airbnbâ€™s style guide recommends essentially doing nothing, and allowing long strings to go on as long as they need to.</p>

<pre>// bad (sorry, this doesn't show up well on mobile)
const longString = 'This is a very long string that \
    far exceeds the 80 column limit. It unfortunately \
    contains long stretches of spaces due to how the \
    continued lines are indented.';</pre>

<pre>// good
const longString = 'This is a very long string that ' + 
    'far exceeds the 80 column limit. It does not contain ' + 
    'long stretches of spaces since the concatenated ' +
    'strings are cleaner.';</pre>

#### â€œforâ€¦ ofâ€ is the preferred type of â€˜forÂ loopâ€™

> With ES6, the language now has three different kinds of `for` loops. All may be used, though `for`-`of` loops should be preferred when possible.

This is a strange one if you ask me, but I thought Iâ€™d include it because it is pretty interesting that Google declares a preferred type of `for` loop.

I was always under the impression that `for... in` loops were better for objects, while `for... of` were better suited to arrays. A â€˜right tool for the right jobâ€™ type situation.

While Googleâ€™s specification here doesnâ€™t necessarily contradict that idea, it is still interesting to know they have a preference for this loop in particular.

#### Donâ€™t useÂ eval()

> Do not use `eval` or the `Function(...string)` constructor (except for code loaders). These features are potentially dangerous and simply do not work in CSP environments.

The [MDN page](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval) for `eval()` even has a section called â€œDonâ€™t use eval!â€

<pre>// bad
`let obj = { a: 20, b: 30 };
let propName = getPropName();  // returns "a" or "b"
eval( 'var result = obj.' + propName );`</pre>

<pre>// good
`let obj = { a: 20, b: 30 };
let propName = getPropName();  // returns "a" or "b"
let result = obj[ propName ];  //  obj[ "a" ] is the same as obj.a`</pre>

<h4 id="toc_8">Constants should be named in ALL_UPPERCASE separated by underscores</h4>

<blockquote>
<p>Constant names use <code>CONSTANT_CASE</code>: all uppercase letters, with words separated by underscores.</p>
</blockquote>

<p>If youâ€™re absolutely sure that a variable shouldnâ€™t change, you can indicate this by capitalizing the name of the constant. This makes the constantâ€™s immutability obvious as it gets used throughout your code.</p>

<p>A notable exception to this rule is if the constant is function-scoped. In this case it should be written in camelCase.</p>

<pre>// bad
const number = 5;</pre>

<pre>// good
const NUMBER = 5;</pre>

<h4 id="toc_9">One variable per declaration</h4>

<blockquote>
<p>Every local variable declaration declares only one variable: declarations such as <code>let a = 1, b = 2;</code> are notÂ used.</p>
</blockquote>

<pre>// bad
let a = 1, b = 2, c = 3;</pre>

<pre>// good
let a = 1;
let b = 2;
let c = 3;</pre>

<h4 id="toc_10">Use single quotes, not doubleÂ quotes</h4>

<blockquote>
<p>Ordinary string literals are delimited with single quotes (<code>&#39;</code>), rather than double quotesÂ (<code>&quot;</code>).</p>

<p>Tip: if a string contains a single quote character, consider using a template string to avoid having to escape theÂ quote.</p>
</blockquote>

<pre>// bad
let directive = "No identification of self or mission."</pre>

<pre>// bad
let saying = `'Say it ain\u0027t so.';`</pre>

<pre>// good
let directive = 'No identification of self or mission.';</pre>

<pre>// good
let saying = `Say it ain't so`;</pre>

<h4 id="toc_11">A finalÂ note</h4>

<p>As I said in the beginning, these are not mandates. Google is just one of many tech giants, and these are just recommendations.</p>

<p>That said, it is interesting to look at the style recommendations that are put out by a company like Google, which employs a lot of brilliant people who spend a lot of time writing excellent code.</p>

<p>You can follow these rules if you want to follow the guidelines for â€˜Google compliant source codeâ€™â€Šâ€”â€Šbut, of course, plenty of people disagree, and youâ€™re free to brush any or all of this off.</p>

<p>I personally think there are plenty of cases where Airbnbâ€™s spec is more appealing than Googleâ€™s. No matter the stance you take on these particular rules, it is still important to keep stylistic consistency in mind when write any sort of code.</p>

<ul>
<li>  <a href="https://medium.freecodecamp.org/tagged/javascript?source=post">JavaScript</a></li>
<li>  <a href="https://medium.freecodecamp.org/tagged/google?source=post">Google</a></li>
<li>  <a href="https://medium.freecodecamp.org/tagged/web-development?source=post">Web Development</a></li>
<li>  <a href="https://medium.freecodecamp.org/tagged/programming?source=post">Programming</a></li>
<li>  <a href="https://medium.freecodecamp.org/tagged/tech?source=post">Tech</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æœ‰èµžç»Ÿä¸€æ—¥å¿—å¹³å°åˆæŽ¢]]></title>
    <link href="http://panlw.github.io/15352773081191.html"/>
    <updated>2018-08-26T17:55:08+08:00</updated>
    <id>http://panlw.github.io/15352773081191.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://tech.youzan.com/you-zan-tong-ri-zhi-ping-tai-chu-tan/">https://tech.youzan.com/you-zan-tong-ri-zhi-ping-tai-chu-tan/</a></p>
</blockquote>

<pre><code>ã€ç¼–è€…çš„è¯ã€‘ä»Ž2015å¹´åˆå…¥èŒæœ‰èµžä»¥æ¥ï¼Œä¸€ç›´è‡´åŠ›äºŽåŽç«¯æœåŠ¡å¼€å‘ï¼Œä¸»è¦è®¾è®¡å¼€å‘äº†ç›‘æŽ§ç³»ç»ŸHawkï¼Œä½†è¿™ä¸æ˜¯æœ¬æ¬¡è¦åˆ†äº«çš„ç‚¹ã€‚ä¸€ä¸ªæœˆå‰ï¼Œè´Ÿè´£æ—¥å¿—å¹³å°Trackçš„å°ä¼™ä¼´å¯»æ±‚æ¢¦æƒ³å‡ºåŽ»åˆ›ä¸šäº†ï¼Œæœ‰å¹¸æŽ¥æ‰‹äº†æ—¥å¿—å¹³å°ï¼Œè¿™å¯¹æœ¬äººç¡®å®žæ˜¯ä¸ªä¸å°çš„æŒ‘æˆ˜ï¼Œä¹ŸåŒæ ·æ˜¯ä¸ªå­¦ä¹ æˆé•¿çš„æœºä¼šã€‚æ­¤æ¬¡å°±å€Ÿç€æ¢³ç†æ—¥å¿—å¹³å°çš„æœºä¼šï¼Œç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹æœ‰èµžç»Ÿä¸€æ—¥å¿—å¹³å°çš„æž¶æž„è®¾è®¡ã€‚
</code></pre>

<h4 id="toc_0">ä¸€ã€å¼•è¨€</h4>

<p>è‡ªæœ‰èµžæˆç«‹ä»¥æ¥ï¼Œå‘å±•è¿…çŒ›ï¼Œä¸šåŠ¡å¢žé•¿å¾ˆå¿«ï¼Œä¸šåŠ¡ç³»ç»Ÿæ•°é‡å¤§ï¼Œæ¯å¤©éƒ½ä¼šäº§ç”Ÿå¤§é‡çš„ç³»ç»Ÿæ—¥å¿—å’Œä¸šåŠ¡æ—¥å¿— (æ®ç»Ÿè®¡ï¼Œå¹³å‡æ¯ç§’äº§ç”Ÿæ—¥å¿— 1.1 ä¸‡æ¡ï¼Œå³°å€¼ 1.5 ä¸‡æ¡ï¼Œæ¯å¤©çš„æ—¥å¿—é‡çº¦ 9 äº¿æ¡ï¼Œå ç”¨ç©ºé—´ 2.4T å·¦å³)ã€‚</p>

<p>åœ¨ä¿¡æ¯åŒ–æ—¶ä»£ï¼Œæ—¥å¿—çš„ä»·å€¼æ˜¯æ— ç©·çš„ã€‚ä¸ºäº†å¯¹ç³»ç»Ÿè¿›è¡Œæœ‰æ•ˆçš„ç›‘æŽ§ã€ç»´æŠ¤ã€ä¼˜åŒ–ã€æ”¹è¿›ï¼Œéƒ½ç¦»ä¸å¼€å¯¹æ—¥å¿—çš„æ”¶é›†å’Œåˆ†æžï¼Œè€Œè¿™äº›æ—¥å¿—æ•£è½åœ¨å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œæ— è®ºå¯¹è¿ç»´åŒå­¦ã€è¿˜æ˜¯ä¸šåŠ¡å¼€å‘åŒå­¦ï¼ŒæŠ‘æˆ–æ˜¯æ•°æ®éƒ¨é—¨çš„åŒå­¦è€Œè¨€ï¼ŒæŸ¥é˜…æˆ–åˆ†æžæ—¥å¿—æ˜¯ä¸€å¤§ç—›ç‚¹ï¼Œå®žæ—¶æ”¶é›†åˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹æˆ–æœºå™¨ä¸Šçš„æ—¥å¿—ï¼Œä¾›ç¦»çº¿æˆ–åœ¨çº¿æŸ¥é˜…åŠåˆ†æžæ¥æå‡å·¥ä½œæ•ˆçŽ‡çš„éœ€æ±‚å¼‚å¸¸è¿«åˆ‡ï¼Œåœ¨æ­¤èƒŒæ™¯ä¸‹ï¼ŒäºŽæ˜¯æœ‰èµžç»Ÿä¸€æ—¥å¿—å¹³å°å°±åº”è¿è€Œç”Ÿäº†ã€‚</p>

<p>åœ¨äº’è”ç½‘é«˜é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œæœ‰é‚£ä¹ˆå¤šä¼˜ç§€çš„æ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼Œè¯¸å¦‚ Kafkaã€Flumeã€Scribeã€Chukwaã€ELK ç­‰ã€‚å¯¹äºŽå¦‚ä½•é€‰åž‹åœ¨æ­¤ä¸åšè®¨è®ºï¼Œè€Œä¸”æœ¬äººæ‰ç–å­¦æµ…ï¼Œä¹Ÿæœªåšæ·±å…¥è°ƒç ”å’Œæ€§èƒ½åˆ†æžå¯¹æ¯”æµ‹è¯•ï¼Œè¿˜ä¸å¤Ÿèµ„æ ¼è®¨è®ºã€‚ç›¸ä¿¡å‰äººçš„é€‰æ‹©æ˜¯æœ‰å…¶ç†ç”±çš„ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ç§‰ç€ â€œçŸ­å¹³å¿«â€ çš„äº’è”ç½‘ç²¾ç¥žï¼Œæž„å»ºçš„è¿™å¥—é€‚åˆæœ‰èµžä¸šåŠ¡ç³»ç»Ÿçš„ç»Ÿä¸€æ—¥å¿—å¹³å°ã€‚</p>

<h4 id="toc_1">äºŒã€æ€»ä½“è®¾è®¡</h4>

<p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æŽ¥ä¸Šæ€»ä½“æž¶æž„å›¾ï¼Œå¦‚å›¾ 2-1 æ‰€ç¤ºï¼š <img src="http://7xtb4n.com1.z0.glb.clouddn.com/track-pic-2-1.png" alt=""/> å›¾ 2-1 æ€»ä½“æž¶æž„å›¾</p>

<p>æœ‰èµžç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿï¼Œè´Ÿè´£æ”¶é›†æ‰€æœ‰ç³»ç»Ÿæ—¥å¿—å’Œä¸šåŠ¡æ—¥å¿—ï¼Œè½¬åŒ–ä¸ºæµå¼æ•°æ®ï¼Œé€šè¿‡ flume æˆ– logstash ä¸Šä¼ åˆ°æ—¥å¿—ä¸­å¿ƒ (kafka é›†ç¾¤)ï¼Œç„¶åŽä¾› Trackã€Stormã€Spark åŠå…¶å®ƒç³»ç»Ÿå®žæ—¶åˆ†æžå¤„ç†æ—¥å¿—ï¼Œå¹¶å°†æ—¥å¿—æŒä¹…åŒ–å­˜å‚¨åˆ° HDFS ä¾›ç¦»çº¿æ•°æ®åˆ†æžå¤„ç†ï¼Œæˆ–å†™å…¥ ElasticSearch æä¾›æ•°æ®æŸ¥è¯¢ï¼Œæˆ–å†™å…¥ Hawk å‘èµ·å¼‚å¸¸æŠ¥è­¦æˆ–æä¾›æŒ‡æ ‡ç›‘æŽ§æŸ¥è¯¢ã€‚</p>

<h4 id="toc_2">ä¸‰ã€æ¨¡å—åˆ†è§£</h4>

<p>ä»Žä¸Šé¢æ€»ä½“æž¶æž„å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´ä¸ªæ—¥å¿—å¹³å°æž¶æž„åˆ†ä¸ºå››å±‚ï¼Œä»Žå·¦åˆ°å³ä¾æ¬¡æ˜¯æ—¥å¿—æŽ¥å…¥å±‚ã€æ—¥å¿—ä¸­å¿ƒã€æ—¥å¿—å¤„ç†å±‚ã€æ—¥å¿—å­˜å‚¨å±‚ã€‚</p>

<h5 id="toc_3">3.1 æ—¥å¿—æŽ¥å…¥å±‚</h5>

<p>æ—¥å¿—æŽ¥å…¥å±‚ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼Œæ–¹å¼ 1 åŸºäºŽ rsyslog å’Œ logstashï¼Œæ–¹å¼ 2 åŸºäºŽ flume-ngã€‚</p>

<h6 id="toc_4">3.1.1</h6>

<p><img src="http://7xtb4n.com1.z0.glb.clouddn.com/track-pic-3-1.png" alt=""/> å›¾ 3-1 æ—¥å¿—æŽ¥å…¥æ–¹å¼ 1</p>

<p>å¯¹äºŽä¸€äº›ç¨³å®šçš„æ—¥å¿—ï¼Œæ¯”å¦‚ç³»ç»Ÿæ—¥å¿—æˆ–æ¡†æž¶æ—¥å¿— (å¦‚ nginx è®¿é—®æ—¥å¿—ã€phpfpm å¼‚å¸¸æ—¥å¿—ç­‰)ï¼Œæˆ‘ä»¬æ·»åŠ  nginx é…ç½®ï¼Œé€šè¿‡ rsyslog å†™åˆ°æœ¬åœ°ç›®å½• local0ï¼Œç„¶åŽ logstash æ ¹æ®å…¶é…ç½®ï¼Œä¼šå°† local0 ä¸­çš„å¢žé‡æ—¥å¿—ä¸Šä¼ åˆ°æ—¥å¿—ä¸­å¿ƒå¯¹åº”çš„ topic ä¸­ï¼Œå…·ä½“æ•°æ®æµå›¾è§å›¾ 3-1 æ‰€ç¤ºï¼š</p>

<h6 id="toc_5">3.1.2</h6>

<p>Flume NG æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ï¼Œé«˜å¯ç”¨ï¼Œå¯é çš„ç³»ç»Ÿï¼Œå®ƒèƒ½å°†ä¸åŒçš„æµ·é‡æ•°æ®æ”¶é›†ï¼Œç§»åŠ¨å¹¶å­˜å‚¨åˆ°ä¸€ä¸ªæ•°æ®å­˜å‚¨ç³»ç»Ÿä¸­ã€‚è½»é‡ï¼Œé…ç½®ç®€å•ï¼Œé€‚ç”¨äºŽå„ç§æ—¥å¿—æ”¶é›†ï¼Œå¹¶æ”¯æŒ Failover å’Œè´Ÿè½½å‡è¡¡ã€‚å¹¶ä¸”å®ƒæ‹¥æœ‰éžå¸¸ä¸°å¯Œçš„ç»„ä»¶ã€‚Flume NG é‡‡ç”¨çš„æ˜¯ä¸‰å±‚æž¶æž„ï¼šAgent å±‚ï¼ŒCollector å±‚å’Œ Store å±‚ï¼Œæ¯ä¸€å±‚å‡å¯æ°´å¹³æ‹“å±•ã€‚å…¶ä¸­ Agent åŒ…å« Sourceï¼ŒChannel å’Œ Sinkï¼Œä¸‰è€…ç»„å»ºäº†ä¸€ä¸ª Agentã€‚ä¸‰è€…çš„èŒè´£å¦‚ä¸‹æ‰€ç¤ºï¼š<br/>
Sourceï¼šç”¨æ¥æ¶ˆè´¹ï¼ˆæ”¶é›†ï¼‰æ•°æ®æºåˆ° Channel ç»„ä»¶ä¸­ï¼Œç®€å•è¯´å°±æ˜¯æœé›†æ•°æ®çš„å…¥å£ã€‚<br/>
Channelï¼šä¸­è½¬ä¸´æ—¶å­˜å‚¨ï¼Œä¿å­˜æ‰€æœ‰ Source ç»„ä»¶ä¿¡æ¯ï¼Œå…¶å®žå°±æ˜¯ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯é…ç½®å¤šä¸ª Chanelã€‚<br/>
Sinkï¼šä»Ž Channel ä¸­è¯»å–ï¼Œè¯»å–æˆåŠŸåŽä¼šåˆ é™¤ Channel ä¸­çš„ä¿¡æ¯ï¼Œç®€å•è¯´å°±æ˜¯æœé›†æ•°æ®çš„å‡ºå£ã€‚</p>

<p>åœ¨æœ‰èµžæ—¥å¿—å¹³å°ä¸­ï¼Œæˆ‘ä»¬åªç”¨äº† Agent å±‚ã€‚å…·ä½“å¯ä»¥è§å›¾ 3-2:</p>

<p><img src="http://7xtb4n.com1.z0.glb.clouddn.com/track-pic-3-2.png" alt=""/></p>

<p>å›¾ 3-2 æ—¥å¿—æŽ¥å…¥æ–¹å¼ 2</p>

<p>æ—¥å¿—ä¸­å¿ƒçš„ kafka æ˜¯æ ¹æ® topic å­˜å–æ•°æ®çš„ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ—¥å¿—ä¸­åŠ å…¥ topic å­—æ®µã€‚ä¸ºäº†ç»Ÿä¸€ï¼Œæˆ‘ä»¬å¯¹æ—¥å¿—æ ¼å¼åšäº†çº¦å®šï¼Œæ ¼å¼å¦‚ä¸‹:</p>

<pre><code>&lt;158&gt;yyyy-MM-dd HH:mm:ss host/ip level[pid]: topic=track.**** {&quot;type&quot;:&quot;error&quot;,&quot;tag&quot;:&quot;redis connection refused&quot;,&quot;platform&quot;:&quot;java/go/php&quot;,&quot;level&quot;:&quot;info/warn/error&quot;,&quot;app&quot;:&quot;appName&quot;,&quot;module&quot;:&quot;com.youzan.somemodule&quot;,&quot;detail&quot;:&quot;any things you want here&quot;}

</code></pre>

<p>å¯¹äºŽ PHP Serverï¼Œæˆ‘ä»¬åœ¨ PHP æ¡†æž¶ä¸­å°è£…äº†æ—¥å¿— SDKï¼ŒPHP å¼€å‘çš„åŒå­¦åªéœ€è°ƒç”¨å†™æ—¥å¿—æŽ¥å£ï¼Œå°±å¯ä»¥å°†æ—¥å¿—ä¼ åˆ° Flume ä¸­ã€‚åŒæ ·çš„ï¼Œå¯¹äºŽ Java Serverï¼Œä¹Ÿå°è£…äº†æ—¥å¿— SDK(åŸºäºŽ logback è‡ªå®šä¹‰äº†<code>TrackAppender</code>)ï¼Œå¹¶é›†æˆåœ¨ Dubbox æ¡†æž¶ä¸­ï¼Œä¸šåŠ¡å¼€å‘çš„åŒå­¦åªéœ€åœ¨å…¶å·¥ç¨‹çš„ logback.xml ä¸­æ·»åŠ ç›¸åº”çš„ appender é…ç½®ï¼ŒæŒ‡æ˜Žåº”ç”¨åå’Œæ—¥å¿— topic å³å¯å°†æ—¥å¿—å¼‚æ­¥ä¼ åˆ° Flume ä¸­ã€‚å¯¹äºŽå…¶å®ƒåº”ç”¨æˆ–æœåŠ¡ (æ¯”å¦‚åŸºäºŽ Goã€Node.JSã€Python ç­‰)ï¼Œå¦‚æžœéœ€è¦æŽ¥å…¥æ—¥å¿—å¹³å°ï¼Œåªéœ€æŒ‰ç…§ä»¥ä¸Šæ—¥å¿—æ ¼å¼ç»„è£…æ—¥å¿—ï¼Œå¹¶å°†å…¶ä¸Šä¼ åˆ° Flume å³å¯ã€‚</p>

<p>ç»†å¿ƒçš„åŒå­¦ä¼šå‘çŽ°ï¼Œåœ¨å›¾ 3-2 ä¸­ï¼Œæˆ‘ä»¬ç”¨äº†<code>TrackSink</code>ï¼Œè¿™ä¸ªæ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿè™½ç„¶ Flume è‡ªå¸¦ä¸°å¯Œçš„ç»„ä»¶ï¼Œä¹ŸåŒ…æ‹¬ KafkaSinkï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç”¨å‘¢ï¼Ÿè€ƒè™‘åˆ°è‡ªå¸¦çš„ KafkaSink ä¸èƒ½æŒ‰æˆ‘ä»¬éœ€è¦çš„ topic æ¥åˆ†å‘æ•°æ®ï¼Œæ‰€ä»¥åªèƒ½è‡ªå®šä¹‰å®žçŽ°äº† Sink æ¥è¾¾åˆ°å†™ä¸åŒ topic æ—¥å¿—åˆ°ä¸åŒæ—¥å¿—ä¸­å¿ƒ topic ä¸­åŽ»çš„ç›®çš„ã€‚</p>

<p>å¦å¤–ï¼ŒFlume æ˜¯é€šè¿‡ Supervisor å¯åŠ¨çš„ï¼Œå¹¶ä¸”æ·»åŠ äº†ç›‘æŽ§æŠ¥è­¦ï¼Œä½†æ˜¯ä¸ºäº†é¿å…æ—¥å¿—å†™å¤±è´¥ï¼Œåœ¨ Flume ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Failover ç­–ç•¥ï¼Œå‡å¦‚å†™æ—¥å¿—ä¸­å¿ƒå¤±è´¥ï¼Œåˆ™å°†æ—¥å¿—å†™åˆ°æœ¬åœ°ï¼Œä¿è¯æ—¥å¿—ä¸ä¸¢å¤±ã€‚</p>

<p>3.2 æ—¥å¿—ä¸­å¿ƒ</p>

<p>ç¾Žå…¶åæ›°æ—¥å¿—ä¸­å¿ƒï¼Œä½†å®žé™…ä¸Šåªæ˜¯æ—¥å¿—ä¸­å¿ƒç¼“å­˜ï¼Œæˆ‘ä»¬åªä¿å­˜æœ€è¿‘ 24 å°æ—¶çš„æ—¥å¿—ï¼Œéœ€è¦æŒä¹…åŒ–çš„æ—¥å¿—éƒ½ä¼šåˆ·å…¥ HDFSã€‚è‡³äºŽä¸ºä»€ä¹ˆé€‰ç”¨ kafka é›†ç¾¤æ¥æž„å»ºæ—¥å¿—ä¸­å¿ƒï¼Œç†ç”±ä¸»è¦å¦‚ä¸‹:</p>

<pre><code>  1ã€åˆ†å¸ƒå¼æž¶æž„ï¼Œå¯æ”¯æŒæ°´å¹³æ‰©å±•ã€‚
  2ã€é«˜åžåé‡ï¼Œåœ¨æ™®é€šçš„æœåŠ¡å™¨ä¸Šæ¯ç§’é’Ÿä¹Ÿèƒ½å¤„ç†å‡ åä¸‡æ¡æ¶ˆæ¯(è¿œé«˜äºŽæˆ‘ä»¬çš„å³°å€¼1.5ä¸‡æ¡/ç§’)ã€‚
  3ã€æ¶ˆæ¯æŒä¹…åŒ–ï¼ŒæŒ‰topicåˆ†åŒºå­˜å‚¨ï¼Œæ”¯æŒå¯é‡å¤æ¶ˆè´¹ã€‚
  4ã€æ—¥å¿—ç³»ç»Ÿä¸éœ€è¦ä¿è¯ä¸¥æ ¼çš„æ¶ˆæ¯å‡†ç¡®æ€§ã€‚
  5ã€æ•°æ®åœ¨ç£ç›˜ä¸Šçš„å­˜å–ä»£ä»·ä¸ºO(1)ã€‚
  6ã€å¯æ ¹æ®brokeré…ç½®å®šæœŸåˆ é™¤è¿‡æœŸæ•°æ®ã€‚

</code></pre>

<p>3.3 æ—¥å¿—å¤„ç†å±‚å’Œæ—¥å¿—å­˜å‚¨å±‚</p>

<p>æ—¥å¿—å¤„ç†å±‚ï¼Œæ˜¯æˆ‘ä»¬çœŸæ­£åšäº‹çš„åœ°æ–¹ï¼›æ—¥å¿—å­˜å‚¨å±‚ï¼Œåˆ™æ˜¯æˆ‘ä»¬å­˜æ”¾æ—¥å¿—åˆ†æžç»“æžœçš„åœ°æ–¹ã€‚</p>

<p>åŸºäºŽæ—¥å¿—ä¸­å¿ƒï¼Œå¯åšçš„äº‹æƒ…æœ‰å¾ˆå¤šã€‚åªè¦æˆ‘ä»¬å¯¹æŸ topic æ—¥å¿—æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆä¾¿å¯ä»¥å°†è¯¥ topic æ—¥å¿—æ¶ˆè´¹æ¥æ»¡è¶³æˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚æˆ‘ä»¬å¯ä»¥ï¼š</p>

<pre><code>1ã€å°†æ—¥å¿—èšåˆï¼Œæ ¹æ®ä¸šåŠ¡ä¸åŒï¼Œå»ºç«‹ä¸åŒçš„ç´¢å¼•ï¼Œå­˜å…¥ElasticSearchæä¾›æŸ¥è¯¢ã€‚
2ã€å‘çŽ°å¼‚å¸¸æ—¥å¿—æ—¶ï¼Œå‘å¾€ç›‘æŽ§ä¸­å¿ƒï¼Œå‘å¯¹åº”çš„ä¸šåŠ¡æ–¹å‘èµ·æŠ¥è­¦ï¼Œå‘çŽ°å’Œé¢„å‘é—®é¢˜çš„å®žæ—¶æ€§æé«˜äº†ã€‚
3ã€ç»Ÿè®¡ä¸€äº›è®¿é—®æ—¥å¿—æˆ–è°ƒç”¨æ—¥å¿—ç­‰æŒ‡æ ‡ä¿¡æ¯ï¼Œå‘å¾€ç›‘æŽ§ä¸­å¿ƒæ¥æŽŒæ¡ç›¸å…³è°ƒç”¨è¶‹åŠ¿ã€‚
4ã€è°ƒç”¨é“¾å¼€å§‹åšèµ·æ¥äº†ï¼Œç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆä¸€ç›®äº†ç„¶äº†ã€‚
5ã€ç”¨æˆ·æ—¥å¿—è¡Œä¸ºå¯åˆ†æžäº†ã€‚

</code></pre>

<p>è¿™é‡Œæˆ‘ä»¬åšäº†ä¸å°‘ï¼Œä½†æ˜¯éœ€è¦åšçš„è¿˜æœ‰æ›´å¤šï¼Œå°±ä¸ä¸€ä¸€ä¾‹ä¸¾äº†ã€‚</p>

<h4 id="toc_6">å››ã€é‡åˆ°çš„é—®é¢˜å’Œè¦åšçš„äº‹æƒ…</h4>

<p>çªç„¶æŽ¥æ‰‹å¦‚æ­¤è§„æ¨¡çš„ä¸€ä¸ªåŸºç¡€äº§å“ï¼Œé‡åˆ°çš„é—®é¢˜è¿˜æ˜¯æ¯”è¾ƒå¤šçš„:</p>

<pre><code>1ã€ä¸šåŠ¡æ—¥å¿—æŽ¥å…¥ï¼Œæ¯ä¸€æ¬¡å¯¹æŽ¥ä¸ä»…éœ€è¦å¼€å‘æ—¥å¿—æ¶ˆè´¹æ¨¡å—ï¼Œè§£æžç›¸åº”æ—¥å¿—ï¼Œå»ºç«‹ç›¸åº”çš„ç´¢å¼•å¹¶å†™å…¥elasticsearchï¼Œè¿˜éœ€è¦å¼€å‘å¯¹åº”å®šåˆ¶çš„æŸ¥è¯¢é¡µé¢ã€‚ç”±äºŽè‡ªå·±æœ¬èº«å¯¹ç³»ç»Ÿä¸ç†Ÿæ‚‰ï¼Œå¦å¤–æ–‡æ¡£ç¼ºå¤±ï¼Œä»¥åŠæ¯ä¸€æ¬¡å¯¹æŽ¥çš„éƒ½æ˜¯â€œæ–°äººâ€ï¼Œè¿˜æ—¶ä¸æ—¶å¯èƒ½ä¼šé‡åˆ°å„ç§åƒå¥‡ç™¾æ€ªçš„é—®é¢˜ï¼Œéœ€è¦æŽ’æŸ¥å®šä½å¹¶è§£å†³é—®é¢˜ã€‚è¿™å—æ€¥éœ€è§£æ”¾ï¼Œä¸ç„¶ä¸€ä¸ªäººçœŸçš„å¿™ä¸è¿‡æ¥ï¼Œé’ˆå¯¹è¯¥é—®é¢˜ï¼ŒæŽ¥ä¸‹æ¥ä¼šæŠ½è±¡å‡ºæ—¥å¿—æ¶ˆè´¹å’Œelasticsearchè¯»å†™SDKï¼Œä¾›ä¸šåŠ¡æŽ¥å…¥æ–¹è‡ªå·±å¼€å‘å’Œç»´æŠ¤ã€‚
2ã€å¯¹äºŽå„ä¸ªç»„ä»¶(å¦‚logstashã€flumeã€kafkaã€elasticsearchç­‰)éƒ½æœªæ›¾æŽ¥è§¦è¿‡çš„æƒ…å†µä¸‹ï¼ŒçŸ­æ—¶é—´æŽ¥æ‰‹è¿™ä¹ˆä¸€ä¸ªæ–°äº§å“ï¼Œéœ€è¦å­¦ä¹ çš„ä¸œè¥¿å¾ˆå¤šï¼ŒåŽ‹åŠ›è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œä½†æ€»ç®—ç†¬è¿‡æ¥äº†ã€‚
3ã€ç¼ºå¤±çš„å¼€å‘æµ‹è¯•çŽ¯å¢ƒï¼Œåˆ°å†™æ­¤æ–‡ç« æ—¶æ€»ç®—æ­å»ºèµ·æ¥äº†ã€‚
4ã€elasticsearchå†…å­˜å ç”¨é«˜ï¼Œä»¥åŠç´¢å¼•çš„ç®¡ç†ä¸Žç»´æŠ¤ï¼Œè¿˜åœ¨ä¼˜åŒ–å’Œè€ƒè™‘ä¸­ã€‚
5ã€éœ€è¦å¼€å‘æ›´åŠ äººæ€§åŒ–ä¸”æ›´æ˜“æ‰©å±•å’Œç»´æŠ¤çš„è¿æŽ§å¹³å°ä¾›ä½¿ç”¨æ–¹æŸ¥è¯¢æ—¥å¿—ã€‚
6ã€æ—¥å¿—æ”¶é›†åˆ°Flumeå¢žåŠ æ”¯æŒUDPåè®®ã€‚
7ã€å°†å­˜å‚¨å±‚çš„HDFSç§»åˆ°æ—¥å¿—ä¸­å¿ƒï¼Œæ”¯æŒæ—¥å¿—åŒæ—¶å†™å…¥Kafkaé›†ç¾¤å’ŒHDFSé›†ç¾¤ã€‚
8ã€æ˜¯æ—¶å€™åšç‚¹æ—¥å¿—æŒ–æŽ˜çš„äº‹æƒ…äº†ã€‚

</code></pre>

<h4 id="toc_7">äº”ã€ç»“è¯­</h4>

<p>ä¸ºä»€ä¹ˆåšè¿™æ¬¡åˆ†äº«ï¼Ÿ</p>

<p>ç”±äºŽä¹‹å‰äº¤æŽ¥æ—¶é—´è¾ƒçŸ­ï¼Œå®žé™…åªæœ‰ 2 å¤©ï¼Œç„¶åŽç»Ÿä¸€æ—¥å¿—å¹³å°æ¶‰åŠçš„å†…å®¹æ¯”è¾ƒå¤šï¼ŒæŽ¥æ‰‹æ—¥å¿—å¹³å°çš„è¿™ä¸€ä¸ªå¤šæœˆæ˜¯ç—›è‹¦çš„ï¼Œç„¶åŽæ‰¾å´” (æœ‰èµž CTO) åæ§½äº†ä¸€ä¸‹ã€‚ç»“æžœå´”çŸ¥é“æˆ‘åœ¨æ¢³ç†æ—¥å¿—å¹³å°ï¼Œå°±è®©æˆ‘é¡ºä¾¿å†™ç¯‡ä»‹ç»æœ‰èµžçš„æ—¥å¿—æž¶æž„çš„æ–‡ç« ï¼Œå¸®åŠ©å¤§å®¶äº†è§£ä¸€ä¸‹ã€‚æ€Žå¥ˆæˆ‘è¿™äººè„¸çš®å¤ªè–„ï¼Œåœ¨å¯¹æ—¥å¿—å¹³å°è¿˜ä¸ç†Ÿæ‚‰çš„æƒ…å†µä¸‹ï¼Œç«Ÿç„¶åº”æ‰¿ä¸‹æ¥äº†ï¼Œä¿—è¯è¯´çš„å¥½ï¼Œæ­»è¦é¢å­æ´»å—ç½ªã€‚</p>

<p>æœ€åŽï¼Œå¥½åƒä¸åšç‚¹å¹¿å‘Šéƒ½å¯¹ä¸èµ·äººæ°‘å¤§ä¼—, çƒ­çƒˆæ¬¢è¿Žä¼˜ç§€ç¨‹åºå‘˜åŠ æˆ‘æœ‰èµžå¤§å®¶åº­ï¼Œæ— è®ºå‰ç«¯åŽç«¯ï¼Œåªè¦æƒ³åšäº‹ä¼šåšäº‹å°±è¡Œã€‚æœ‰æ„è€…è¯·çŒ›æˆ³: <a href="http://job.youzan.com/" title="åŠ å…¥æˆ‘ä»¬">åŠ å…¥æˆ‘ä»¬</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MySQL8 Authentication plugin Change]]></title>
    <link href="http://panlw.github.io/15348499248375.html"/>
    <updated>2018-08-21T19:12:04+08:00</updated>
    <id>http://panlw.github.io/15348499248375.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="http://samchu.logdown.com/posts/7425945-mysql8-authentication-plugin-change">http://samchu.logdown.com/posts/7425945-mysql8-authentication-plugin-change</a></p>

<p><img src="media/15348499248375/15348503868862.jpg" alt=""/></p>
</blockquote>

<p>é€™å¹¾å¤© MySQL å‡º 8 çš„ç‰ˆæœ¬, æ²’æƒ³åˆ°å¯†ç¢¼å„²å­˜æ–¹å¼è®Šæ›´äº†, é “æ™‚ä¸€å †äººæ…˜å«XD</p>

<p>å› ç‚º ä¹‹å‰ MySQL é è¨­å„²å­˜å¯†ç¢¼çš„æ–¹å¼æ˜¯<code>mysql_native_password</code>, ä½† 8.0 ä¹‹å¾Œ é è¨­çš„å„²å­˜æ–¹å¼ç‚º<code>caching_sha2_password</code>, èªªæ˜¯åˆå¿«åˆå®‰å…¨å•¦, ä½†è®“äººæŽªæ‰‹ä¸åŠ, ä¸€å † SQL å·¥å…· (Navicat) å¯èƒ½é‚„ä¾†ä¸åŠæ›´æ–°æ”¯æ´ å°±...</p>

<p>ç™»å…¥å¤±æ•—!!</p>

<pre><code>Authentication plugin &#39;caching_sha2_password&#39; cannot be loaded: dlopen(/usr/local/mysql/lib/plugin/caching_sha2_password.so, 2): image not found
</code></pre>

<h2 id="toc_0">æ–¹æ³•1 : å°±å‡ç´šä¸ŠåŽ»å§, è®Šæ›´ JDBC é€£çµæ–¹å¼</h2>

<ol>
<li>é¦–å…ˆæ›´æ–°ä½ çš„ JDBC é©…å‹• runtime &#39;mysql:mysql-connector-java:8.0.11&#39;</li>
<li>ä¿®æ”¹ä½ çš„ driver-class-name , å› ç‚º Loading class `com.mysql.jdbc.Driver&#39;. This is deprecated. , è«‹ä½ æ›æˆæ–°ç‰ˆçš„ com.mysql.cj.jdbc.Driver</li>
<li>JDBC URL å¢žåŠ åƒæ•¸<code>allowPublicKeyRetrieval=true</code></li>
</ol>

<p>å®Œæˆ, é€™æ¨£ä½ çš„ JDBC å°±å¯ä»¥æ­é…ä½¿ç”¨ä¸Š<code>caching_sha2_password</code>çš„æ©Ÿåˆ¶äº†</p>

<h2 id="toc_1">æ–¹æ³•2 : æˆ‘è¦æœ€æ–°ç‰ˆä½†æ˜¯ä¸è¦ç”¨æ–°çš„å¯†ç¢¼æ©Ÿåˆ¶</h2>

<p>æˆ‘æ˜¯ç”¨ Docker å•¦, å¤šå€‹åƒæ•¸å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†<code>--default-authentication-plugin=mysql_native_password</code></p>

<pre><code>docker run --name askask-mysql -e MYSQL_DATABASE=askask -e MYSQL_ROOT_PASSWORD=1qaz2wsx -p 3306:3306 -d mysql --default-authentication-plugin=mysql_native_password
</code></pre>

<p>æ”¶å·¥</p>

<h2 id="toc_2">æ–¹æ³•3 : ä¿®æ”¹è´¦æˆ·çš„å¯†ç¢¼æ©Ÿåˆ¶</h2>

<pre><code class="language-sql">CREATE DATABASE rep2 CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER &#39;dev&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;Dev.1234&#39;;
ALTER USER &#39;dev&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;password&#39;;
GRANT ALL PRIVILEGES ON rep2.* TO &#39;dev&#39;@&#39;%&#39;;
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[**The Path to Becoming a Software Architect**]]></title>
    <link href="http://panlw.github.io/15344302211672.html"/>
    <updated>2018-08-16T22:37:01+08:00</updated>
    <id>http://panlw.github.io/15344302211672.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://medium.com/@nvashanin/the-path-to-becoming-a-software-architect-de53f1cb310a">https://medium.com/@nvashanin/the-path-to-becoming-a-software-architect-de53f1cb310a</a></p>

<p><a href="https://medium.com/@nvashanin" title="Go to the profile of Nikolay Ashanin">Nikolay Ashanin</a> | Oct 1, 2017</p>

<p>Lead Software Engineer at EPAM Systems. Interested in software architecture and team management.</p>
</blockquote>

<p><img src="https://cdn-images-1.medium.com/max/800/1*JFdmWD8_X5gpCjNVaqILgQ.png" alt=""/>Image source: monumentvalleygame</p>

<p>Have you ever wondered what career opportunities a developer has? What directions are open, beyond what horizons to grow. And most importantly, where are developers beyond the age of 45? Is there a developer among your friends who is over 45? I personally know several developers beyond this age and many of them are hardcore programmers who even saw punch cards back in the day.</p>

<p><strong>There are several career paths a developer might take:</strong></p>

<p>â— The first and obvious one is to <strong>grow in the area in which you are working</strong>. If you are a junior developer, then just grow to middle, then senior and lead roles.</p>

<p>â— <strong>Transition to another technology stack</strong>. Actually, a big number of developers moved into the mobile area when iOS and Android OS gained ground.</p>

<p>â— <strong>Grow into a manager role</strong>. As a developer, the greatest staffing issue I saw was the shortage of competent managers. Clever managers are expensive, hence they are scarce. If the manager has a technical background, that will allow him to be on the same wavelength with the developers.</p>

<p>â— <strong>Become a software architect</strong>. This direction will be considered in this series of articles.</p>

<p>â— <strong>Get out of IT</strong>. Sometimes this happens. It is never too late to do what you like to do.</p>

<h3 id="toc_0">Article series</h3>

<ol>
<li> <a href="https://medium.com/@nvashanin/the-path-to-becoming-a-software-architect-de53f1cb310a">The Path to Becoming a Software Architect</a></li>
<li> <a href="https://medium.com/@nvashanin/stakeholders-in-software-architecture-6d18f36250f9">Stakeholders in Software Architecture</a></li>
<li> <a href="https://medium.com/@nvashanin/types-of-software-architects-aa03e359d192">Types of Software Architects</a></li>
<li> <a href="https://medium.com/@nvashanin/quality-attributes-in-software-architecture-3844ea482732">Quality attributes in Software Architecture. Part I</a></li>
<li> TBD Quality attributes in Software Architecture. Part II</li>
<li> TBD Software Architect. Diagrams and documentation</li>
<li> <a href="https://medium.com/@nvashanin/certificates-in-software-architecture-6b18e0102fe7">Certificates in Software Architecture</a></li>
<li> <a href="https://medium.com/@nvashanin/books-in-software-architecture-6ad974e524ce">Books in Software Architecture</a></li>
<li> TBD Software Architect. Design vs Architecture</li>
</ol>

<h3 id="toc_1">Yes, This Was MyÂ Path</h3>

<p>In the past 8 years, I have worked with Java EE, then moved to iOS, and became a team lead. I managed various developer teams, including Android, and Web stacks. Created the architecture of the network layer for several services developed by the company, with sockets and REST API. I became acquainted with the managerial role and the prospect of growing in this direction while in the position of team lead for over two years. In my next role, my goal is to grow as a software architect.</p>

<p>For most developers, the function of the architect on the project is often unclear, so in this series of articles, I will try to find the answers to these related questions. Who is an architect, what is the scope of responsibilities, and how to grow in this direction and outline and action plan for myself and beginners wanting to move along this path.</p>

<h3 id="toc_2"><strong>Who Can Benefit fromÂ This?</strong></h3>

<p>This series of articles will help you if you belong to one of the following categories:</p>

<p>â— <strong>IT developer or engineer</strong>. You are still growing as a developer, but you are looking ahead and planning your career. Even if the goals are initially vague, a person who consciously sets strategic goals will reach them much quicker than a person who does not plan where she is heading.</p>

<p>â— <strong>Team leader, lead software engineer</strong>. You are at the highest stage of the software development discipline. To grow further, you have a choice to either learn one more stack of technologies, pursue a career outside software engineering, or to become a software architect.</p>

<p>â— <strong>Software architect</strong>. You recently took this position, or have been working in this field for a long time. Perhaps one of the main qualities of such a specialist is the understanding that there are always areas that a person does not know and that the learning process is continuous.</p>

<p>â— <strong>IT manager</strong>. Although you are a manager, you understand perfectly well that you should at least approximately understand what your subordinates or colleagues are doing. The acute problem of management is the technical incompetence of the manager in the field in which he or she is managing.</p>

<h3 id="toc_3"><strong>Who is an Architect?</strong></h3>

<p>Before moving on to more specific questions, it is necessary to define the software architect role and it responsibilities.</p>

<blockquote>
<p>A <strong>software architect</strong> is a software expert who makes high-level design choices and dictates technical standards, including software coding standards, tools, and platforms. The leading expert is referred to as the chief architect. (Wikipedia, The Free Encyclopedia, s.v. â€œSoftware architectâ€, <a href="https://en.wikipedia.org/wiki/Software_architect">https://en.wikipedia.org/wiki/Software_architect</a></p>
</blockquote>

<p>Like most high-level positions, there are no clear criteria that define this role. However, it is possible to define a number of responsibilities and qualities that contribute to the career of the architect.</p>

<p>First, letâ€™s consider the <strong>characteristics of the architect</strong>:</p>

<p>â— <strong>Communicability</strong>. Having talked with many software architects, I heard that it is one of the most important characteristic of this specialist. During the working day, they have to talk with customers in the language of business, managers of all levels, business analysts and developers. If you have a natural charisma and you know how to convince people, then this will be a huge plus, as it is very important to explain your actions correctly. Architects are laconic, eloquent and competent speakers. The software architects with whom I spoke have highly developed skills in communication and persuasion. Another reason why this characteristic is most important is that the architect in this role participates in most discussion making processes, and often compromises must be reach that are acceptable and beneficial for all involved parties.</p>

<p>â— <strong>Broad and deep technical knowledge</strong>. This should be obvious since one cannot become a software architect with a medical background. In addition, the architect usually has knowledge in several technological stacks at a decent level, and should have a good understanding of a few other ones. The software architect should also be prepared to compose a large number of technical documentation, reports and diagrams.</p>

<p>â— <strong>Responsibility</strong>. You should understand that architect decisions are usually the most expensive. Therefore, a person in this position should take the most responsible approach to his work and to the decisions made. If the developerâ€™s error costs a couple days of work of one person, then the architectâ€™s mistake can cost person-years on complex projects!</p>

<p>â— <strong>Stress resistance</strong>. You will have to make decisions because in this role, you will be asked to do so and you will need response. You will be working with different people from different areas, and you will have to deal with rapidly changing demands or even with changing business environments. Therefore, it is necessary to be ready for stress and to look for some ways to escape negative emotions. Work is always more pleasant when it brings pleasure. So if you choose this role only for the money, then think again.</p>

<p>â— <strong>Management skills</strong>. This includes both organizational and leadership skills. The ability to lead a team, which may be distributed and composed of very different specialists, is essential.</p>

<p>â— <strong>Analytic skills</strong>. Even if a specialist has a wide erudition in technology, he has tried many things on his own or participated in projects of various types, this does not guarantee that he can easily change the style of thinking to architect. One of the most important tasks is the ability to represent an abstract problem in the form of some finite real object of the system, which developers are already evaluating, designing and developing. Great communications skills are essential to clearly represent the abstraction in the form of the final system to the members of the team and the customer. It will be necessary to clearly communicate to both business and development, what is still to be done.</p>

<p>If we talk about the responsibilities of the architect, then here is the perfect example from 19th century about bridge construction. At that time, the tests of the newly constructed bridge were the following: the key group of engineers, architects and workers stood under the bridge while the first vehicles were on it. Thus, they staked their lives upon the construction and the strength of the structure. So if there is a questionâ€Šâ€”â€Šwhat is the responsibility of the software architect on the project? The answer is, he is responsible for everything.</p>

<p>If you give up loud and beautiful phrases, then the architectâ€™s work includes:</p>

<p>â— Identifying the stakeholders on the project.</p>

<p>â— Identifying business requirements and requirements of the stakeholders on the project.</p>

<p>â— Designing the entire system based on the received requirements.</p>

<p>â— Choosing the system architecture and each individual component of this system at a high level.</p>

<p>â— Choosing the technologies for the implementation of each component and connections between the components.</p>

<p>â— Architectural review. Yes, yes, it exists.</p>

<p>â— Code-review.</p>

<p>â— Writing project documentation and its support.</p>

<p>â— Creating unified development standards in the company.</p>

<p>â— Controlling the architecture during the next iteration of the system release.</p>

<p>This is only a subset of the software architectâ€™s responsibilities. The most important responsibility is complete technical support of the project from the moment of inception, through product release, to development of enhancements. And supporting the next releases. It will be necessary to switch a lot between different tasks during the working day.</p>

<h3 id="toc_4"><strong>How to Become a Software Architect?</strong></h3>

<p>To begin with, it is important to define milestone goals that lead to achieving your strategic goal of becoming a software architect. For me, such <strong>goals for the next six months</strong> are:</p>

<p>â— <strong>Understand and try several technological stacks</strong>. My current knowledge is concentrated in the field of iOS. It is necessary to try Android, several server languages, to start python, and refresh Java EE skills. The architect is a full-stack developer, so it is important to have a broad technical knowledge.</p>

<p>â— <strong>Reading literature</strong>. It is important to determine the most valuable books and articles that will help to grow in this direction. Usually the most effective way to find such literature is ask other professionals in this field for their recommendation. In one of the future articles, I plan to give you such a list of literature.</p>

<p>â— <strong>Find a mentor</strong>. It is desirable to find a software architect at your current place of employment. It is always easier to get experience from a trained specialist than to start considering a certain area from scratch. It is important to be prepared to ask good questions from your mentor.</p>

<p>â— <strong>Study courses/obtain certificates</strong>. There are many courses and certificates available, but only a few are worth their money, and the higher level courses cost a lot of money. Personally, I have attended the architectural courses of Luxoft (<a href="http://www.luxoft-training.com/it-course/ARC-001/">http://www.luxoft-training.com/it-course/ARC-001/</a>), which have proven to be a worthy investment. It is extremely important that the lecturer of the course be a professional in this field and be able to answer questions. As for certificates, before starting, it is best to understand whether there are authoritative certification systems for architects and whether it is worthwhile obtaining the certification. This point I will discuss in a future article of this series.</p>

<p>One of the most important parts is a clear and stable plan review. What has been done, what should be reviewed, and where to accelerate or which goal to remove as useless.</p>

<h3 id="toc_5">Check Your Readiness Level</h3>

<p>If you are interested in this introductory article from the series on how to become a software architect, or if you suddenly have thoughts to try this path, it is worth making sure that you really want it.</p>

<p>Firstly, people are afraid of everything new. A new position, new kind of stress, as opposed to the comfortable status quo. Of course, the choice is not always unambiguous and depends on how much you are willing to change something in your life. At the same time, it can depend not only on you, but also on the family, your financial commitments, parents and other factors.</p>

<p>Secondly, this path takes several years. The process of becoming a software architect does not happen overnight. As a team lead, I realized what to do and how to deal with stress only a year after I was appointed to an official position. At the same time six months before that, I performed it unofficially. One software architect I know said that he understood what his responsibilities are 18 months after he was promoted to this role. Such intervals of time are normal and you need to understand whether you are ready to move in this direction. Even if you do not have a stable plan ready, it is better to start taking small steps that move you ahead, rather than remaining in the same place.</p>

<p>Standing in the same place in IT is a synonym for stagnation and personal fetters in life.</p>

<ul>
<li>  <a href="https://medium.com/tag/software-development?source=post">Software Development</a></li>
<li>  <a href="https://medium.com/tag/software-architecture?source=post">Software Architecture</a></li>
<li>  <a href="https://medium.com/tag/software-engineering?source=post">Software Engineering</a></li>
<li>  <a href="https://medium.com/tag/management?source=post">Management</a></li>
<li>  <a href="https://medium.com/tag/software?source=post">Software</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[InnoDBå¹¶å‘å¦‚æ­¤é«˜ï¼ŒåŽŸå› ç«Ÿç„¶åœ¨è¿™ï¼Ÿ]]></title>
    <link href="http://panlw.github.io/15342611126076.html"/>
    <updated>2018-08-14T23:38:32+08:00</updated>
    <id>http://panlw.github.io/15342611126076.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p>åŽŸæ–‡åœ°å€ <a href="https://mp.weixin.qq.com/s/R3yuitWpHHGWxsUcE0qIRQ">https://mp.weixin.qq.com/s/R3yuitWpHHGWxsUcE0qIRQ</a></p>

<p>åŽŸåˆ›ï¼š 58æ²ˆå‰‘  æž¶æž„å¸ˆä¹‹è·¯  2018-08-14</p>
</blockquote>

<p>ã€Š<a href="http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651961431&amp;idx=1&amp;sn=4f46fbada3d99ca6cf74b305d06c1ac6&amp;chksm=bd2d0d8b8a5a849d8cb5a616c957abde7a6485cd2624372b84a5459eed081bd95429a09572f8&amp;scene=21#wechat_redirect">InnoDB è¡Œé”ï¼Œå¦‚ä½•é”ä½ä¸€æ¡ä¸å­˜åœ¨çš„è®°å½•ï¼Ÿ</a>ã€‹åŸ‹äº†ä¸€ä¸ªå‘ï¼Œæ²¡æƒ³åˆ°è¯„è®ºåå“å‰§çƒˆï¼Œå¤§å®¶éƒ½å¸Œæœ›æ·±æŒ–ä¸‹åŽ»ã€‚åŽŸè®¡åˆ’å†™å†™ InnoDB çš„é”ç»“æŸè¿™ä¸ª caseï¼Œæ—¢ç„¶å‘¼å£°è¿™ä¹ˆé«˜ï¼Œå¹²è„†å…¨ç›˜<strong>ç³»ç»Ÿæ€§</strong>çš„å†™å†™ InnoDB çš„<strong>å¹¶å‘æŽ§åˆ¶</strong>ï¼Œ<strong>é”</strong>ï¼Œ<strong>äº‹åŠ¡æ¨¡åž‹</strong>å¥½äº†ã€‚</p>

<p>ä½“ç³»ç›¸å¯¹å®å¤§ï¼Œä¸€ç¯‡è‚¯å®šå†™ä¸å®Œï¼Œå®¹æˆ‘å¨“å¨“é“æ¥ï¼Œé€šä¿—åœ°è¯´æ¸…æ¥šæ¥é¾™åŽ»è„‰ã€‚</p>

<p><strong>ä¸€ã€å¹¶å‘æŽ§åˆ¶</strong></p>

<p><strong>ä¸ºå•¥è¦è¿›è¡Œå¹¶å‘æŽ§åˆ¶ï¼Ÿ</strong></p>

<p>å¹¶å‘çš„ä»»åŠ¡å¯¹åŒä¸€ä¸ªä¸´ç•Œèµ„æºè¿›è¡Œæ“ä½œï¼Œå¦‚æžœä¸é‡‡å–æŽªæ–½ï¼Œå¯èƒ½å¯¼è‡´ä¸ä¸€è‡´ï¼Œæ•…å¿…é¡»è¿›è¡Œ<strong>å¹¶å‘æŽ§åˆ¶</strong>ï¼ˆConcurrency Controlï¼‰ã€‚</p>

<p><strong>æŠ€æœ¯ä¸Šï¼Œé€šå¸¸å¦‚ä½•è¿›è¡Œå¹¶å‘æŽ§åˆ¶ï¼Ÿ</strong></p>

<p>é€šè¿‡å¹¶å‘æŽ§åˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„å¸¸è§æ‰‹æ®µæœ‰ï¼š</p>

<ul>
<li><p>é”ï¼ˆLockingï¼‰</p></li>
<li><p>æ•°æ®å¤šç‰ˆæœ¬ï¼ˆMulti Versioningï¼‰</p></li>
</ul>

<p><strong>äºŒã€é”</strong></p>

<p><strong>å¦‚ä½•ä½¿ç”¨æ™®é€šé”ä¿è¯ä¸€è‡´æ€§ï¼Ÿ</strong></p>

<p>æ™®é€šé”ï¼Œè¢«ä½¿ç”¨æœ€å¤šï¼š</p>

<p>(1) æ“ä½œæ•°æ®å‰ï¼Œé”ä½ï¼Œå®žæ–½äº’æ–¥ï¼Œä¸å…è®¸å…¶ä»–çš„å¹¶å‘ä»»åŠ¡æ“ä½œï¼›</p>

<p>(2) æ“ä½œå®ŒæˆåŽï¼Œé‡Šæ”¾é”ï¼Œè®©å…¶ä»–ä»»åŠ¡æ‰§è¡Œï¼›</p>

<p>å¦‚æ­¤è¿™èˆ¬ï¼Œæ¥ä¿è¯ä¸€è‡´æ€§ã€‚</p>

<p><strong>æ™®é€šé”å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>

<p>ç®€å•çš„é”ä½å¤ªè¿‡ç²—æš´ï¼Œè¿ž â€œè¯»ä»»åŠ¡â€ ä¹Ÿæ— æ³•å¹¶è¡Œï¼Œä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹æœ¬è´¨ä¸Šæ˜¯ä¸²è¡Œçš„ã€‚</p>

<p>äºŽæ˜¯å‡ºçŽ°äº†<strong>å…±äº«é”</strong>ä¸Ž<strong>æŽ’ä»–é”</strong>ï¼š</p>

<ul>
<li><p>å…±äº«é”ï¼ˆ<strong>S</strong>hare Locksï¼Œè®°ä¸º S é”ï¼‰ï¼Œè¯»å–æ•°æ®æ—¶åŠ  S é”</p></li>
<li><p>æŽ’ä»–é”ï¼ˆe<strong>X</strong>clusive Locksï¼Œè®°ä¸º X é”ï¼‰ï¼Œä¿®æ”¹æ•°æ®æ—¶åŠ  X é”</p></li>
</ul>

<p>å…±äº«é”ä¸ŽæŽ’ä»–é”çš„çŽ©æ³•æ˜¯ï¼š</p>

<ul>
<li><p>å…±äº«é”ä¹‹é—´ä¸äº’æ–¥ï¼Œç®€è®°ä¸ºï¼šè¯»è¯»å¯ä»¥å¹¶è¡Œ</p></li>
<li><p>æŽ’ä»–é”ä¸Žä»»ä½•é”äº’æ–¥ï¼Œç®€è®°ä¸ºï¼šå†™è¯»ï¼Œå†™å†™ä¸å¯ä»¥å¹¶è¡Œ</p></li>
</ul>

<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€æ—¦å†™æ•°æ®çš„ä»»åŠ¡æ²¡æœ‰å®Œæˆï¼Œæ•°æ®æ˜¯ä¸èƒ½è¢«å…¶ä»–ä»»åŠ¡è¯»å–çš„ï¼Œè¿™å¯¹å¹¶å‘åº¦æœ‰è¾ƒå¤§çš„å½±å“ã€‚</p>

<p><u>ç”»å¤–éŸ³ï¼šå¯¹åº”åˆ°æ•°æ®åº“ï¼Œå¯ä»¥ç†è§£ä¸ºï¼Œå†™äº‹åŠ¡æ²¡æœ‰æäº¤ï¼Œè¯»ç›¸å…³æ•°æ®çš„ select ä¹Ÿä¼šè¢«é˜»å¡žã€‚</u></p>

<p><strong>æœ‰æ²¡æœ‰å¯èƒ½ï¼Œè¿›ä¸€æ­¥æé«˜å¹¶å‘å‘¢ï¼Ÿ</strong></p>

<p>å³ä½¿å†™ä»»åŠ¡æ²¡æœ‰å®Œæˆï¼Œå…¶ä»–è¯»ä»»åŠ¡ä¹Ÿå¯èƒ½å¹¶å‘ï¼Œè¿™å°±å¼•å‡ºäº†æ•°æ®å¤šç‰ˆæœ¬ã€‚</p>

<p><strong>ä¸‰ã€æ•°æ®å¤šç‰ˆæœ¬</strong></p>

<p>æ•°æ®å¤šç‰ˆæœ¬æ˜¯ä¸€ç§èƒ½å¤Ÿè¿›ä¸€æ­¥æé«˜å¹¶å‘çš„æ–¹æ³•ï¼Œå®ƒçš„<strong>æ ¸å¿ƒåŽŸç†</strong>æ˜¯ï¼š</p>

<p>ï¼ˆ1ï¼‰å†™ä»»åŠ¡å‘ç”Ÿæ—¶ï¼Œå°†æ•°æ®å…‹éš†ä¸€ä»½ï¼Œä»¥ç‰ˆæœ¬å·åŒºåˆ†ï¼›</p>

<p>ï¼ˆ2ï¼‰å†™ä»»åŠ¡æ“ä½œæ–°å…‹éš†çš„æ•°æ®ï¼Œç›´è‡³æäº¤ï¼›</p>

<p>ï¼ˆ3ï¼‰å¹¶å‘è¯»ä»»åŠ¡å¯ä»¥ç»§ç»­è¯»å–æ—§ç‰ˆæœ¬çš„æ•°æ®ï¼Œä¸è‡³äºŽé˜»å¡žï¼›</p>

<p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxqYZaEWwXRwibTg8vNtNIPG7Hfiat5wx6D353IIxWmOKJawOcJ84QFu2WYicElTUeTsy9Am0MQZpcyg/640?wx_fmt=png" alt=""/></p>

<p>å¦‚ä¸Šå›¾ï¼š</p>

<p>1. æœ€å¼€å§‹æ•°æ®çš„ç‰ˆæœ¬æ˜¯ V0ï¼›</p>

<p>2. T1 æ—¶åˆ»å‘èµ·äº†ä¸€ä¸ªå†™ä»»åŠ¡ï¼Œè¿™æ˜¯æŠŠæ•°æ® clone äº†ä¸€ä»½ï¼Œè¿›è¡Œä¿®æ”¹ï¼Œç‰ˆæœ¬å˜ä¸º V1ï¼Œä½†ä»»åŠ¡è¿˜æœªå®Œæˆï¼›</p>

<p>3. T2 æ—¶åˆ»å¹¶å‘äº†ä¸€ä¸ªè¯»ä»»åŠ¡ï¼Œä¾ç„¶å¯ä»¥è¯» V0 ç‰ˆæœ¬çš„æ•°æ®ï¼›</p>

<p>4. T3 æ—¶åˆ»åˆå¹¶å‘äº†ä¸€ä¸ªè¯»ä»»åŠ¡ï¼Œä¾ç„¶ä¸ä¼šé˜»å¡žï¼›</p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®å¤šç‰ˆæœ¬ï¼Œé€šè¿‡ â€œè¯»å–æ—§ç‰ˆæœ¬æ•°æ®â€ èƒ½å¤Ÿæžå¤§æé«˜ä»»åŠ¡çš„å¹¶å‘åº¦ã€‚</p>

<p>æé«˜å¹¶å‘çš„æ¼”è¿›æ€è·¯ï¼Œå°±åœ¨å¦‚æ­¤ï¼š</p>

<ul>
<li><p><strong>æ™®é€šé”</strong>ï¼Œæœ¬è´¨æ˜¯ä¸²è¡Œæ‰§è¡Œ</p></li>
<li><p><strong>è¯»å†™é”</strong>ï¼Œå¯ä»¥å®žçŽ°è¯»è¯»å¹¶å‘</p></li>
<li><p><strong>æ•°æ®å¤šç‰ˆæœ¬</strong>ï¼Œå¯ä»¥å®žçŽ°è¯»å†™å¹¶å‘</p></li>
</ul>

<p><u>ç”»å¤–éŸ³ï¼šè¿™ä¸ªæ€è·¯ï¼Œæ¯”æ•´ç¯‡æ–‡ç« çš„å…¶ä»–æŠ€æœ¯ç»†èŠ‚æ›´é‡è¦ï¼Œå¸Œæœ›å¤§å®¶ç‰¢è®°ã€‚</u></p>

<p>å¥½ï¼Œå¯¹åº”åˆ° InnoDB ä¸Šï¼Œå…·ä½“æ˜¯æ€Žä¹ˆçŽ©çš„å‘¢ï¼Ÿ</p>

<p><strong>å››ã€redo, undo,</strong> <strong>å›žæ»šæ®µ</strong></p>

<p>åœ¨è¿›ä¸€æ­¥ä»‹ç» InnoDB å¦‚ä½•ä½¿ç”¨ â€œè¯»å–æ—§ç‰ˆæœ¬æ•°æ®â€ æžå¤§æé«˜ä»»åŠ¡çš„å¹¶å‘åº¦ä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆä»‹ç»ä¸‹ redo æ—¥å¿—ï¼Œundo æ—¥å¿—ï¼Œå›žæ»šæ®µï¼ˆrollback segmentï¼‰ã€‚</p>

<p><strong>ä¸ºä»€ä¹ˆè¦æœ‰ redo</strong> <strong>æ—¥å¿—ï¼Ÿ</strong></p>

<p>æ•°æ®åº“äº‹åŠ¡æäº¤åŽï¼Œå¿…é¡»å°†æ›´æ–°åŽçš„æ•°æ®åˆ·åˆ°ç£ç›˜ä¸Šï¼Œä»¥ä¿è¯ ACID ç‰¹æ€§ã€‚ç£ç›˜<strong>éšæœºå†™</strong>æ€§èƒ½è¾ƒä½Žï¼Œå¦‚æžœæ¯æ¬¡éƒ½åˆ·ç›˜ï¼Œä¼šæžå¤§å½±å“æ•°æ®åº“çš„åžåé‡ã€‚</p>

<p>ä¼˜åŒ–æ–¹å¼æ˜¯ï¼Œå°†ä¿®æ”¹è¡Œä¸ºå…ˆå†™åˆ° redo æ—¥å¿—é‡Œï¼ˆæ­¤æ—¶å˜æˆäº†<strong>é¡ºåºå†™</strong>ï¼‰ï¼Œå†å®šæœŸå°†æ•°æ®åˆ·åˆ°ç£ç›˜ä¸Šï¼Œè¿™æ ·èƒ½æžå¤§æé«˜æ€§èƒ½ã€‚</p>

<p><u>ç”»å¤–éŸ³ï¼šè¿™é‡Œçš„æž¶æž„è®¾è®¡æ–¹æ³•æ˜¯ï¼Œ<strong>éšæœºå†™ä¼˜åŒ–ä¸ºé¡ºåºå†™</strong>ï¼Œæ€è·¯æ›´é‡è¦ã€‚</u></p>

<p>å‡å¦‚æŸä¸€æ—¶åˆ»ï¼Œæ•°æ®åº“å´©æºƒï¼Œè¿˜æ²¡æ¥å¾—åŠåˆ·ç›˜çš„æ•°æ®ï¼Œåœ¨æ•°æ®åº“é‡å¯åŽï¼Œä¼šé‡åš redo æ—¥å¿—é‡Œçš„å†…å®¹ï¼Œä»¥ä¿è¯å·²æäº¤äº‹åŠ¡å¯¹æ•°æ®äº§ç”Ÿçš„å½±å“éƒ½åˆ·åˆ°ç£ç›˜ä¸Šã€‚</p>

<p><strong>ä¸€å¥è¯</strong>ï¼Œredo æ—¥å¿—ç”¨äºŽä¿éšœï¼Œå·²æäº¤äº‹åŠ¡çš„ ACID ç‰¹æ€§ã€‚</p>

<p><strong>ä¸ºä»€ä¹ˆè¦æœ‰ undo</strong> <strong>æ—¥å¿—ï¼Ÿ</strong></p>

<p>æ•°æ®åº“äº‹åŠ¡æœªæäº¤æ—¶ï¼Œä¼šå°†äº‹åŠ¡ä¿®æ”¹æ•°æ®çš„é•œåƒï¼ˆå³ä¿®æ”¹å‰çš„æ—§ç‰ˆæœ¬ï¼‰å­˜æ”¾åˆ° undo æ—¥å¿—é‡Œï¼Œå½“äº‹åŠ¡å›žæ»šæ—¶ï¼Œæˆ–è€…æ•°æ®åº“å¥”æºƒæ—¶ï¼Œå¯ä»¥åˆ©ç”¨ undo æ—¥å¿—ï¼Œå³æ—§ç‰ˆæœ¬æ•°æ®ï¼Œæ’¤é”€æœªæäº¤äº‹åŠ¡å¯¹æ•°æ®åº“äº§ç”Ÿçš„å½±å“ã€‚</p>

<p><u>ç”»å¤–éŸ³ï¼šæ›´ç»†èŠ‚çš„ï¼Œ</u></p>

<p><u>å¯¹äºŽ <strong>insert æ“ä½œ</strong>ï¼Œundo æ—¥å¿—è®°å½•æ–°æ•°æ®çš„ PK(ROW</u>ID)ï¼Œå›žæ»šæ—¶ç›´æŽ¥åˆ é™¤ï¼›_</p>

<p><u>å¯¹äºŽ <strong>delete/update æ“ä½œ</strong>ï¼Œundo æ—¥å¿—è®°å½•æ—§æ•°æ® rowï¼Œå›žæ»šæ—¶ç›´æŽ¥æ¢å¤ï¼›</u></p>

<p><u>ä»–ä»¬åˆ†åˆ«å­˜æ”¾åœ¨ä¸åŒçš„ buffer é‡Œã€‚</u></p>

<p><strong>ä¸€å¥è¯</strong>ï¼Œundo æ—¥å¿—ç”¨äºŽä¿éšœï¼Œæœªæäº¤äº‹åŠ¡ä¸ä¼šå¯¹æ•°æ®åº“çš„ ACID ç‰¹æ€§äº§ç”Ÿå½±å“ã€‚</p>

<p><strong>ä»€ä¹ˆæ˜¯å›žæ»šæ®µï¼Ÿ</strong></p>

<p>å­˜å‚¨ undo æ—¥å¿—çš„åœ°æ–¹ï¼Œæ˜¯å›žæ»šæ®µã€‚</p>

<p>undo æ—¥å¿—å’Œå›žæ»šæ®µå’Œ InnoDB çš„ MVCC å¯†åˆ‡ç›¸å…³ï¼Œè¿™é‡Œä¸¾ä¸ªä¾‹å­å±•å¼€è¯´æ˜Žä¸€ä¸‹ã€‚</p>

<p><strong>æ —å­</strong>ï¼š</p>

<p>t(id PK, name);</p>

<p>æ•°æ®ä¸ºï¼š</p>

<p>1, shenjian</p>

<p>2, zhangsan</p>

<p>3, lisi</p>

<p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxqYZaEWwXRwibTg8vNtNIPGhicRJvTpNR0lzoZticJ8BLAWEAbMzC9pgZ0yYZ29IdWKekoqiaxuf6Neg/640?wx_fmt=png" alt=""/></p>

<p>æ­¤æ—¶æ²¡æœ‰äº‹åŠ¡æœªæäº¤ï¼Œæ•…å›žæ»šæ®µæ˜¯ç©ºçš„ã€‚</p>

<p>æŽ¥ç€å¯åŠ¨äº†ä¸€ä¸ªäº‹åŠ¡ï¼š</p>

<p>start trx;</p>

<p>delete (1, shenjian);</p>

<p>update set(3, lisi) to (3, xxx);</p>

<p>insert (4, wangwu);</p>

<p>å¹¶ä¸”äº‹åŠ¡å¤„äºŽæœªæäº¤çš„çŠ¶æ€ã€‚</p>

<p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxqYZaEWwXRwibTg8vNtNIPGLSOOJDKXmdHqkgdeXFibUI0bNhuQN0qb0E5BiaR00gwaS0IU7vzz0tSA/640?wx_fmt=png" alt=""/></p>

<p>å¯ä»¥çœ‹åˆ°ï¼š</p>

<p>(1) è¢«åˆ é™¤å‰çš„ (1, shenjian) ä½œä¸ºæ—§ç‰ˆæœ¬æ•°æ®ï¼Œè¿›å…¥äº†å›žæ»šæ®µï¼›</p>

<p>(2) è¢«ä¿®æ”¹å‰çš„ (3, lisi) ä½œä¸ºæ—§ç‰ˆæœ¬æ•°æ®ï¼Œè¿›å…¥äº†å›žæ»šæ®µï¼›</p>

<p>(3) è¢«æ’å…¥çš„æ•°æ®ï¼ŒPK(4) è¿›å…¥äº†å›žæ»šæ®µï¼›</p>

<p>æŽ¥ä¸‹æ¥ï¼Œå‡å¦‚äº‹åŠ¡ rollbackï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡å›žæ»šæ®µé‡Œçš„ undo æ—¥å¿—å›žæ»šã€‚</p>

<p><u>ç”»å¤–éŸ³ï¼šå‡è®¾äº‹åŠ¡æäº¤ï¼Œå›žæ»šæ®µé‡Œçš„ undo æ—¥å¿—å¯ä»¥åˆ é™¤ã€‚</u></p>

<p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxqYZaEWwXRwibTg8vNtNIPGMuEql2dsc2US7uwMaP9fBic9dPeod96CqwcaN6Qd75icNssicNHkaaMzw/640?wx_fmt=png" alt=""/></p>

<p>å¯ä»¥çœ‹åˆ°ï¼š</p>

<p>(1) è¢«åˆ é™¤çš„æ—§æ•°æ®æ¢å¤äº†ï¼›</p>

<p>(2) è¢«ä¿®æ”¹çš„æ—§æ•°æ®ä¹Ÿæ¢å¤äº†ï¼›</p>

<p>(3) è¢«æ’å…¥çš„æ•°æ®ï¼Œåˆ é™¤äº†ï¼›</p>

<p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxqYZaEWwXRwibTg8vNtNIPGry9tyIxsGfql43eEhWoYHg6ibS1S4th1dMjj6JKTwt8XWnIt0iaS71jw/640?wx_fmt=png" alt=""/></p>

<p>äº‹åŠ¡å›žæ»šæˆåŠŸï¼Œä¸€åˆ‡å¦‚æ•…ã€‚</p>

<p><strong>å››ã€InnoDB</strong> <strong>æ˜¯åŸºäºŽå¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶çš„å­˜å‚¨å¼•æ“Ž</strong></p>

<p>ã€Š<a href="http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651961428&amp;idx=1&amp;sn=31a9eb967941d888fbd4bb2112e9602b&amp;chksm=bd2d0d888a5a849e7ebaa7756a8bc1b3d4e2f493f3a76383fc80f7e9ce7657e4ed2f6c01777d&amp;scene=21#wechat_redirect">å¤§æ•°æ®é‡ï¼Œé«˜å¹¶å‘é‡çš„äº’è”ç½‘ä¸šåŠ¡ï¼Œä¸€å®šè¦ä½¿ç”¨ InnoDB</a>ã€‹æåˆ°ï¼ŒInnoDB æ˜¯é«˜å¹¶å‘äº’è”ç½‘åœºæ™¯æœ€ä¸ºæŽ¨èçš„å­˜å‚¨å¼•æ“Žï¼Œæ ¹æœ¬åŽŸå› ï¼Œå°±æ˜¯å…¶<strong>å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶</strong>ï¼ˆMulti Version Concurrency Control, MVCCï¼‰ã€‚è¡Œé”ï¼Œå¹¶å‘ï¼Œäº‹åŠ¡å›žæ»šç­‰å¤šç§ç‰¹æ€§éƒ½å’Œ MVCC ç›¸å…³ã€‚</p>

<p>MVCC å°±æ˜¯é€šè¿‡ â€œè¯»å–æ—§ç‰ˆæœ¬æ•°æ®â€ æ¥é™ä½Žå¹¶å‘äº‹åŠ¡çš„é”å†²çªï¼Œæé«˜ä»»åŠ¡çš„å¹¶å‘åº¦ã€‚</p>

<p><strong>æ ¸å¿ƒé—®é¢˜ï¼š</strong></p>

<p><strong>æ—§ç‰ˆæœ¬æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ</strong></p>

<p><strong>å­˜å‚¨æ—§ç‰ˆæœ¬æ•°æ®ï¼Œå¯¹ MySQL</strong> <strong>å’Œ InnoDB</strong> <strong>åŽŸæœ‰æž¶æž„æ˜¯å¦æœ‰å·¨å¤§å†²å‡»ï¼Ÿ</strong></p>

<p>é€šè¿‡ä¸Šæ–‡ undo æ—¥å¿—å’Œå›žæ»šæ®µçš„é“ºåž«ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜å°±éžå¸¸å¥½å›žç­”äº†ï¼š</p>

<p>(1) æ—§ç‰ˆæœ¬æ•°æ®å­˜å‚¨åœ¨å›žæ»šæ®µé‡Œï¼›</p>

<p>(2) å¯¹ MySQL å’Œ InnoDB åŽŸæœ‰æž¶æž„ä½“ç³»å†²å‡»ä¸å¤§ï¼›</p>

<p>InnoDB çš„å†…æ ¸ï¼Œä¼šå¯¹æ‰€æœ‰ row æ•°æ®å¢žåŠ ä¸‰ä¸ªå†…éƒ¨å±žæ€§ï¼š</p>

<p>(1)<strong>DB_TRX_ID</strong>ï¼Œ6 å­—èŠ‚ï¼Œè®°å½•æ¯ä¸€è¡Œæœ€è¿‘ä¸€æ¬¡ä¿®æ”¹å®ƒçš„äº‹åŠ¡ IDï¼›</p>

<p>(2)<strong>DB_ROLL_PTR</strong>ï¼Œ7 å­—èŠ‚ï¼Œè®°å½•æŒ‡å‘å›žæ»šæ®µ undo æ—¥å¿—çš„æŒ‡é’ˆï¼›</p>

<p>(3)<strong>DB_ROW_ID</strong>ï¼Œ6 å­—èŠ‚ï¼Œå•è°ƒé€’å¢žçš„è¡Œ IDï¼›</p>

<p><strong>InnoDB</strong> <strong>ä¸ºä½•èƒ½å¤Ÿåšåˆ°è¿™ä¹ˆé«˜çš„å¹¶å‘ï¼Ÿ</strong></p>

<p>å›žæ»šæ®µé‡Œçš„æ•°æ®ï¼Œå…¶å®žæ˜¯åŽ†å²æ•°æ®çš„å¿«ç…§ï¼ˆsnapshotï¼‰ï¼Œè¿™äº›æ•°æ®æ˜¯ä¸ä¼šè¢«ä¿®æ”¹ï¼Œselect å¯ä»¥è‚†æ— å¿Œæƒ®çš„å¹¶å‘è¯»å–ä»–ä»¬ã€‚</p>

<p><strong>å¿«ç…§è¯»</strong>ï¼ˆSnapshot Readï¼‰ï¼Œè¿™ç§<strong>ä¸€è‡´æ€§ä¸åŠ é”çš„è¯»</strong>ï¼ˆConsistent Nonlocking Readï¼‰ï¼Œå°±æ˜¯ InnoDB å¹¶å‘å¦‚æ­¤ä¹‹é«˜çš„æ ¸å¿ƒåŽŸå› ä¹‹ä¸€ã€‚</p>

<p>è¿™é‡Œçš„<strong>ä¸€è‡´æ€§</strong>æ˜¯æŒ‡ï¼Œäº‹åŠ¡è¯»å–åˆ°çš„æ•°æ®ï¼Œè¦ä¹ˆæ˜¯äº‹åŠ¡å¼€å§‹å‰å°±å·²ç»å­˜åœ¨çš„æ•°æ®ï¼ˆå½“ç„¶ï¼Œæ˜¯å…¶ä»–å·²æäº¤äº‹åŠ¡äº§ç”Ÿçš„ï¼‰ï¼Œè¦ä¹ˆæ˜¯äº‹åŠ¡è‡ªèº«æ’å…¥æˆ–è€…ä¿®æ”¹çš„æ•°æ®ã€‚</p>

<p><strong>ä»€ä¹ˆæ ·çš„ select</strong> <strong>æ˜¯å¿«ç…§è¯»ï¼Ÿ</strong></p>

<p>é™¤éžæ˜¾ç¤ºåŠ é”ï¼Œæ™®é€šçš„ select è¯­å¥éƒ½æ˜¯å¿«ç…§è¯»ï¼Œä¾‹å¦‚ï¼š</p>

<p>select * from t where id&gt;2;</p>

<p>è¿™é‡Œçš„æ˜¾ç¤ºåŠ é”ï¼Œéžå¿«ç…§è¯»æ˜¯æŒ‡ï¼š</p>

<p>select * from t where id&gt;2 <strong>lock in share mode</strong>;</p>

<p>select * from t where id&gt;2 <strong>for update</strong>;</p>

<p>é—®é¢˜æ¥äº†ï¼Œè¿™äº›æ˜¾ç¤ºåŠ é”çš„è¯»ï¼Œæ˜¯ä»€ä¹ˆè¯»ï¼Ÿä¼šåŠ ä»€ä¹ˆé”ï¼Ÿå’Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«åˆæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>

<p>æœ¬èŠ‚çš„å†…å®¹å·²ç»å¤Ÿå¤šäº†ï¼Œä¸”å¬ä¸‹å›žåˆ†è§£ã€‚</p>

<p><strong>æ€»ç»“</strong></p>

<p>(1) å¸¸è§å¹¶å‘æŽ§åˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„æ–¹æ³•æœ‰<strong>é”</strong>ï¼Œ<strong>æ•°æ®å¤šç‰ˆæœ¬</strong>ï¼›</p>

<p>(2) <strong>æ™®é€šé”</strong>ä¸²è¡Œï¼Œ<strong>è¯»å†™é”</strong>è¯»è¯»å¹¶è¡Œï¼Œ<strong>æ•°æ®å¤šç‰ˆæœ¬</strong>è¯»å†™å¹¶è¡Œï¼›</p>

<p>(3)<strong>redo æ—¥å¿—</strong>ä¿è¯å·²æäº¤äº‹åŠ¡çš„ ACID ç‰¹æ€§ï¼Œè®¾è®¡æ€è·¯æ˜¯ï¼Œé€šè¿‡é¡ºåºå†™æ›¿ä»£éšæœºå†™ï¼Œæé«˜å¹¶å‘ï¼›</p>

<p>(4)<strong>undo æ—¥å¿—</strong>ç”¨æ¥å›žæ»šæœªæäº¤çš„äº‹åŠ¡ï¼Œå®ƒå­˜å‚¨åœ¨å›žæ»šæ®µé‡Œï¼›</p>

<p>(5)InnoDB æ˜¯åŸºäºŽ <strong>MVCC</strong> çš„å­˜å‚¨å¼•æ“Žï¼Œå®ƒåˆ©ç”¨äº†å­˜å‚¨åœ¨å›žæ»šæ®µé‡Œçš„ undo æ—¥å¿—ï¼Œå³æ•°æ®çš„æ—§ç‰ˆæœ¬ï¼Œæé«˜å¹¶å‘ï¼›</p>

<p>(6)InnoDB ä¹‹æ‰€ä»¥å¹¶å‘é«˜ï¼Œå¿«ç…§è¯»ä¸åŠ é”ï¼›</p>

<p>(7)InnoDB æ‰€æœ‰æ™®é€š select éƒ½æ˜¯å¿«ç…§è¯»ï¼›</p>

<p><u>ç”»å¤–éŸ³ï¼šæœ¬æ–‡çš„çŸ¥è¯†ç‚¹å‡åŸºäºŽ MySQL5.6ã€‚</u></p>

<p>å¸Œæœ›å¤§å®¶æœ‰æ”¶èŽ·ï¼Œä¸‹ä¸€ç¯‡ç»§ç»­æ·±å…¥ InnoDB çš„<strong>é”</strong>ã€‚</p>

<p>å¸Œæœ›é€šä¿—çš„æŠ€æœ¯æ–‡è¢«æ›´å¤šäººçœ‹åˆ°ï¼Œæ±‚å¸®<strong>è½¬</strong>ã€‚</p>

<p>ç›¸å…³æ–‡ç« ï¼š</p>

<p>ã€Š<a href="http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651961428&amp;idx=1&amp;sn=31a9eb967941d888fbd4bb2112e9602b&amp;chksm=bd2d0d888a5a849e7ebaa7756a8bc1b3d4e2f493f3a76383fc80f7e9ce7657e4ed2f6c01777d&amp;scene=21#wechat_redirect">InnoDBï¼Œ5 é¡¹æœ€ä½³å®žè·µï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶ï¼Ÿ</a>ã€‹</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ¥è‡ªNetflixçš„ç³»ç»Ÿé«˜å¯ç”¨å»ºè®®]]></title>
    <link href="http://panlw.github.io/15342609315238.html"/>
    <updated>2018-08-14T23:35:31+08:00</updated>
    <id>http://panlw.github.io/15342609315238.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="http://www.infoq.com/cn/articles/tips-for-high-availability">http://www.infoq.com/cn/articles/tips-for-high-availability</a></p>
</blockquote>

<p>åœ¨è¿‡åŽ»å››å¹´ä¸­ï¼ŒNetflix å·²ä»Žä¸åˆ° 5000 ä¸‡ç”¨æˆ·å¢žåŠ åˆ° 1.25 äº¿ç”¨æˆ·ã€‚è¿™ç§å¢žé•¿ç»™æˆ‘ä»¬å¸¦æ¥äº†ä¼¸ç¼©æ€§æ–¹é¢çš„æŒ‘æˆ˜ï¼Œä½†å®žé™…ä¸Šï¼Œæˆ‘ä»¬å·²ç»è®¾æ³•åœ¨è¿™æ®µæ—¶é—´å†…æé«˜äº†æœåŠ¡çš„æ•´ä½“å¯ç”¨æ€§ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œæˆ‘ä»¬ä¹Ÿæ›´åŠ æ˜Žç™½è¯¥å¦‚ä½•æå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ä½†å¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œè¿™äº›ç»éªŒæ¥ä¹‹ä¸æ˜“ï¼šåœ¨å‡ºçŽ°é—®é¢˜æ—¶æˆ‘ä»¬å¿™æˆä¸€å›¢ï¼Œæœ‰æ—¶å€™è¿˜è¦å¤„ç†ç”¨æˆ·äº‹ä»¶ã€‚å°½ç®¡æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œå…¨æ‰«æ¸…æ‰€æœ‰çš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä»ç„¶è¿˜æœ‰å¾ˆå¤šå¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Œä½†æˆ‘ä»¬åˆ†äº«çš„è¿™äº›ç»éªŒéƒ½æ˜¯ä»Žå®žæˆ˜ä¸­æ€»ç»“å‡ºæ¥çš„ã€‚å¸Œæœ›ä½ ä»¬èƒ½å¤Ÿä»Žä¸­æ”¶èŽ·ç‚¹ä»€ä¹ˆï¼Œä»¥å…åœ¨å‡Œæ™¨ä¸‰ç‚¹é’Ÿæ”¶åˆ°è¦ä½ èµ·åºŠå¤„ç†ç”¨æˆ·äº‹ä»¶çš„ç”µè¯ã€‚</p>

<p>åœ¨ Netflixï¼Œæˆ‘ä»¬ä½¿ç”¨ Spinnaker ä½œä¸ºæŒç»­é›†æˆå’Œäº¤ä»˜çš„å¹³å°ã€‚è¿™é‡Œè®¨è®ºçš„å¾ˆå¤šæœ€ä½³å®žè·µéƒ½å·²çº³å…¥åˆ° Spinnaker ä¸­ï¼Œè¿™äº›æŠ€å·§å’Œæœ€ä½³å®žè·µå…·æœ‰é€šç”¨æ€§ï¼Œå°†å¸®åˆ°ä»»ä½•æƒ³è¦æå‡ç³»ç»Ÿå¯ç”¨æ€§çš„äººã€‚</p>

<h2 id="toc_0">ä¼˜å…ˆè€ƒè™‘åŒºåŸŸéƒ¨ç½²è€Œä¸æ˜¯å…¨çƒéƒ¨ç½²</h2>

<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°½å¯èƒ½æä¾›æœ€ä½³çš„å®¢æˆ·ä½“éªŒã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦é™åˆ¶ç³»ç»Ÿå˜æ›´çš„å½±å“èŒƒå›´ï¼Œå¯¹å˜æ›´è¿›è¡ŒéªŒè¯ï¼Œç„¶åŽå°†å˜æ›´æŽ¨ç»™å®¢æˆ·ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œæˆ‘ä»¬ä¸€æ¬¡åªéƒ¨ç½²ä¸€ä¸ª AWS åŒºåŸŸï¼Œè¿™ä¸ºæˆ‘ä»¬çš„ç”Ÿäº§éƒ¨ç½²æä¾›äº†é¢å¤–çš„å®‰å…¨ä¿éšœã€‚æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿåœ°è½¬ç§»å—å½±å“çš„å®¢æˆ·æµé‡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æœ€é‡è¦çš„å››å¤§è¡¥æ•‘æ‰‹æ®µä¹‹ä¸€ã€‚</p>

<p>æˆ‘ä»¬è¿˜å»ºè®®åœ¨æ¯ä¸ªåŒºåŸŸéƒ¨ç½²ä¹‹é—´å¯¹åº”ç”¨ç¨‹åºåŠŸèƒ½è¿›è¡ŒéªŒè¯ï¼Œå¹¶é¿å…åœ¨ç›®æ ‡åŒºåŸŸçš„é«˜å³°æ—¶æ®µè¿›è¡Œéƒ¨ç½²ã€‚</p>

<p>åœ¨ Spinnaker ä¸­ï¼ŒæŒ‡å®šéƒ¨ç½²çš„ç›®æ ‡åŒºåŸŸéžå¸¸ç®€å•ã€‚</p>

<p>ï»¿<a href="https://s3.amazonaws.com/infoq.content.live.0/articles/tips-for-high-availability/zh/resources/12111-1533721785047.png"><img src="https://res.infoq.com/articles/tips-for-high-availability/zh/resources/12111-1533721785047.png" alt=""/></a>ï»¿</p>

<h2 id="toc_1">ä½¿ç”¨çº¢é»‘éƒ¨ç½²ç­–ç•¥è¿›è¡Œç”Ÿäº§éƒ¨ç½²</h2>

<p>åœ¨çº¢é»‘ï¼ˆä¹Ÿç§°ä¸ºè“ç»¿ï¼‰éƒ¨ç½²ä¸­ï¼Œæ–°ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼ˆçº¢è‰²ï¼‰åœ¨é€šè¿‡å¥åº·æ£€æŸ¥ä¹‹åŽç«‹å³å¼€å§‹æŽ¥æ”¶æµé‡ã€‚åœ¨ç¡®å®šçº¢è‰²ç‰ˆæœ¬çš„å¥åº·çŠ¶æ€ä¹‹åŽï¼Œä¹‹å‰çš„ï¼ˆé»‘è‰²ï¼‰ç‰ˆæœ¬å°†è¢«ç¦ç”¨ï¼Œå¹¶ä¸”ä¸ä¼šæ”¶åˆ°ä»»ä½•æµé‡ã€‚å¦‚æžœè¦å›žæ»šï¼Œåªéœ€è¦å¯ç”¨ä»¥å‰çš„ç‰ˆæœ¬å³å¯ï¼Œéžå¸¸ç®€å•ã€‚è¿™ç§æ¨¡åž‹åŠ å¿«äº†æˆ‘ä»¬çš„éƒ¨ç½²æµç¨‹ï¼Œå¹¶å¯ä»¥åœ¨å‡ºçŽ°é—®é¢˜æ—¶å›žæ»šåˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚</p>

<p>è¦ä½¿ç”¨ Spinnaker å®Œæˆçº¢é»‘éƒ¨ç½²ï¼Œåªéœ€è¦åœ¨ç®¡é“ä¸­æŒ‡å®šç­–ç•¥ï¼ˆå¹¶å¯é€‰æ‹©æ€§åœ°åœ¨ç­–ç•¥ä¸­è®¾ç½®å‚æ•°ï¼‰ï¼ŒSpinnaker å°†è´Ÿè´£å®Œæˆéƒ¨ç½²ã€‚</p>

<p>ï»¿<a href="https://s3.amazonaws.com/infoq.content.live.0/articles/tips-for-high-availability/zh/resources/12612-1533721785745.png"><img src="https://res.infoq.com/articles/tips-for-high-availability/zh/resources/12612-1533721785745.png" alt=""/></a>ï»¿</p>

<h2 id="toc_2">ä½¿ç”¨éƒ¨ç½²çª—å£</h2>

<p>æ¯å½“ä½ åœ¨éƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨æ—¶ï¼Œéƒ½è¦è®°ä½ä»¥ä¸‹ä¸¤ç‚¹ï¼šé¦–å…ˆï¼Œä½ ï¼ˆæˆ–ä½ çš„åŒäº‹ï¼‰æ˜¯å¦æœ‰ç›‘æŽ§éƒ¨ç½²ï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œè¡¥æ•‘ï¼Ÿç¬¬äºŒï¼Œå¦‚æžœå‡ºçŽ°äº†é—®é¢˜ï¼Œä½ æ˜¯å¦èƒ½å¤Ÿå°½å¯èƒ½å‡å°å½±å“èŒƒå›´ï¼Ÿ</p>

<p>æˆ‘ä»¬çš„æµåª’ä½“æµé‡éµå¾ªç›¸å¯¹å¯é¢„æµ‹çš„æ¨¡å¼ï¼Œå¤§å¤šæ•°äººä¼šåœ¨æ™šä¸Šæ‰“å¼€è§†é¢‘æµã€‚å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®é€‰æ‹©å·¥ä½œæ—¶æ®µå’Œéžé«˜å³°æ—¶æ®µçš„éƒ¨ç½²çª—å£ã€‚</p>

<p>Spinnaker ä¸ºæ­¤æä¾›äº†ä¸€ä¸ªç•Œé¢ï¼Œè®©æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æŒ‡å®šè¿è¡Œéƒ¨ç½²ç®¡é“çš„æ—¥æœŸå’Œæ—¶é—´ã€‚</p>

<p>ï»¿<a href="https://s3.amazonaws.com/infoq.content.live.0/articles/tips-for-high-availability/zh/resources/413-1533721787411.jpeg"><img src="https://res.infoq.com/articles/tips-for-high-availability/zh/resources/413-1533721787411.jpeg" alt=""/></a>ï»¿</p>

<h2 id="toc_3">ç¡®ä¿ä¸è¦åœ¨éžå·¥ä½œæ—¶æ®µæˆ–å‘¨æœ«è‡ªåŠ¨è§¦å‘éƒ¨ç½²</h2>

<p>éƒ¨ç½²çª—å£ä¹Ÿé€‚ç”¨äºŽè‡ªåŠ¨è§¦å‘çš„äº‹ä»¶ã€‚åœ¨ Spinnaker ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ cron è¡¨è¾¾å¼ä½œä¸ºç®¡é“è§¦å‘å™¨ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªå†’é™©çš„ç­–ç•¥ï¼šæœ‰äº› cron è¡¨è¾¾å¼å¯èƒ½ä¼šåœ¨éžå·¥ä½œæ—¶æ®µæˆ–å‘¨æœ«æ‰§è¡Œç®¡é“ï¼Œä½†è¿™ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚æ— è®ºä½ ä½¿ç”¨å“ªä¸€ç§è‡ªåŠ¨åŒ–æœºåˆ¶ï¼Œéƒ½è¦ç¡®ä¿ä»»ä½•è‡ªåŠ¨è§¦å‘çš„ç®¡é“éƒ½å¯ä»¥åœ¨æ— äººå€¼å®ˆçš„æ¨¡å¼ä¸‹è¿è¡Œã€‚</p>

<p>ï»¿<a href="https://s3.amazonaws.com/infoq.content.live.0/articles/tips-for-high-availability/zh/resources/8914-1533721784600.png"><img src="https://res.infoq.com/articles/tips-for-high-availability/zh/resources/8914-1533721784600.png" alt=""/></a>ï»¿</p>

<h2 id="toc_4">å¯ç”¨ Chaos Monkey</h2>

<p>Chaos Monkey ç”± Netflix åˆ›å»ºå¹¶å¼€æºï¼Œæ˜¯æˆ‘ä»¬æ··æ²Œå·¥ç¨‹å·¥å…·å¥—ä»¶çš„ä¸€éƒ¨åˆ†ã€‚Chaos Monkey ä»¥ä¸å¯é¢„æµ‹çš„æ–¹å¼éšæœºç»ˆæ­¢ç”Ÿäº§çŽ¯å¢ƒä¸­çš„å®žä¾‹ï¼Œä»¥æ­¤æ¥å¢žå¼ºæœåŠ¡ï¼Œè®©æœåŠ¡å…·å¤‡åº”å¯¹å•å®žä¾‹æ•…éšœçš„å¼¹æ€§èƒ½åŠ›ã€‚å¦‚æžœæŸäº›æœåŠ¡ä¸å…·å¤‡å¼¹æ€§èƒ½åŠ›ï¼ŒChaos Monkey å°†ä¼šæš´éœ²å‡ºå®ƒä»¬çš„æ¼æ´žï¼ŒæœåŠ¡æ‰€æœ‰è€…å°±å¯ä»¥åœ¨è¿™äº›æ¼æ´žæ¼”å˜æˆå½±å“ç”¨æˆ·çš„äº‹æ•…ä¹‹å‰ä¿®å¤å®ƒä»¬ã€‚åœ¨ Netflixï¼Œç”Ÿäº§çŽ¯å¢ƒä¸­çš„æ‰€æœ‰æœåŠ¡éƒ½åº”è¯¥å¯ç”¨ Chaos Monkeyï¼Œåœ¨ Chaos Monkey ç»ˆæ­¢åº”ç”¨ç¨‹åºå®žä¾‹æ—¶ï¼ŒæœåŠ¡æ‰€æœ‰è€…ä¸åº”è¯¥æ£€æµ‹åˆ°ä»»ä½•é—®é¢˜ã€‚</p>

<p>ï»¿ï»¿<a href="https://s3.amazonaws.com/infoq.content.live.0/articles/tips-for-high-availability/zh/resources/7415-1533721786316.png"><img src="https://res.infoq.com/articles/tips-for-high-availability/zh/resources/7415-1533721786316.png" alt=""/></a></p>

<h2 id="toc_5">åœ¨å°†ä»£ç æŽ¨é€åˆ°ç”Ÿäº§çŽ¯å¢ƒä¹‹å‰ä½¿ç”¨å„ç§æµ‹è¯•å’Œé‡‘ä¸é›€åˆ†æžæ¥éªŒè¯ä»£ç </h2>

<p>å®žçŽ°å¿«é€Ÿéƒ¨ç½²çš„å…³é”®æ˜¯åœ¨éƒ¨ç½²ä¹‹å‰è‡ªåŠ¨éªŒè¯æ–°ç‰ˆæœ¬çš„è½¯ä»¶ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å¿…è¦çš„æµ‹è¯•å¥—ä»¶éƒ½åº”è¯¥åœ¨æ²¡æœ‰äººå·¥å¹²é¢„çš„æƒ…å†µä¸‹è¿è¡Œã€‚</p>

<p>ï»¿<a href="https://s3.amazonaws.com/infoq.content.live.0/articles/tips-for-high-availability/zh/resources/5616-1533721787677.png"><img src="https://res.infoq.com/articles/tips-for-high-availability/zh/resources/5616-1533721787677.png" alt=""/></a>ï»¿</p>

<p>æ­¤å¤–ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨é‡‘ä¸é›€åˆ†æžã€‚é‡‘ä¸é›€åˆ†æžæ˜¯ä¸€ç§é€šè¿‡å®žæ—¶æµé‡æ¥éªŒè¯æœåŠ¡å˜æ›´çš„æœ‰æ•ˆæ–¹æ³•ã€‚æœ€è¿‘æˆ‘ä»¬å¼€æºäº†å†…éƒ¨å·¥å…· Kayentaï¼Œå®ƒå¯ä»¥è½»æ¾é›†æˆåˆ° Spinnaker ä¸­ï¼Œå¹¶ç»“åˆäººå·¥åˆ¤æ–­ï¼Œæˆä¸ºæ”¾å¼€æ‰€æœ‰ç”Ÿäº§æµé‡ä¹‹å‰çš„æœ€åŽä¸€é“é—¨æ§›ã€‚</p>

<p>ï»¿<a href="https://s3.amazonaws.com/infoq.content.live.0/articles/tips-for-high-availability/zh/resources/5217-1533721786866.png"><img src="https://res.infoq.com/articles/tips-for-high-availability/zh/resources/5217-1533721786866.png" alt=""/></a>ï»¿</p>

<h2 id="toc_6">å¿…è¦çš„äººå·¥å¹²é¢„</h2>

<p>å°½å¯èƒ½ä½¿ç”¨è‡ªåŠ¨åŒ–ï¼Œä½†åœ¨å¿…è¦çš„æ—¶å€™ä¹Ÿéœ€è¦äººå·¥å¹²é¢„ã€‚ä¾‹å¦‚ï¼Œåœ¨å°†æ–°ç‰ˆæœ¬æŽ¨å‘ç”Ÿäº§çŽ¯å¢ƒä¹‹å‰éœ€è¦æ£€æŸ¥é‡‘ä¸é›€è¿è¡Œçš„ç»“æžœã€‚</p>

<p>ï»¿<a href="https://s3.amazonaws.com/infoq.content.live.0/articles/tips-for-high-availability/zh/resources/4618-1533721785369.png"><img src="https://res.infoq.com/articles/tips-for-high-availability/zh/resources/4618-1533721785369.png" alt=""/></a>ï»¿</p>

<h2 id="toc_7">åœ¨éƒ¨ç½²æ—¶å°½å¯èƒ½åªç”¨å·²ç»æµ‹è¯•è¿‡çš„ä¸œè¥¿</h2>

<p>æ—¢ç„¶ä½ å·²ç»å¯¹æ–°ç‰ˆæœ¬è¿›è¡Œäº†å¤§é‡çš„æµ‹è¯•å’ŒéªŒè¯ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ åœ¨è¿›è¡Œç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²æ—¶åªç”¨æµ‹è¯•è¿‡çš„ä¸œè¥¿ã€‚å¯¹äºŽæˆ‘ä»¬æ¥è¯´ï¼Œæˆ‘ä»¬æ›´å€¾å‘äºŽä»Žæµ‹è¯•çŽ¯å¢ƒä¸­å¤åˆ¶ç»è¿‡éªŒè¯çš„é•œåƒï¼Œè€Œä¸æ˜¯é‡æ–°æž„å»ºæ–°çš„é•œåƒã€‚</p>

<h2 id="toc_8">å®šæœŸæ£€æŸ¥è”ç³»äººè®¾ç½®</h2>

<p>æœ‰æ—¶å€™ï¼Œä¸ºäº†ç¡®ä¿åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§ï¼Œä½ æ‰€è¦åšçš„å…¶å®žå¾ˆç®€å•ã€‚å¦‚æžœä½ çš„åº”ç”¨ç¨‹åºä¼šå‡ºé—®é¢˜ï¼Œå¹¶ä¸”å¾ˆå¯èƒ½ä¼šåœ¨æŸä¸ªæ—¶é—´ç‚¹å‡ºé—®é¢˜ï¼Œé‚£ä¹ˆæ­¤æ—¶æœ€é‡è¦çš„æ˜¯æ‰¾åˆ°èƒ½è§£å†³é—®é¢˜çš„äººã€‚å› æ­¤ï¼Œè¯·å®šæœŸæ£€æŸ¥ä½ çš„è”ç³»äººè®¾ç½®ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿åœ¨å‘ç”Ÿäº‹æ•…æ—¶èƒ½å¤Ÿè¿…é€Ÿæ‰¾åˆ°è§£å†³é—®é¢˜çš„äººã€‚</p>

<p>ï»¿<a href="https://s3.amazonaws.com/infoq.content.live.0/articles/tips-for-high-availability/zh/resources/3819-1533721783682.png"><img src="https://res.infoq.com/articles/tips-for-high-availability/zh/resources/3819-1533721783682.png" alt=""/></a>ï»¿</p>

<p>Spinnaker æä¾›äº†ä¸€ä¸ª â€œPage application ownerâ€ æŒ‰é’®ï¼Œè¯·ç¡®ä¿è¿™é‡Œé…ç½®çš„ä¿¡æ¯æ˜¯æœ€æ–°çš„ï¼Œè¿™æ ·å°±ä¸ä¼šåœ¨å‘ç”Ÿé—®é¢˜æ—¶æ‰¾é”™äººã€‚</p>

<h2 id="toc_9">çŸ¥é“å¦‚ä½•å¿«é€Ÿå›žæ»šéƒ¨ç½²</h2>

<p>å³ä½¿æœ‰å¯é çš„æµ‹è¯•ã€é‡‘ä¸é›€å’Œå…¶ä»–éªŒè¯è¿‡ç¨‹ï¼Œå°†æŸäº›ä¸œè¥¿éƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒä¸­ä»ç„¶ä¼šå‡ºçŽ°é—®é¢˜ã€‚ä¹Ÿè®¸è¿™æ˜¯ä¸€ç§ç”±ç«žæ€æ¡ä»¶å¯¼è‡´çš„ç½•è§é”™è¯¯ï¼Œåªä¼šåœ¨è¾¾åˆ°ä¸€å®šè§„æ¨¡æ—¶æ‰å‘ç”Ÿã€‚ä½†æ— è®ºæ˜¯ä½•ç§æƒ…å†µï¼Œæœ€é‡è¦çš„æ˜¯ä½ è¦çŸ¥é“åœ¨å¿…è¦æ—¶å¦‚ä½•å¿«é€Ÿæ¢å¤åˆ°ä¹‹å‰æ­£å¸¸çš„çŠ¶æ€ã€‚</p>

<p>åœ¨ Spinnaker ä¸­ï¼Œå¦‚æžœåº”ç”¨ç¨‹åºçš„æ–°ç‰ˆæœ¬å‡ºçŽ°é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ â€œServer Groupâ€ ä¸‹çš„ â€œRollbackâ€ é€‰é¡¹è¿›è¡Œå›žæ»šã€‚å›žæ»šå°†å¯ç”¨ä½ é€‰æ‹©çš„ ASGï¼ˆé€šå¸¸æ˜¯ä¹‹å‰çš„ï¼‰ï¼Œå¹¶ç¦ç”¨å‘ç”Ÿæ•…éšœçš„ ASGã€‚Spinnaker è¿˜æ”¯æŒåˆ›å»ºå¯åœ¨å‘ç”Ÿç®¡é“æ•…éšœæ—¶æ‰§è¡Œæˆ–é€šè¿‡æ‰‹åŠ¨è§¦å‘çš„å›žæ»šç®¡é“ã€‚</p>

<p>ï»¿<a href="https://s3.amazonaws.com/infoq.content.live.0/articles/tips-for-high-availability/zh/resources/320-1533721786579.jpeg"><img src="https://res.infoq.com/articles/tips-for-high-availability/zh/resources/320-1533721786579.jpeg" alt=""/></a>ï»¿</p>

<h2 id="toc_10">å¦‚æžœå®žä¾‹è¿è¡Œä¸æ­£å¸¸ï¼Œå°†éƒ¨ç½²è§†ä¸ºå¤±è´¥</h2>

<p>å¤šå¹´æ¥ï¼Œæœ‰å‡ æ¬¡æˆ‘ä»¬åœ¨éƒ¨ç½²æˆåŠŸåŽæ„Ÿè§‰çŠ¶æ€ä¸å¯¹ï¼Œå®žä¾‹èµ·æ¥äº†ï¼Œä½†ä¸èƒ½æ­£å¸¸å¤„ç†æµé‡ã€‚â€œæˆåŠŸâ€ çš„éƒ¨ç½²ç»™æˆ‘ä»¬é€ æˆäº†ä¸€ç§å‡è±¡ï¼Œå½“ä¸€ä¸ªå…³é”®çš„æœåŠ¡è¿è¡Œä¸æ­£å¸¸æ—¶ï¼Œè¯·æ±‚å¾ˆå¿«ä¼šå †ç§¯èµ·æ¥ï¼Œæœ‰æ—¶ä¼šå¯¼è‡´é‡è¯•é›ªå´©ï¼Œé€ æˆå„ç§å„æ ·çš„ç ´åã€‚å› æ­¤ï¼Œå½“å®žä¾‹è¿è¡Œä¸æ­£å¸¸æ—¶ï¼Œè¦å°†éƒ¨ç½²è§†ä¸ºå¤±è´¥ã€‚</p>

<p>Spinnaker æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹æ³•ç”¨äºŽå…³è”å®žä¾‹çš„å¥åº·çŠ¶å†µã€‚å½“ä¸€ä¸ªå®žä¾‹ä¸å¥åº·æ—¶ï¼ŒSpinnaker ä¼šå°†å…¶æ ‡æ³¨å‡ºæ¥ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œä¸å¥åº·çš„å®žä¾‹å°†æ”¶ä¸åˆ°æµé‡ã€‚å¦‚æžœ ASG ä¸­çš„æ‰€æœ‰å®žä¾‹éƒ½ä¸å¥åº·ï¼ŒSpinnaker ä¼šå°†éƒ¨ç½²è§†ä¸ºå¤±è´¥ã€‚Spinnaker è¿˜ç”¨ä¸åŒçš„é¢œè‰²æ¥æ ‡è®°å®žä¾‹çš„çŠ¶æ€ï¼Œå¦‚å¯åŠ¨ä¸­ã€ç­‰å¾…å‘çŽ°ã€ä¸å¥åº·å’Œå¥åº·ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>

<p>ï»¿<a href="https://s3.amazonaws.com/infoq.content.live.0/articles/tips-for-high-availability/zh/resources/8221-1533721786054.png"><img src="https://res.infoq.com/articles/tips-for-high-availability/zh/resources/8221-1533721786054.png" alt=""/></a>ï»¿</p>

<h2 id="toc_11">åœ¨è¿›è¡Œè‡ªåŠ¨éƒ¨ç½²æ—¶ï¼Œéœ€è¦é€šçŸ¥å›¢é˜Ÿæœ‰å…³éƒ¨ç½²çš„æƒ…å†µ</h2>

<p>è®©äººä»¬çŸ¥é“éƒ¨ç½²å·²æˆåŠŸè¿›å…¥ç”Ÿäº§çŽ¯å¢ƒï¼Œè¿™å¯¹æˆåŠŸçš„è¿ç»´æ¥è¯´è‡³å…³é‡è¦ã€‚åœ¨å‡ºçŽ°é—®é¢˜æ—¶ï¼Œéœ€è¦çŸ¥é“å‘ç”Ÿäº†å“ªäº›å˜æ›´ä»¥åŠè¿™äº›å˜æ›´æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„ã€‚å› æ­¤ï¼Œåœ¨è¿›è¡Œè‡ªåŠ¨éƒ¨ç½²æ—¶ï¼Œéœ€è¦é€šçŸ¥å›¢é˜Ÿï¼Œè®©ä»–ä»¬å¯†åˆ‡å…³æ³¨æœåŠ¡çš„å¥åº·çŠ¶å†µã€‚åœ¨ Netflixï¼Œæˆ‘ä»¬ä½¿ç”¨ Slack å‘é€é€šçŸ¥ã€‚åœ¨ Spinnaker ä¸­ï¼Œç®¡é“å¯ä»¥åœ¨éƒ¨ç½²å®Œæˆæ—¶é€šçŸ¥ç›¸åº”çš„ Slack é¢‘é“ã€‚</p>

<p>ï»¿<a href="https://s3.amazonaws.com/infoq.content.live.0/articles/tips-for-high-availability/zh/resources/6422-1533721787145.png"><img src="https://res.infoq.com/articles/tips-for-high-availability/zh/resources/6422-1533721787145.png" alt=""/></a>ï»¿</p>

<h2 id="toc_12">è‡ªåŠ¨åŒ–éžå…¸åž‹éƒ¨ç½²ï¼Œè€Œä¸æ˜¯è¿›è¡Œä¸€æ¬¡æ€§æ‰‹åŠ¨éƒ¨ç½²</h2>

<p>æ¯ä¸ªå·¥ç¨‹å¸ˆéƒ½ä¸ºéžå…¸åž‹æƒ…å†µç¼–å†™è¿‡ä¸€æ¬¡æ€§è„šæœ¬ã€‚è€Œå½“è¿™ç±» â€œä¸€æ¬¡æ€§â€ æƒ…å†µå†æ¬¡å‘ç”Ÿæ—¶ï¼Œå›¢é˜Ÿçš„å…¶ä»–æˆå‘˜å¹¶ä¸çŸ¥é“å†™è„šæœ¬çš„é‚£ä¸ªå·¥ç¨‹å¸ˆåœ¨è„šæœ¬é‡Œéƒ½å¹²äº†ä»€ä¹ˆï¼Œå› ä¸ºè„šæœ¬æœ¬æ¥æ˜¯æ‰“ç®—è¿è¡Œä¸€æ¬¡å°±ä¸¢æŽ‰çš„ï¼å¾ˆå¤šäººéƒ½é‡åˆ°è¿‡è¿™ç§æƒ…å†µã€‚</p>

<p>ç®¡é“æ˜¯è‡ªåŠ¨æ‰§è¡Œä¸€ç³»åˆ—æ­¥éª¤çš„æœ‰æ•ˆæ‰‹æ®µï¼Œå³ä½¿æœ‰äº›æ­¥éª¤å¹¶ä¸ä¼šæ¯å¤©éƒ½æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨äºŽç´§æ€¥æŽ¨é€çš„ç®¡é“ï¼Œå®ƒä½¿ç”¨å‚æ•°ä½œä¸ºæŽ§åˆ¶æ‰§è¡Œçš„æ¡ä»¶ï¼ˆæ¯”å¦‚è·³è¿‡éƒ¨ç½²çª—å£ï¼‰ã€‚</p>

<p>ä¸è¦å¿˜è®°å®šæœŸæµ‹è¯•éžå…³é”®åœºæ™¯çš„éžå…¸åž‹ï¼ˆå’Œå…¸åž‹ï¼‰éƒ¨ç½²ç®¡é“ï¼</p>

<h2 id="toc_13">ä½¿ç”¨å…ˆå†³æ¡ä»¶éªŒè¯é¢„æœŸçŠ¶æ€</h2>

<p>çŽ°å¦‚ä»Šï¼Œç³»ç»Ÿç»å¸¸å‘ç”Ÿå˜åŒ–æ˜¯å¸¸æ€ã€‚åœ¨ Netflixï¼Œæˆ‘ä»¬çš„æ•°ç™¾ä¸ªå¾®æœåŠ¡åœ¨ä¸æ–­å‘ç”Ÿå˜åŒ–ã€‚åšå‡ºæ— æ ¹æ®çš„å‡è®¾ï¼ˆæ¯”å¦‚å‡è®¾å…¶ä»–ç³»ç»Ÿçš„çŠ¶æ€ï¼‰æ˜¯å¾ˆå±é™©çš„ã€‚æˆ‘ä»¬çŽ°åœ¨ä½¿ç”¨å…ˆå†³æ¡ä»¶æ¥ç¡®ä¿åœ¨éƒ¨ç½²æ–°ä»£ç æˆ–è¿›è¡Œå…¶ä»–å˜æ›´æ—¶å‡è®¾ä»ç„¶æœ‰æ•ˆã€‚è¿™å¯¹äºŽé•¿æ—¶é—´æ‰§è¡Œçš„ç®¡é“ï¼ˆå¯èƒ½æ˜¯å› ä¸ºäººå·¥åˆ¤æ–­æˆ–éƒ¨ç½²çª—å£é€ æˆå»¶è¿Ÿï¼‰æ¥è¯´å°¤ä¸ºé‡è¦ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å‘ç”Ÿæ½œåœ¨çš„ç ´åæ€§æ“ä½œä¹‹å‰ä½¿ç”¨å…ˆå†³æ¡ä»¶æ¥éªŒè¯é¢„æœŸçš„çŠ¶æ€ã€‚</p>

<h2 id="toc_14">ç»“è®º</h2>

<p>è¿™ç¯‡æ–‡ç« æ€»ç»“äº†æˆ‘ä»¬å¤šå¹´æ¥åœ¨ Netflix ç§¯ç´¯çš„å„ç§æŠ€å·§å’Œæœ€ä½³å®žè·µã€‚æˆ‘ä»¬çš„æ–¹æ³•æ˜¯å°½å¯èƒ½å›´ç»•è¿™äº›æœ€ä½³å®žè·µæž„å»ºå·¥å…·ã€‚æˆ‘ä»¬å§‹ç»ˆæŠŠæé«˜æœåŠ¡å¯ç”¨æ€§ä½œä¸ºç›®æ ‡ã€‚åœ¨çœŸæ­£éœ€è¦äººå·¥å¹²é¢„æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šä»‹å…¥ï¼Œå¦åˆ™å°±ä¸æ’æ‰‹ã€‚å·¥ç¨‹å¸ˆçš„æ—¶é—´ç”¨åœ¨äº†é‚£äº›å¯ä»¥æé«˜å¯ç”¨æ€§çš„ä»»åŠ¡ä¸Šï¼Œè€Œåœ¨ä¸éœ€è¦ä»–ä»¬å‚ä¸Žçš„æƒ…å†µä¸‹ï¼Œä»–ä»¬å¯ä»¥ä¸“æ³¨å…¶ä»–äº‹æƒ…ã€‚</p>

<p>è‹±æ–‡åŽŸæ–‡ï¼š<a href="https://medium.com/@NetflixTechBlog/tips-for-high-availability-be0472f2599c">https://medium.com/@NetflixTechBlog/tips-for-high-availability-be0472f2599c</a></p>

<p><input type="hidden"></p>

<p>ç›¸å…³å†…å®¹</p>

<h3 id="toc_15"><a href="http://www.infoq.com/cn/articles/how-netflix-does-failovers-7-minutes-flat?utm_source=infoq&amp;utm_medium=related_content_link&amp;utm_campaign=relatedContent_undefined_clk">Netflix å¦‚ä½•åœ¨ 7 åˆ†é’Ÿå†…å®Œæˆå¤±æ•ˆå¤‡æ´</a></h3>

<h3 id="toc_16"><a href="http://www.infoq.com/cn/articles/mysql-high-availability-at-github?utm_source=infoq&amp;utm_medium=related_content_link&amp;utm_campaign=relatedContent_undefined_clk">GitHub çš„ MySQL é«˜å¯ç”¨æ€§å®žè·µ</a></h3>

<h3 id="toc_17"><a href="http://www.infoq.com/cn/articles/netflix-what-happens-when-you-press-play?utm_source=infoq&amp;utm_medium=related_content_link&amp;utm_campaign=relatedContent_undefined_clk">Netflix: å½“ä½ æŒ‰ä¸‹ â€œæ’­æ”¾â€ çš„æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</a></h3>

<h3 id="toc_18"><a href="http://www.infoq.com/cn/news/2018/05/netflix-zuul2?utm_source=infoq&amp;utm_medium=related_content_link&amp;utm_campaign=relatedContent_undefined_clk">Netflix æ­£å¼å¼€æºå…¶ API ç½‘å…³ Zuul 2</a></h3>

<h3 id="toc_19"><a href="http://www.infoq.com/cn/presentations/the-practice-of-open-source-distributed-monitoring-cat-system?utm_source=infoq&amp;utm_medium=related_content_link&amp;utm_campaign=relatedContent_undefined_clk">å¼€æºåˆ†å¸ƒå¼ç›‘æŽ§ CAT ç³»ç»Ÿçš„é«˜å¯ç”¨å®žè·µ</a></h3>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[5 Reasons and 101 Bugfixes â€“ Why You Should Use Hibernate 5.3]]></title>
    <link href="http://panlw.github.io/15342604876749.html"/>
    <updated>2018-08-14T23:28:07+08:00</updated>
    <id>http://panlw.github.io/15342604876749.html</id>
    <content type="html"><![CDATA[
<p>Hibernate 5.3 is available for a little more than 3 months now, and last week, the team released the <a href="http://in.relation.to/2018/07/24/hibernate-orm-533-final-out/">3rd maintenanceÂ release</a>. So, itâ€™s about time to take a closer look at the new version.</p>

<p>In addition to more than 100 bug fixes, Hibernate 5.3 includes a few features and improvements that might motivate you to update your current project.</p>

<h2 id="toc_0">Improved Memory consumption</h2>

<p>Letâ€™s start with probably the best reason to update to Hibernate 5.3: It consumes less memory than the previous versions.</p>

<p>The improvement was triggered by an interesting discussion in theÂ <a href="https://discourse.hibernate.org/t/batch-fetch-style-recommendations/631">Hibernate forum</a>. A user reported that he tried to migrate his application from Hibernate 3.6 to 5.3. During the migration, he recognized that the memory consumption of Hibernateâ€™s SessionFactory went up to 950MB.</p>

<p>The issue was caused by the size and number of <u>EntityLoader</u>s that Hibernate instantiated. It was fixed in 2 steps:</p>

<ol>
<li> <a href="https://hibernate.atlassian.net/browse/HHH-12556">HHH-12556</a> â€“ Similar <u>EntityLoader</u>s now share some internal data structures. This reduced the memory consumption of the application by ~50%.
The fix was backported to Hibernate 5.2.18. So, if youâ€™re using Hibernate 5.2 and donâ€™t want to upgrade to 5.3, you should at least update to 5.2.18.</li>
<li> <a href="https://hibernate.atlassian.net/browse/HHH-12558">HHH-12558</a> â€“ Hibernate supports a bunch of different lockÂ modes with specific loaders. In the past, it instantiated all loaders eagerly. Hibernate 5.3 only instantiates the 2 most common ones and loads all others lazily.</li>
</ol>

<p>At the end of the discussion, the user who reported the issue wrote that the improved Hibernate version only used ~ 250MB. So, for his application, these two changes reduced the memory consumption by ~70%.</p>

<p>I obviously canâ€™t promise that it will be equally effective for your project. However, the reported improvement is so enormous that you should at least give it a try.</p>

<h2 id="toc_1">JPA 2.2 compliance</h2>

<p>Hibernate 5.3.0 is the first version thatâ€™s fully compliant with JPA 2.2. However, because the support for all the interesting features was already added in Hibernate 5.0, 5.1 and 5.2, and I already wrote extensive tutorials about all of them, I will not dive any deeper into this topic.</p>

<p>If youâ€™re not already familiar with JPA 2.2, you can read more about it in the following articles:</p>

<ul>
<li>  <a href="https://www.thoughts-on-java.org/map-date-time-api-jpa-2-2/">How To Map The Date And Time API with JPA 2.2</a></li>
<li>  <a href="https://www.thoughts-on-java.org/get-query-results-stream-hibernate-5/">How to get query results as a Stream with Hibernate 5.2</a>Â (please note that Hibernate now also offers the <u>getResultStream</u> method)</li>
<li>  <a href="https://www.thoughts-on-java.org/jpa-2-2s-new-stream-method-and-how-you-should-not-use-it/">JPA 2.2â€™s new getResultStream() method and how you should NOT use it</a></li>
<li>  <a href="https://www.thoughts-on-java.org/jpa-2-2-repeatable-annotations/">JPA 2.2 Introduces @Repeatable Annotations</a></li>
</ul>

<h2 id="toc_2">Small Improvements</h2>

<p>Learn more about primary keys<meta itemprop="thumbnailUrl" content="https://www.thoughts-on-java.org/wp-content/plugins/wp-youtube-lyte/lyteThumbs.php?origThumbUrl=%2F%2Fi.ytimg.com%2Fvi%2Fqn9SbW44rQ8%2Fmaxresdefault.jpg"><meta itemprop="embedURL" content="https://www.youtube.com/embed/qn9SbW44rQ8"><meta itemprop="uploadDate" content=""></p>

<p><img src="https://i.ytimg.com/vi/qn9SbW44rQ8/0.jpg" alt=""/><br/>
Watch this video on YouTube<meta itemprop="description" content="">](<a href="https://youtu.be/qn9SbW44rQ8">https://youtu.be/qn9SbW44rQ8</a>)</p>

<p><a href="https://youtu.be/qn9SbW44rQ8"></a><a href="http://bit.ly/2cUsid8">Follow me on YouTube</a> to not miss any new videos.</p>

<h3 id="toc_3">Implicit ID generator definitions</h3>

<p>If you <a href="https://www.thoughts-on-java.org/jpa-generate-primary-keys/">generate your primary key values</a>, youâ€™re probably aware of Hibernateâ€™s <u>@SequenceGenerator</u> and <u>@TableGenerator</u> annotations. You can use them to define which sequence or table Hibernate shall use to generate the primary key value.</p>

<p>Here is a typical example of a primary key mapping that tells Hibernate to use the database sequence <u>author</u>seq_ to generate the unique primary key values.</p>

<pre><code class="language-java">@Entity
public class Author {
 
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = &quot;author_seq&quot;)
    @SequenceGenerator(name=&quot;author_seq&quot;, sequenceName = &quot;author_seq&quot;)
    private Long id;
 
    ...
}
</code></pre>

<p>The mapping definition consists of 2 parts:</p>

<ol>
<li> The <u>@GeneratedValue</u> annotation defines which generation strategy Hibernate shall use and references a custom generator.</li>
<li> The <u>@SquenceGenerator</u> annotation specifies the generator and tells Hibernate the name of the sequence you want to use.</li>
</ol>

<p>As you can see in the code snippet, I use the same name for the generator and the database sequence. Thatâ€™s a pretty common and verbose mapping.</p>

<p>If your mapping looks the same, I have good news for you: You no longer need to define the generator if your database sequence or table has the same name as your <u>@SequenceGenerator</u> or <u>@TableGenerator</u>.</p>

<p>That enables me to shorten the previous mapping and to remove the <u>@SequenceGenerator</u> definition.</p>

<pre><code class="language-java">@Entity
public class Author {
 
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = &quot;author_seq&quot;)
    private Long id;
 
    ...
}
</code></pre>

<h3 id="toc_4">Support for MySQL 8 SKIP LOCKED and NOWAIT</h3>

<p>MySQL 8.0.1 added the SKIP LOCKED and NOWAIT feature to provide different options to handle locked rows during read-operations. The MySQL Server team explained them in great detail on their blog:Â <a href="https://mysqlserverteam.com/mysql-8-0-1-using-skip-locked-and-nowait-to-handle-hot-rows/">MySQL 8.0.1: Using SKIP LOCKED and NOWAIT to handle hot rows.</a></p>

<p>Hereâ€™s a quick description of both features:</p>

<ul>
<li>  SKIP LOCKED enables you to perform a non-deterministic read that skips all locked rows. That means that locked rows are missing in your result set.</li>
<li>  If you require a deterministic read but donâ€™t want to wait for the locks to be released, you can use the NOWAIT feature. It causes your query to fail immediately if any records in your result set are locked.</li>
</ul>

<p>The <u>MySQL8Dialect</u> included in Hibernate 5.3 supports both these features so that you can use them in your queries.</p>

<p>Learn more about AttributeConverter<meta itemprop="thumbnailUrl" content="https://www.thoughts-on-java.org/wp-content/plugins/wp-youtube-lyte/lyteThumbs.php?origThumbUrl=%2F%2Fi.ytimg.com%2Fvi%2FTIeeRif4ocg%2Fmaxresdefault.jpg"><meta itemprop="embedURL" content="https://www.youtube.com/embed/TIeeRif4ocg"><meta itemprop="uploadDate" content=""></p>

<p><img src="https://i.ytimg.com/vi/TIeeRif4ocg/0.jpg" alt=""/><br/>
Watch this video on YouTube<meta itemprop="description" content="">](<a href="https://youtu.be/TIeeRif4ocg">https://youtu.be/TIeeRif4ocg</a>)</p>

<p><a href="https://youtu.be/TIeeRif4ocg"></a><a href="http://bit.ly/2cUsid8">Follow me on YouTube</a> to not miss any new videos.</p>

<h3 id="toc_5">Apply AttributeConverter when calling a function</h3>

<p><a href="https://www.thoughts-on-java.org/jpa-21-how-to-implement-type-converter/">AttributeConverters</a> provide a standardized, easy way to define the mapping of a Java type. You can either use them to add support for unsupported classes or to customize the <a href="https://www.thoughts-on-java.org/jpa-21-type-converter-better-way-to/">mapping of an already supported Java type</a>.</p>

<p>The following code snippet shows an example from myÂ <a href="https://www.thoughts-on-java.org/jpa-tips-map-duration-attribute/">JPA Tip: How to map a Duration attribute</a>. JPA 2.2 doesnâ€™t provide a mapping forÂ _java.time.Duration_ objects. If you want to map such an object, you can use this <u>AttributeConverter</u> to map it to a <u>Long</u>.</p>

<pre><code class="language-java">@Converter(autoApply = true)
public class DurationConverter implements AttributeConverter&lt;Duration, Long&gt; {
     
    Logger log = Logger.getLogger(DurationConverter.class.getSimpleName());
 
    @Override
    public Long convertToDatabaseColumn(Duration attribute) {
        log.info(&quot;Convert to Long&quot;);
        return attribute.toNanos();
    }
 
    @Override
    public Duration convertToEntityAttribute(Long duration) {
        log.info(&quot;Convert to Duration&quot;);
        return Duration.of(duration, ChronoUnit.NANOS);
    }
}
</code></pre>

<p>After you applied the AttributeConverter to an attribute or automatically applied them to all attributes of a specific type, it gets transparently used:</p>

<ul>
<li>  during all lifecycle state transitions,</li>
<li>  to map the result of a query and</li>
<li>  when used in path expressions in a <a href="http://JPQL">JPQL</a> or CriteriaQuery.</li>
</ul>

<p>However, for whatever reason, the usage of converted attribute values as function parameters is explicitly undefined.</p>

<p>Previous Hibernate versions didnâ€™t convert the attribute value if you referenced it as a function parameter. This changed with Hibernate 5.3.2. It now converts the attribute value before it provides it as a function parameter.</p>

<h2 id="toc_6">Support for Java 9 and preparations for Java 11</h2>

<p>Beginning with Hibernate 5.3.0, all Hibernate modules specify a <a href="https://blog.codefx.org/java/java-module-system-tutorial/">Java 9 module</a> name following the patternÂ _org.hibernate.orm.${module-name}_, e.g., the hibernate-core module defines the nameÂ _org.hibernate.orm.core._</p>

<p>The Hibernate team also updated the dependencies, prepared the build process and run their test suite with the latest JDK 11 build. So, we can hope for a smooth transition to JDK11.</p>

<h2 id="toc_7">Conclusion</h2>

<p>Should you update to Hibernate 5.3?</p>

<p>You probably already know my answer. Itâ€™s a clear yes! Especially the improved memory consumption is a great reason to do the update.</p>

<p>However, please keep in mind that every update has its risks and that you obviously shouldnâ€™t update any project dependency without testing it carefully.</p>

<p>So, what about you? Did you already update your application to use Hibernate 5.3 or will you update it in the near future?</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java æ€§èƒ½ä¼˜åŒ–æŒ‡å—ï¼ŒåŠå”¯å“ä¼šçš„å®žæˆ˜]]></title>
    <link href="http://panlw.github.io/15340923334107.html"/>
    <updated>2018-08-13T00:45:33+08:00</updated>
    <id>http://panlw.github.io/15340923334107.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p>åŽŸæ–‡å‡ºå¤„ï¼š <a href="http://calvin1978.blogcn.com/articles/javatuning.html">æ±Ÿå—ç™½è¡£</a></p>
</blockquote>

<p>æ¥äº†å”¯å“ä¼šä¸€å¹´å¤šï¼Œä¸å°‘æ—¶é—´èŠ±åœ¨ä¸ŽæœåŠ¡åŒ–æ¡†æž¶ã€ä¸šåŠ¡åº”ç”¨çš„æ€§èƒ½çš„ç¼ æ–—ä¸Šã€‚</p>

<p>å‰å‡ å¤©æ­£å¥½è¶ç€ä¸­ç”Ÿä»£ç¤¾åŒºçš„<a href="http://www.hdb.com/party/bajzu.html">åæœˆååŸŽæŠ€æœ¯æ²™é¾™</a>ï¼ŒæŠŠè„‘æµ·ä¸­<strong>å…³äºŽæ€§èƒ½ä¼˜åŒ–çš„è®°å¿†</strong>å…¨éƒ¨ç†äº†ä¸€éâ€¦. è®²å®Œå›žå®¶ï¼Œåˆæœ¬ç€è®¤çœŸä¸¥è°¨çš„æ€åº¦å†ç†äº†ä¸€éï¼Œç»ˆäºŽæˆä¸ºçŽ°åœ¨è¿™ä»½ <strong>66 é¡µçš„ PPT</strong>ã€‚</p>

<p>å„ä½å®¢å®˜ï¼Œ1.4 ç‰ˆçš„å†…å®¹ç•¥æœ‰å¢žå‡ï¼Œè¶…é“¾æŽ¥ä¹Ÿå·²ä¿®å¥½:Â <a href="http://files.blogcn.com/wp06/M00/00/ED/CpCCFVgRySAAAAAAAC42ozG7w4w912.pdf">ã€ŠJava æ€§èƒ½ä¼˜åŒ–æŒ‡å— V1.4.pdfã€‹</a></p>

<p><a href="http://files.blogcn.com/wp04/M00/08/02/CoFCGVgHnLkAAAAAAAETKzIbY-c369.jpg" title="å¹»ç¯ç‰‡01"><img src="http://files.blogcn.com/wp04/M00/08/02/CoFCGVgHnLkAAAAAAAETKzIbY-c369.jpg" alt=""/></a></p>

<h3 id="toc_0">èŒƒå›´</h3>

<p>åº”ç”¨æ€§èƒ½ï¼Œå—æ“ä½œç³»ç»Ÿå‚æ•°ï¼Œä¸‰æ–¹ç±»åº“é€‰æ‹©ï¼Œæ•°æ®åº“æŸ¥è¯¢ï¼Œç”šè‡³åŽ‹æµ‹å·¥å…·å¦‚ JMeter æœ¬èº«è°ƒä¼˜çš„å½±å“ã€‚</p>

<p>æœ¬æ¬¡åˆ†äº«åªç€é‡åœ¨ä¸‰æ–¹é¢ï¼š</p>

<ul>
<li>  JVM çš„è°ƒä¼˜</li>
<li>  ä»£ç çš„è°ƒä¼˜</li>
<li>  å®šä½æ€§èƒ½é—®é¢˜çš„å·¥å…·</li>
</ul>

<p><a href="http://files.blogcn.com/wp06/M00/00/ED/CpCCFVgHnPMAAAAAAADXW3vnM8I951.jpg" title="å¹»ç¯ç‰‡03"><img src="http://files.blogcn.com/wp06/M00/00/ED/CpCCFVgHnPMAAAAAAADXW3vnM8I951.jpg" alt=""/></a></p>

<p><a href="http://files.blogcn.com/wp02/M00/08/EF/CpAZrVgHnSkAAAAAAACnv2fHcK0833.jpg" title="å¹»ç¯ç‰‡04"><img src="http://files.blogcn.com/wp02/M00/08/EF/CpAZrVgHnSkAAAAAAACnv2fHcK0833.jpg" alt=""/></a></p>

<h3 id="toc_1">åŸºæœ¬åŽŸåˆ™</h3>

<p>ç½‘ä¸Šå¦‚æ­¤å¤šæ–°æ—§ä¸ä¸€çš„èµ„æ–™ï¼Œè¿™ä¹ˆå¤šè‚†æ„ä¼ æ’­äº¦çœŸäº¦é”™çš„è§‚ç‚¹ï¼Œæ€Žä¹ˆåŠžå‘¢ï¼Ÿ</p>

<ol>
<li> å¤šçœ‹ä¸€äº›é è°±çš„èµ„æ–™ï¼Œé—®ä¸€äº›é è°±çš„äººã€‚</li>
<li> æ€€ç–‘ä¸€åˆ‡ï¼Œå¾®åŸºå‡†æµ‹è¯•ä¸€åˆ‡ï¼Œè¯šæ„æŽ¨è JMHã€‚</li>
<li> çœ‹ JDK ä»£ç ï¼Œçœ‹ä¸€åˆ‡ä»£ç ã€‚</li>
</ol>

<p><a href="http://files.blogcn.com/wp04/M00/00/D1/CpCCFVgHnewAAAAAAAC4WC08BEA045.jpg" title="å¹»ç¯ç‰‡06"><img src="http://files.blogcn.com/wp04/M00/00/D1/CpCCFVgHnewAAAAAAAC4WC08BEA045.jpg" alt=""/></a></p>

<p><a href="http://files.blogcn.com/wp06/M00/04/D0/CoFCGVgHnjEAAAAAAADZwUFf8O8583.jpg" title="å¹»ç¯ç‰‡07"><img src="http://files.blogcn.com/wp06/M00/04/D0/CoFCGVgHnjEAAAAAAADZwUFf8O8583.jpg" alt=""/></a></p>

<p><a href="http://files.blogcn.com/wp02/M00/08/EF/CpAZrVgHnokAAAAAAACCHhzO17w957.jpg" title="å¹»ç¯ç‰‡08"><img src="http://files.blogcn.com/wp02/M00/08/EF/CpAZrVgHnokAAAAAAACCHhzO17w957.jpg" alt=""/></a></p>

<p><a href="http://files.blogcn.com/wp04/M00/08/02/CoFCGVgHn6YAAAAAAADGggFLBi0755.jpg" title="å¹»ç¯ç‰‡09"><img src="http://files.blogcn.com/wp04/M00/08/02/CoFCGVgHn6YAAAAAAADGggFLBi0755.jpg" alt=""/></a></p>

<h3 id="toc_2">JVM ä¼˜åŒ–</h3>

<p>é¦–å…ˆï¼ŒJIT å…¥é—¨çŸ¥è¯†ï¼›ç„¶åŽï¼ŒJVM å‚æ•°çš„ç®€ä»‹ï¼›å†ç„¶åŽï¼Œæœ€å¤´ç—›çš„ GC é—®é¢˜çš„å¤„ç†ã€‚</p>

<p><a href="http://files.blogcn.com/wp06/M00/00/ED/CpCCFVgHoB4AAAAAAACR8THhKLc792.jpg" title="å¹»ç¯ç‰‡21"><img src="http://files.blogcn.com/wp06/M00/00/ED/CpCCFVgHoB4AAAAAAACR8THhKLc792.jpg" alt=""/></a></p>

<p><a href="http://files.blogcn.com/wp06/M00/00/ED/CpCCFVgHqVoAAAAAAADQAgCkMkE356.jpg" title="å¹»ç¯ç‰‡30"><img src="http://files.blogcn.com/wp06/M00/00/ED/CpCCFVgHqVoAAAAAAADQAgCkMkE356.jpg" alt=""/></a></p>

<h3 id="toc_3">ä»£ç ä¼˜åŒ–</h3>

<p>ä»£ç ä¼˜åŒ–ï¼Œä¸¤å¤§æ–¹å‘ä¸€æ˜¯é¢å‘ GC çš„ç¼–ç¨‹ï¼ŒäºŒæ˜¯å¹¶å‘ä¸Žé”ï¼Œç„¶åŽå†æ¥èŠèŠå…¶ä»–ã€‚</p>

<p><a href="http://files.blogcn.com/wp02/M00/08/EF/CpAZrVgHoGwAAAAAAADk5iKpsPw033.jpg" title="å¹»ç¯ç‰‡34"><img src="http://files.blogcn.com/wp02/M00/08/EF/CpAZrVgHoGwAAAAAAADk5iKpsPw033.jpg" alt=""/></a></p>

<h3 id="toc_4">é—®é¢˜å®šä½å·¥å…·é›†</h3>

<p>é»‘ç›’è°ƒä¼˜æ˜¯æœ€ä¸å¯é çš„ï¼ŒæŽ¨èçº¿ä¸‹ç”¨ JMCï¼Œçº¿ä¸Šç”¨ Btrace å®šä½é—®é¢˜ã€‚</p>

<p><a href="http://files.blogcn.com/wp04/M00/00/D1/CpCCFVgHoZMAAAAAAAC3Llc-Yyw623.jpg" title="å¹»ç¯ç‰‡51"><img src="http://files.blogcn.com/wp04/M00/00/D1/CpCCFVgHoZMAAAAAAAC3Llc-Yyw623.jpg" alt=""/></a></p>

<h3 id="toc_5">ç‰¹åˆ«é¸£è°¢</h3>

<p>æ„Ÿè°¢ R å¤§ ï¼Œ æ—¥å¸¸ä¸‰æ›´åŠå¤œè·¨æ´‹çƒ­å¿ƒè§£ç­”å„ç§ JVM é—®é¢˜ã€‚</p>

<p>æ„Ÿè°¢ Chembo(å›½é’¦)ï¼Œå¯¹ PPT çš„ç¾ŽåŒ–ã€‚</p>

<h3 id="toc_6">å®Œæ•´ PPT ä¸‹è½½</h3>

<p><a href="http://files.blogcn.com/wp06/M00/00/ED/CpCCFVgRySAAAAAAAC42ozG7w4w912.pdf">ã€ŠJava æ€§èƒ½ä¼˜åŒ–æŒ‡å— V1.4.pdfã€‹</a>, by æ±Ÿå—ç™½è¡£, è¶…é“¾æŽ¥ä¿®æ­£ç‰ˆã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¹²è´§ | ä½™é¢å®å¤§è§„æ¨¡æœåŠ¡åŒ–çš„æŠ€æœ¯åˆ›æ–°]]></title>
    <link href="http://panlw.github.io/15340916506798.html"/>
    <updated>2018-08-13T00:34:10+08:00</updated>
    <id>http://panlw.github.io/15340916506798.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/41646747">https://zhuanlan.zhihu.com/p/41646747</a> ä¸€ä¸ªä¸å¤ªå¯çˆ±çš„å¥³å­©å­</p>

<p>æœ¬æ–‡ä½œè€…ï¼šæŽé‘«ï¼Œå¤©å¼˜åŸºé‡‘ç§»åŠ¨å¹³å°éƒ¨ä»»æŠ€æœ¯æ€»ç›‘å…¼é¦–æž¶ï¼Œä¸»è¦è´Ÿè´£å¤©å¼˜ç§»åŠ¨ç›´é”€å¹³å°çš„æ•´ä½“æŠ€æœ¯æž¶æž„å’ŒæŠ€æœ¯å›¢é˜Ÿç®¡ç†ã€‚<br/>
åœ¨æ­¤ä¹‹å‰ï¼Œåœ¨åŽä¸ºçš„ä¸­é—´ä»¶æŠ€æœ¯å›¢é˜Ÿï¼Œä»»å…­çº§æŠ€æœ¯ä¸“å®¶ï¼Œä¸»å¯¼äº†å¤šæ¬¾åŽä¸ºè½¯ä»¶çš„äº‘è®¡ç®—äº§å“çš„è§„åˆ’ã€è®¾è®¡ã€æž„å»ºåŠè½åœ°å·¥ä½œï¼ŒåŒ…æ‹¬ APaaSã€ASPaaSã€æœåŠ¡æ²»ç†å¹³å°ã€åˆ†å¸ƒå¼æœåŠ¡è°ƒæµ‹æ¡†æž¶ç­‰å‡ æ¬¾äº§å“ï¼›æ›´æ—©ä¹‹å‰ï¼Œåœ¨å½“å½“ç½‘çš„è¿ä½œäº§å“ä¸­å¿ƒåšæŠ€æœ¯è´Ÿè´£äººï¼Œä¸»è¦è´Ÿè´£ç”µå•†ä¸­åŽå°çš„ä»“å‚¨ã€ç‰©æµã€å®¢æœç­‰ç³»ç»Ÿçš„é‡æž„ä¼˜åŒ–åŠæŠ€æœ¯ç®¡ç†å·¥ä½œã€‚</p>

<p>ä¸ªäººä»Žä¸šåå¤šå¹´ï¼Œåšè¿‡å¾ˆå¤šæŠ€æœ¯æ–¹å‘ï¼Œä¹Ÿæ˜¯ä»Žé¡¹ç›®ç‰ˆæœ¬ç ”å‘æ…¢æ…¢åˆ°ä¸­é—´ä»¶ç ”å‘ï¼Œå†åˆ°å¹³å°ç ”å‘ï¼Œæ¶‰åŠçš„æŠ€æœ¯é¢†åŸŸæ¯”è¾ƒå¤šã€‚åœ¨å¹¶è¡Œè®¡ç®—ã€å¤§è§„æ¨¡åˆ†å¸ƒå¼æœåŠ¡åŠæ²»ç†ã€ä¸­é—´ä»¶äº‘åŒ–åŠæœåŠ¡åŒ–ï¼ˆPaaSï¼‰ã€APM ç›‘æŽ§ã€åŸºç¡€å¼€å‘å¹³å°ã€æ•°æ®é›†æˆç­‰é¢†åŸŸéƒ½æœ‰äº›æŠ€æœ¯ç§¯ç´¯ï¼Œå¦‚æžœå¤§å®¶åœ¨è¿™äº›é¢†åŸŸæœ‰ç–‘é—®æˆ–å¥½çš„å»ºè®®ï¼Œæ¬¢è¿ŽåŠ æˆ‘çš„å¾®ä¿¡å·å…±åŒæŽ¢è®¨ã€‚</p>
</blockquote>

<p><img src="https://pic3.zhimg.com/v2-448a9367fbd6d700321a85583097d054_r.jpg" alt=""/></p>

<p>ä¸ƒæœˆåˆï¼ŒæŽé‘«åœ¨ ArchSummit æ·±åœ³å¤§ä¼šä¸Šåšäº†é¢˜ä¸ºã€Šä½™é¢å®å¤§è§„æ¨¡æœåŠ¡åŒ–çš„æŠ€æœ¯åˆ›æ–°ã€‹çš„åˆ†äº«ï¼ŒçŽ°åœºåå“çƒ­çƒˆã€‚çŽ°å°† PPT å’Œè®²ç¨¿æ•´ç†å‡ºæ¥ï¼Œåˆ†äº«ç»™å¤§å®¶ï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶ä¸€äº›å¯å‘ï¼Œä¹Ÿæ¬¢è¿Žç•™è¨€è®¨è®ºã€‚</p>

<p><img src="https://pic2.zhimg.com/80/v2-fa07d74992a0f5f565dbfd12a5391aa5_hd.jpg" alt=""/></p>

<p>åˆ†äº«åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p>

<ul>
<li>  ä½™é¢å®çš„æ•´ä½“æž¶æž„å˜è¿åŽ†å²ï¼›</li>
<li>  è®²ä¸€è®²æˆ‘ä»¬æ˜¯å¦‚ä½•è¿›è¡ŒåŸºé‡‘å®žæ—¶é”€å”®å¹³å°åŠå¤§æ•°æ®å¹³å°çš„æœåŠ¡åŒ–æ”¹é€ çš„ï¼›</li>
<li>  â€œæœåŠ¡åŒ–â€ å¯¹æˆ‘ä»¬è¿ç»´åŠç ”å‘æ¨¡å¼çš„å½±å“åŠæˆ‘ä»¬çš„åº”å¯¹ç­–ç•¥ï¼›</li>
</ul>

<p>ä½™é¢å®çš„æ•´ä½“æž¶æž„å˜è¿åŽ†å²</p>

<p><img src="https://pic4.zhimg.com/80/v2-bc3a8986b6158bf772dd6b2e711a40e2_hd.jpg" alt=""/></p>

<p>ä½™é¢å®æœ¬è´¨ä¸Šæ˜¯ä¸€æ”¯è´§å¸åŸºé‡‘ï¼Œå®ƒçš„èƒŒåŽæ˜¯å¤©å¼˜çš„å¢žåˆ©å®åŸºé‡‘ã€‚ç”±äºŽå’Œæ”¯ä»˜å®çš„å…³ç³»ï¼Œå®ƒæ—¢æ˜¯ç†è´¢äº§å“ï¼Œåˆæ˜¯æ”¯ä»˜äº§å“ï¼Œç†è´¢å’Œæ”¯ä»˜çš„åŒé‡å±žæ€§ï¼Œå†åŠ ä¸Šäº’è”ç½‘äº§å“æ‰€ç‰¹æœ‰çš„æžç®€çš„ç”¨æˆ·ä½“éªŒï¼Œè®©ä½™é¢å®ä¸€ç»æŽ¨å‡ºï¼Œè¿…é€Ÿæˆä¸ºäº† â€œçˆ†æ¬¾â€ï¼ŒçŸ­çŸ­äº”å¹´å†…èŽ·å¾—äº†ä¸€ä¸ªæƒŠäººçš„å‘å±•ã€‚å¯ä»¥æ¯«ä¸å¤¸å¼ çš„è¯´ï¼Œä½™é¢å®çš„å‡ºçŽ°ï¼Œå¼€å¯äº†ä¸­å›½çš„å…¨æ°‘ç†è´¢æ—¶ä»£ï¼</p>

<p><img src="https://pic2.zhimg.com/80/v2-d99a3a7f381fc64de0f3d43c07146cea_hd.jpg" alt=""/></p>

<p>ä¸ºäº†é€‚åº”ä¸šåŠ¡çš„çˆ†ç‚¸å¼å¢žé•¿ï¼Œ5 å¹´æ¥ä½™é¢å®çš„æŠ€æœ¯æž¶æž„åšäº† 4 æ¬¡å¤§çš„å˜æ›´ï¼Œæ¯æ¬¡æŠ€æœ¯å˜æ›´çš„èƒŒåŽï¼Œéƒ½æ‰¿è½½äº†å¤©å¼˜æŠ€æœ¯å›¢é˜Ÿå¯¹ç³»ç»Ÿè§„æ¨¡ã€å¯æ‰©å±•æ€§åŠå‡çº§æˆæœ¬çš„ç»¼åˆè€ƒé‡å’Œå¹³è¡¡ä¹‹é“ã€‚</p>

<p><img src="https://pic4.zhimg.com/80/v2-02129e0f6899ad2c991f93f0383154b2_hd.jpg" alt=""/></p>

<p><strong>ä½™é¢å®ä¸Šçº¿ä¹‹åˆï¼Œè§£å†³çš„æ˜¯ â€œä»Žæ— åˆ°æœ‰â€ çš„é—®é¢˜ã€‚</strong><br/>
å½“æ—¶æ²¡æœ‰å…¶å®ƒç±»ä¼¼çš„äº’è”ç½‘é‡‘èžäº§å“å¯ä»¥åšå‚è€ƒï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¼ ç»Ÿçš„å…¸åž‹ä¼ä¸šçº§é‡‘èžæž¶æž„ã€‚ç”±äºŽé‡‡ç”¨çš„æ˜¯è‡ªå»º IDC æœºæˆ¿çš„æ–¹å¼ï¼Œæˆ‘ä»¬ç”¨ç¡¬ä»¶è´Ÿè½½å‡è¡¡è®¾å¤‡å°†äº¤æ˜“è¯·æ±‚æŽ¥å…¥è¿›æ¥ï¼Œå‰ç«¯æ˜¯ç”±ä¸¤å° weblogic æž„æˆçš„å°åž‹çš„å‰ç½®å¤„ç†é›†ç¾¤ï¼Œè¯·æ±‚è¢«ç¨åšå¤„ç†ä¹‹åŽï¼Œå³è¢«é€åˆ°åŽç«¯ç”±é‡‘æ­£çš„åŸºé‡‘äº¤æ˜“ä¸­é—´ä»¶æž„å»ºçš„é›†ç¾¤åšä¸šåŠ¡å¤„ç†ï¼Œå…¶ä¸­ KCXP å’Œ KCBP æ˜¯é‡‘è¯å…¬å¸çš„æ¶ˆæ¯ä¸­é—´ä»¶å’Œä¸šåŠ¡ä¸­é—´ä»¶ï¼Œä¸šåŠ¡æ•°æ®å­˜å‚¨é‡‡ç”¨çš„æ˜¯ä¸¤å° Oracle æ•°æ®åº“æœåŠ¡å™¨æž„å»ºçš„ä¸€ä¸»ä¸€å¤‡çš„å°é›†ç¾¤ï¼Œè¿™ä¸ªæ˜¯çº¿ä¸Šåº“ï¼ŒåŒæ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªåŒæ ·æž¶æž„çš„åŽ†å²åº“æœåŠ¡ã€‚ç¡¬ä»¶æ–¹é¢é‡‡ç”¨çš„éƒ½æ˜¯å°åž‹æœºè®¾å¤‡ï¼Œæ•°æ®å¤‡ä»½åˆ™é‡‡ç”¨ EMC çš„äº§å“ã€‚</p>

<p>è¿™æ˜¯å…¸åž‹çš„ IOE æž¶æž„ï¼Œå…¨å¥—çš„å•†ç”¨è½¯ç¡¬ä»¶é…ç½®ï¼Œæˆæœ¬å¾ˆé«˜ã€‚æž¶æž„ä½“ç³»è™½ç„¶å¾ˆå¤šçŽ¯èŠ‚éƒ½é‡‡ç”¨äº†é›†ç¾¤çš„æ–¹å¼ï¼Œä½†æ›´å¤šçš„æ˜¯ä½¿ç”¨ä¸»å¤‡æ¨¡å¼ï¼Œè€Œä¸æ˜¯è´Ÿè½½å‡è¡¡çš„åˆ†å¸ƒå¼æ¨¡å¼ï¼Œå› æ­¤ç³»ç»Ÿçš„å•ç‚¹èµ„æºè´Ÿè½½åŽ‹åŠ›è¾ƒå¤§ï¼Œå°¤å…¶æ˜¯æ•°æ®åº“ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å•åº“æ¨¡å¼ï¼ˆå¦ä¸€ä¸ªåº“æ˜¯å¤‡åº“ï¼‰ï¼Œæ‰©å±•æ€§è¾ƒå·®ã€‚<br/>
å½“æ—¶çš„ç³»ç»Ÿå®¹é‡è®¾è®¡ä¸Šé™æ˜¯èƒ½æ”¯æŒåƒä¸‡çº§ç”¨æˆ·ï¼Œä¼ ç»ŸåŸºé‡‘é”€å”®æ¨¡å¼æ˜¯èµ°ä»£é”€æœºæž„çš„æ–¹å¼ï¼ŒæŠ•èµ„åŸºé‡‘ç”¨æˆ·ä¹Ÿå¤šä»¥ç†è´¢ä¸ºç›®çš„ã€‚æ‰€ä»¥æ¯å¤©å¯èƒ½å¤„ç†çš„å¸æˆ·å¼€æˆ·ä¹Ÿå°±æ˜¯å‡ ä¸‡åˆ°å‡ åä¸‡çš„è§„æ¨¡ã€‚ç”±äºŽä½™é¢å®å¯¹æŽ¥æ˜¯æ”¯ä»˜å®ï¼Œæ”¯ä»˜å®çš„ç”¨æˆ·è§„æ¨¡è¾¾åˆ°åƒä¸‡çº§ï¼Œè¿™æ˜¯è®¾è®¡äº§å“æ—¶å¯¹éœ€æ±‚çš„å®šä½ã€‚æŒ‰ç…§é¢„ä¼°ï¼Œè¿™ä¸ªè®¾è®¡å®¹é‡æ€Žä¹ˆéƒ½èƒ½æ‰›ä¸ªå‡ å¹´ã€‚ç»“æžœï¼Œæˆ‘ä»¬ä½Žä¼°äº†ä½™é¢å®çš„çƒ­åº¦ï¼Œä¸Šçº¿çŸ­çŸ­ 10 å¤©å·¦å³ï¼Œæ–°å¼€æˆ·æ•°å·²ç»çªç ´ 100W äº†ï¼ŒæŒ‰è¿™ä¸ªé€Ÿåº¦ï¼Œ3 ä¸ªæœˆå·¦å³æ•°æ®åº“å®¹é‡ä¸Šçº¿å°±è¦è¢«çªç ´ã€‚äº‹å®žä¹Ÿç¡®å®žå¦‚æ­¤ï¼Œæˆ‘ä»¬çš„å®¢æˆ·é‡ä¸‰ä¸ªæœˆå°±è¾¾åˆ°ä¸€åƒä¸‡ï¼Œä½™é¢å®ä¸€æœŸç³»ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸåªæœ‰ä¸‰ä¸ªæœˆï¼</p>

<p><img src="https://pic2.zhimg.com/80/v2-5816971a16e8e2b907617e72c69a7da4_hd.jpg" alt=""/></p>

<p>æ‰€ä»¥ä¸€æœŸç³»ç»Ÿä¸€ä¸Šçº¿ï¼Œå›¢é˜Ÿå°±ä¸å¾—ä¸å¼€å§‹è€ƒè™‘æ‰©å®¹ï¼Œè®¡åˆ’å°†å®¹é‡æ‰©å…… 30~50 å€ï¼Œè®¡ç®—è§„æ¨¡ä¹ŸåŒæ­¥å¢žåŠ ã€‚å¦‚æžœè¿˜æ˜¯é‡‡ç”¨ä¸€æœŸç³»ç»Ÿçš„çº¯å•†ç”¨è½¯ç¡¬ä»¶çš„æ¨¡å¼è¿›è¡Œæ¨ªå‘æ‰©å±•çš„è¯ï¼Œæˆæœ¬è¦è¾¾åˆ° 1~2 ä¸ªäº¿ï¼Œè¿™æ ·çš„æˆæœ¬å¯¹äºŽå½“æ—¶å¤©å¼˜è¿™æ ·ä¸€å®¶å°åž‹åŸºé‡‘å…¬å¸è€Œè¨€ï¼Œæ˜¯ä¸å¯è´Ÿæ‹…ä¹‹é‡ï¼å› æ­¤ï¼Œåœ¨é˜¿é‡Œçš„å»ºè®®ä¸‹ï¼Œæˆ‘ä»¬å†³å®šæ•´ä½“ä¸Šäº‘ã€‚</p>

<p>å½“æ—¶åšå‡ºè¿™ä¸ªå†³å®šçš„åŽ‹åŠ›è¿˜æ˜¯éžå¸¸å¤§çš„ï¼Œå› ä¸ºå½“æ—¶æ²¡æœ‰ä»»ä½•ä¸€å®¶é‡‘èžå…¬å¸å’ŒåŸºé‡‘å…¬å¸è¿™ä¹ˆçŽ©ï¼Œæˆ‘ä»¬æˆäº†ç¬¬ä¸€ä¸ªåƒèžƒèŸ¹çš„äººã€‚ä½†åœ¨å·¨å¤§çš„æˆæœ¬åŽ‹åŠ›ä¹‹ä¸‹ï¼Œæˆ‘ä»¬èµ°å‡ºäº†è¿™ä¸€æ­¥ï¼Œè¿™å°±æ˜¯ä½™é¢å® 2.0ï¼</p>

<p>ä½™é¢å® 2.0 çš„æž¶æž„ä¸­ç”¨é˜¿é‡Œäº‘ä¸Šçš„è½¯è´Ÿè½½å‡è¡¡ SLB æ›¿æ¢äº†ç¡¬ä»¶è´Ÿè½½å‡è¡¡ï¼›ç”¨é˜¿é‡Œäº‘ä¸Šçš„è™šæ‹Ÿè®¡ç®—å•å…ƒ ECS æ›¿æ¢å°åž‹æœºæˆä¸ºå‰ç½®æœåŠ¡åŠä¸­é—´ä»¶æœåŠ¡çš„æœåŠ¡å™¨ï¼›ç”¨é˜¿é‡Œäº‘çš„ web æœåŠ¡æ›¿æ¢äº†å‰ç½®æœåŠ¡å™¨ä¸Šçš„ weblogicã€‚</p>

<p>æœ€å¤§çš„ä¸€ä¸ªå˜åŒ–æ˜¯æ•°æ®åº“å±‚é¢ï¼ŒåŽŸæ¥çš„ Oracle å•åº“è¢«æ›¿æ¢æˆäº†é˜¿é‡Œäº‘ä¸Šçš„ä¸€ä¸ª 50 ä¸ªèŠ‚ç‚¹çš„ RDS é›†ç¾¤ï¼Œå®žé™…ä¸Šå°±æ˜¯è¿›è¡Œäº†åˆ†åº“åˆ†è¡¨çš„æ‹†åˆ†ï¼Œç»è¿‡æµ‹ç®—ï¼Œéœ€è¦ä½¿ç”¨ 50 ç»„ä¸šåŠ¡èŠ‚ç‚¹ï¼Œä½†åœ¨æ‹†åˆ†æ—¶ï¼Œè€ƒè™‘åˆ°æ‰©å±•æ€§ï¼Œå¹¶æœªç®€å•åœ°æ‹†åˆ†æˆ 50 ä»½ï¼Œè€Œæ˜¯æ ¹æ®ç”¨æˆ·å¸å· ID ä½œä¸ºåˆ†ç‰‡ä¸»é”®å°†æ ¸å¿ƒä¸šåŠ¡è¡¨æ‹†åˆ†æˆ 1000 ä»½ï¼Œç„¶åŽæ¯ä¸ªèŠ‚ç‚¹å¤„ç† 20 ä»½æ•°æ®ï¼ˆç‰©ç†å­è¡¨ï¼‰ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å°†æ¥å¦‚æžœç³»ç»Ÿé‡åˆ°ç“¶é¢ˆï¼Œéœ€è¦æ‰©å®¹æ—¶ï¼Œä¸éœ€è¦å¯¹æ‹†åˆ†ç®—æ³•è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸”æ•°æ®å¹³å‡è¿ç§»æ—¶åªéœ€è¦ä»¥åº“ä¸ºçº§åˆ«è¿›è¡Œï¼Œä»Žè€Œé¿å…äº†æ‹†è¡¨ã€‚</p>

<p>ä¸Šäº‘åŽï¼Œä¸ä»…æ•°æ®åº“æ€»å®¹é‡æœ‰äº†å‡ åå€çš„æå‡ï¼Œäº¤æ˜“å¤„ç†æ•ˆçŽ‡ä¹Ÿä»Žä¸€æœŸçš„ 120W ç¬” / å°æ—¶æå‡åˆ°äº†è¿‘ 2000W ç¬” / å°æ—¶ï¼›æœ€å¤§æ¸…ç®—æ—¶é—´ä»Žä¹‹å‰çš„ 7 ä¸ªå¤šå°æ—¶é™ä½Žåˆ°äº†ä¸åˆ° 2 ä¸ªå°æ—¶ï¼›è€Œæ€»æˆæœ¬ï¼Œæ‰å¢žåŠ äº†ä¸åˆ° 1 å€ã€‚æ‰€ä»¥ï¼Œä¸Šäº‘å¯¹æˆ‘ä»¬ç³»ç»Ÿæ•´ä½“æ•ˆçŽ‡çš„æå‡å’Œæˆæœ¬çš„é™ä½Žæœ‰éžå¸¸æ˜Žæ˜¾çš„ä½œç”¨ã€‚</p>

<p><img src="https://pic4.zhimg.com/80/v2-6413443e5520ec8dfcae02e4bc97e5bd_hd.jpg" alt=""/></p>

<p>ä½™é¢å® 2.0 çš„æž¶æž„ç¨³å®šè¿è¡Œäº†è¿‘ 3 å¹´ï¼Œä¸­é—´ç»åŽ†äº†å‡ æ¬¡å°çš„å‡çº§ä¼˜åŒ–ï¼Œæœ‰åŠ›æ”¯æ’‘äº†è¿™ä¸ªè¿‡ç¨‹ä¸­çš„å„ç§ä¸šåŠ¡åˆ›æ–°ï¼Œä½†ä¹Ÿåœ¨æ”¯æ’‘ä¸šåŠ¡å¿«é€Ÿå‘å±•ä¸­åŸ‹ä¸‹äº†ä¸€äº› â€œå‘â€ã€‚</p>

<p>2016 å¹´ï¼Œæˆ‘ä»¬å†³å®šå¯¹ç³»ç»Ÿè¿›è¡Œä¸€æ¬¡å¤§å‡çº§ã€‚è¿™æ¬¡å‡çº§çš„ä¸»è¦åŸºè°ƒå°±æ˜¯ â€œä¸šåŠ¡é€»è¾‘é‡æž„ï¼Œä¼˜åŒ–æ¸…ç®—æµç¨‹â€ï¼Œè¿™å°±æ˜¯ä½™é¢å® 3.0ï¼</p>

<p>è¿™ä¸€é˜¶æ®µçš„ä¸šåŠ¡é€»è¾‘å¤æ‚åº¦è¦è¿œè¿œé«˜äºŽ 3 å¹´å‰ï¼Œå› æ­¤ 3.0 çš„æž¶æž„ä¸­ï¼Œè®¡ç®—å•å…ƒæ¯” 2.0 æœ‰äº†æ˜Žæ˜¾çš„æ‰©å……ã€‚ç”±äºŽæ•°æ®åº“å‰æœŸé¢„ç•™çš„ buffer æ¯”è¾ƒå¤§ï¼Œå¹¶æ²¡æœ‰æˆä¸ºæœ¬é˜¶æ®µçš„ç“¶é¢ˆï¼Œä¾ç„¶ç»´æŒäº† 50 ä¸ªèŠ‚ç‚¹çš„è§„æ¨¡ã€‚</p>

<p>è¿™æ¬¡å‡çº§ä¹‹åŽï¼Œæ€»ä½“è®¡ç®—èƒ½åŠ›æœ‰äº†è¾ƒå¤§å¹…åº¦çš„æé«˜ã€‚å¤„ç†æ•ˆçŽ‡æ¯”èµ· 2.0 çš„æ—¶å€™å¢žé•¿äº† 2 å€å¤šï¼Œä¹Ÿæ”¯æ’‘äº† 2016 å¹´æ˜¥èŠ‚æœŸé—´æ—¥äº¤æ˜“ 4 äº¿å¤šç¬”çš„å³°å€¼ã€‚ä½†æ˜¯ï¼Œæ¸…ç®—æ—¶é—´æ¯” 2.0 æ—¶æœŸæœ‰è¾ƒå¤§å¢žé•¿ï¼Œè¿™æˆäº†ç³»ç»Ÿçš„ä¸€ä¸ª â€œéšæ‚£â€ã€‚</p>

<p><img src="https://pic1.zhimg.com/80/v2-ffb278a398ee7a6d383025d3e579863f_hd.jpg" alt=""/></p>

<p>2017 å¹´ï¼Œä¸ºäº†é…åˆæ”¯ä»˜å®æ‹“å®½çº¿ä¸‹æ”¯ä»˜åœºæ™¯ï¼Œå¹¶å°†ä¸šåŠ¡æŽ¨å¹¿è¦†ç›–åˆ°ä¸‰ã€å››çº¿åŸŽå¸‚ï¼ŒåŒæ—¶ï¼Œä¹Ÿè¦è§£å†³æ¸…ç®—æ—¶é—´è¿‡é•¿çš„éšæ‚£ï¼Œæˆ‘ä»¬è§„åˆ’äº†ä½™é¢å® 4.0 çš„å‡çº§ã€‚</p>

<p>è¿™ä¸€é˜¶æ®µçš„ç³»ç»Ÿè§„æ¨¡å·²ç»å¾ˆå¤§äº†ï¼Œå¦‚æžœè¿˜æ˜¯æŒ‰ 3.0 çš„æž¶æž„è¿›è¡Œæ¨ªå‘æ‰©å……çš„è¯ï¼Œæˆæœ¬å°†å‘ˆçº¿æ€§å¢žé•¿ã€‚ç»è¿‡ç»¼åˆè€ƒé‡ï¼Œå†³å®šåœ¨å‡çº§å‰ï¼Œå…ˆä¼˜åŒ–å•èŠ‚ç‚¹çš„å¤„ç†æ€§èƒ½ï¼Œæé«˜æ•ˆçŽ‡åŠè´Ÿè½½åŽå†æ‰©å®¹ï¼Œä»¥é™ä½Žæ€»ä½“çš„å‡çº§æˆæœ¬ã€‚</p>

<p>å› æ­¤ï¼Œè¿™æ¬¡å‡çº§é¦–å…ˆå°†ç›´é”€å’Œä»£é”€ä¸šåŠ¡åˆäºŒä¸ºä¸€ï¼ŒåŒä¸€å°è®¡ç®—å•å…ƒæ—¢å¤„ç†ç›´é”€ä¸šåŠ¡ï¼Œä¹Ÿå¤„ç†ä»£é”€ä¸šåŠ¡ï¼Œæé«˜äº†å•ç‚¹çš„å¤„ç†æ•ˆçŽ‡ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå†è¿›è¡Œæ‰©å®¹ï¼Œå°†è®¡ç®—å•å…ƒä»Ž 340 èŠ‚ç‚¹æ‰©å……åˆ° 480 èŠ‚ç‚¹ï¼Œæ•°æ®åº“æ‰©å®¹ 4 å€ã€‚é€šè¿‡è¿™ä¸¤æ­¥ä¼˜åŒ–åŠæ‰©å……åŠ¨ä½œï¼Œæœ€ç»ˆç³»ç»Ÿçš„å®¹é‡åŠè®¡ç®—èƒ½åŠ›å‡æœ‰äº† 4~8 å€çš„æé«˜ï¼Œè¿™å¥—æ–°çš„æž¶æž„æ”¯æ’‘æˆ‘ä»¬å¹³ç¨³åº¦è¿‡äº† 2017 å¹´åŒåä¸€åŠæ˜¥èŠ‚çš„äº¤æ˜“é«˜å³°ã€‚</p>

<p>çœ‹åˆ°è¿™é‡Œï¼Œå¤§å®¶å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼šä¸€èˆ¬åœ¨ç³»ç»ŸæœåŠ¡åŒ–æ”¹é€ ä¸­ï¼ŒæœåŠ¡æ˜¯ä¼šè¢«æ‹†çš„è¶Šæ¥è¶Šç»†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬åå…¶é“è€Œè¡Œï¼Œåè€Œå¯¹æœåŠ¡è¿›è¡Œäº†æ•´åˆï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œä½™é¢å®å‘å±•åˆ°çŽ°åœ¨ï¼Œä¸šåŠ¡æ¨¡å¼å·²ç»æ¯”è¾ƒæˆç†Ÿï¼Œé€šè¿‡ç»†ç²’åº¦çš„æœåŠ¡æ¨¡æ€æ¥ä¿è¯å¯æ‰©å±•æ€§çš„éœ€æ±‚å·²ç»ä¸æ˜¯é‚£ä¹ˆå¼ºçƒˆï¼›å¦ä¸€æ–¹é¢ï¼Œç³»ç»Ÿè§„æ¨¡åºžå¤§ï¼Œæ‰©å®¹çš„æˆæœ¬æˆä¸ºé‡ç‚¹è€ƒè™‘å› ç´ ï¼›ç»¼åˆè¿™ä¸¤æ–¹é¢çš„è€ƒé‡ï¼Œé€‚å½“å¢žåŠ å•ç‚¹çš„å¤æ‚åº¦ï¼Œå¯ä»¥é™ä½Žæ•´ä½“æˆæœ¬ã€‚</p>

<p><img src="https://pic4.zhimg.com/80/v2-49d8eaa19b1a017f36edd9ae65199acb_hd.jpg" alt=""/></p>

<p>ç›®å‰ï¼Œé’ˆå¯¹ä½™é¢å®è¿™å•åªåŸºé‡‘å·²ç»å»ºç«‹èµ·äº†ä¸€å¥—å®Œæ•´çš„æŠ€æœ¯ç”Ÿæ€ä½“ç³»ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯ä½™é¢å®çš„äº§å“ã€å¸å·ã€äº¤æ˜“ã€æ¸…ç®—ç­‰æ¨¡å—ï¼Œåœ¨ç»“åˆå®žæ—¶è°ƒç”¨å’Œæ–‡ä»¶äº¤äº’ä¸¤å¥—æŽ¥å£çš„åŸºç¡€ä¸Šï¼Œæž„å»ºäº†ç”µå•†å¤§æ•°æ®çš„åˆ†æžä½“ç³»åŠä¸€ç³»åˆ—è¾…åŠ©æ”¯æ’‘ç³»ç»Ÿã€‚åŒæ—¶ï¼Œä½™é¢å®ç³»ç»Ÿå’Œå…¶å®ƒç¬¬ä¸‰æ–¹ç³»ç»Ÿä¹Ÿæœ‰å¤§é‡çš„äº¤äº’ï¼ŒåŒ…æ‹¬æ”¯ä»˜å®ã€ç›‘ç®¡ã€ç›´ä»£é”€æ¸ é“ç­‰ç­‰ã€‚</p>

<p>æˆ‘ä»¬æ˜¯å¦‚ä½•è¿›è¡ŒåŸºé‡‘å®žæ—¶é”€å”®å¹³å°åŠå¤§æ•°æ®å¹³å°çš„æœåŠ¡åŒ–æ”¹é€ çš„<br/>
ä½™é¢å®ç³»ç»Ÿçš„å»ºè®¾ç›´æŽ¥é”»ç‚¼äº†å¤©å¼˜çš„æŠ€æœ¯å›¢é˜Ÿï¼Œè®©æˆ‘ä»¬æ˜Žç™½äº†å¤§åž‹äº’è”ç½‘åº”ç”¨æ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„çŽ©æ³•ï¼Œè¿™ä¹Ÿç›´æŽ¥æŽ¨åŠ¨äº†å¤©å¼˜è‡ªæœ‰çš„åŸºé‡‘ç›´é”€å¹³å°çš„æœåŠ¡åŒ–æ”¹é€ ã€‚æŽ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä»ŽåŸºé‡‘å®žæ—¶äº¤æ˜“å¹³å°åŠå¤§æ•°æ®å¹³å°çš„æœåŠ¡åŒ–æ”¹é€ è¿™ä¸¤æ–¹é¢æ¥å¯¹æ­¤åˆ†åˆ«åšè¯¦ç»†ä»‹ç»ã€‚</p>

<p><img src="https://pic1.zhimg.com/80/v2-f2286374d36cbd661878e12ee089f9de_hd.jpg" alt=""/></p>

<p><strong>åœ¨å¼€å§‹è¿™å—çš„å†…å®¹ä¹‹å‰ï¼Œå…ˆç®€å•çš„ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹åŸºé‡‘å…¬å¸çš„ä¸šåŠ¡ã€‚</strong><br/>
åŸºé‡‘å…¬å¸æœ€ä¸»è¦çš„å°±æ˜¯ â€œä¹°å–â€ åŸºé‡‘ï¼Œæˆ‘ä»¬ä»Žç›´é”€å’Œä»£é”€æ¸ é“æŠŠäº¤æ˜“è¯·æ±‚ â€œæŽ¥â€ è¿›æ¥ï¼Œåœ¨æˆ‘ä»¬çš„æ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿè¿›è¡Œç”³è´­ã€è®¤è´­ã€å®šæŠ•ã€èµŽå›žã€è½¬æ¢ç­‰ç­‰æ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹é‡Œï¼Œä¼šæ¶‰åŠä¸Žæ”¯ä»˜æ¸ é“ã€é“¶è¡Œç­‰ä¸€ç³»åˆ—çš„äº¤ä»˜ï¼›åŒæ—¶ï¼Œè¿˜æœ‰å¤§é‡çš„æ¸…ç»“ç®—å’Œ TA æ¸…ç®—ï¼Œè¿™ä¸ªè¿‡ç¨‹é‡Œï¼Œè¿˜è¦å’Œé“¶è¯ç›‘ä¼šã€ä¸­ç™»ç­‰ä¸€ç³»åˆ—ç›‘ç®¡æœºæž„æœ‰æ•°æ®ä¸Šçš„äº¤äº’ã€‚èšæ‹¢è¿‡æ¥çš„å·¨é‡çš„èµ„é‡‘ä¼šè¢«ç»Ÿä¸€ç®¡æŽ§ã€å¹¶æŠ•å…¥åˆ°è‚¡å¸‚ã€å€ºå¸‚ã€è´§å¸å¸‚åœºç­‰æŠ•èµ„å¸‚åœºåŽ»èµšé’±æ”¶ç›Šã€‚å›´ç»•è¿™ä¸ªä¸šåŠ¡è¿˜æœ‰ç›¸åº”çš„æŠ•ç ”ã€åŸºé‡‘äº§å“ç®¡ç†ã€é£ŽæŽ§ã€å®¢æœç­‰ä¸­åŽå°çš„ä¸šåŠ¡æ”¯æŒã€‚<br/>
ä»¥ä¸Šï¼Œå°±æ˜¯åŸºé‡‘å…¬å¸çš„æ—¥å¸¸ä¸šåŠ¡æ¨¡å¼ã€‚</p>

<p><img src="https://pic2.zhimg.com/80/v2-d4ef2511eaa39b96914d43002786fcab_hd.jpg" alt=""/></p>

<p>åœ¨å¤©å¼˜æ—©æœŸçš„åŸºé‡‘é”€å”®ç³»ç»Ÿçš„å»ºè®¾ä¸­ï¼Œå…¶å®žæ²¡æœ‰ä»€ä¹ˆæœåŠ¡åŒ–çš„æ¦‚å¿µï¼Œå½“æ—¶çš„æ¨¡å¼æ˜¯æœ‰ä»€ä¹ˆç±»åž‹çš„ä¸šåŠ¡ï¼Œå°±é’ˆå¯¹è¿™ç§ä¸šåŠ¡å•ç‹¬å¼€å‘ä¸€å¥—ç‹¬ç«‹çš„é”€å”®åŠæ¸…ç»“ç®—ç³»ç»Ÿã€‚ç”±äºŽä¸šåŠ¡é‡æ™®éä¸å¤§ï¼Œè¿™äº›ç³»ç»Ÿå¾€å¾€é‡‡ç”¨å•ä½“æž¶æž„æ¨¡å¼ï¼Œä¸è€ƒè™‘æ¨ªå‘æ‰©å±•æ€§ã€‚ç»è¿‡å¤šå¹´çš„å‘å±•å’Œç§¯ç´¯ï¼Œå†…éƒ¨å¤šå¥—ç›´é”€åŠä»£é”€äº¤æ˜“ç³»ç»Ÿå¹¶å­˜ï¼Œç³»ç»Ÿé—´å¸å·æ²¡æœ‰æ‰“é€šï¼Œç”¨æˆ·çš„èµ„äº§æ•°æ®æ— æ³•ç»Ÿä¸€ï¼Œç”¨æˆ·ä½“éªŒå·®ï¼›å¦ä¸€æ–¹é¢ï¼Œå„ç³»ç»Ÿé—´åŠŸèƒ½é‡å¤çš„çŽ°è±¡ä¸¥é‡ï¼Œä¸ä»…é‡å¤å ç”¨è½¯ç¡¬ä»¶èµ„æºï¼Œç‰ˆæœ¬çš„æŽ§åˆ¶ä¹Ÿå¾ˆéº»çƒ¦ã€‚<br/>
è¿™ç§çŠ¶å†µç”šè‡³åœ¨æˆ‘ä»¬æ•´ä½“è¿ç§»åˆ°äº‘ä¸Šä¹‹åŽè¿˜å­˜åœ¨äº†å¾ˆé•¿çš„ä¸€æ®µæ—¶é—´ï¼Œæ‰€ä»¥ï¼Œ<strong>æ‰€è°“çš„ â€œæœåŠ¡åŒ–â€ï¼Œå¹¶ä¸æ˜¯ä»…ä»…ä¸Šäº‘é‚£ä¹ˆç®€å•ï¼Œå®ƒæ›´å¤šçš„è¿˜æ˜¯æ¶‰åŠåˆ°æž¶æž„æ€ç»´çš„è½¬å˜ã€‚</strong></p>

<p><img src="https://pic1.zhimg.com/80/v2-f23511243bdad6525dd807da0e29b059_hd.jpg" alt=""/></p>

<p>ç—›å®šæ€ç—›ä¹‹åŽï¼Œæˆ‘ä»¬å†³å®šå°†è¿™äº›ç³»ç»Ÿä¸­é€šç”¨çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬ç”¨æˆ·è´¦æˆ·ã€äº¤æ˜“ã€æ”¯ä»˜ã€èµ„äº§ã€ç»“ç®—ç­‰æŠ½å–å‡ºæ¥ï¼Œä»¥ç‹¬ç«‹æœåŠ¡çš„å½¢å¼å¯¹å¤–æä¾›é€šç”¨æœåŠ¡ã€‚è¿™æ ·ï¼ŒåŽŸæ¥çš„ä¸šåŠ¡ç³»ç»Ÿæ›´å¤šçš„å……å½“äº†ä¸€ä¸ªäº¤æ˜“å¤§åŽ…çš„è§’è‰²ï¼Œå¯ä»¥åšçš„æ›´è½»ï¼Œæ‰©å±•ä¹Ÿå°±æ›´å®¹æ˜“äº†ã€‚ç”¨æˆ·çš„äº¤æ˜“è¯·æ±‚é€šè¿‡å®‰å…¨ç½‘å…³å±‚è¢«ç»Ÿä¸€æŽ¥å…¥è¿›æ¥ï¼Œæˆ‘ä»¬ç›®å‰ä½¿ç”¨äº†ä¸¤å¥—ç½‘å…³ï¼Œä¸€å¥—æ˜¯ SLBï¼Œå¦å¤–ä¸€å¥—æ˜¯ç§»åŠ¨ç½‘å…³ã€‚æ•´å¥—å¹³å°éƒ½æ˜¯åœ¨é˜¿é‡Œäº‘åŠèš‚èšé‡‘èžäº‘çš„ I å±‚åŠ P å±‚èƒ½åŠ›åŸºç¡€ä¹‹ä¸Šæž„å»ºçš„ï¼Œæˆ‘ä»¬åœ¨å®ƒä»¬çš„åŸºç¡€ä¹‹ä¸Šè¿˜æž„å»ºäº†ç›¸åº”çš„æ—¥å¿—ç›‘æŽ§ã€æœåŠ¡æ²»ç†ã€APMã€è¿ç»´ç®¡æŽ§ç­‰ä¸€ç³»åˆ—èƒ½åŠ›ã€‚</p>

<p>ä»¥ä¸Šï¼Œå°±æ˜¯æˆ‘ä»¬ç›®å‰å®žæ—¶äº¤æ˜“å¹³å°çš„æ•´ä½“æœåŠ¡åŒ–çš„æž¶æž„ã€‚</p>

<p><img src="https://pic1.zhimg.com/80/v2-4eb0d4d090cc40b5e6bf09278b050c95_hd.jpg" alt=""/></p>

<p>æ•°æ®åˆ†æžä¹Ÿæ˜¯é‡‘èžå…¬å¸çš„ä¸€é¡¹é‡è¦å·¥ä½œï¼Œæˆ‘ä»¬çš„å¤§æ•°æ®å¹³å°ä¼šä»Žå®žæ—¶çº¿ä¸Šä¸šåŠ¡ç³»ç»Ÿã€æ¸…ç»“ç®—ç³»ç»Ÿã€è¿è¥æ´»åŠ¨ã€web åŠ APP çš„ç”¨æˆ·åŸ‹ç‚¹ä¸­é‡‡é›†å„ä¸ªç»´åº¦çš„æ•°æ®ï¼Œå¹¶ä»¥ ODSï¼ˆæ“ä½œåž‹æ•°æ®ï¼‰æ±‡æ€»åˆ°æ•°æ®ä»“åº“ä¸­ï¼Œå†æ ¹æ®é¢„å…ˆå®šä¹‰çš„æ•°æ®æ¨¡åž‹ï¼ŒæŠ½å–å‡ºç›¸åº”çš„ä¸»æ•°æ®ã€‚åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šï¼ŒåŸºäºŽç”¨æˆ·ã€è¿è¥ã€èµ„äº§ã€äº¤æ˜“ã€é£ŽæŽ§ç­‰ä¸»é¢˜æ¥æž„å»ºå¤šå±‚æ¬¡çš„æ•°æ®é›†å¸‚ã€‚æœ‰äº†è¿™ä¸ªæ•°æ®é›†å¸‚ä¹‹åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»¥æœåŠ¡çš„å½¢å¼ï¼Œåœ¨æ•°æ®ä¸Šåšä¸€å±‚æœåŠ¡åŒ–çš„å°è£…ï¼Œåœ¨å…¶ä¸Šè¿›è¡Œæ•°æ®çš„åº”ç”¨ã€‚ä¸€ç±»åº”ç”¨æ˜¯æ•°æ®çš„ç¦»çº¿åˆ†æžï¼ŒåŒ…æ‹¬ç•™å­˜åˆ†æžã€ä¿æœ‰åˆ†æžã€è¥é”€åˆ†æžç­‰ç­‰ï¼›å¦ä¸€ç±»åº”ç”¨æ˜¯å°†è¿™äº›é‡åº¦æ±‡æ€»æ•°æ®åº”ç”¨åœ¨å®žæ—¶ä¸šåŠ¡ä¹‹ä¸­ï¼Œå°¤å…¶æ˜¯è¥é”€æ´»åŠ¨ä¹‹ä¸­ã€‚æˆ‘ä»¬åœ¨è¿™äº›æ•°æ®é›†å¸‚ä¸Šï¼Œæž„å»ºäº†ä¸€äº›é«˜çº§è¿è¥æ´»åŠ¨ï¼ŒåŒ…æ‹¬åŸºäºŽç”¨æˆ·ç»¼åˆèµ„äº§æž„å»ºçš„ç†è´¢ç«žèµ›ï¼Œå¦‚ â€œå¼˜è¿æ¦œâ€ã€â€œå¹´åº¦è´¦å•â€ã€â€œç†è´¢è¾¾äººâ€ ç­‰ç­‰ï¼›å¦å¤–ï¼Œæˆ‘ä»¬è¿˜åŸºäºŽè¿™äº›ä¸åŒç»´åº¦çš„æ•°æ®ï¼Œæžäº†ä¸€ä¸ªè¡¡é‡ç”¨æˆ·ç»¼åˆç†è´¢èƒ½åŠ›çš„æŒ‡æ ‡ä½“ç³»ï¼Œå³â€œè´¢å•†æŒ‡æ•°â€ã€‚</p>

<p>æˆ‘ä»¬è¿™å¥—èƒ½åŠ›æ˜¯åŸºäºŽé˜¿é‡Œäº‘ä¸Šçš„å¤§æ•°æ®åŠ å·¥åŠåˆ†æžèƒ½åŠ›æ¥æž„å»ºçš„ï¼Œåˆ©ç”¨äº†é˜¿é‡Œäº‘çš„ MaxComputeã€DTSã€QuickBI ç­‰ä¸€ç³»åˆ—èƒ½åŠ›ã€‚åœ¨å¤§æ•°æ®å¹³å°çš„èƒ½åŠ›æž„å»ºä¸Šï¼Œæˆ‘ä»¬éµå¾ªå¦‚ä¸‹æ¨¡å¼ï¼šé¦–å…ˆè¿›è¡Œæ•°æ®æ¨¡åž‹çš„è§„åˆ’ï¼›æœ‰äº†æ¨¡åž‹ä¹‹åŽåˆ©ç”¨ ETL è¿›è¡Œæ•°æ®çš„æŠ½å–ã€è½¬æ¢åŠæ¸…æ´—ï¼›æŽ¥ç€å†åˆ©ç”¨ä¸€ç³»åˆ—çš„è§„åˆ™å¯¹æ•°æ®è´¨é‡è¿›è¡Œç›‘æŽ§ï¼›å°†æ ¼çš„æ•°æ®å…±äº«å‡ºåŽ»ï¼Œä¾›å…¶ä»–æ–¹åº”ç”¨ï¼›å¦å¤–ï¼Œå®šæœŸè¿›è¡Œæ•°æ®èµ„äº§è¯„ä¼°ï¼ŒåŸºäºŽè¯„ä¼°ç»“æžœä¸æ–­çš„å¯¹æ¨¡åž‹è¿›è¡Œä¼˜åŒ–è°ƒæ•´ã€‚è¿™æ ·ï¼Œå°±å½¢æˆäº†å¯¹æ•°æ®çš„é—­çŽ¯æ“ä½œã€‚</p>

<p><strong>åœ¨è¿™é‡Œï¼Œè¦é‡ç‚¹å¼ºè°ƒçš„æ˜¯æ•°æ®è´¨é‡ç›‘æŽ§ã€‚</strong>å¯¹äºŽç¦»çº¿åˆ†æžï¼Œæ•°æ®çš„ç²¾åº¦åŠå®žæ—¶æ€§æ™®éè¦æ±‚ä¸é«˜ï¼›ä½†å¯¹äºŽäºŒæ¬¡ä½¿ç”¨çš„æ±‡æ€»æ•°æ®ï¼Œåˆ™æœ‰å¾ˆé«˜çš„ç²¾åº¦è¦æ±‚å’Œå®žæ—¶æ€§è¦æ±‚ï¼Œæ¯”å¦‚ç”¨äºŽç”¨æˆ·ç«žèµ›æŽ’è¡Œå¹¶æœ‰å¥–åŠ±çš„ä¸€äº›è¿è¥æ´»åŠ¨ï¼Œç”±äºŽæ¯ç¬”äº¤æ˜“è®°å½•éƒ½ä¸Žé’±æŒ‚é’©ï¼Œç”¨æˆ·å¯¹å‡†ç¡®æ€§å¾ˆæ•æ„Ÿï¼Œç¨æœ‰ä¸æ…Žå°±ä¼šå¼•å‘å¤§è§„æ¨¡çš„å®¢è¯‰ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è‡ªæž„å»ºçš„è§„åˆ™å¼•æ“ŽåŸºç¡€ä¸Šï¼Œåˆ©ç”¨æ•°ç™¾æ¡é¢„å…ˆå®šä¹‰çš„è§„åˆ™ï¼Œå¯¹æ•°æ®è¿›è¡ŒæŠ½æ ·æˆ–è€…å…¨é‡çš„æ£€æµ‹ï¼Œä¸€æ—¦æ£€æµ‹åˆ°å¼‚å¸¸ï¼Œåˆ™ä¼šè‡ªåŠ¨è§¦å‘äººå·¥è®¢æ­£æˆ–è€…è‡ªåŠ¨åŒ–æ•°æ®è®¢æ­£çš„ä»»åŠ¡ã€‚</p>

<p><img src="https://pic2.zhimg.com/80/v2-485378d5ee7e8316cd128b96ce0c0b68_hd.jpg" alt=""/></p>

<p>æˆ‘ä»¬ç›®å‰ä½¿ç”¨çš„æœåŠ¡åŒ–çš„åº•å±‚æ¡†æž¶æ˜¯èš‚èšé‡‘èžäº‘æä¾›çš„ SOFARPCã€‚SOFARPC æä¾›äº†ç›¸å¯¹ç®€ä¾¿çš„æœåŠ¡æš´éœ²åŠæœåŠ¡æŽ¥å…¥çš„æ–¹å¼ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå®ƒå¯ä»¥åŸºäºŽ Spring çš„æ‰©å±•æ ‡ç­¾æœºåˆ¶ï¼ŒæŠŠä¸€ä¸ª Spring çš„ bean å®žä¾‹ä»¥ç‰¹å®šçš„åè®®æš´éœ²ä¸ºè¿œç¨‹æœåŠ¡ï¼Œä¹Ÿå¯ä»¥ä»¥æŽ¥å£çš„å½¢å¼æŠŠä¸€ä¸ªè¿œç¨‹æœåŠ¡æŽ¥å…¥è¿›æ¥ï¼ŒåŒæ—¶ï¼Œå®ƒè¿˜æä¾›äº†é“¾å¼è¿‡æ»¤å™¨çš„æœºåˆ¶ï¼Œå¯¹æ‰€æœ‰çš„æœåŠ¡è°ƒç”¨è¯·æ±‚è¿›è¡Œä¸€ä¸ªä¸²è¡Œå¼çš„å¤„ç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å®ƒæ¥å®žçŽ°ä¸€äº›è‡ªå®šä¹‰çš„æœåŠ¡ç®¡æŽ§ç­–ç•¥ï¼ŒåŒ…æ‹¬æœåŠ¡ Mockï¼Œçº¿ä¸Šæ•°æ®é‡‡é›†ç­‰èƒ½åŠ›ã€‚</p>

<p><img src="https://pic4.zhimg.com/80/v2-425203cfc2fd880b46e9e9848f3ff95e_hd.jpg" alt=""/></p>

<p>å•æœ‰åˆ†å¸ƒå¼æœåŠ¡æ¡†æž¶ï¼Œè¿˜ä¸è¶³ä»¥ä¿è¯æœåŠ¡åŒ–çš„å¹³ç¨³è½åœ°ã€‚ä¼ä¸šæœåŠ¡åŒ–ä¹‹è·¯è¦èµ°çš„é¡ºç•…ï¼Œä¸€å®šæ˜¯è¦ä¸¤æ¡è…¿èµ°è·¯çš„ï¼Œä¸€æ¡è…¿æ˜¯åˆ†å¸ƒå¼æœåŠ¡æ¡†æž¶ï¼Œå¦ä¸€æ¡è…¿æ˜¯æœåŠ¡æ²»ç†ï¼Œåªæœ‰ä¸¤æ¡è…¿éƒ½å¥å£®ï¼Œè·¯æ‰èƒ½èµ°çš„é¡ºç•…ã€‚é˜¿é‡Œäº‘ç»“åˆå®ƒçº¿ä¸Šçš„èµ„æºç¼–æŽ’å’Œèµ„æºè°ƒåº¦èƒ½åŠ›ï¼Œä¸º SOFARPC æä¾›äº†ç›¸å¯¹å®Œå–„çš„æœåŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿå®žçŽ°è¯¸å¦‚æœåŠ¡ä¸Šçº¿ã€ä¸‹çº¿ï¼Œæ‰©å®¹ã€ç¼©å®¹ç­‰æ“ä½œã€‚åŒæ—¶ï¼Œèš‚èšè¿˜æä¾›äº†ä¸€ä¸ªå« Guardian çš„ç»„ä»¶ï¼Œé€šè¿‡å®ƒå¯ä»¥å®žçŽ°å¯¹çº¿ä¸ŠæœåŠ¡çš„ç†”æ–­é™æµçš„è‡ªåŠ¨ä¿æŠ¤æœºåˆ¶ï¼Œç±»ä¼¼ Netflix æä¾›çš„ Hystrix ç»„ä»¶ï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥åŽ»äº†è§£ä¸€ä¸‹ã€‚</p>

<p><img src="https://pic4.zhimg.com/80/v2-ecf0fe4b534d372dc36043fc9e913ba5_hd.jpg" alt=""/></p>

<p>æˆ‘æ‰€åœ¨çš„ç§»åŠ¨å¼€å‘éƒ¨é—¨ï¼Œé‡‡ç”¨äº†èš‚èšçš„ç§»åŠ¨å¼€å‘å¹³å° mPaaS æ¡†æž¶ï¼ŒmPaaS æ˜¯ç±»ä¼¼ OSGi çš„ä¸€å¥—æ¨¡å—åŒ–çš„æ’ä»¶ç®¡ç†æ¡†æž¶ï¼ŒAPP åº”ç”¨éœ€è¦çš„å„ç§åŸºç¡€èƒ½åŠ›éƒ½å¯ä»¥ä»¥æ’ä»¶çš„å½¢å¼é›†æˆè¿›æ¥ï¼Œå®ƒæä¾›çš„æœåŠ¡è¿œç¨‹è°ƒç”¨èƒ½åŠ›å°±æ˜¯åŸºäºŽ SOFARPCã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸Šé¢çš„è¿™ä¸ªå›¾ï¼ŒmpaaS æä¾›äº†ç»Ÿä¸€çš„æœåŠ¡ç½‘å…³ï¼Œå¯ä»¥å®žçŽ°å¯¹æœåŠ¡ç«¯çš„ SOFA æœåŠ¡çš„è¿œç¨‹è°ƒç”¨èƒ½åŠ›ï¼›åŒæ—¶ï¼Œå®ƒè¿˜æä¾›äº†æ—¥å¿—ç½‘å…³å’Œæ¶ˆæ¯ç½‘å…³ï¼Œå¯ä»¥å®žçŽ°å¯¹ APP ä¸Šçš„åŸ‹ç‚¹ä¿¡æ¯çš„é‡‡é›†æœåŠ¡åŠæ¶ˆæ¯çš„æŽ¨é€æœåŠ¡ã€‚é€šè¿‡ mPaaS è¿™å¥—æ¡†æž¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›¸å¯¹æ–¹ä¾¿çš„å®žçŽ°ç§»åŠ¨åº”ç”¨çš„å¼€å‘å·¥ä½œã€‚</p>

<p>ä»¥ä¸Šå°±æ˜¯ç›®å‰æˆ‘ä»¬åŸºé‡‘å®žæ—¶é”€å”®å¹³å°çš„æ•´ä½“æœåŠ¡åŒ–çš„ä¸€ä¸ªçŠ¶å†µï¼ŒæŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†ä»‹ç»ä¸€ä¸‹æœåŠ¡åŒ–å¯¹æˆ‘ä»¬ç ”å‘å’Œè¿ç»´çš„å½±å“ã€‚</p>

<p><img src="https://pic1.zhimg.com/80/v2-6b965f3bb1d5779437aa9d4bd751a8f8_hd.jpg" alt=""/></p>

<p>â€œæœåŠ¡åŒ–â€ å¯¹æˆ‘ä»¬è¿ç»´åŠç ”å‘æ¨¡å¼çš„å½±å“åŠæˆ‘ä»¬çš„åº”å¯¹ç­–ç•¥<br/>
æœåŠ¡åŒ–çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª â€œæ‹†â€ å­—ï¼ŒåŽŸæ¥çš„å•ä½“åº”ç”¨è¢«æ‹†æˆäº†å¤§å¤§å°å°çš„åº”ç”¨é›†ç¾¤å’ŒæœåŠ¡é›†ç¾¤ï¼Œå¹¶è¢«åˆ†æ•£åˆ°ç½‘ç»œçš„å„ä¸ªèŠ‚ç‚¹ï¼Œç”±ä¸åŒçš„å›¢é˜Ÿè´Ÿè´£ï¼Œæ¯ä¸ªå›¢é˜Ÿå„ç®¡ä¸€æ®µã€‚åœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹ï¼Œè¿ç»´å’Œç ”å‘éƒ½ä¼šé­é‡ä¸€ç³»åˆ—æ–°çš„é—®é¢˜å’ŒæŒ‘æˆ˜ï¼ŒåŒ…æ‹¬æ•…éšœçš„å®šç•Œå®šä½ã€è°ƒç”¨å…³ç³»çš„æ¢³ç†ã€é›†ç¾¤çŽ¯å¢ƒä¸‹çš„è°ƒè¯•åŠåˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹çš„äº‹åŠ¡ä¸€è‡´æ€§çš„ä¿éšœç­‰ç­‰ã€‚</p>

<p>æŽ¥ä¸‹æ¥å°±æ¥çœ‹çœ‹ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•ç ´è§£è¿™äº›å›°å±€çš„ã€‚</p>

<p><img src="https://pic4.zhimg.com/80/v2-53adc1cb5473ec83cb8ab8e1ee178c47_hd.jpg" alt=""/></p>

<p><strong>ã€åªæœ‰æ›´é«˜æ•ˆçš„æ”¶é›†çº¿ä¸ŠæœåŠ¡çš„æ—¥å¿—ï¼Œæ‰èƒ½æ›´å¥½çš„å¯¹æœåŠ¡è¿›è¡Œç›‘æŽ§å’Œç®¡æŽ§ã€‘</strong><br/>
ä¼ ç»Ÿçš„æ—¥å¿—æ”¶é›†ä¸€èˆ¬é‡‡ç”¨è¯¸å¦‚ log4j è¿™ç±»çš„æ—¥å¿—ç»„ä»¶è¿›è¡Œæ—¥å¿—çš„è½ç›˜ï¼Œå†é€šè¿‡ logstash æˆ–è€… flume è¿™ç±»çš„æ—¥å¿—é‡‡é›†ç»„ä»¶è¿›è¡Œè½ç›˜æ—¥å¿—çš„å¢žé‡æ”¶é›†ï¼Œé€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œæ—¥å¿—é‡‡é›†å­˜åœ¨å¤§é‡çš„ç£ç›˜ IOã€‚å¯¹äºŽçº¿ä¸ŠæœåŠ¡å™¨æ¥è¯´ï¼Œæœ€å¤§çš„æ€§èƒ½ç“¶é¢ˆå°±æ˜¯ç£ç›˜ IOï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘å’Œé«˜è´Ÿè½½çŽ¯å¢ƒä¸‹ï¼Œç£ç›˜ IO å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“ä¼šè¢«æˆå€æ”¾å¤§ã€‚æˆ‘ä»¬çš„æµ‹è¯•æ˜¾ç¤ºï¼Œåœ¨æ•´ä¸ªç³»ç»Ÿè´Ÿè½½è¢«æ‰“æ»¡çš„å‰æä¸‹ï¼Œæ—¥å¿—é‡‡é›†æ‰€äº§ç”Ÿçš„æ•´ä½“æ€§èƒ½æ¶ˆè€—å äº†æ€»èµ„æºçš„ 40% å·¦å³ã€‚</p>

<p>ä¸ºäº†é™ä½Žç³»ç»Ÿèµ„æºå ç”¨ï¼ŒåŒæ—¶æ›´é«˜æ•ˆçš„é‡‡é›†æœåŠ¡æ—¥å¿—ï¼Œæˆ‘ä»¬å¼€å‘äº†æ— ç£ç›˜ IO çš„æ—¥å¿—é‡‡é›†æ–¹å¼ã€‚å…·ä½“æµç¨‹æ˜¯ï¼šé‡‡ç”¨ç±»ä¼¼ Spring AOP çš„æ–¹å¼ï¼Œå¯¹æœåŠ¡çš„è¯·æ±‚è¿›è¡ŒæŒ¡æˆªï¼Œé‡‡é›†æœåŠ¡çš„è°ƒç”¨å»¶æ—¶ã€æœåŠ¡çŠ¶æ€ç­‰ä¿¡æ¯ï¼›åŒæ—¶ï¼Œæ ¹æ®è‡ªå®šä¹‰çš„é…ç½®ï¼ŒæŠ“å–ç‰¹å®šçš„å…¥å‚å’Œå‡ºå‚æ•°æ®ï¼Œæ‰€æœ‰è¿™äº›ä¿¡æ¯éƒ½ä¼šè¢«å°è£…åˆ°ä¸€ä¸ªæ¶ˆæ¯å¯¹è±¡ä¹‹ä¸­ï¼Œå¹¶æ‰”åˆ°ä¸€ä¸ªå†…å­˜æ¶ˆæ¯é˜Ÿåˆ—ä¹‹ä¸­è¿›è¡Œç¼“å­˜ï¼›ä¸Žæ­¤åŒæ—¶ï¼Œæœ‰ç‹¬ç«‹çš„çº¿ç¨‹å¯¹è¿™äº›æ¶ˆæ¯è¿›è¡Œé¢„å¤„ç†ï¼ˆå¦‚æžœéœ€è¦çš„è¯ï¼‰ï¼Œé¢„å¤„ç†ç»“æžœä¹Ÿä¼šè¢«åŽ‹å…¥å†…å­˜æ¶ˆæ¯é˜Ÿåˆ—ä¸­å†æ¬¡è¿›è¡Œç¼“å­˜ï¼›æœ€åŽï¼Œç”±ç‹¬ç«‹çš„å‘é€çº¿ç¨‹å°†è¿™äº›å†…å­˜æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„åŽŸå§‹æ—¥å¿—æˆ–è€…é¢„å¤„ç†æ•°æ®å‘é€åˆ°è¿œç¨‹çš„æ—¥å¿—æ‰‹æœºç«¯ã€‚</p>

<p>åœ¨æ—¥å¿—çš„æ”¶é›†ç«¯ï¼ŒæŽ¥è¿›æ¥çš„æ—¥å¿—ç»Ÿä¸€è¢«æ‰”åˆ°å†…å­˜æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç¼“å­˜ï¼Œå†è¢«åˆ†æ•£åˆ°ä¸åŒæ—¶é—´ç‰‡æ®µå¯¹åº”çš„äºŒçº§æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”±ç‹¬ç«‹çš„åˆ†æžå™¨å®žä¾‹é›†åˆè¿›è¡Œåˆ†æžå’Œè½ç›˜å­˜å‚¨ï¼Œé€šè¿‡è¿™ç§çº¯å†…å­˜ + å…¨å¼‚æ­¥çš„å¤„ç†æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æœ€å¤§é™åº¦çš„é¿å…èµ„æºé”çš„ç«žäº‰ï¼Œå¹¶æ¦¨å–æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œä»Žè€Œå®žçŽ°å¯¹æ—¥å¿—çš„é«˜æ•ˆçš„å¤„ç†ã€‚</p>

<p>é€šè¿‡è¿™å¥—ä½“ç³»ï¼Œåœ¨ä¸å µå¡žçš„æƒ…å†µä¸‹ï¼Œä»»ä½•ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹çš„æ•…éšœï¼Œåœ¨ 1~2 ç§’ä¹‹å†…å°±èƒ½è¢«æˆ‘ä»¬çš„åˆ†æžå™¨æ•æ‰åˆ°ã€‚</p>

<p><img src="https://pic4.zhimg.com/80/v2-43b32c2fb751fef1fb7ec0c1d3be9af5_hd.jpg" alt=""/></p>

<p>å¦‚æžœæŠŠåˆ†å¸ƒå¼æœåŠ¡æ¡†æž¶æ¯”ä½œæ˜¯ â€œå’–å•¡â€ çš„è¯ï¼Œé‚£åº”ç”¨æ€§èƒ½ç®¡ç†ä¸­çš„è°ƒç”¨é“¾ç›‘æŽ§åŠåˆ†æžå°±æ˜¯ â€œå¥¶æ˜”â€ äº†ï¼Œå’–å•¡å’Œå¥¶æ˜”æ˜¯ä»€ä¹ˆï¼Œæ˜¯ç»é…ï¼</p>

<p>è°ƒç”¨é“¾æ¯”å¸¸è§„çš„æ—¥å¿—æ”¶é›†æ–¹å¼æ›´å…³æ³¨æ—¥å¿—ä¹‹é—´çš„å…³ç³»ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„ traceId æŠŠä¸åŒæœåŠ¡èŠ‚ç‚¹ä¸Šçš„æ—¥å¿—èšåˆåœ¨ä¸€èµ·ï¼Œæ¥å®Œæ•´æè¿°ä¸€ä¸ªè¯·æ±‚çš„è°ƒç”¨è¿‡ç¨‹ï¼Œé€šè¿‡è¿™ä¸ªè°ƒç”¨é“¾è·¯ï¼Œæˆ‘ä»¬å¯ä»¥å‘çŽ°æœåŠ¡çš„æ€§èƒ½ç“¶é¢ˆåœ¨å“ªé‡Œã€åŸ‹ç‚¹çš„ç¼ºå¤±æƒ…å†µã€ç½‘ç»œçš„è´¨é‡ç­‰ç­‰ä¸€ç³»åˆ—ä¿¡æ¯ï¼Œé€šè¿‡è°ƒç”¨é“¾çš„èšåˆï¼Œè¿˜å¯ä»¥èŽ·å–åˆ°æœåŠ¡é›†ç¾¤çš„è´Ÿè½½å’Œå¥åº·åº¦ç­‰æ›´å¤æ‚çš„ä¿¡æ¯ã€‚</p>

<p>è°ƒç”¨é“¾èƒ½å¤Ÿæœ‰æ•ˆè§£å†³åˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹çš„ç›‘æŽ§éœ€æ±‚ï¼Œä½†åœ¨ä½¿ç”¨è°ƒç”¨é“¾çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿè¦å¹³è¡¡å…¨é‡‡é›†è¿˜æ˜¯æŠ½æ ·é‡‡é›†ã€è‡ªåŠ¨æ’ç åŸ‹ç‚¹è¿˜æ˜¯æ‰‹åŠ¨åŸ‹ç‚¹ã€å®žæ—¶ç»Ÿè®¡è¿˜æ˜¯é¢„ç»Ÿè®¡ç­‰ç­‰è¿™äº›é—®é¢˜ï¼Œå¦‚ä½•æƒè¡¡ï¼Œéœ€è¦æ ¹æ®è‡ªèº«çš„ç‰¹ç‚¹åŠæŠ€æœ¯å®žåŠ›æ¥åšå†³ç­–ã€‚ä»Šå¤©ç”±äºŽæ—¶é—´å…³ç³»ï¼Œä¸åœ¨è¿™é‡Œå±•å¼€äº†ï¼Œå¦‚æžœæœ‰æ„Ÿå…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥å…³æ³¨æˆ‘åœ¨å¤§ä¼šåŽä¸¤å¤©çš„æ·±åº¦åŸ¹è®­ã€Šå¾®æœåŠ¡æ²»ç†çš„æŽ¢ç´¢ä¸Žå®žè·µã€‹ã€‚</p>

<p><img src="https://pic1.zhimg.com/80/v2-010c471293822c6edf53598a35e63545_hd.jpg" alt=""/></p>

<p>æˆ‘ä»¬å‰é¢è¯´äº†ï¼Œä¼ä¸šæœåŠ¡åŒ–è½åœ°è¦ä¸¤æ¡ â€œè…¿â€ èµ°è·¯ï¼Œä¸€æ¡æ˜¯æœåŠ¡æ¡†æž¶ï¼Œå¦å¤–ä¸€æ¡å°±æ˜¯æœåŠ¡æ²»ç†ï¼ŒæœåŠ¡åŒ–ä¹‹è·¯è¦èµ°çš„é¡ºç•…ï¼Œä¸€å®šæ˜¯ä¸¤æ¡è…¿éƒ½å¥å£®ã€‚</p>

<p>é€šè¿‡å‡ å¹´çš„åŠªåŠ›ï¼Œæˆ‘ä»¬å·²ç»åˆæ­¥æž„å»ºäº†æœåŠ¡åŒ–çš„æ²»ç†ä½“ç³»ï¼Œèƒ½å¤Ÿè¦†ç›–åˆ°æœåŠ¡ç›‘æŽ§å’ŒæœåŠ¡ç®¡æŽ§çš„å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œå…¶ä¸­ç®¡æŽ§çš„å¤§éƒ¨åˆ†èƒ½åŠ›æ˜¯ä¾æ‰˜äºŽèš‚èšé‡‘èžäº‘çš„èƒ½åŠ›æ¥æž„å»ºçš„ï¼Œè€Œç›‘æŽ§è¿™éƒ¨åˆ†èƒ½åŠ›åˆ™æ˜¯åœ¨ SOFARPC çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡æ•´åˆå¸¸è§„æ—¥å¿—ä½“ç³»åŠ APM ç›‘æŽ§çš„èƒ½åŠ›æ¥ç»¼åˆèŽ·å–çš„ã€‚<br/>
æœåŠ¡ç›‘æŽ§è¿™å—ï¼Œæˆ‘ä»¬ä»Žå„ä¸ªæœåŠ¡èŠ‚ç‚¹æŠ½å–æœåŠ¡è°ƒç”¨å»¶æ—¶ã€è°ƒç”¨çŠ¶æ€ã€è°ƒç”¨å¼‚å¸¸ç­‰ä¿¡æ¯ï¼Œå¹¶æ±‡æ€»åˆ°æ—¥å¿—ä¸­å¿ƒè¿›è¡Œç»¼åˆç»Ÿè®¡ï¼Œå¾—åˆ°å„ç±»çš„ç›‘æŽ§æŠ¥è¡¨å’Œç›‘æŽ§å¤§ç›˜ã€‚é€šè¿‡é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œçº¿ä¸Šçš„æ•…éšœå®šä½å®šç•Œï¼›é€šè¿‡è°ƒç”¨é‡çš„å„çº§æ±‡æ€»ï¼Œæˆ‘ä»¬å¯ä»¥èŽ·å–çº¿ä¸Šå®žæ—¶ â€œæ°´ä½â€ï¼Œè¿›è€Œè¿›è¡Œå®¢è§‚çš„å®¹é‡è§„åˆ’ï¼›é€šè¿‡è°ƒç”¨å»¶æ—¶å’Œé”™è¯¯çŽ‡ï¼Œæˆ‘ä»¬å¯ä»¥æŽ¨æ–­çº¿ä¸ŠæœåŠ¡çš„å¥åº·åº¦ï¼›åœ¨è¿™äº›æ•°æ®çš„åŸºç¡€ä¸Šï¼ŒåŸºäºŽæ—¶é—´ç»´åº¦ï¼Œè¿˜å¯ä»¥èŽ·å–åˆ°æœåŠ¡éšæ—¶é—´çš„è´¨é‡æ¼”è¿›æƒ…å†µï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å¯¹æ•´ä¸ªæœåŠ¡é›†ç¾¤å°±èƒ½æœ‰ä¸€ä¸ªå…¨é¢è€Œå®žæ—¶çš„äº†è§£ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šï¼Œåšå‡ºæ­£ç¡®çš„ç®¡æŽ§å†³ç­–ã€‚</p>

<p>é€šè¿‡æœåŠ¡ç®¡æŽ§ï¼Œå¯ä»¥å°†æœåŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„è°ƒåº¦æŒ‡ä»¤ä¸‹å‘åˆ°å‘å¸ƒç³»ç»Ÿï¼Œè¿›è¡ŒæœåŠ¡çš„ä¸Šçº¿ã€ä¸‹çº¿ã€æ‰©å®¹ã€ç¼©å®¹ç­‰æ“ä½œï¼Œå¦å¤–é™æµã€é™çº§ã€è°ƒæ•´è´Ÿè½½çš„æŒ‡ä»¤åˆ™ä¼šç›´æŽ¥ä¸‹å‘åˆ°å„ä¸ªæœåŠ¡èŠ‚ç‚¹ä¸­ï¼Œç”±æœåŠ¡æ¡†æž¶çš„ SDK è¿›è¡Œç›¸åº”çš„è°ƒæ•´åŠ¨ä½œã€‚</p>

<p>è¿™æ ·ï¼Œé€šè¿‡æœåŠ¡çš„ç›‘æŽ§ï¼ˆå·¦è¾¹ï¼‰å’ŒæœåŠ¡çš„ç®¡æŽ§ï¼ˆå³è¾¹ï¼‰ï¼Œå°±å½¢æˆäº†é’ˆå¯¹æœåŠ¡æ²»ç†çš„ä¸€ä¸ªé—­çŽ¯çš„æ“ä½œã€‚</p>

<p><img src="https://pic4.zhimg.com/80/v2-44b14c158d5433d1b6d3bdac49166903_hd.jpg" alt=""/></p>

<p>åœ¨æœåŠ¡åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œç ”å‘é‡åˆ°çš„ç¬¬ä¸€ä¸ªå›°éš¾ï¼Œä¸€å®šæ˜¯è°ƒè¯•ã€‚åŽŸæ¥å•ä½“åº”ç”¨ä¸­çš„æœåŠ¡è¢«æ‹†åˆ†åˆ°ä¸åŒå›¢é˜Ÿï¼Œå¹¶éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè€Œæœ¬åœ°åªæœ‰ä¸€ä¸ªæœåŠ¡æŽ¥å£ã€‚è¿™æ—¶å€™è¦åšè°ƒè¯•ï¼Œè¦ä¹ˆåš P2P ç›´è¿žï¼Œè¦ä¹ˆåš Mock ã€‚é‡‡ç”¨ä¼ ç»Ÿçš„ Mock æ‰‹æ®µï¼Œè¦å†™ä¸€å †çš„ Mock è¯­å¥ï¼Œæ¯”å¦‚ç”¨ mockitoï¼Œå°±è¦å†™ä¸€å †çš„ whenâ€¦..thenReturnâ€¦. çš„è¯­å¥ï¼Œè€¦åˆåº¦éžå¸¸çš„é«˜ã€‚</p>

<p>æˆ‘ä»¬æ˜¯åˆ©ç”¨åˆ†å¸ƒå¼æœåŠ¡æ¡†æž¶æä¾›çš„è¿‡æ»¤å™¨æœºåˆ¶ï¼Œå¼€å‘äº†ä¸€ä¸ª Mock è¿‡æ»¤å™¨ï¼Œå¹¶é€šè¿‡ Mock æ•°æ®æ–‡ä»¶æ¥è¯¦ç»†å®šä¹‰è¦è¢« Mock çš„æœåŠ¡çš„åç§°ã€å…¥å‚åŠå‡ºå‚ã€‚è¿™æ ·ï¼Œå½“è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œå°†æœåŠ¡ååŠå…¥å‚å’Œ Mock æ•°æ®ä¸­çš„å®šä¹‰è¿›è¡Œæ¯”å¯¹ï¼Œç»“æžœå»åˆï¼Œåˆ™ç›´æŽ¥å°† Mock æ•°æ®æ–‡ä»¶ä¸­çš„å‡ºå‚ååºåˆ—åŒ–åŽä½œä¸ºæœåŠ¡çš„è°ƒç”¨ç»“æžœç›´æŽ¥è¿”å›žï¼ŒåŒæ—¶è¿œç¨‹è°ƒç”¨çš„æ‰€æœ‰åŽç»­æ“ä½œè¢«ç»ˆæ­¢ã€‚è¿™æ ·ï¼Œå°±é€šè¿‡ Mock æ•°æ®æ¨¡æ‹Ÿäº†ä¸€ä¸ªçœŸå®žçš„è¿œç¨‹æœåŠ¡ã€‚</p>

<p>Mock è¿‡æ»¤å™¨çš„å¯ç”¨å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥å®žçŽ° â€œå¼€å…³æŽ§åˆ¶â€ï¼Œå¯ä»¥åªåœ¨å¼€å‘å’Œæµ‹è¯•çŽ¯å¢ƒå¯ç”¨ï¼Œç”Ÿäº§çŽ¯å¢ƒå…³é—­ã€‚</p>

<p>é€šè¿‡è¿™ç§æ–¹å¼æ¥æž„å»ºæœåŠ¡çš„ Mock èƒ½åŠ›ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†™ä¸€å †çš„ Mock ä»£ç äº†ï¼Œè€Œä¸”æ•´ä¸ªè¿‡ç¨‹å¯¹ä¸šåŠ¡é€»è¾‘æ¥è¯´å®Œå…¨æ— æ„ŸçŸ¥ï¼Œå®Œå…¨æŠŠ Mock èƒ½åŠ›ä¸‹æ²‰åˆ°åº•å±‚çš„æœåŠ¡æ¡†æž¶ã€‚</p>

<p><img src="https://pic4.zhimg.com/80/v2-83de9c9141a351da2a3119e50308ffce_hd.jpg" alt=""/></p>

<p>é€šè¿‡è¿™ç§æ–¹å¼æž„å»ºçš„åˆ†å¸ƒå¼æœåŠ¡çš„ Mock èƒ½åŠ›ï¼Œé™¤äº† Mock è¿‡æ»¤å™¨ï¼Œæœ€æ ¸å¿ƒçš„å°±æ˜¯ Mock æ•°æ®çš„æž„å»ºã€‚<br/>
<strong>Mock æ•°æ®çš„è´¨é‡ç›´æŽ¥å†³å®šäº†è°ƒæµ‹çš„è´¨é‡ï¼</strong><br/>
è¯´èµ· Mock æ•°æ®ï¼Œå®ƒæ‰€åšçš„æ— éžå°±æ˜¯åŒ¹é…å“ªä¸ªæœåŠ¡ã€è¾“å…¥çš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œè¾“å‡ºçš„ç»“æžœåˆæ˜¯ä»€ä¹ˆã€‚ä½†å®žé™…çš„æƒ…å†µå¾€å¾€æ›´å¤æ‚ï¼Œä½ ä¸å¯èƒ½é€šè¿‡é™æ€æ•°æ®åŽ»æž„å»ºä¸€ä¸ªæ‰€è°“çš„ â€œå½“å‰æ—¶é—´â€ å§ï¼å› æ­¤ï¼ŒMock æ•°æ®é™¤äº†æ”¯æŒé™æ€è¾“å…¥è¾“å‡ºæ•°æ®çš„æ¯”å¯¹ï¼Œè¿˜éœ€è¦æ”¯æŒåŠ¨æ€åŒ¹é…æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æ”¯æŒè„šæœ¬åŒ¹é…ï¼Œæˆ‘ä»¬æ‰€æž„å»ºçš„æœåŠ¡ Mock æ¡†æž¶ï¼Œæ”¯æŒåœ¨ Mock æ•°æ®ä¸­åŒæ—¶ä½¿ç”¨ bsh å’Œ groovy è¿™ä¸¤ç§è„šæœ¬ã€‚å¦å¤–ï¼Œä¸€ä¸ªæœåŠ¡é›†ç¾¤ä¸­ï¼Œå¾€å¾€ä¼šå­˜åœ¨åŒä¸€æœåŠ¡çš„ä¸åŒç‰ˆæœ¬ï¼Œå› æ­¤è¦çœŸå®žæ¨¡æ‹ŸçŽ°å®žæƒ…å†µçš„è¯ï¼ŒMock æ•°æ®ä¹Ÿå¿…é¡»æœ‰ç‰ˆæœ¬çš„æ¦‚å¿µã€‚</p>

<p>é™¤äº†ä»¥ä¸Šä¸¤ç§åŒ¹é…æ¨¡å¼ï¼Œæˆ‘ä»¬é’ˆå¯¹å®žé™…æƒ…å†µï¼Œè¿˜å¼€å‘äº†ç¬¬ä¸‰ç§ Mock æ¨¡å¼ï¼Œå°±æ˜¯å¯ä»¥é’ˆå¯¹ä¸€ä¸ªçœŸå®žè¯·æ±‚ï¼Œéƒ¨åˆ†ä¿®æ”¹å®ƒçš„å›žå‚æ¥æ¨¡æ‹Ÿå‡ºä¸€ä¸ªç¬¬ä¸‰æ–¹çš„ç»“æžœï¼Œè¿™ç§æ–¹å¼åœ¨å‚æ•°é‡éžå¸¸å¤šçš„æƒ…å†µä¸‹éžå¸¸æœ‰ç”¨ã€‚</p>

<p>æ‰€ä»¥ï¼Œè¦æž„å»ºå¥½ä¸€ä¸ª Mock æ•°æ®æ˜¯éœ€è¦æŠ•å…¥ä¸å°‘å·¥ä½œé‡çš„ï¼Œé‚£ä¹ˆè°æ¥åšè¿™ä¸ªäº‹æƒ…å‘¢ï¼Ÿè¿™å®žé™…ä¸Šç‰µæ¶‰åˆ°ç®¡ç†è§„èŒƒäº†ã€‚æˆ‘ä»¬çš„è§„å®šæ˜¯ï¼ŒæœåŠ¡è°æä¾›ï¼Œå°±ç”±è°æ¥æž„å»ºè¿™ä¸ª mock æ•°æ®ï¼ŒæœåŠ¡è°ƒç”¨æ–¹å¯ä»¥åœ¨è¿™ä¸ªåŸºç¡€ä¸Šåšä¿®æ”¹æˆ–è€…æ›¿æ¢ã€‚ä½†è¿™è¿˜ä¸å¤Ÿï¼Œç”±äºŽæœåŠ¡ä¼šéžå¸¸å¤šï¼Œå› æ­¤ï¼Œå¯¹ Mock æ•°æ®çš„ç®¡ç†ä¸€å®šè¦ä½“ç³»åŒ–å’Œå·¥ç¨‹åŒ–ã€‚<strong>æˆ‘çš„å»ºè®®æ˜¯ï¼Œå¯ä»¥é‡‡ç”¨ç‹¬ç«‹çš„é¡¹ç›®å·¥ç¨‹å¯¹ Mock æ•°æ®è¿›è¡Œç‹¬ç«‹çš„ç®¡ç†å’Œå‘å¸ƒã€‚</strong></p>

<p>ç›®å‰ï¼Œæˆ‘ä»¬é’ˆå¯¹å‰ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¼€å‘äº†å®Œæ•´çš„ Mock èƒ½åŠ›ï¼Œå¯ä»¥è®©å¼€å‘äººå‘˜åœ¨åŸºæœ¬ â€œæ— æ„Ÿâ€ çš„çŠ¶æ€ä¸‹è¿›è¡Œæœ¬åœ°åŒ–çš„åŠŸèƒ½è°ƒæµ‹ï¼ŒåŒæ—¶æä¾›ä¸€äº›è‡ªç ”çš„å°å·¥å…·æ¥è‡ªåŠ¨ç”Ÿæˆ Mock æ–‡ä»¶ï¼Œä»¥é™ä½Žæž„å»º Mock çš„éš¾åº¦å’ŒäººåŠ›æŠ•å…¥ã€‚</p>

<p>ä¸ºäº†æœ‰æ•ˆé™ä½Žåˆ¶ä½œ Mock æ–‡ä»¶çš„æˆæœ¬ï¼Œæˆ‘ä»¬è¿˜åŸºäºŽæœåŠ¡æ¡†æž¶çš„è¿‡æ»¤å™¨æœºåˆ¶å¼€å‘äº† â€œåœ¨çº¿æ•°æ®æŠ“å–è¿‡æ»¤å™¨â€ï¼Œå®ƒå¯ä»¥å°†æŒ‡å®šçš„æœåŠ¡è¯·æ±‚çš„å…¥å‚å’Œè¿”å›žç»“æžœéƒ½æŠ“å–ä¸‹æ¥ï¼Œå¹¶ç›´æŽ¥å†™æˆ Mock æ•°æ®æ–‡ä»¶ã€‚é€šè¿‡æŠ“å–æ–¹å¼èŽ·å¾—çš„ Mock æ•°æ®æ–‡ä»¶ï¼Œ<strong>å¾€å¾€æœ‰æ›´å¥½çš„æ•°æ®è´¨é‡</strong>ï¼Œæ¯•ç«Ÿåæ˜ çš„æ˜¯æ›´åŠ çœŸå®žçš„ä¸šåŠ¡åœºæ™¯ã€‚å½“ç„¶äº†ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªåˆè§„æ€§çš„é—®é¢˜ï¼Œå¯¹çº¿ä¸Šæ•°æ®çš„æŠ“å–æ˜¯ç§æ•æ„Ÿè¡Œä¸ºï¼Œå¤§éƒ¨åˆ†å…¬å¸è¿™ä¹ˆå¹²éƒ½ä¼šå¾ˆè°¨æ…Žï¼Œä¸€èˆ¬éƒ½è¦åšå¥½æ•°æ®è„±æ•çš„å¤„ç†å·¥ä½œã€‚å¯¹äºŽæˆ‘ä»¬ï¼Œç›®å‰åªåœ¨æµ‹è¯•çŽ¯å¢ƒä¸­è¿›è¡Œæ•°æ®æŠ“å–æ“ä½œã€‚</p>

<p><img src="https://pic1.zhimg.com/80/v2-0d2850203e49e03b0be9e89235823248_hd.jpg" alt=""/></p>

<p>äº‹åŠ¡çš„ä¸€è‡´æ€§å’Œå¯ç”¨æ€§é—®é¢˜æ˜¯åˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹ â€œè€ç”Ÿå¸¸è°ˆâ€ çš„é—®é¢˜äº†ï¼Œç›¸ä¿¡å¤§å®¶ä¹Ÿæˆ–å¤šæˆ–å°‘é‡åˆ°è¿‡è¿™ç±»é—®é¢˜ã€‚é’ˆå¯¹åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæˆ‘ä»¬é‡‡å–äº† 3 çº§åº”å¯¹çš„ç­–ç•¥ã€‚</p>

<p>é¦–å…ˆï¼Œåœ¨åˆ†åº“åˆ†è¡¨æ“ä½œä¸­ï¼Œæˆ‘ä»¬ä¼šåšæŒ â€œå®žä½“ç»„â€ ä¼˜å…ˆçš„ç­–ç•¥ï¼Œå°½é‡æŒ‰ç…§ç»Ÿä¸€çš„ â€œç‰‡é”®â€ è¿›è¡Œåˆ†åº“åˆ†è¡¨æ“ä½œï¼Œæ¯”å¦‚è¯´ï¼Œå¦‚æžœç»Ÿä¸€æŒ‰ â€œç”¨æˆ·è´¦æˆ· IDâ€ ä½œä¸ºåˆ†åº“åˆ†è¡¨é”®çš„è¯ï¼Œé‚£ä¹ˆç”¨æˆ·ç›¸å…³çš„äº¤æ˜“ã€èµ„äº§ã€æ”¯ä»˜ç­‰ç›¸å…³ä¿¡æ¯éƒ½ä¼šè½åˆ°åŒä¸€ä¸ªç‰©ç†åº“å®žä¾‹ä¹‹ä¸­ï¼Œè¿™æ ·çš„è¯ï¼Œé’ˆå¯¹æ­¤ç”¨æˆ·çš„ç›¸å…³æ“ä½œï¼Œæœ¬åœ°äº‹åŠ¡å°±å¯ä»¥ç”Ÿæ•ˆï¼Œä»Žè€Œé¿å…äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„ä½¿ç”¨ã€‚å› ä¸ºå¯¹äºŽä»»ä½•åˆ†å¸ƒå¼äº‹åŠ¡è€Œè¨€ï¼Œä¸ç®¡åšä¸åšèµ„æºé”å®šï¼Œä¸ºäº†æœ‰æ•ˆä¿éšœäº‹åŠ¡çŠ¶æ€ï¼Œéƒ½éœ€è¦é¢å¤–çš„èµ„æºå¤„ç†æ¶ˆè€—ã€‚</p>

<p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†è‡ªç ”çš„æ”¯æŒå¤šçº§äº‹åŠ¡çš„ TCC æœåŠ¡ï¼Œä»¥åº”å¯¹ä¸å¯é¿å…çš„åˆ†å¸ƒå¼äº‹åŠ¡éœ€æ±‚ã€‚é‡‡ç”¨ TCC çš„åŽŸå› æœ€ä¸»è¦è¿˜æ˜¯åœ¨äºŽç›¸å¯¹å…¶å®ƒèµ„æºç®¡ç†å™¨è€Œè¨€ï¼Œå®ƒç›¸å¯¹ç®€å•ï¼Œæˆ‘ä»¬ä¸ç”¨å…³æ³¨èµ„æºå±‚é¢ï¼Œåªéœ€è¦å…³æ³¨æœåŠ¡æŽ¥å£å³å¯ã€‚<br/>
ä¸Šé¢çš„ç¬¬äºŒå¼ å›¾æ˜¯ TCC çš„å…¸åž‹æž¶æž„æ¨¡å¼å›¾ï¼Œç›¸ä¿¡åªè¦ç ”ç©¶è¿‡ TCC çš„åŒå­¦ä»¬ä¸€å®šçœ‹è¿‡è¿™å¼ å›¾ï¼Œç¬¬ä¸‰å¼ åˆ™æ˜¯æˆ‘ä»¬è‡ªç ”çš„ TCC çš„ä¸€ä¸ªæ›´è¯¦ç»†çš„äº¤äº’æž¶æž„å›¾ï¼Œèƒ½ä½“çŽ°æ›´å¤šæŠ€æœ¯ç»†èŠ‚ï¼Œå¸Œæœ›èƒ½å¯¹å¤§å®¶æœ‰æ‰€å‚è€ƒå€Ÿé‰´ã€‚<br/>
æ€»çš„æ¥è¯´ï¼Œä»Žæˆ‘ä¸ªäººçš„ç†è§£è€Œè¨€ï¼Œè‡ªå·±å®žçŽ°ä¸€ä¸ª TCC æ¡†æž¶ï¼ˆç‹¬ç«‹æœåŠ¡ï¼‰å¹¶ä¸éº»çƒ¦ï¼Œæœ€æ ¸å¿ƒçš„æ˜¯è¦è§£å†³ä¸¤å¤§æ ¸å¿ƒé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯å‚ä¸Žäº‹åŠ¡çš„ä¸šåŠ¡æ•°æ®çš„ç¼“å­˜å’Œå›žæ”¾é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨åš TRY æ“ä½œçš„æ—¶å€™ï¼Œå°±éœ€è¦å°†äº‹åŠ¡æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œå¯ä»¥å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œå½“æ¡†æž¶åš Confirm å’Œ Cancel æ“ä½œæ—¶ï¼Œå†ç”¨ç¼“å­˜çš„äº‹åŠ¡æ•°æ®åŽ»è¿è¡Œç‰¹å®šçš„æœåŠ¡é€»è¾‘ï¼Œæ‰€ä»¥ï¼Œè¿™å°±è¦æ±‚åœ¨ TRYã€Confirm å’Œ Cancel çš„æ–¹æ³•æž„é€ ä¸Šè¦æœ‰ä¸€å®šçš„çº¦æŸï¼Œä¹Ÿå°±æ˜¯ç›¸äº’ä¹‹é—´è¦èƒ½å¤Ÿè¯†åˆ«å“ªäº›å…¥å‚æ˜¯äº‹åŠ¡æ•°æ®ï¼›å¦ä¸€ä¸ªæ˜¯çˆ¶å­äº‹åŠ¡çš„äº‹åŠ¡ ID çš„ä¼ é€’é—®é¢˜ï¼Œæˆ‘ä»¬é€šè¿‡åˆ†å¸ƒå¼æœåŠ¡æ¡†æž¶çš„ â€œéžä¸šåŠ¡ä¼ å‚â€ æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€æ—¦æŸä¸€ä¸ªäº‹åŠ¡æž„å»ºäº†ä¸€ä¸ªäº‹åŠ¡ IDï¼Œè¿™ä¸ªäº‹åŠ¡ ID å°±ä¼šè¢«æ”¾ç½®åˆ°çŽ¯å¢ƒä¸Šä¸‹æ–‡ä¹‹ä¸­ï¼Œå¹¶éšç€ RPC è°ƒç”¨ä¼ é€’åˆ°è¿œç¨‹æœåŠ¡ï¼Œè¿œç¨‹æœåŠ¡å¦‚æžœä¾¦æµ‹åˆ°ä¸Šä¸‹æ–‡ä¸­å·²ç»å­˜åœ¨äº‹åŠ¡ ID äº†ï¼Œåˆ™å°±ä¸å†æž„å»ºæ–°çš„äº‹åŠ¡ IDï¼Œè¿™æ ·çš„è¯ï¼Œçˆ¶å­äº‹åŠ¡ä¹‹é—´å°±é€šè¿‡åŒä¸€ä¸ªäº‹åŠ¡ ID å…³è”åœ¨ä¸€èµ·ã€‚<br/>
æœ€åŽï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„ä¿éšœä¸€å®šæ˜¯ â€œå¯¹è´¦ã€å¯¹è´¦ã€å¯¹è´¦â€ï¼Œè¿™æ˜¯æœ€ä¼ ç»Ÿï¼Œä¹Ÿæ˜¯æœ€å¯é çš„æœ€åŽä¸€é“é˜²çº¿ï¼Œè¿™ä¹Ÿæ˜¯é‡‘èžå…¬å¸çš„åŸºç¡€èƒ½åŠ›ï¼Œè¿™é‡Œæˆ‘å°±ä¸å±•å¼€è¯¦ç»†è¯´äº†ã€‚</p>

<p><img src="https://pic2.zhimg.com/80/v2-b70c0af13fbc3a1e8019e0aaf8dbb0f8_hd.jpg" alt=""/></p>

<p>æœåŠ¡åŒ–ä¹‹åŽï¼Œæ¯ä¸ªå›¢é˜Ÿè´Ÿè´£ä¸€éƒ¨åˆ†çš„æœåŠ¡ï¼Œç»å¸¸ä¸€ä¸ªä¸šåŠ¡ä¼šæ¶‰åŠå¤šä¸ªå›¢é˜Ÿä¹‹é—´çš„ååŒé…åˆï¼Œå¦‚ä½•è®©å›¢é˜Ÿå†…éƒ¨ã€å›¢é˜Ÿä¹‹é—´çš„åä½œæ›´é«˜æ•ˆï¼Œå¤©å¼˜å†…éƒ¨ä¹Ÿåšäº†ä¸åŒçš„å°è¯•ï¼Œä»Žç»¼åˆæ•ˆæžœæ¥è¯´ï¼Œæ•æ·æ¨¡å¼ä¼šæ›´é€‚åˆä¸€äº›ã€‚<br/>
ä»¥æˆ‘ä»¬ç§»åŠ¨å¹³å°å›¢é˜Ÿä¸¾ä¾‹ï¼Œæˆ‘ä»¬ç›®å‰é‡‡ç”¨ä¸¤å‘¨ä¸€è¿­ä»£ã€å›ºå®šå‘ç‰ˆçš„æ¨¡å¼ï¼ŒåŒæ—¶æ¯ä¸ªè¿­ä»£ä¹‹å†…ï¼Œé‡‡ç”¨ â€œç«è½¦å‘å¸ƒæ¨¡å¼â€ï¼Œå®žè¡Œç­è½¦åˆ¶ï¼Œå‡†ç‚¹å‘è½¦ï¼Œè¿™æ ·çš„è¯ï¼Œå…¶å®ƒåä½œéƒ¨é—¨åœ¨å¾ˆæ—©ä¹‹å‰å°±èƒ½å¤§æ¦‚çŸ¥é“æˆ‘ä»¬çš„ä¸€ä¸ªå‘å¸ƒè®¡åˆ’ï¼Œäº§å“æ–¹é¢ä¹Ÿå¤§æ¦‚çŸ¥é“è¦æŠŠéœ€æ±‚æ”¾å…¥å“ªä¸ªè¿­ä»£ä¹‹ä¸­ã€‚è¿™æ ·ï¼Œèƒ½å¤Ÿæœ‰æ•ˆå‡è½»éƒ¨é—¨é—´çš„æ²Ÿé€šæˆæœ¬ã€‚åœ¨æ¯æœŸå·¥ä½œé‡è¯„ä¼°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šé¢„ç•™ä¸€äº›å·¥ä½œé‡ bufferï¼Œä»¥åº”å¯¹ä¸€äº›ä¸´æ—¶æ€§éœ€æ±‚ï¼Œè¿™ç±»éœ€æ±‚ä¸å—ç‰ˆæœ¬çº¦æŸï¼ŒæŒ‰éœ€å‘å¸ƒã€‚å¦‚æžœè¿™ä¸ªè¿­ä»£å‘¨æœŸå†…æ²¡æœ‰è¿™ç±»ç´§æ€¥éœ€æ±‚çš„è¯ï¼Œæˆ‘ä»¬ä¼šä»Ž backlog ä¸­æžä¸€äº›æž¶æž„ä¼˜åŒ–çš„éœ€æ±‚æ¥å¡«è¡¥è¿™äº› bufferã€‚</p>

<p>å¯¹æ¯ä¸ªè¿­ä»£è€Œè¨€ï¼Œæœ€ä¸å¯æŽ§çš„å°±æ˜¯ UI çš„è®¾è®¡äº†ï¼ŒUI çš„è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œæ„Ÿæ€§åŒ–çš„å› ç´ ä¼šæ›´å¤šä¸€äº›ï¼Œå¯èƒ½ä¼šåå¤ä¿®æ”¹å¤šæ¬¡ï¼Œä¸åƒç¨‹åºä»£ç é‚£ä¹ˆæ˜Žç¡®ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸å°† UI è®¾è®¡çº³å…¥è¿­ä»£ä¹‹ä¸­ï¼Œè€Œæ˜¯å°†å…¶ä½œä¸ºéœ€æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨æ¯ä¸ªè¿­ä»£å¼€å§‹ä¹‹å‰çš„å·¥ä½œé‡è¯„ä¼°ä¸­ï¼Œè¦æ±‚å¿…é¡»æä¾›å®Œæ•´çš„ UI ç‰©æ–™ï¼Œå¦åˆ™ä¸äºˆè¯„ä¼°å·¥ä½œé‡ï¼Œæ­¤éœ€æ±‚ä¹Ÿä¸ä¼šè¢«çº³å…¥è¿­ä»£ä¹‹ä¸­ã€‚<br/>
è¦ä¿è¯æ•æ·æ¨¡å¼å¹³ç¨³æŽ¨è¿›ï¼Œè¿˜éœ€è¦ä¸€å¥—ä¸Žä¹‹åŒ¹é…çš„ DevOps ç ”å‘å·¥å…·ä½“ç³»åŽ»æ”¯æ’‘å®ƒã€‚è¿™æ–¹é¢èš‚èšé‡‘èžäº‘æœ‰ç›¸å¯¹å®Œå–„çš„ç ”å‘ç®¡ç†å·¥å…·ä½“ç³»ï¼Œä½†æˆ‘ä»¬ç›®å‰æš‚æ—¶æ²¡æœ‰ä½¿ç”¨ï¼Œæ¯•ç«Ÿå›¢é˜Ÿè§„æ¨¡ä¸ä¸€æ ·ã€‚æˆ‘ä»¬å›¢é˜Ÿç›®å‰è§„æ¨¡è¿˜æ¯”è¾ƒå°ï¼Œå› æ­¤è¿˜æ˜¯é‡‡ç”¨ä¸šç•Œæœ€é€šç”¨çš„ä¸€äº›å¼€æºçš„äº§å“ï¼ˆåŒ…æ‹¬ Jekinsã€Jiraã€Wiki ç­‰ï¼‰æ¥æ•´åˆæž„å»ºæˆ‘ä»¬è‡ªå·±çš„ DevOps çš„å·¥å…·é“¾ï¼Œä½†æˆ‘ä»¬ä¼šåœ¨æˆ‘ä»¬çš„ç ”å‘ Pipeline ä¸­é€šè¿‡è„šæœ¬æ¥æ•´åˆé‡‘èžäº‘çš„ä¸€ç³»åˆ—èƒ½åŠ›ï¼ŒåŒ…æ‹¬åŒ…ä¸Šä¼ ã€å‘å¸ƒèƒ½ç­‰ä¸€ç³»åˆ— IaaS çš„èƒ½åŠ›ã€‚è¿™æ ·ï¼Œå°±å°†äº‘ä¸‹çš„ç ”å‘å’Œäº‘ä¸Šçš„å‘å¸ƒèƒ½åŠ›æ•´åˆåœ¨äº†ä¸€èµ·ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¼šæ”¶é›† DevOps å·¥å…·é“¾ä¸­å„ä¸ªçŽ¯èŠ‚çš„æ•°æ®ï¼Œå¹¶é€šè¿‡è‡ªç ”çš„ç²¾ç›Šçœ‹æ¿æ¥è¿›è¡Œå„ä¸ªç»´åº¦çš„æ•°æ®æ±‡æ€»ç»Ÿè®¡å’Œå‘ˆçŽ°ï¼Œä»Žè€Œå®žçŽ°å¯¹ç ”å‘çš„æŽ¨è¿›çŠ¶å†µåŠè´¨é‡çš„ä¸¥æ ¼æŠŠæŽ§ã€‚</p>

<p><img src="https://pic3.zhimg.com/80/v2-87efc79672b19d697a03793aa134e1f6_hd.jpg" alt=""/></p>

<p>æ€»ç»“<br/>
ä»¥ä¸Šå°±æ˜¯æœ¬æ¬¡åˆ†äº«çš„ä¸»è¦å†…å®¹ï¼Œå‰é¢æˆ‘ä»¬å·²ç»ä»‹ç»äº†ï¼Œæˆ‘ä»¬å¾ˆå¤šæœåŠ¡åŒ–çš„èƒ½åŠ›éƒ½æ˜¯åœ¨èš‚èšé‡‘èžäº‘çš„ I å±‚å’Œ P å±‚èƒ½åŠ›åŸºç¡€ä¹‹ä¸Šæž„å»ºèµ·æ¥çš„ï¼Œèš‚èšç›®å‰å·²ç»å°†å®ƒçš„äº‘åŽŸç”Ÿæž¶æž„å¼•æ“Ž â€”â€” SOFA ä¸­é—´ä»¶è¿›è¡Œé€æ­¥å¼€æºï¼Œå°¤å…¶æ˜¯æˆ‘ä¹‹å‰ä»‹ç»çš„ SOFARPCï¼Œå„ä½åŒå­¦å¦‚æžœæ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥å…³æ³¨æœ¬å…¬ä¼—å·äº†è§£ã€‚</p>

<p><img src="https://pic4.zhimg.com/80/v2-6cd70446d9f8bc3be06edb1fcd87e57b_hd.jpg" alt=""/></p>

]]></content>
  </entry>
  
</feed>
