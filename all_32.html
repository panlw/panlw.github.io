<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Junkman
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="Junkman" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:panlw.github.io ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; Junkman</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
       
       <li><a href="index.html">HOME</a></li>
    <li><a href="archives.html">Archives</a></li>
    <li><a href="about.html">ABOUT</a></li>

    <li><label>Categories</label></li>

        
            <li><a href="Infra.html">Infra</a></li>
        
            <li><a href="Coding.html">Coding</a></li>
        
            <li><a href="Modeling.html">Modeling</a></li>
        
            <li><a href="Archtecting.html">Archtecting</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
	$(function(){
		$('#menu_item_index').addClass('is_active');
	});
</script>
<div class="row">
	<div class="large-8 medium-8 columns">
		<div class="markdown-body home-categories">
		
			<div class="article">
                <a class="clearlink" href="15473835014607.html">
                
                  <h1>GitHub：我们为什么会弃用jQuery？</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<blockquote>
<p>原文地址 <a href="https://mp.weixin.qq.com/s?__biz=MzUxMzcxMzE5Ng==&amp;mid=2247489496&amp;idx=1&amp;sn=ec3d379d62e80991858055c42ea298ae&amp;chksm=f951a29bce262b8dbcdffe5e8800f0917602f7257b733c0ab84e95f0146d2aa9db2116f3c54c&amp;scene=27#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzUxMzcxMzE5Ng==&amp;mid=2247489496&amp;idx=1&amp;sn=ec3d379d62e80991858055c42ea298ae&amp;chksm=f951a29bce262b8dbcdffe5e8800f0917602f7257b733c0ab84e95f0146d2aa9db2116f3c54c&amp;scene=27#wechat_redirect</a></p>
</blockquote>

<p>GitHub.com 在 2007 年底开始使用 jQuery 1.2.1，那是谷歌发布 Chrome 浏览器的前一年。当时还没有通过 CSS 选择器来查询 DOM 元素的标准方法，也没有动态渲染元素的样式的标准方法，而 Internet Explorer 的 XMLHttpRequest 接口与其他很多 API 一样，在浏览器之间存在不一致性问题。</p>

<p>jQuery 让 DOM 操作、创建动画和 “AJAX” 请求变得相当简单，基本上，它让 Web 开发人员能够创建更加现代化的动态 Web 体验。最重要的是，使用 jQuery 为一个浏览器开发的代码也适用于其他浏览器。在 GitHub 的早期阶段，jQuery 让小型的开发团队能够快速进行原型设计并开发出新功能，而无需专门针对每个 Web 浏览器调整代码。</p>

<p>基于 jQuery 简单的接口所构建的扩展库也成为 GitHub.com 前端的基础构建块：pjax（<a href="https://github.com/defunkt/jquery-pjax%EF%BC%89%E5%92%8C">https://github.com/defunkt/jquery-pjax）和</a> facebox（<a href="https://github.com/defunkt/facebox%EF%BC%89%E3%80%82">https://github.com/defunkt/facebox）。</a></p>

<p>我们将永远不会忘记 John Resig 和 jQuery 贡献者创建和维护的这样一个有用的基本库。</p>

<p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(63, 63, 63);font-size: 20px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);">后来的 Web 标准</section></p>

<p>多年来，GitHub 成长为一家拥有数百名工程师的公司，并逐渐成立了一个专门的团队，负责 JavaScript 代码的规模和质量。我们一直在排除技术债务，有时技术债务会随着依赖项的增多而增长，这些依赖项在一开始会为我们带来一定的价值，但这些价值也随着时间的推移而下降。</p>

<p>我们可以将 jQuery 与现代浏览器支持的 Web 标准的快速演化进行比较：</p>

<ul>
<li><p>$(selector) 模式可以使用 querySelectorAll() 来替换；</p></li>
<li><p>现在可以使用 Element.classList 来实现 CSS 类名切换；</p></li>
<li><p>CSS 现在支持在样式表中而不是在 JavaScript 中定义可视动画；</p></li>
<li><p>现在可以使用 Fetch Standard 执行 $.ajax 请求；</p></li>
<li><p>addEventListener() 接口已经足够稳定，可以跨平台使用；</p></li>
<li><p>我们可以使用轻量级的库来封装事件委托模式；</p></li>
<li><p>随着 JavaScript 语言的发展，jQuery 提供的一些语法糖已经变得多余。</p></li>
</ul>

<p>另外，链式语法不能满足我们想要的编写代码的方式。例如：</p>

<pre><code>$(&#39;.js-widget&#39;)
  .addClass(&#39;is-loading&#39;)
  .show()
</code></pre>

<p>这种语法写起来很简单，但是根据我们的标准，它并不能很好地传达我们的意图。作者是否期望在当前页面上有一个或多个 js-widget 元素？另外，如果我们更新页面标记并意外遗漏了 js-widget 类名，浏览器是否会抛出异常会告诉我们出了什么问题？默认情况下，当没有任何内容与选择器匹配时，jQuery 会跳过整个表达式，但对我们来说，这是一个 bug。</p>

<p>最后，我们开始使用 Flow 来注解类型，以便在构建时执行静态类型检查，并且我们发现，链式语法不适合做静态分析，因为几乎所有 jQuery 方法返回的结果都是相同的类型。我们当时之所以选择 Flow，是因为 @flow weak 模式等功能可以让我们逐步将类型应用于无类型的代码库上。</p>

<p>总而言之，移除 jQuery 意味着我们可以更多地依赖 Web 标准，让 MDN Web 文档成为前端开发人员事实上的默认文档，在将来可以维护更具弹性的代码，并且可以将 30KB 的依赖从我们的捆绑包中移除，加快页面的加载速度和 JavaScript 的执行速度。</p>

<p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(63, 63, 63);font-size: 20px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);">逐步解耦</section></p>

<p>虽然定下了最终目标，但我们也知道，分配所有资源一次性移除 jQuery 是不可行的。这种匆匆忙忙的做法可能会导致网站功能出现回归。相反，我们采取了以下的策略：</p>

<p>1. 设定指标，跟踪整一行代码调用 jQuery 的比率，并监控指标走势随时间变化的情况，确保它保持不变或下降，而不是上升。</p>

<p><img src="https://mmbiz.qpic.cn/mmbiz_png/XIibZ0YbvibkXSZGYu270lGMD9GEAuMbvWh5BQ97VPmLwD4YDu8VwNHd41yq7fPWZ36X6rC9DYH9r7rK5J2Attuw/640?wx_fmt=png" alt=""/></p>

<p>2. 我们不鼓励在任何新代码中导入 jQuery。为了方便自动化，我们创建了 eslint-plugin-jquery（<a href="https://github.com/dgraham/eslint-plugin-jquery%EF%BC%89%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%89%E4%BA%BA%E8%AF%95%E5%9B%BE%E4%BD%BF%E7%94%A8">https://github.com/dgraham/eslint-plugin-jquery），如果有人试图使用</a> jQuery 功能，例如 $.ajax，CI 检查将会失败。</p>

<p>3. 旧代码中存在大量违反 eslint 规则的情况，我们在代码注释中使用特定的 eslint-disable 规则进行了注解。看到这些代码的读者，他们都该知道，这些代码不符合我们当前的编码实践。</p>

<p>4. 我们创建了一个拉请求机器人，当有人试图添加新的 eslint-disable 规则时，会对拉取请求留下评论。这样我们就可以尽早参与代码评审，并提出替代方案。</p>

<p>5. 很多旧代码使用了 pjax 和 facebox 插件，所以我们在保持它们的接口几乎不变的同时，在内部使用 JS 重新实现它们的逻辑。静态类型检查有助于提升我们进行重构的信心。</p>

<p>6. 很多旧代码与 rails-behavior 发生交互，我们的 Ruby on Rails 适配器几乎是 “不显眼的”JS，它们将 AJAX 生命周期处理器附加到某些表单上：</p>

<pre><code>// 旧方法
  $(document).on(&#39;ajaxSuccess&#39;, &#39;form.js-widget&#39;, function(event, xhr, settings, data) {
    // 将响应数据插入到 DOM 中
  })
</code></pre>

<p>7. 我们选择触发假的 ajax* 生命周期事件，并保持这些表单像以前一样异步提交内容，而不是立即重写所有调用，只是会在内部使用 fetch()。</p>

<p>8. 我们自己维护了 jQuery 的一个版本，每当发现我们不再需要 jQuery 的某个模块的时候，就会将它从自定义版本中删除，并发布更轻量的版本。例如，在移除了 jQuery 的 CSS 伪选择器之后（如: visible 或: checkbox）我们就可以移除 Sizzle 模块了，当所有的 $.ajax 调用都被 fetch() 替换时，就可以移除 AJAX 模块。</p>

<p>这样做有两个目的：加快 JavaScript 执行速度，同时确保不会有新代码试图使用已移除的功能。</p>

<p>9. 我们根据网站的分析结果尽快放弃对旧版本 Internet Explorer 的支持。每当某个 IE 版本的使用率低于某个阈值时，我们就会停止向它提供 JavaScript 支持，并专注支持更现代的浏览器。尽早放弃对 IE 8 和 IE 9 的支持对于我们来说意味着可以采用很多原生的浏览器功能，否则的话有些功能很难通过 polyfill 来实现。</p>

<p>10. 作为 GitHub.com 前端功能开发新方法的一部分，我们专注于尽可能多地使用常规 HTML，并且逐步添加 JavaScript 行为作为渐进式增强。因此，那些使用 JS 增强的 Web 表单和其他 UI 元素通常也可以在禁用 JavaScript 的浏览器上正常运行。在某些情况下，我们可以完全删除某些遗留的代码，而不需要使用 JS 重写它们。</p>

<p>经过多年的努力，我们逐渐减少对 jQuery 的依赖，直到没有一行代码引用它为止。</p>

<p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(63, 63, 63);font-size: 20px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);">自定义元素</section></p>

<p>近年来一直在炒作一项新技术，即自定义元素——浏览器原生的组件库，这意味着用户无需下载、解析和编译额外的字节。</p>

<p>从 2014 年开始，我们已经基于 v0 规范创建了一些自定义元素。然而，由于标准仍然在不断变化，我们并没有投入太多精力。直到 2017 年，Web Components v1 规范发布，并且 Chrome 和 Safari 实现了这一规范，我们才开始更广泛地采用自定义元素。</p>

<p>在移除 jQuery 期间，我们也在寻找用于提取自定义元素的模式。例如，我们将用于显示模态对话框的 facebox 转换为 <details-dialog> 元素（<a href="https://github.com/github/details-dialog-element%EF%BC%89%E3%80%82">https://github.com/github/details-dialog-element）。</a></p>

<p>我们的渐进式增强理念也延伸到了自定义元素上。这意味着我们将尽可能多地保留标记内容，然后再标记上添加行为。例如，<local-time> 默认显示原始时间戳，它被升级成可以将时间转换为本地时区，而对于 &lt; details-dialog&gt;，当它被嵌在 <details > 元素中时，可以在不使用 JavaScript 的情况下具备交互性，它被升级成具有辅助增强功能。</p>

<p>以下是实现 <local-time> 自定义元素的示例：</p>

<pre><code>// local-time 根据用户的当前时区显示时间。
//
// 例如:
//   &lt;local-time datetime=&quot;2018-09-06T08:22:49Z&quot;&gt;Sep 6, 2018&lt;/local-time&gt;
//
class LocalTimeElement extends HTMLElement {
  static get observedAttributes() {
    return [&#39;datetime&#39;]
  }

  attributeChangedCallback(attrName, oldValue, newValue) {
    if (attrName === &#39;datetime&#39;) {
      const date = new Date(newValue)
      this.textContent = date.toLocaleString()
    }
  }
}

if (!window.customElements.get(&#39;local-time&#39;)) {
  window.LocalTimeElement = LocalTimeElement
  window.customElements.define(&#39;local-time&#39;, LocalTimeElement)
}
</code></pre>

<p>我们很期待 Web 组件的 Shadow DOM。Shadow DOM 的强大功能为 Web 带来了很多可能性，但也让 polyfill 变得更加困难。因为使用 polyfill 会导致性能损失，因此在生产环境中使用它们是不可行的。</p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/1/13</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Node.js.html'>Node.js</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
              


			<div class="row">
			  <div class="large-6 columns">
			  <p class="text-left" style="padding-top:25px;">
			   <a href="all_31.html">&laquo; Prev Page</a>  
			  </p>
			  </div>
			  <div class="large-6 columns">
			<p class="text-right" style="padding-top:25px;">
			 <a href="all_33.html">&raquo; Next Page</a> 
			</p>
			  </div>
			</div>
		</div>
	</div><!-- large 8 -->

 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="./asset/img/logo.jpg" /></div>
            
                <h1>Junkman</h1>
                <div class="site-des">“拾荒者”一词来自凯文・凯利的《失控》中关于机器学习的故事（“收集癖好机”如何完成他的收集工作）。</div>
                <div class="social">









<a target="_blank" class="github" target="_blank" href="https://github.com/panlw/" title="GitHub">GitHub</a>

  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="Infra.html"><strong>Infra</strong></a>
        
            <a href="Coding.html"><strong>Coding</strong></a>
        
            <a href="Modeling.html"><strong>Modeling</strong></a>
        
            <a href="Archtecting.html"><strong>Archtecting</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15517999043443.html">The Art of Crafting Architectural Diagrams</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15517997955971.html">为什么说我们需要软件架构图？</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15516128677869.html">DNS Servers That Offer Privacy and Filtering</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15516123108194.html">Airbnb's Migration from Monolith to Services</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15516097487470.html">Events As First-Class Citizens</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>


  </body>
</html>
