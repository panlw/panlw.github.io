<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  OpenID Connect explained - Junkman
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="Junkman" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:panlw.github.io ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; Junkman</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
       
       <li><a href="index.html">HOME</a></li>
    <li><a href="archives.html">Archives</a></li>
    <li><a href="about.html">ABOUT</a></li>

    <li><label>Categories</label></li>

        
            <li><a href="Infra.html">Infra</a></li>
        
            <li><a href="Coding.html">Coding</a></li>
        
            <li><a href="Modeling.html">Modeling</a></li>
        
            <li><a href="Archtecting.html">Archtecting</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
          <h1>OpenID Connect explained</h1>
     
        <div class="read-more clearfix">
          <span class="date">2018/9/21</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='Authn&Authz.html'>Authn&Authz</a></span>
           
         
          <span class="comments">
            

            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <blockquote>
<p><a href="https://connect2id.com/learn/openid-connect">https://connect2id.com/learn/openid-connect</a></p>
</blockquote>

<p>OpenID Connect has become the leading standard for single sign-on and identity provision on the Internet. Its formula for success: simple JSON-based identity tokens (JWT), delivered via OAuth 2.0 flows designed for web, browser-based and native / mobile applications.</p>

<h2 id="toc_0"><a href="#intro">1. Local user authentication vs Identity Providers</a></h2>

<p><img src="https://connect2id.com/assets/learn/openid-connect/enter.png" alt=""/></p>

<p>Applications often need to identify their users. The simplistic approach is to create a local database for the users’ accounts and credentials. Given enough technical care this can be made to work well. However, local authentication can be bad for business:</p>

<ul>
<li><p>People find sign up and account creation tedious, and rightly so. Consumer web sites and apps may suffer abandoned shopping carts because of that, which means loss of business and sales.</p></li>
<li><p>For enterprises with many apps, maintenance of separate user databases can easily become an administrative and security nightmare. You may want to put your IT resources to better use.</p></li>
</ul>

<p>The established solution to these problems is to delegate user authentication and provisioning to a dedicated, purpose-built service, called an Identity Provider (IdP).</p>

<p>Google, Facebook and Twitter, where many people on the internet are registered, offer such IdP services for their users. A consumer web site can greatly streamline user onboarding by integrating login with these IdPs.</p>

<p>In a enterprise, this would ideally be one internal IdP service, for employees and contractors to log into the internal applications. Centralisation has considerable benefits, such as easier administration and potentially faster development cycles for new apps. You may ask: Isn’t that going to create a single point of failure? No, not when the IdP service is built for redundancy.</p>

<h2 id="toc_1"><a href="#oidc">2. Enter OpenID Connect</a></h2>

<p><img src="https://connect2id.com/assets/learn/openid-connect/openid.png" alt=""/></p>

<p><a href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect</a>, published in 2014, is not the first standard for IdP, but definitely the best in terms of usability and simplicity, having learned the lessons from past efforts such as <a href="https://en.wikipedia.org/wiki/Security_Assertion_Markup_Language">SAML</a> and OpenID 1.0 and 2.0.</p>

<p>What is the formula for success of OpenID Connect?</p>

<ul>
<li><p><strong>Easy to consume identity tokens</strong>: Clients receive the user’s identity encoded in a secure JSON Web Token (JWT), called an ID token. JWTs are appreciated for their elegance and portability, and for their ready support for a wide range of signature and encryption algorithms. All that makes JWT outstanding for the ID token job.</p></li>
<li><p><strong>Based on the OAuth 2.0 protocol</strong>: The ID token is obtained via a standard OAuth 2.0 flow, with support for web applications as well as native / mobile apps. OAuth 2.0 also means having one protocol for authentication and authorisation (obtaining access tokens).</p></li>
<li><p><strong>Simplicity</strong>: OpenID Connect is simple enough to integrate with basic apps, but it also has the features and security options to match demanding enterprise requirements.</p></li>
</ul>

<h2 id="toc_2"><a href="#id-token">3. The identity token</a></h2>

<p><img src="https://connect2id.com/assets/learn/openid-connect/id-card.png" alt=""/></p>

<p>The <a href="https://openid.net/specs/openid-connect-core-1_0.html#IDToken">ID token</a> resembles the concept of an identity card, in a standard <a href="https://tools.ietf.org/html/rfc7523">JWT</a> format, signed by the OpenID Provider (OP). To obtain one the client needs to send the user to their OP with an authentication request.</p>

<p>Features of the ID token:</p>

<ul>
<li>  Asserts the identity of the user, called <u>subject</u> in OpenID (sub).</li>
<li>  Specifies the issuing authority (iss).</li>
<li>  Is generated for a particular <u>audience</u>, i.e. client (aud).</li>
<li>  May contain a nonce (nonce).</li>
<li>  May specify when (auth_time) and how, in terms of strength (acr), the user was authenticated.</li>
<li>  Has an issue (iat) and expiration time (exp).</li>
<li>  May include additional requested details about the subject, such as name and email address.</li>
<li>  Is digitally signed, so it can be verified by the intended recipients.</li>
<li>  May optionally be encrypted for confidentiality.</li>
</ul>

<p>The ID token statements, or claims, are packaged in a simple JSON object:</p>

<pre><code>{
  &quot;sub&quot;       : &quot;alice&quot;,
  &quot;iss&quot;       : &quot;https://openid.c2id.com&quot;,
  &quot;aud&quot;       : &quot;client-12345&quot;,
  &quot;nonce&quot;     : &quot;n-0S6_WzA2Mj&quot;,
  &quot;auth_time&quot; : 1311280969,
  &quot;acr&quot;       : &quot;c2id.loa.hisec&quot;,
  &quot;iat&quot;       : 1311280970,
  &quot;exp&quot;       : 1311281970
}
</code></pre>

<p>The ID token header, claims JSON and signature are encoded into a base 64 URL-safe string, for easy passing arround, for example as URL parameter.</p>

<pre><code>eyJhbGciOiJSUzI1NiIsImtpZCI6IjFlOWdkazcifQ.ewogImlzcyI6ICJodHRw
Oi8vc2VydmVyLmV4YW1wbGUuY29tIiwKICJzdWIiOiAiMjQ4Mjg5NzYxMDAxIiw
KICJhdWQiOiAiczZCaGRSa3F0MyIsCiAibm9uY2UiOiAibi0wUzZfV3pBMk1qIi
wKICJleHAiOiAxMzExMjgxOTcwLAogImlhdCI6IDEzMTEyODA5NzAKfQ.ggW8hZ
1EuVLuxNuuIJKX_V8a_OMXzR0EHR9R6jgdqrOOF4daGU96Sr_P6qJp6IcmD3HP9
9Obi1PRs-cwh3LO-p146waJ8IhehcwL7F09JdijmBqkvPeB2T9CJNqeGpe-gccM
g4vfKjkM8FcGvnzZUN4_KSP0aAp1tOJ1zZwgjxqGByKHiOtX7TpdQyHE5lcMiKP
XfEIQILVq0pc_E2DzL7emopWoaoZTF_m0_N0YzFC6g6EJbOEoRoSK5hoDalrcvR
YLSrQAZZKflyuVCyixEoV9GfNQC3_osjzw2PAithfubEEBLuVVk4XUVrWOLrLl0
nx7RkKU8NXNHq-rvKMzqg
</code></pre>

<p>You can read more about the JWT data structure and its encoding in <a href="https://tools.ietf.org/html/rfc7519">RFC 7519</a>.</p>

<h2 id="toc_3"><a href="#auth-request">4. How to request an ID token</a></h2>

<p><img src="https://connect2id.com/assets/learn/openid-connect/walk.png" alt=""/></p>

<p>Now that we know what an <a href="#id-token">ID token</a> is, how can a client, called Relying Party (RP) in OpenID Connect, request one?</p>

<p>Authentication must take place at the identity provider, where the user’s session or credentials will be checked. For that a trusted agent is required, and this role is usually performed by the web browser.</p>

<p>A browser popup is the preferred way for a web application to redirect the user to the IdP. Mobile apps on platforms such as Android or iOS should launch the system browser for that purpose. Embedded web views are not be trusted, as there’s nothing to prevent the app from snooping on the user password. User authentication must always occur in a trusted context that is separate from the app (e.g. the browser).</p>

<p>Note that OpenID Connect doesn’t specify how users should actually be authenticated, this is <a href="#auth-methods">left up to the provider to decide</a>.</p>

<p>ID tokens are requested via the <a href="oauth-2">OAuth 2.0 protocol</a>, which has been a tremendous success on its own. OAuth was originally devised as a simple authorisation mechanism for apps to obtain access tokens for web APIs or other protected resources. It has <u>flows</u> designed for all application type: traditional server-based web applications, browser (JavaScript) only apps, and native / mobile apps.</p>

<p>So what are those flows, or paths, for obtaining ID tokens?</p>

<ul>
<li><p><a href="https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth">Authorisation code flow</a> — the most commonly used flow, intended for traditional web apps as well as native / mobile apps. Involves an initial browser redirection to / from the OP for user authentication and consent, then a second back-channel request to retrieve the ID token. This flow offers optimal security, as tokens are not revealed to the browser and the client can also be authenticated.</p></li>
<li><p><a href="https://openid.net/specs/openid-connect-core-1_0.html#ImplicitFlowAuth">Implicit flow</a> — for browser (JavaScript) based apps that don’t have a backend. The ID token is received directly with the redirection response from the OP. No back-channel request is required here.</p></li>
<li><p><a href="https://openid.net/specs/openid-connect-core-1_0.html#HybridFlowAuth">Hybrid flow</a> — rarely used, allows the application front-end and back-end to receive tokens separately from one another. Essentially a combination of the code and implicit flows.</p></li>
</ul>

<p>The OpenID Connect spec provides a nice <a href="https://openid.net/specs/openid-connect-core-1_0.html#Authentication">comparison</a> of the three flows, reproduced here in a simplified form.</p>

<p><colgroup><col> <col style="width: 18%"> <col style="width: 18%"> <col style="width: 18%"></colgroup><br/>
| Flow property | Code | Implicit | Hybrid |<br/>
| Browser redirection step | ✔ | ✔ | ✔ |<br/>
| Backend request step | ✔ | ✕ | ✔ |<br/>
| Tokens revealed to browser | ✕ | ✔ | ✔ |<br/>
| Client can be authenticated | ✔ | ✕ | ✔ |</p>

<h2 id="toc_4"><a href="#cool-id-token-uses">5. Cool ID token uses</a></h2>

<p><img src="https://connect2id.com/assets/learn/openid-connect/checkin.png" alt=""/></p>

<p>An <a href="#id-token">ID token</a> can be put to uses beyond basic sign-in:</p>

<ul>
<li><p><strong>Stateless sessions</strong> — Put into a browser cookie the ID token can implement a lightweight stateless session. This does away with the need to store sessions on the server side (in memory or on disk), which can be a burden to manage and scale. The session is checked by validating the ID token. When the token reaches some predefined age past its issue timestamp (iat) the application can simply ask the OP for a new one via a silent <u>prompt=none</u> request.</p></li>
<li><p><strong>Passing identity to 3rd parties</strong> — The ID token may be passed to other application components or to backend services when knowledge of the user’s identity is required, for example to log audit trails.</p></li>
<li><p><strong>Token exchange</strong> — The ID token may be exchanged for an access token at the token endpoint of an OAuth 2.0 authorisation server (<a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-12">draft-ietf-oauth-token-exchange-12</a>). There are real world scenarios when an identity document is required to obtain access, for example when you check in at a hotel to get your room key. Token exchange has uses in distributed and enterprise applications.</p></li>
</ul>

<h2 id="toc_5"><a href="#example-auth-code-flow">6. Example OpenID authentication</a></h2>

<p><img src="https://connect2id.com/assets/learn/openid-connect/browser.png" alt=""/></p>

<p>We will now go through a minimal example of how to obtain an ID token for a user from an OP, using the <a href="https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth">authorisation code flow</a>. This is the most commonly used flow by traditional web applications. Examples of the <a href="https://openid.net/specs/openid-connect-core-1_0.html#ImplicitFlowAuth">implicit</a> and <a href="https://openid.net/specs/openid-connect-core-1_0.html#HybridFlowAuth">hybrid flow</a> can be found in the <a href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect spec</a>.</p>

<p>The code flow has two steps:</p>

<p><colgroup><col> <col style="width: 40%"> <col style="width: 40%"></colgroup><br/>
|  | Step 1 | Step 2 |<br/>
| <strong>Purpose</strong> | 1. Authenticate user<br/>
2. Receive user consent | 1. Authenticate client (optional)<br/>
2. Exchange code for token(s) |<br/>
| <strong>Via</strong> | Front-channel request<br/>
<small>(browser redirection)</small> | Back-channel request<br/>
<small>(app to web server)</small> |<br/>
| <strong>To</strong> | Authorisation endpoint | Token endpoint |<br/>
| <strong>Result on success</strong> | Authorisation code<br/>
<small>(step 2 input)</small> | ID token<br/>
<small>(+ OAuth 2.0 access token)</small> |</p>

<h3 id="toc_6"><a href="#example-auth-code-flow-step-1">Code flow: Step 1</a></h3>

<p>The RP initiates user authentication by redirecting the browser to the <a href="https://tools.ietf.org/html/rfc6749#section-3.1">OAuth 2.0 authorisation endpoint</a> of the OpenID Provider. The OpenID <a href="https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest">authentication request</a> is essentially an OAuth 2.0 <a href="https://tools.ietf.org/html/rfc6749#section-4.1.1">authorisation request</a> to access the user’s identity, indicated by an <code>openid</code> value in the scope parameter.</p>

<p>Example authentication redirection to the OP:</p>

<pre><code>HTTP/1.1 302 Found
Location: https://openid.c2id.com/login?
          response_type=code
          &amp;scope=openid
          &amp;client_id=s6BhdRkqt3
          &amp;state=af0ifjsldkj
          &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
</code></pre>

<p>The request parameters are encoded in the URI query:</p>

<ul>
<li><p><strong>response_type</strong> Set to <code>code</code> to indicate an authorisation code flow.</p></li>
<li><p><strong>scope</strong> Used to specify the scope of the requested authorisation in OAuth. The scope value <code>openid</code> signals a request for OpenID authentication and ID token.</p></li>
<li><p><strong>client_id</strong> The client identifier of the RP at the OP. This identifier is assigned when the RP is registered with the OP, via the client registration API, a developer console, or some other method.</p></li>
<li><p><strong>state</strong> Opaque value set by the RP to maintain state between request and callback.</p></li>
<li><p><strong>redirect_uri</strong> The RP callback URI for the authentication response.</p></li>
</ul>

<p>At the OP, the user will typically be authenticated by checking if they have a valid session (established by a browser cookie), and in the absence of that, by prompting the user to login. After that the user will typically be asked whether they agree to sign into the RP.</p>

<p><img src="https://connect2id.com/assets/learn/openid-connect/op-login-consent.png" alt=""/></p>

<p>The OP will then call the client <code>redirect_uri</code> with an authorisation code (on success) or an error code (if access was denied, or some other error occurred, such a malformed request was detected).</p>

<pre><code>HTTP/1.1 302 Found
Location: https://client.example.org/cb?
          code=SplxlOBeZQQYbYS6WxSbIA
          &amp;state=af0ifjsldkj
</code></pre>

<p>The RP must validate the <code>state</code> parameter, and use the <code>code</code> to proceed to the <a href="#example-auth-code-flow-step-2">next step</a> - exchanging the code for the ID token.</p>

<h3 id="toc_7"><a href="#example-auth-code-flow-step-2">Code flow: Step 2</a></h3>

<p>The authorisation code is an intermediate credential, which encodes the authorisation obtained at <a href="#example-auth-code-flow-step-1">step 1</a>. It is therefore opaque to the RP and only has meaning to the OP server. To retrieve the ID token the RP must submit the code to the OP, but this time with a direct back-channel request. This is done for two reasons:</p>

<ul>
<li>  To authenticate confidential clients with the OP before revealing the tokens;</li>
<li>  To deliver the tokens straight to the RP, thus avoid exposing them to the browser.</li>
</ul>

<p>The code-for-token exchange happens at the <a href="#token-endpoint">token endpoint</a> of the OP:</p>

<pre><code>POST /token HTTP/1.1
Host: openid.c2id.com
Content-Type: application/x-www-form-urlencoded
Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW

grant_type=authorization_code
 &amp;code=SplxlOBeZQQYbYS6WxSbIA
 &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
</code></pre>

<p>The client ID and secret are passed via the <code>Authorization</code> header. Apart from <a href="https://tools.ietf.org/html/rfc6749#section-2.3.1">HTTP basic authentication</a> OpenID Connect also supports authentication with a <a href="https://tools.ietf.org/html/rfc7523">JWT</a>, which doesn’t expose the client credentials with the token request, has expiration, and thus provides stronger security.</p>

<p>The token request parameters are form-encoded:</p>

<ul>
<li><p><strong>grant_type</strong> Set to <code>authorization_code</code>.</p></li>
<li><p><strong>code</strong> The code obtained from <a href="#example-auth-code-flow-step-1">step 1</a>.</p></li>
<li><p><strong>redirect_uri</strong> Repeats the callback URI from step 1.</p></li>
</ul>

<p>On success the OP will return a JSON object with the ID token, an access token and an optional refresh token:</p>

<pre><code>HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store
Pragma: no-cache

{
  &quot;id_token&quot;: &quot;eyJhbGciOiJSUzI1NiIsImtpZCI6IjFlOWdkazcifQ.ewogImlzc
    yI6ICJodHRwOi8vc2VydmVyLmV4YW1wbGUuY29tIiwKICJzdWIiOiAiMjQ4Mjg5
    NzYxMDAxIiwKICJhdWQiOiAiczZCaGRSa3F0MyIsCiAibm9uY2UiOiAibi0wUzZ
    fV3pBMk1qIiwKICJleHAiOiAxMzExMjgxOTcwLAogImlhdCI6IDEzMTEyODA5Nz
    AKfQ.ggW8hZ1EuVLuxNuuIJKX_V8a_OMXzR0EHR9R6jgdqrOOF4daGU96Sr_P6q
    Jp6IcmD3HP99Obi1PRs-cwh3LO-p146waJ8IhehcwL7F09JdijmBqkvPeB2T9CJ
    NqeGpe-gccMg4vfKjkM8FcGvnzZUN4_KSP0aAp1tOJ1zZwgjxqGByKHiOtX7Tpd
    QyHE5lcMiKPXfEIQILVq0pc_E2DzL7emopWoaoZTF_m0_N0YzFC6g6EJbOEoRoS
    K5hoDalrcvRYLSrQAZZKflyuVCyixEoV9GfNQC3_osjzw2PAithfubEEBLuVVk4
    XUVrWOLrLl0nx7RkKU8NXNHq-rvKMzqg&quot;
  &quot;access_token&quot;: &quot;SlAV32hkKG&quot;,
  &quot;token_type&quot;: &quot;Bearer&quot;,
  &quot;expires_in&quot;: 3600,
}
</code></pre>

<p>The ID token is a JWT and must be properly <a href="https://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation">validated</a> by the RP before it can be accepted.</p>

<p>Note that a <a href="https://tools.ietf.org/html/rfc6750">bearer access token</a> is also included. This is to ensure the <a href="https://tools.ietf.org/html/rfc6749#section-4.1.4">token response</a> is compliant with the <a href="https://tools.ietf.org/html/rfc6749">OAuth 2.0</a> spec. For basic OpenID authentication requests where only an ID token is requested this access token is nominal and may be safely ignored. The access token however comes into play when also requesting access to user profile data at the UserInfo endpoint. More on this in the <a href="#claims">next chapter</a>.</p>

<h2 id="toc_8"><a href="#claims">7. Claims (user info)</a></h2>

<p><img src="https://connect2id.com/assets/learn/openid-connect/userinfo.png" alt=""/></p>

<p>OpenID Connect specifies a set of <a href="https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims">standard claims</a>, or user attributes. They are intended to supply the client with consented user details such as email, name and picture, upon request. <a href="https://en.wikipedia.org/wiki/IETF_language_tag">Language tags</a> enable localisation.</p>

<table>
<thead>
<tr>
<th>Scope value</th>
<th>Associated claims</th>
</tr>
</thead>

<tbody>
<tr>
<td>email</td>
<td>email, email_verified</td>
</tr>
<tr>
<td>phone</td>
<td>phone_number, phone_number_verified</td>
</tr>
<tr>
<td>profile</td>
<td>name, family_name, given_name, middle_name, nickname, preferred_username, profile, picture, website, gender, birthdate, zoneinfo, locale, updated_at</td>
</tr>
<tr>
<td>address</td>
<td>address</td>
</tr>
</tbody>
</table>

<p>Clients can request claims in two ways:</p>

<ul>
<li>  An entire claims category by its <code>scope</code> value (see the above table for the scope value to claim mappings)</li>
<li>  Individually, with the optional <a href="https://openid.net/specs/openid-connect-core-1_0.html#ClaimsParameter">claims</a> request parameter.</li>
</ul>

<p>Example request to access the user’s identity (ID token) and email, by simply setting the scope to <code>openid email</code>:</p>

<pre><code>HTTP/1.1 302 Found
Location: https://openid.c2id.com/login?
          response_type=code
          &amp;scope=openid%20email
          &amp;client_id=s6BhdRkqt3
          &amp;state=af0ifjsldkj
          &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
</code></pre>

<p>If you’re an application developer, respect the user’s privacy and keep the requested claims down to the very essential. This will increase your chances of user conversion and will also ensure compliance with recent privacy laws.</p>

<p>Note that even if a user allows an application to access their identity, they may choose to deny release of some claims. The application should be able to handle such decisions gracefully.</p>

<p>The claims format is JSON:</p>

<pre><code>{
   &quot;sub&quot;                     : &quot;alice&quot;,
   &quot;email&quot;                   : &quot;alice@wonderland.net&quot;,
   &quot;email_verified&quot;          : true,
   &quot;name&quot;                    : &quot;Alice Adams&quot;,
   &quot;given_name&quot;              : &quot;Alice&quot;,
   &quot;family_name&quot;             : &quot;Adams&quot;,
   &quot;phone_number&quot;            : &quot;+359 (99) 100200305&quot;,
   &quot;profile&quot;                 : &quot;https://c2id.com/users/alice&quot;,
   &quot;https://c2id.com/groups&quot; : [ &quot;audit&quot;, &quot;admin&quot; ]
 }
</code></pre>

<p>OpenID providers may extend the standard JSON claims schema to include <a href="https://openid.net/specs/openid-connect-core-1_0.html#AdditionalClaims">additional attributes</a>. Enterprises may for instance define claims such as employee role, manager, and department. The names of any additional claims should be prefixed by a URL to create a safe namespace for them and prevent collisions.</p>

<h2 id="toc_9"><a href="#endpoints">8. OpenID Connect provider endpoints</a></h2>

<p><img src="https://connect2id.com/assets/learn/openid-connect/endpoints.png" alt=""/></p>

<p><colgroup><col style="width: 50%"> <col style="width: 50%"></colgroup><br/>
| Core endpoints | Optional endpoints |<br/>
| </p>

<ul>
<li>  <a href="#authz-endpoint">Authorisation</a></li>
<li>  <a href="#token-endpoint">Token</a></li>
<li><p><a href="#userinfo-endpoint">UserInfo</a></p>

<p>| </p></li>
<li><p><a href="#optional-endpoints">WebFinger</a></p></li>
<li><p><a href="#optional-endpoints">Provider metadata</a></p></li>
<li><p><a href="#optional-endpoints">Provider JWK set</a></p></li>
<li><p><a href="#optional-endpoints">Client registration</a></p></li>
<li><p><a href="#optional-endpoints">Session management</a></p>

<p>|</p></li>
</ul>

<h3 id="toc_10"><a href="#authz-endpoint">8.1 Authorisation endpoint</a></h3>

<p>This is the OP server endpoint where the user is asked to <a href="#auth-methods">authenticate</a> and grant the client access to the user’s identity (ID token) and potentially other requested details, such as email and name (called UserInfo claims).</p>

<p>This is the only standard endpoint where users interact with the OP, via a user agent, which role is typically assumed by a web browser.</p>

<h3 id="toc_11"><a href="#token-endpoint">8.2 Token endpoint</a></h3>

<p>The token endpoint lets the client appf exchange the code received from the <a href="#authz-endpoint">authorisation endpoint</a> for an ID token and access token. If the client is confidential it will be required to authenticate at the token endpoint.</p>

<p>The token endpoint it may also accept other OAuth 2.0 <a href="https://tools.ietf.org/html/rfc6749#section-1.3">grant types</a> to issue tokens, for example:</p>

<ul>
<li>  <a href="https://tools.ietf.org/html/rfc7523">JWT assertion</a></li>
<li>  <a href="https://tools.ietf.org/html/rfc7522">SAML 2.0 assertion</a></li>
</ul>

<h3 id="toc_12"><a href="#userinfo-endpoint">8.3 UserInfo endpoint</a></h3>

<p>The <a href="https://openid.net/specs/openid-connect-core-1_0.html#UserInfo">UserInfo endpoint</a> returns previously consented user profile information to the client. A valid access token is required for that.</p>

<pre><code>GET /userinfo HTTP/1.1
Host: openid.c2id.com
Authorization: Bearer SlAV32hkKG
</code></pre>

<p>The UserInfo is JSON encoded and may optionally be packaged as a JWT that is signed or encrypted.</p>

<pre><code>HTTP/1.1 200 OK
Content-Type: application/json

{
  &quot;sub&quot;                     : &quot;alice&quot;,
  &quot;email&quot;                   : &quot;alice@wonderland.net&quot;,
  &quot;email_verified&quot;          : true,
  &quot;name&quot;                    : &quot;Alice Adams&quot;,
  &quot;picture&quot;                 : &quot;https://c2id.com/users/alice.jpg&quot;
}
</code></pre>

<h3 id="toc_13"><a href="#optional-endpoints">8.4 Optional endpoints</a></h3>

<p>OpenID Connect providers can have these additional endpoints:</p>

<ul>
<li><p><strong><a href="https://openid.net/specs/openid-connect-discovery-1_0.html#IssuerDiscovery">WebFinger</a></strong> — Enables dynamic discovery of the OpenID Connect provider for a given user, based on their email address or some other detail.</p></li>
<li><p><strong><a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata">Provider metadata</a></strong> — JSON document listing the OP endpoint URLs and the OpenID Connect / OAuth 2.0 features it supports. Clients can use this information to configure their requests to the OP.</p></li>
<li><p><strong>Provider JWK set</strong> — JSON document containing the provider’s public keys (typically RSA) in JSON Web Key (JWK) format. These keys are used to secure the issued ID tokens and other artifacts.</p></li>
<li><p><strong><a href="https://openid.net/specs/openid-connect-registration-1_0.html">Client registration</a></strong> — RESTful web API for registering client apps with the OP. Registration may be protected (require pre-authorisation) or open (public).</p></li>
<li><p><strong><a href="https://openid.net/specs/openid-connect-session-1_0.html">Session management</a></strong> — Enables client apps to check if a logged in user has still an active session with the OpenID Connect provider. Also to facilitate logout.</p></li>
</ul>

<h2 id="toc_14"><a href="#specs">9. Where is the spec?</a></h2>

<p><img src="https://connect2id.com/assets/learn/openid-connect/done.png" alt=""/></p>

<p>The standard was produced by a working group at the <a href="https://openid.net">OpenID foundation</a> and comprises a set of documents which can be explored at <a href="https://openid.net/connect/"></a><a href="https://openid.net/connect/">http://openid.net/connect/</a>.</p>

<h2 id="toc_15"><a href="#faq">10. FAQ</a></h2>

<p><img src="https://connect2id.com/assets/learn/openid-connect/faq.png" alt=""/></p>

<h3 id="toc_16"><a href="#oidc-oauth-relationship">10.1 How is OpenID Connect related to OAuth 2.0?</a></h3>

<p><a href="oauth-2">OAuth 2.0</a> is a framework for obtaining access tokens for protected resources such as web APIs. OpenID Connect utilises the OAuth 2.0 semantics and flows to allow clients (relying parties) to access the user’s identity, encoded in a JSON Web Token (JWT) called ID token. The access token facilitates retrieval of consented profile details (called claims or attributes) from the <a href="#userinfo">UserInfo</a> endpoint of the OpenID provider.</p>

<h3 id="toc_17"><a href="#auth-methods">10.2 How do OpenID providers authenticate users?</a></h3>

<p>OpenID Connect leaves this entirely up to the particular IdP. Implementors may use any method for authenticating users, or combine two methods for stronger security (2FA).</p>

<ul>
<li>  Username / password</li>
<li>  Hardware tokens</li>
<li>  SMS confirmation</li>
<li>  Biometrics</li>
<li>  Etc.</li>
</ul>

<p>The IdP may set the optional <code>acr</code> and <code>amr</code> claims in the <a href="#id-token">ID token</a> to inform the client how the user has been authenticated.</p>

<p>Clients are also have control over authentication:</p>

<ul>
<li><p>The optional <code>prompt=login</code> parameter will cause the user to be (re)authenticated, even if they have a valid session (cookie) with the IdP.</p></li>
<li><p>With IdPs that support various authentication strengths, the application may request stronger authentication using the optional <code>acr_values</code> parameter.</p></li>
</ul>

<h3 id="toc_18"><a href="#bearer-access-token">10.3 What is a bearer access token?</a></h3>

<p>The access token resembles the concept of a physical token or ticket. It gives the holder access to a specific HTTP resource or web service, which is typically limited by scope and has an expiration time.</p>

<p>Bearer access tokens are easy to use - whoever has one is permitted to call the protected resource. For that reason they must always be passed around over a secure channel (TLS / HTTPS) and stored securely.</p>

<p>OpenID Connect employs OAuth 2.0 access tokens to allow client apps to retrieve consented <a href="#claims">user information</a> from the <a href="#userinfo-endpoint">UserInfo endpoint</a>.</p>

<p>An OpenID provider may extend the access token scope to other protected resources and web APIs.</p>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="15376909096951.html" 
          title="Previous Post: Caffeine Cache 进程缓存之王">&laquo; Caffeine Cache 进程缓存之王</a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="15374959996961.html" 
          title="Next Post: New Architecture of OAuth 2.0 and OpenID Connect Implementation">New Architecture of OAuth 2.0 and OpenID Connect Implementation &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5ae58078c0d7b2ab"></script>

          

          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="./asset/img/logo.jpg" /></div>
            
                <h1>Junkman</h1>
                <div class="site-des">“拾荒者”一词来自凯文・凯利的《失控》中关于机器学习的故事（“收集癖好机”如何完成他的收集工作）。</div>
                <div class="social">









<a target="_blank" class="github" target="_blank" href="https://github.com/panlw/" title="GitHub">GitHub</a>

  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="Infra.html"><strong>Infra</strong></a>
        
            <a href="Coding.html"><strong>Coding</strong></a>
        
            <a href="Modeling.html"><strong>Modeling</strong></a>
        
            <a href="Archtecting.html"><strong>Archtecting</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15517999043443.html">The Art of Crafting Architectural Diagrams</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15517997955971.html">为什么说我们需要软件架构图？</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15516128677869.html">DNS Servers That Offer Privacy and Filtering</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15516123108194.html">Airbnb's Migration from Monolith to Services</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15516097487470.html">Events As First-Class Citizens</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>


  </body>
</html>
